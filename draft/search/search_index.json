{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Universal Commerce Protocol","text":"Universal CommerceProtocol <p>         The common language for platforms, agents and businesses.       </p> <p>         UCP defines building blocks for agentic commerce\u2014from discovering and buying to post purchase experiences\u2014allowing the ecosystem to interoperate through one standard, without custom builds.       </p> Learn <p>Protocol overview, core concepts, and design principles</p>          Read the docs        Implement <p>GitHub repo, technical spec, SDKs, and reference implementations</p>          View on GitHub        Co-developed and adopted by industry leaders <p>       UCP was built by the industry, for the industry to solve for fragmented commerce journeys that lead to abandoned carts and frustrated shoppers, and enable agentic commerce.     </p> Google Shopify Etsy Wayfair Target Walmart Built for flexibility, security, and scale <p>       Agentic commerce demands interoperability. UCP is built on industry standards \u2014 REST and JSON-RPC transports;       Agent Payments Protocol (AP2),       Agent2Agent (A2A), and       Model Context Protocol (MCP)       support built-in \u2014 so different systems can work together without custom integration.     </p> Scalable and universal <p>           Surface-agnostic design that can scale to support any commerce entity (from small businesses to enterprise scale) and all modalities (chat, visual commerce, voice, etc).         </p> Businesses at the center <p>           Built to facilitate commerce, ensuring retailers retain control of their business rules and remain the Merchant of Record with full ownership of the customer relationship.         </p> Open and extensible <p>           Open and extensible by design, enabling development of community-driven capabilities and extensions across verticals.         </p> Secure and private <p>           Built on proven security standards for account linking (OAuth 2.0) and secure payment (AP2) via payment mandates and verifiable credentials.         </p> Frictionless payments <p>           Open wallet ecosystem with interoperability between providers to ensure buyers can pay with their preferred payment methods.         </p> See it in action <p>       UCP is designed to facilitate the entire commerce lifecycle, from initial product discovery and search to final sale and post-purchase support.   The protocol's initial launch focuses on three core capabilities: Checkout, Identity Linking, and Order Management.     </p> Checkout Identity Linking Order SEE IT IN ACTION Checkout <p>Support complex cart logic, dynamic pricing, tax calculations, and more across millions of businesses through unified checkout sessions.</p> Learn more <pre><code>{\n  \"ucp\": { ... },\n  \"id\": \"chk_123456789\",\n  \"status\": \"ready_for_complete\",\n  \"currency\": \"USD\",\n  \"buyer\": {\n    \"email\": \"e.beckett@example.com\",\n    \"first_name\": \"Elisa\",\n    \"last_name\": \"Beckett\"\n  },\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Monos Carry-On Pro suitcase\",\n        \"price\": 26550\n      },\n      \"quantity\": 1,\n      ...\n    }\n  ],\n  \"totals\": [ ... ],\n  \"links\": [ ... ],\n  \"payment\": { ... },\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"id\": \"method_1\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"li_1\"],\n        \"selected_destination_id\": \"dest_1\",\n        \"destinations\": [\n          {\n            \"id\": \"dest_1\",\n            \"first_name\": \"Elisa\",\n            \"last_name\": \"Beckett\",\n            \"street_address\": \"1600 Amphitheatre Pkwy\",\n            \"address_locality\": \"Mountain View\",\n            \"address_region\": \"CA\",\n            \"postal_code\": \"94043\",\n            \"address_country\": \"US\"\n          }\n        ],\n        \"groups\": [\n          {\n            \"id\": \"group_1\",\n            \"line_item_ids\": [\"li_1\"],\n            \"selected_option_id\": \"free-shipping\",\n            \"options\": [\n              {\n                \"id\": \"free-shipping\",\n                \"title\": \"Free Shipping\",\n                \"totals\": [ {\"type\": \"total\", \"amount\": 0} ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n</code></pre> SEE IT IN ACTION Identity Linking <p>OAuth 2.0 standard enables agents to maintain secure, authorized relationships without sharing credentials.</p> Learn more <pre><code>Sample of /.well-known/oauth-authorization-server\n\n{\n  \"issuer\": \"https://example.com\",\n  \"authorization_endpoint\": \"https://example.com/oauth2/authorize\",\n  \"token_endpoint\": \"https://example.com/oauth2/token\",\n  \"revocation_endpoint\": \"https://example.com/oauth2/revoke\",\n  \"scopes_supported\": [\n    \"ucp:scopes:checkout_session\",\n  ],\n  \"response_types_supported\": [\n    \"code\"\n  ],\n  \"grant_types_supported\": [\n    \"authorization_code\",\n    \"refresh_token\"\n  ],\n  \"token_endpoint_auth_methods_supported\": [\n    \"client_secret_basic\"\n  ],\n  \"service_documentation\": \"https://example.com/docs/oauth2\"\n}\n</code></pre> SEE IT IN ACTION Order <p>From purchase confirmation to delivery. Real-time webhooks power status updates, shipment tracking, and return processing across every channel.</p> Learn more <pre><code>{\n  \"ucp\": { ... },\n  \"id\": \"order_123456789\",\n  \"checkout_id\": \"chk_123456789\",\n  \"permalink_url\": ...,\n  \"line_items\": [ ... ],\n  \"fulfillment\": {\n    \"expectations\": [\n      {\n        \"id\": \"exp_1\",\n        \"line_items\": [{ \"id\": \"li_1\", \"quantity\": 1 }],\n        \"method_type\": \"shipping\",\n        \"destination\": {\n          \"first_name\": \"Elisa\",\n          \"last_name\": \"Beckett\",\n          \"street_address\": \"1600 Amphitheatre Pkwy\",\n          \"address_locality\": \"Mountain View\",\n          \"address_region\": \"CA\",\n          \"postal_code\": \"94043\",\n          \"address_country\": \"US\"\n        },\n        \"description\": \"Arrives in 2-3 business days\",\n        \"fulfillable_on\": \"now\"\n      }\n      ...\n    ],\n    \"events\": [\n      {\n        \"id\": \"evt_1\",\n        \"occurred_at\": \"2026-01-11T10:30:00Z\",\n        \"type\": \"delivered\",\n        \"line_items\": [{ \"id\": \"li_1\", \"quantity\": 1 }],\n        \"tracking_number\": \"123456789\",\n        \"tracking_url\": \"https://fedex.com/track/123456789\",\n        \"description\": \"Delivered to front door\"\n      }\n    ]\n  },\n  \"adjustments\": [\n    {\n      \"id\": \"adj_1\",\n      \"type\": \"refund\",\n      \"occurred_at\": \"2026-01-12T14:30:00Z\",\n      \"status\": \"completed\",\n      \"line_items\": [{ \"id\": \"li_1\", \"quantity\": 1 }],\n      \"amount\": 26550,\n      \"description\": \"Defective item\"\n    }\n  ],\n  \"totals\": [ ... ]\n}\n</code></pre> Power native checkout <p>         Integrate and negotiate directly with a seller's checkout API to power native UI and workflows for your platform.       </p> See how it works Embed business checkout <p>         Embed and render business checkout UI to support complex checkout flows, with advanced capabilities like bidirectional communication, and payment and shipping address delegation.       </p> Learn more Designed for the entire commerce ecosystem For Developers <p>           Build the future of commerce on an open foundation. Join our community in evolving an open-source standard designed for the next generation of digital commerce.         </p> View the technical spec For Businesses <p>           UCP empowers retailers to meet customers wherever they are\u2014AI assistants, shopping agents, embedded experiences\u2014without rebuilding your checkout for each. You remain the Merchant of Record and your business logic stays intact.         </p> Integrate with UCP For AI Platforms <p>           Simplify business onboarding with standardized APIs and provide your audience with an integrated shopping experience. Compatible with MCP, A2A, and existing agent frameworks.         </p> Learn more about UCP core concepts For Payment Providers <p>           Universal payments that are provable\u2014every authorization backed by cryptographic proof of user consent. Open, modular payment handler design enables open interoperability and choice of payment methods.         </p> Learn more about UCP and AP2 Endorsed across the ecosystem Adyen Amex Ant International Best Buy Carrefour Chewy Commerce Flipkart Gap Kroger Lowe's Macy's Mastercard Paypal Salesforce Sephora Shopee Stripe The Home Depot Ulta Visa Worldpay Zalando Adyen Amex Ant International Best Buy Carrefour Chewy Commerce Flipkart Gap Kroger Lowe's Macy's Mastercard Paypal Salesforce Sephora Shopee Stripe The Home Depot Ulta Visa Worldpay Zalando Get started today <p>         UCP is an open standard designed to let AI agents, apps, businesses, and payment providers interact seamlessly without needing custom, one-off integrations for every connection. We actively seek your feedback and contributions to help build the future of commerce.       </p> <p>         The complete technical specification, documentation, and reference implementations are hosted in our public GitHub repository.       </p> Download <p>Download and run our code samples</p> Experiment <p>Experiment with the protocol and its different agent roles</p> Contribute <p>Contribute your feedback and code to the public repository</p>          Visit the GitHub repository"},{"location":"playground/","title":"Playground","text":"UCP Playground <p>Walk through a complete UCP checkout flow step-by-step. This interactive     demo runs entirely in the browser, simulating payloads and validating     against real UCP schemas at each stage.</p> 1. Platform Profile <p>Select the capability profile for the Platform. This determines which extensions (e.g., fulfillment, discounts) are negotiated.</p> Configuration            Platform Type            Standard (Core Only) Advanced (All Extensions) <p>           Supports basic checkout and order retrieval.         </p> Capabilities Copy Continue \u2192 2. Discovery <p>The Platform fetches <code>/.well-known/ucp</code>. The response below is filtered to show the intersection of the Business's capabilities and the Platform's profile.</p> GET Request <pre>GET /.well-known/ucp HTTP/1.1\nHost: business.example.com\nAccept: application/json</pre> Response (Filtered) <pre></pre> \u2190 Back Continue \u2192 3. Capability Negotiation <p>Intersection of Platform and Business capabilities. Orphaned extensions are pruned.</p> Business Capabilities <pre></pre> Resulting Intersection <pre></pre> \u2190 Back Continue \u2192 4. Create Checkout <p>The Platform initiates a session. The error response below follows the strict <code>message.json</code> schema.</p> Request Payload <pre></pre> Response <pre></pre> Simulation Scenario: Missing Buyer Email Missing Shipping Destination Run Request \u2190 Back Next Step \u2192 5. Update Checkout <p>Patch the checkout with missing information to resolve validation errors.</p> PATCH Request Run Update <pre></pre> Response <pre></pre> \u2190 Back Next Step \u2192 6. Mint Instrument <p>Simulate the payment handler flow to acquire a payment credential.</p> Select Handler Shop Pay com.shopify.shop_pay Google Pay com.google.pay Mint Credential Minted Instrument <pre></pre> \u2190 Back Next Step \u2192 7. Complete Checkout <p>Submit the minted instrument to finalize the transaction and create an order.</p> Request Finalize <pre></pre> Response (Order Created) <pre></pre> Success! Order ID:  created.      \u2190 Back Next Step \u2192 8. Webhook Simulation <p>Simulate a backend event (e.g., shipping center update) triggering a webhook push to the Agent.</p> Trigger Event <p>This action runs on the Business server and pushes data to the Platform's webhook URL.</p> Simulate \"Shipped\" Event Webhook Payload (POST) Push Notification <pre>// Waiting for event trigger...</pre> \u2190 Back About this demo This playground is a simulation running entirely in your browser. It uses mocked logic to demonstrate the UCP protocol flow and isn't intended as a reference for production code. For real-world implementation examples and best practices, please check out our samples on GitHub."},{"location":"documentation/core-concepts/","title":"Core Concepts","text":""},{"location":"documentation/core-concepts/#core-concepts","title":"Core Concepts","text":"<p>The Universal Commerce Protocol (UCP) is an open standard designed to facilitate communication and interoperability between diverse commerce entities. In a fragmented landscape where consumer surfaces/platforms, businesses, payment providers, and identity providers operate on different systems, UCP provides a standardized common language and functional primitives.</p> <p>This document provides the detailed technical specification for UCP. For a complete definition of all data models and schemas, see the Schema Reference.</p> <p>Its primary goal is to enable:</p> <ul> <li>Consumer Surfaces/Platforms: To discover business capabilities and     facilitate purchases.</li> <li>Businesses: To expose their inventory and retail logic in a standard     way without building custom integrations for every platform.</li> <li>Payment &amp; Credential Providers: To securely exchange tokens and     credentials to facilitate transactions.</li> </ul>"},{"location":"documentation/core-concepts/#high-level-architecture","title":"High level architecture","text":""},{"location":"documentation/core-concepts/#key-goals-of-ucp","title":"Key Goals of UCP","text":"<ul> <li>Interoperability: Bridge the gap between consumer surfaces, businesses,     and payment ecosystems.</li> <li>Discovery: Allow consumer surfaces to dynamically discover what     businesses support (e.g., \"Do they support guest checkout?\", \"Do they have     loyalty programs?\").</li> <li>Security: Facilitate secure, standards-based (OAuth 2.0, PCI-DSS     compliant patterns) exchanges of sensitive user and payment data.</li> <li>Agentic Commerce: Enable AI agents to act on behalf of users to complete     complex tasks like \"Find a headset under $100 and buy it.\"</li> </ul>"},{"location":"documentation/core-concepts/#roles-participants","title":"Roles &amp; Participants","text":"<p>UCP defines the interactions between four primary distinct actors, each playing a specific role in the commerce lifecycle.</p>"},{"location":"documentation/core-concepts/#platform-applicationagent","title":"Platform (Application/Agent)","text":"<p>The platform is the consumer-facing surface (such as an AI agent, mobile app, or social media site) acting on behalf of the User. It orchestrates the commerce journey by discovering businesses and facilitating user intent.</p> <ul> <li>Responsibilities: Discovering businesses capabilities via profiles,     initiating checkout sessions, and presenting the UI or conversational     interface to the user.</li> <li>Examples: AI Shopping Assistants, Super Apps, Search Engines.</li> </ul>"},{"location":"documentation/core-concepts/#business","title":"Business","text":"<p>The entity selling goods or services. In the UCP model, businesses act as the Merchant of Record (MoR), retaining financial liability and ownership of the order.</p> <ul> <li>Responsibilities: Exposing commerce capabilities (inventory, pricing,     tax calculation), fulfilling orders, and processing payments via their     chosen PSP.</li> <li>Examples: Retailers, Airlines, Hotel Chains, Service Providers.</li> </ul>"},{"location":"documentation/core-concepts/#credential-provider-cp","title":"Credential Provider (CP)","text":"<p>A trusted entity responsible for securely managing and sharing sensitive user data, particularly payment instruments and shipping addresses.</p> <ul> <li>Responsibilities: Authenticating the user, issuing payment tokens (to     keep raw card data off the platform), and holding PII securely to minimize     compliance scope for other parties.</li> <li>Examples: Digital Wallets (e.g., Google Wallet, Apple Pay), Identity     Providers.</li> </ul>"},{"location":"documentation/core-concepts/#payment-service-provider-psp","title":"Payment Service Provider (PSP)","text":"<p>The financial infrastructure provider that processes payments on behalf of businesses.</p> <ul> <li>Responsibilities: Authorizing and capturing transactions, handling     settlements, and communicating with card networks. The PSP often interacts     directly with tokens provided by the Credential Provider.</li> <li>Examples: Stripe, Adyen, PayPal, Braintree, Chase Paymentech.</li> </ul>"},{"location":"documentation/core-concepts/#core-concepts-summary","title":"Core Concepts Summary","text":"<p>UCP revolves around three fundamental constructs that define how entities interact.</p> <ul> <li>Capabilities: Standalone core features that a business supports. These     are the \"verbs\" of the protocol.<ul> <li>Examples: Checkout, Identity Linking, Order.</li> </ul> </li> <li>Extensions: Optional capabilities that augment another capability     via the <code>extends</code> field. Extensions appear in <code>ucp.capabilities[]</code>     alongside core capabilities.<ul> <li>Examples: Discounts (extends Checkout), AP2 Mandates (extends     Checkout).</li> </ul> </li> <li>Services: The lower-level communication layers used to exchange data.     UCP is transport-agnostic but defines specific bindings for     interoperability.<ul> <li>Examples: REST API (primary), MCP (Model Context Protocol), A2A     (Agent2Agent).</li> </ul> </li> </ul>"},{"location":"documentation/roadmap/","title":"Roadmap","text":""},{"location":"documentation/roadmap/#roadmap","title":"Roadmap","text":"<p>This roadmap is meant to provide transparency into our strategic priorities and to align our partners on the critical path toward a fully agentic, global commerce standard. Our goal is to move beyond isolated transactions and build a cohesive, intelligent commerce layer that works across borders and verticals.</p> <p>Note: This roadmap reflects our current direction and intends to guide planning, but it does not constitute a commitment to deliver specific features. Our approach to these challenges may evolve, and initiatives are subject to change, removal, or addition as business priorities shift and we receive community feedback.</p>"},{"location":"documentation/roadmap/#upcoming-roadmap-priorities","title":"Upcoming roadmap priorities","text":""},{"location":"documentation/roadmap/#deeper-support-for-the-full-consumer-journey","title":"Deeper support for the full consumer journey","text":"<p>To move beyond isolated transactions, we are expanding the protocol's scope to tackle key user journeys such as multi-item checkout, loyalty, and lifecycle management, while ensuring the business's brand and logic remain central to all shopping experiences. Key upcoming initiatives include:</p> <ul> <li>Product discovery and post-order management: By facilitating the entire     journey, we help businesses maximize lifetime and average order value rather     than just processing a single item for checkout.</li> <li>Cart and basket building: Support for multi-item checkout from a     business, complex basket rules (e.g., promotions, tax, shipping), and varied     fulfillment logic that reflects how people actually shop.</li> <li>Loyalty &amp; Member benefits: Capabilities to enable loyalty and member     benefits to help users find the best value and businesses achieve a deeper     connection with their consumers through account linking.</li> <li>Native cross-sell and upsell modules: Capabilities for businesses to     provide personalized recommendations and upsells based on user context.</li> </ul>"},{"location":"documentation/roadmap/#support-for-global-markets","title":"Support for global markets","text":"<p>We are building a scalable ecosystem that is inclusive of all business sizes and geographies, ensuring that \"simple and open\" means accessible to everyone. We plan to do this through a phased rollout across markets, including India, Indonesia, Latin America, and others. We are adapting the protocol to support broader regional use cases and localized payment interoperability.</p>"},{"location":"documentation/roadmap/#build-with-us","title":"Build with us","text":"<p>The future of commerce cannot be built in a vacuum. We invite businesses, developers, and payment providers to join us in refining these specifications. Your feedback on our early builds helps us shape the standards that will power the next generation of global commerce.</p> <p>Become a UCP contributor</p>"},{"location":"documentation/schema-authoring/","title":"Schema Authoring","text":""},{"location":"documentation/schema-authoring/#schema-authoring-guide","title":"Schema Authoring Guide","text":"<p>This guide documents conventions for authoring UCP JSON schemas: metadata fields, the registry pattern, schema variants, and versioning.</p>"},{"location":"documentation/schema-authoring/#schema-metadata-fields","title":"Schema Metadata Fields","text":"<p>UCP schemas use standard JSON Schema fields plus UCP-specific metadata:</p> Field Standard Purpose Required For <code>$schema</code> JSON Schema Declares JSON Schema draft version (SHOULD use <code>draft/2020-12</code>) All schemas <code>$id</code> JSON Schema Schema's canonical URI for <code>$ref</code> resolution All schemas <code>title</code> JSON Schema Human-readable display name All schemas <code>description</code> JSON Schema Schema purpose and usage All schemas <code>name</code> UCP Reverse-domain identifier; doubles as registry key Capabilities, services, handlers <code>version</code> UCP Entity version (<code>YYYY-MM-DD</code> format) Capabilities, services, payment handlers <code>id</code> UCP Instance identifier for multiple configurations Payment handlers only"},{"location":"documentation/schema-authoring/#why-self-describing","title":"Why Self-Describing?","text":"<p>Capability schemas must be self-describing: when a platform fetches a schema, it should determine exactly what capability and version it represents without cross-referencing other documents. This matters because:</p> <ol> <li> <p>Independent versioning: Capabilities may version independently. The schema    must declare its version explicitly\u2014you can't infer it from the URL.</p> </li> <li> <p>Validation: Validators can cross-check that a capability declaration's    <code>schema</code> URL points to a schema whose embedded <code>name</code>/<code>version</code> match the    declaration. Mismatches are authoring errors caught at build time.</p> </li> <li> <p>Developer experience: When reading a schema file, integrators immediately    see what capability it defines without reverse-engineering the <code>$id</code> URL.</p> </li> <li> <p>Compact namespace: The <code>name</code> field provides a standardized reverse-domain    identifier (e.g., <code>dev.ucp.shopping.checkout</code>) that's more compact and semantic    than the full <code>$id</code> URL.</p> </li> </ol>"},{"location":"documentation/schema-authoring/#why-both-id-and-name","title":"Why Both <code>$id</code> and <code>name</code>?","text":"Field Role Format <code>$id</code> JSON Schema primitive for <code>$ref</code> resolution and tooling URI (required by spec) <code>name</code> Registry key and stable identifier Reverse-domain <p><code>$id</code> must be a valid URI per JSON Schema spec. <code>name</code> is the key used in registries (<code>capabilities</code>, <code>services</code>, <code>payment_handlers</code>) and the wire protocol identifier used in capability negotiation\u2014decoupled from schema hosting so that <code>schema</code> URLs can change as infrastructure evolves.</p> <p>The reverse-domain format provides namespace governance: domain owners control their namespace (<code>dev.ucp.*</code>, <code>com.shopify.*</code>), avoiding collisions between UCP and vendor entities. This stable identity layer allows trust and resolution mechanisms to evolve independently\u2014future versions could adopt verifiable credentials, content-addressed schemas, or other verification methods without breaking capability negotiation.</p>"},{"location":"documentation/schema-authoring/#why-version-uses-dates","title":"Why <code>version</code> Uses Dates?","text":"<p>The <code>version</code> field uses date-based versioning (<code>YYYY-MM-DD</code>) to enable:</p> <ul> <li>Capability negotiation: Platforms request specific versions they support</li> <li>Breaking change management: New versions get new dates; old versions remain   valid and resolvable</li> <li>Independent lifecycles: Extensions can release on their own schedule</li> </ul>"},{"location":"documentation/schema-authoring/#schema-categories","title":"Schema Categories","text":"<p>UCP schemas fall into six categories based on their role in the protocol.</p>"},{"location":"documentation/schema-authoring/#capability-schemas","title":"Capability Schemas","text":"<p>Define negotiated capabilities that appear in <code>ucp.capabilities{}</code> registries.</p> <ul> <li>Top-level fields: <code>$schema</code>, <code>$id</code>, <code>title</code>, <code>description</code>, <code>name</code>, <code>version</code></li> <li>Variants: <code>platform_schema</code>, <code>business_schema</code>, <code>response_schema</code></li> </ul> <p>Examples: <code>checkout.json</code>, <code>fulfillment.json</code>, <code>discount.json</code>, <code>order.json</code></p>"},{"location":"documentation/schema-authoring/#service-schemas","title":"Service Schemas","text":"<p>Define transport bindings that appear in <code>ucp.services{}</code> registries. Each transport (REST, MCP, A2A, Embedded) is a separate entry.</p> <ul> <li>Top-level fields: <code>$schema</code>, <code>$id</code>, <code>title</code>, <code>description</code>, <code>name</code>, <code>version</code></li> <li>Variants: <code>platform_schema</code>, <code>business_schema</code></li> <li>Transport requirements:<ul> <li>REST/MCP: <code>endpoint</code>, <code>schema</code> (OpenAPI/OpenRPC URL)</li> <li>A2A: <code>endpoint</code> (Agent Card URL)</li> <li>Embedded: <code>schema</code> (OpenRPC URL)</li> </ul> </li> </ul>"},{"location":"documentation/schema-authoring/#payment-handler-schemas","title":"Payment Handler Schemas","text":"<p>Define payment handler configurations in <code>ucp.payment_handlers{}</code> registries.</p> <ul> <li>Top-level fields: <code>$schema</code>, <code>$id</code>, <code>title</code>, <code>description</code>, <code>name</code>, <code>version</code></li> <li>Variants: <code>platform_schema</code>, <code>business_schema</code>, <code>response_schema</code></li> <li>Instance <code>id</code>: Required to distinguish multiple configurations of the same handler</li> </ul> <p>Examples: <code>com.google.pay</code>, <code>dev.shopify.shop_pay</code>, <code>dev.ucp.processor_tokenizer</code></p> <p>\u2192 See Payment Handler Guide for detailed guidance on handler structure, config/instrument/credential schemas, and the full specification template.</p>"},{"location":"documentation/schema-authoring/#component-schemas","title":"Component Schemas","text":"<p>Data structures embedded within capabilities but not independently negotiated. Do not appear in registries.</p> <ul> <li>Top-level fields: <code>$schema</code>, <code>$id</code>, <code>title</code>, <code>description</code></li> <li>Omit: <code>name</code>, <code>version</code> (not independently versioned)</li> </ul> <p>Examples:</p> <ul> <li><code>schemas/shopping/payment.json</code> \u2014 Payment configuration (part of checkout)</li> </ul>"},{"location":"documentation/schema-authoring/#type-schemas","title":"Type Schemas","text":"<p>Reusable definitions referenced by other schemas. Do not appear in registries.</p> <ul> <li>Top-level fields: <code>$schema</code>, <code>$id</code>, <code>title</code>, <code>description</code></li> <li>Omit: <code>name</code>, <code>version</code></li> </ul> <p>Examples: <code>types/buyer.json</code>, <code>types/line_item.json</code>, <code>types/postal_address.json</code></p>"},{"location":"documentation/schema-authoring/#meta-schemas","title":"Meta Schemas","text":"<p>Define protocol structure rather than entity payloads.</p> <ul> <li>Top-level fields: <code>$schema</code>, <code>$id</code>, <code>title</code>, <code>description</code></li> <li>Omit: <code>name</code>, <code>version</code></li> </ul> <p>Examples: <code>ucp.json</code> (entity base), <code>capability.json</code>, <code>service.json</code>, <code>payment_handler.json</code></p>"},{"location":"documentation/schema-authoring/#the-registry-pattern","title":"The Registry Pattern","text":"<p>UCP organizes capabilities, services, and handlers in registries\u2014objects keyed by <code>name</code> rather than arrays of objects with <code>name</code> fields.</p> <pre><code>{\n  \"capabilities\": {\n    \"dev.ucp.shopping.checkout\": [{\"version\": \"2026-01-11\"}],\n    \"dev.ucp.shopping.fulfillment\": [{\"version\": \"2026-01-11\"}]\n  },\n  \"services\": {\n    \"dev.ucp.shopping\": [\n      {\"version\": \"2026-01-11\", \"transport\": \"rest\"},\n      {\"version\": \"2026-01-11\", \"transport\": \"mcp\"}\n    ]\n  },\n  \"payment_handlers\": {\n    \"com.google.pay\": [{\"id\": \"gpay_1234\", \"version\": \"2026-01-11\"}]\n  }\n}\n</code></pre>"},{"location":"documentation/schema-authoring/#registry-contexts","title":"Registry Contexts","text":"<p>The same registry structure appears in three contexts with different field requirements:</p> Context Location Required Fields Platform Profile Advertised URI <code>version</code>, <code>spec</code>, <code>schema</code> Business Profile <code>/.well-known/ucp</code> <code>version</code>; may add <code>config</code> API Responses Checkout/order payloads <code>version</code> (+ <code>id</code> for handlers)"},{"location":"documentation/schema-authoring/#the-entity-pattern","title":"The Entity Pattern","text":"<p>All capabilities, services, and handlers extend a common <code>entity</code> base schema:</p> Field Type Description <code>version</code> string Entity version (<code>YYYY-MM-DD</code>) \u2014 always required <code>spec</code> URI Human-readable specification <code>schema</code> URI JSON Schema URL <code>id</code> string Instance identifier (handlers only) <code>config</code> object Entity-specific configuration"},{"location":"documentation/schema-authoring/#schema-variants","title":"Schema Variants","text":"<p>Each entity type defines three variants for different contexts:</p> <p><code>platform_schema</code> \u2014 Full declarations for discovery</p> <pre><code>{\n  \"dev.ucp.shopping.fulfillment\": [{\n    \"version\": \"2026-01-11\",\n    \"spec\": \"https://ucp.dev/specification/fulfillment\",\n    \"schema\": \"https://ucp.dev/schemas/shopping/fulfillment.json\",\n    \"config\": {\n      \"supports_multi_group\": true\n    }\n  }]\n}\n</code></pre> <p><code>business_schema</code> \u2014 Business-specific overrides</p> <pre><code>{\n  \"dev.ucp.shopping.fulfillment\": [{\n    \"version\": \"2026-01-11\",\n    \"config\": {\n      \"allows_multi_destination\": {\"shipping\": true}\n    }\n  }]\n}\n</code></pre> <p><code>response_schema</code> \u2014 Minimal references in API responses</p> <pre><code>{\n  \"ucp\": {\n    \"capabilities\": {\n      \"dev.ucp.shopping.fulfillment\": [{\"version\": \"2026-01-11\"}]\n    }\n  }\n}\n</code></pre> <p>Define all three in your schema's <code>$defs</code>:</p> <pre><code>\"$defs\": {\n  \"platform_schema\": {\n    \"allOf\": [{\"$ref\": \"../capability.json#/$defs/platform_schema\"}]\n  },\n  \"business_schema\": {\n    \"allOf\": [{\"$ref\": \"../capability.json#/$defs/business_schema\"}]\n  },\n  \"response_schema\": {\n    \"allOf\": [{\"$ref\": \"../capability.json#/$defs/response_schema\"}]\n  }\n}\n</code></pre>"},{"location":"documentation/schema-authoring/#versioning-strategy","title":"Versioning Strategy","text":""},{"location":"documentation/schema-authoring/#ucp-capabilities-devucp","title":"UCP Capabilities (<code>dev.ucp.*</code>)","text":"<p>UCP-authored capabilities version with protocol releases by default. Individual capabilities may version independently when needed.</p>"},{"location":"documentation/schema-authoring/#vendor-capabilities-comvendor","title":"Vendor Capabilities (<code>com.{vendor}.*</code>)","text":"<p>Capabilities outside <code>dev.ucp.*</code> version fully independently:</p> <pre><code>{\n  \"name\": \"com.shopify.loyalty\",\n  \"version\": \"2025-09-01\",\n  \"spec\": \"https://shopify.dev/ucp/loyalty\",\n  \"schema\": \"https://shopify.dev/ucp/schemas/loyalty.json\"\n}\n</code></pre> <p>Vendor schemas follow the same self-describing requirements.</p>"},{"location":"documentation/schema-authoring/#complete-example-capability-schema","title":"Complete Example: Capability Schema","text":"<p>A capability schema defines both payload structure and declaration variants:</p> <pre><code>{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"$id\": \"https://ucp.dev/schemas/shopping/checkout.json\",\n  \"name\": \"dev.ucp.shopping.checkout\",\n  \"version\": \"2026-01-11\",\n  \"title\": \"Checkout\",\n  \"description\": \"Base checkout schema. Extensions compose via allOf.\",\n\n  \"$defs\": {\n    \"platform_schema\": {\n      \"allOf\": [{\"$ref\": \"../capability.json#/$defs/platform_schema\"}]\n    },\n    \"business_schema\": {\n      \"allOf\": [{\"$ref\": \"../capability.json#/$defs/business_schema\"}]\n    },\n    \"response_schema\": {\n      \"allOf\": [{\"$ref\": \"../capability.json#/$defs/response_schema\"}]\n    }\n  },\n\n  \"type\": \"object\",\n  \"required\": [\"ucp\", \"id\", \"line_items\", \"status\", \"currency\", \"totals\", \"links\"],\n  \"properties\": {\n    \"ucp\": {\"$ref\": \"../ucp.json#/$defs/response_checkout_schema\"},\n    \"id\": {\"type\": \"string\", \"description\": \"Checkout identifier\"},\n    \"line_items\": {\"type\": \"array\", \"items\": {\"$ref\": \"types/line_item.json\"}},\n    \"status\": {\"type\": \"string\", \"enum\": [\"open\", \"completed\", \"expired\"]},\n    \"currency\": {\"type\": \"string\", \"pattern\": \"^[A-Z]{3}$\"},\n    \"totals\": {\"$ref\": \"types/totals.json\"},\n    \"links\": {\"$ref\": \"types/links.json\"}\n  }\n}\n</code></pre> <p>Key points:</p> <ul> <li>Top-level <code>name</code> and <code>version</code> make the schema self-describing</li> <li><code>$defs</code> variants enable validation in different contexts</li> <li>Payload properties define the actual checkout response structure</li> </ul>"},{"location":"documentation/ucp-and-ap2/","title":"UCP and AP2","text":""},{"location":"documentation/ucp-and-ap2/#ucp-and-ap2","title":"UCP and AP2","text":"<p>UCP is fully compatible with Agent Payments Protocol (AP2). AP2 serves as the trust layer for agent-led transactions completed on behalf of a user, mandating a secure, verifiable exchange of intents and authorizations between Platforms and businesses. By using Verifiable Digital Credentials (VDCs), AP2 eliminates the need for middleman \"trust referees.\" It allows businesses to receive signed checkout commitments\u2014ensuring the price and terms don't change mid-flow\u2014and allows Platforms to provide cryptographically signed payment authorizations that are mathematically tied to the specific state of the cart.</p>"},{"location":"documentation/ucp-and-ap2/#key-benefits","title":"Key benefits","text":"<ul> <li>Binding proof: Both parties have cryptographic evidence of exactly what     was offered and what was agreed upon, ensuring the transaction is final and     authentic.</li> <li>Fraud reduction: Payment mandates are scoped specifically to a checkout     hash, preventing \"token replay\" or amount manipulation.</li> <li>Agentic readiness: Allows autonomous AI agents to transact on behalf of     users with pre-defined, verifiable boundaries.</li> </ul>"},{"location":"documentation/ucp-and-ap2/#protocol-flow","title":"Protocol flow","text":"<ol> <li>Discovery: The business publishes their discovery document, declaring     support for the AP2 extension.</li> <li>Session Activation: When creating or updating a checkout session, the     Platform signals the activation of AP2.</li> <li>Signing (business): The business responds with a <code>checkoutSignature</code> (a     detached JWT signing the checkout state) and lists supported verifiable     presentation formats (e.g., <code>sd-jwt</code>).</li> <li>Authorization: Upon user consent, the Platform generates two     credentials:<ul> <li>CheckoutMandate: Contains the hash of the <code>CheckoutObject</code>.</li> <li>PaymentMandate: An SD-JWT-VC containing the payment authorization.</li> </ul> </li> <li>Completion: The Platform submits both mandates to the business\u2019     <code>/complete</code> endpoint.</li> <li>Verification:<ul> <li>The business verifies the <code>CheckoutMandate</code>.</li> <li>The Payment Processor verifies the <code>PaymentMandate</code>.</li> </ul> </li> <li>Confirmation: If valid, the payment is processed, and the order is     confirmed.</li> </ol> <p>Dependencies: Checkout capability</p> <p>See here for full AP2 mandates extension</p> <p>Learn more about AP2</p>"},{"location":"specification/ap2-mandates/","title":"AP2 Mandates Extension","text":""},{"location":"specification/ap2-mandates/#ap2-mandates-extension","title":"AP2 Mandates Extension","text":""},{"location":"specification/ap2-mandates/#overview","title":"Overview","text":"<p>The AP2 Mandates extension enables the secure exchange of user intents and authorizations using Verifiable Digital Credentials. It extends the standard Shopping Service Checkout capability to support the AP2 Protocol.</p> <p>When this capability is negotiated and active, it transforms a standard checkout session into a cryptographically bound agreement:</p> <ul> <li>Businesses MUST embed a cryptographic signature in checkout     responses, proving the terms (price, line items) are authentic.</li> <li>Platforms MUST provide cryptographically signed proofs (Mandates)     during the <code>complete</code> operation, proving the user explicitly authorized the     specific checkout state and funds transfer.</li> </ul> <p>Security Binding: Once this extension is negotiated in the capability intersection, the session is Security Locked. Neither party may revert to a standard (unprotected) checkout flow.</p> <p></p>"},{"location":"specification/ap2-mandates/#design","title":"Design","text":"<p>All AP2-specific fields are nested under an <code>ap2</code> object in both requests and responses. This design provides:</p> <ul> <li>Schema modularity \u2014 Base checkout schema stays clean; AP2 adds one     field containing all its data.</li> <li>Consistent canonicalization \u2014 One rule: exclude <code>ap2</code> from the business's     signature computation. Future AP2 fields are automatically handled.</li> <li>Extension coexistence \u2014 Multiple security extensions can coexist     without namespace collisions.</li> <li>Capability signal \u2014 Presence of <code>ap2</code> object clearly indicates AP2     is active.</li> </ul>"},{"location":"specification/ap2-mandates/#discovery-negotiation","title":"Discovery &amp; Negotiation","text":"<p>This extension follows the standard UCP negotiation protocol. It is activated only when it appears in the Capability Intersection of both the business and the platform.</p>"},{"location":"specification/ap2-mandates/#business-profile-advertisement","title":"Business Profile Advertisement","text":"<p>Businesses declare support by adding <code>dev.ucp.shopping.ap2_mandate</code> to their <code>capabilities</code> list in <code>/.well-known/ucp</code>.</p> <p>Business Profile Example:</p> <pre><code>{\n  \"capabilities\": {\n    \"dev.ucp.shopping.checkout\": [\n      {\n        \"version\": \"2026-01-11\",\n        \"spec\": \"https://ucp.dev/specification/checkout\",\n        \"schema\": \"https://ucp.dev/schemas/shopping/checkout.json\"\n      }\n    ],\n    \"dev.ucp.shopping.ap2_mandate\": [\n      {\n        \"version\": \"2026-01-11\",\n        \"spec\": \"https://ucp.dev/specification/ap2-mandates\",\n        \"schema\": \"https://ucp.dev/schemas/shopping/ap2_mandate.json\",\n        \"extends\": \"dev.ucp.shopping.checkout\",\n        \"config\": {\n          \"vp_formats_supported\": {\n            \"dc+sd-jwt\": { }\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/ap2-mandates/#platform-profile-advertisement","title":"Platform Profile Advertisement","text":"<p>Platforms declare support in their profile. If the platform is operating under the trusted platform provider model, the platform MUST provide at least one key in the top-level <code>signing_keys</code> array in their profile.</p>"},{"location":"specification/ap2-mandates/#activation-and-session-locking","title":"Activation and Session Locking","text":"<ol> <li>The platform advertises its profile URI (transport-specific mechanism).</li> <li>The business fetches the profile and computes the intersection.</li> <li>If <code>dev.ucp.shopping.ap2_mandate</code> is present in the intersection:<ul> <li>The business MUST include <code>ap2.merchant_authorization</code> in all     checkout responses.</li> <li>The business MUST NOT accept a <code>complete_checkout</code> request that     lacks <code>ap2.checkout_mandate</code>.</li> <li>The platform MUST verify the business's signature before presenting     the checkout to the user.</li> </ul> </li> </ol>"},{"location":"specification/ap2-mandates/#signing-key-requirements","title":"Signing Key Requirements","text":"<p>To utilize this extension, a public signing key MUST be available for the business to verify the mandate's signature.</p> <ul> <li>Platform Provider Flow: Key provided in the platform profile's <code>signing_keys</code>.</li> <li>User Credential Flow: Key bound to the digital payment credential.</li> </ul> <p>If a public key cannot be resolved, or if the signature is invalid, the business MUST return an error.</p>"},{"location":"specification/ap2-mandates/#cryptographic-requirements","title":"Cryptographic Requirements","text":""},{"location":"specification/ap2-mandates/#signature-algorithm","title":"Signature Algorithm","text":"<p>All signatures MUST use one of the following algorithms:</p> Algorithm Description <code>ES256</code> ECDSA using P-256 curve and SHA-256 (RECOMMENDED) <code>ES384</code> ECDSA using P-384 curve and SHA-384 <code>ES512</code> ECDSA using P-521 curve and SHA-512"},{"location":"specification/ap2-mandates/#business-authorization","title":"Business Authorization","text":"<p>Businesses MUST embed their signature in the checkout response body under <code>ap2.merchant_authorization</code> using JWS Detached Content format (RFC 7515 Appendix F).</p> <p>Checkout Response with Embedded Signature:</p> <pre><code>{\n  \"id\": \"chk_abc123\",\n  \"status\": \"ready_for_complete\",\n  \"currency\": \"USD\",\n  \"line_items\": [...],\n  \"totals\": [...],\n  \"ap2\": {\n    \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6Im1lcmNoYW50XzIwMjUifQ..&lt;signature&gt;\"\n  }\n}\n</code></pre> <p>The <code>merchant_authorization</code> value is a JWS with detached payload in the format <code>&lt;header&gt;..&lt;signature&gt;</code>. The double dot (<code>..</code>) indicates the payload is transmitted separately (as the checkout body itself).</p> <p>JWS Header Claims:</p> Claim Type Required Description <code>alg</code> string Yes Signature algorithm (<code>ES256</code>, <code>ES384</code>, <code>ES512</code>) <code>kid</code> string Yes Key ID referencing the business's <code>signing_keys</code> <p>Signature Computation:</p> <p>The signature MUST cover both the JWS header and the checkout payload. This prevents algorithm substitution attacks where an attacker modifies the <code>alg</code> claim without invalidating the signature.</p> <pre><code>sign_checkout(checkout, private_key, kid, alg=\"ES256\"):\n    // Extract payload (checkout minus ap2)\n    payload = checkout without \"ap2\" field\n\n    // Canonicalize using JCS (RFC 8785)\n    canonical_bytes = jcs_canonicalize(payload)\n\n    // Create protected header\n    header = {\"alg\": alg, \"kid\": kid}\n    encoded_header = base64url_encode(json_encode(header))\n\n    // Sign header + payload per JWS\n    signing_input = encoded_header + \".\" + base64url_encode(canonical_bytes)\n    signature = sign(signing_input, private_key, alg)\n\n    // Return detached JWS (header..signature, no payload)\n    checkout.ap2.merchant_authorization = encoded_header + \"..\" + base64url_encode(signature)\n    return checkout\n</code></pre>"},{"location":"specification/ap2-mandates/#mandate-structure","title":"Mandate Structure","text":"<p>Mandates are SD-JWT credentials with Key Binding (<code>+kb</code>). The platform MUST produce two distinct mandate artifacts:</p> Mandate UCP Placement Purpose checkout_mandate <code>ap2.checkout_mandate</code> Proof bound to checkout terms, protects business payment_mandate <code>payment.instruments[*].credential.token</code> Proof bound to payment authorization, protects funds <p>The checkout mandate MUST contain the full checkout response including the <code>ap2.merchant_authorization</code> field. This creates a nested cryptographic binding where the platform's signature covers the business's signature.</p> <p>Specification Boundary: This extension defines where mandates are placed in UCP requests and responses. The mandate credential structure (claims, selective disclosure, key binding) is defined by the AP2 Protocol Specification.</p>"},{"location":"specification/ap2-mandates/#canonicalization","title":"Canonicalization","text":"<p>For signature computation over JSON payloads, implementations MUST use JSON Canonicalization Scheme (JCS) as defined in RFC 8785.</p> <p>JCS produces a deterministic, byte-for-byte identical representation of JSON data, ensuring signatures can be verified regardless of whitespace, key ordering, or Unicode normalization differences.</p> <p>Canonicalization Rule: When computing the business's signature, exclude the <code>ap2</code> field entirely. This ensures future AP2 fields are automatically handled.</p>"},{"location":"specification/ap2-mandates/#the-mandate-flow","title":"The Mandate Flow","text":"<p>Once the <code>dev.ucp.shopping.ap2_mandate</code> capability is negotiated, the session is locked into the following flow. Both parties MUST follow these steps to ensure cryptographic integrity; any attempt to bypass these steps or submit a completion request without mandates MUST result in a session failure.</p>"},{"location":"specification/ap2-mandates/#step-1-checkout-creation-signing","title":"Step 1: Checkout Creation &amp; Signing","text":"<p>The platform initiates the session. The business returns the <code>Checkout</code> object with <code>ap2.merchant_authorization</code> embedded in the response body.</p> <p>Error: Definition '#/$defs/checkout' not found in 'source/schemas/shopping/ap2_mandate.json'</p> <p>Example Response:</p> <pre><code>{\n  \"id\": \"chk_abc123\",\n  \"status\": \"ready_for_complete\",\n  \"currency\": \"USD\",\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\"id\": \"item_123\", \"title\": \"Widget\", \"price\": 2500},\n      \"quantity\": 2,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 5000},\n        {\"type\": \"total\", \"amount\": 5000}\n      ]\n    }\n  ],\n  \"totals\": [\n    {\"type\": \"subtotal\", \"amount\": 5000},\n    {\"type\": \"tax\", \"amount\": 400},\n    {\"type\": \"total\", \"amount\": 5400}\n  ],\n  \"ap2\": {\n    \"merchant_authorization\": \"eyJhbGciOiJFUzI1NiIsImtpZCI6Im1lcmNoYW50XzIwMjUifQ..&lt;signature&gt;\"\n  }\n}\n</code></pre> <p>The platform MUST verify the signature:</p> <pre><code>verify_merchant_authorization(checkout, merchant_profile):\n    // Parse detached JWS (header..signature)\n    jws = checkout.ap2.merchant_authorization\n    [encoded_header, empty, encoded_signature] = jws.split(\".\")\n\n    // Decode and validate header\n    header = json_decode(base64url_decode(encoded_header))\n    assert header.alg in [\"ES256\", \"ES384\", \"ES512\"]\n\n    // Reconstruct signed payload (checkout minus ap2)\n    payload = checkout without \"ap2\" field\n    canonical_bytes = jcs_canonicalize(payload)\n\n    // Reconstruct signing input (header + payload)\n    signing_input = encoded_header + \".\" + base64url_encode(canonical_bytes)\n\n    // Get business's public key and verify\n    public_key = get_key_by_kid(merchant_profile.signing_keys, header.kid)\n    return verify(encoded_signature, signing_input, public_key, header.alg)\n</code></pre>"},{"location":"specification/ap2-mandates/#step-2-user-consent-mandate-generation","title":"Step 2: User Consent &amp; Mandate Generation","text":"<p>When the user confirms the purchase, the platform MUST facilitate the generation of cryptographically verifiable mandates.</p>"},{"location":"specification/ap2-mandates/#option-1-trusted-platform-provider","title":"Option 1: Trusted Platform Provider","text":"<p>A trusted platform provider acts on the user's behalf to generate the mandate credentials. The platform provider MUST ensure that mandates are not created without explicit user consent from trusted, deterministic channels.</p> <p>Upon user consent, the platform signs the mandates using their server-side key. The business trusts the platform's signature implies user consent.</p>"},{"location":"specification/ap2-mandates/#option-2-digital-payment-credential","title":"Option 2: Digital Payment Credential","text":"<p>In this model the user has a VDC issued from a source trusted by the business (for example: a digital payment credential issued by a bank or network).</p> <p>The platform requests a presentation via a protocol like OpenID4VP. The User's Wallet (or equivalent) processes the request and signs the mandates using the private key associated with their payment credential.</p> <p>The business trusts the Credential Issuer (Bank) and verifies the user's Key Binding (+kb) signature.</p>"},{"location":"specification/ap2-mandates/#step-3-submission-complete_checkout","title":"Step 3: Submission (<code>complete_checkout</code>)","text":"<p>Once the mandates are generated, the platform submits them in the completion request:</p> Name Type Required Description checkout_mandate Checkout Mandate No SD-JWT+kb proving user authorized this checkout. <pre><code>{\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"instr_1\",\n        \"handler_id\": \"gpay_1234\",\n        \"type\": \"card\",\n        \"selected\": true,\n        \"display\": {\n          \"description\": \"Visa\u2006\u2022\u2022\u2022\u2022\u20061234\",\n        },\n        \"billing_address\": {\n          \"street_address\": \"123 Main St\",\n          \"address_locality\": \"Anytown\",\n          \"address_region\": \"CA\",\n          \"address_country\": \"US\",\n          \"postal_code\": \"12345\"\n        },\n        \"credential\": {\n          \"type\": \"PAYMENT_GATEWAY\",\n          \"token\": \"examplePaymentMethodToken\"\n        }\n      }\n    ]\n  },\n  \"ap2\": {\n    \"checkout_mandate\": \"eyJhbGciOiJFUzI1NiIsInR5cCI6InZjK3NkLWp3dCJ9...\" // The User-Signed SD-JWT+kb / platform provider signed SD-JWT / delegated SD-JWT-KB\n  }\n}\n</code></pre> <ul> <li><code>ap2.checkout_mandate</code>: The SD-JWT+kb checkout mandate containing the     full checkout (with <code>ap2.merchant_authorization</code>)</li> <li><code>payment.instruments[*].credential.token</code>: Contains the payment mandate (composite token)</li> </ul>"},{"location":"specification/ap2-mandates/#verification-processing","title":"Verification &amp; Processing","text":""},{"location":"specification/ap2-mandates/#business-verification","title":"Business Verification","text":"<p>Upon receiving the <code>complete</code> request, the business MUST:</p> <ol> <li>Enforce Negotiation: If AP2 was negotiated, reject the request with     <code>mandate_required</code> error code if <code>ap2.checkout_mandate</code> is missing.</li> </ol> <p>Mandate Verification (per AP2 spec):</p> <ol> <li>Verify Mandate: Decode and verify the SD-JWT signature, key binding,     and expiration per the     AP2 Protocol Specification.</li> <li>Extract Embedded Checkout: Extract the checkout object from the     verified mandate claims.</li> </ol> <p>UCP Verification:</p> <ol> <li> <p>Verify Business Authorization: Confirm <code>ap2.merchant_authorization</code>     in the embedded checkout is the business's own valid signature:</p> <pre><code>jws = embedded_checkout.ap2.merchant_authorization\n[encoded_header, _, encoded_signature] = jws.split(\".\")\nheader = json_decode(base64url_decode(encoded_header))\n\npayload = embedded_checkout without \"ap2\" field\nsigning_input = encoded_header + \".\" + base64url_encode(jcs_canonicalize(payload))\n\nmy_key = get_key_by_kid(my_signing_keys, header.kid)\nverify(encoded_signature, signing_input, my_key, header.alg)\n</code></pre> </li> <li> <p>Verify Terms Match: Confirm the embedded checkout terms match the     current session state (id, totals, line items).</p> </li> </ol>"},{"location":"specification/ap2-mandates/#psp-verification","title":"PSP Verification","text":"<p>The business passes the <code>token</code> (composite object) to their Payment Handler / PSP. The PSP verifies the <code>payment_mandate</code> per the AP2 Protocol Specification, including signature validation, expiration, and correlation with the checkout.</p>"},{"location":"specification/ap2-mandates/#schema","title":"Schema","text":""},{"location":"specification/ap2-mandates/#business-authorization_1","title":"Business Authorization","text":"<p>JWS Detached Content signature (RFC 7515 Appendix F) over the checkout response body (excluding ap2 field). Format: <code>&lt;base64url-header&gt;..&lt;base64url-signature&gt;</code>. The header MUST contain 'alg' (ES256/ES384/ES512) and 'kid' claims. The signature covers both the header and JCS-canonicalized checkout payload.</p> <p>Pattern: <code>^[A-Za-z0-9_-]+\\.\\.[A-Za-z0-9_-]+$</code></p>"},{"location":"specification/ap2-mandates/#ap2-checkout-response","title":"AP2 Checkout Response","text":"<p>The <code>ap2</code> object included in checkout responses.</p> Name Type Required Description merchant_authorization Merchant Authorization No Merchant's signature proving checkout terms are authentic."},{"location":"specification/ap2-mandates/#checkout-mandate","title":"Checkout Mandate","text":"<p>SD-JWT+kb credential in <code>ap2.checkout_mandate</code>. Proving user authorization for the checkout. Contains the full checkout including <code>ap2.merchant_authorization</code>.</p> <p>Pattern: <code>^[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]*\\.[A-Za-z0-9_-]+(~[A-Za-z0-9_-]+)*$</code></p>"},{"location":"specification/ap2-mandates/#ap2-complete-request","title":"AP2 Complete Request","text":"<p>The <code>ap2</code> object included in COMPLETE checkout requests.</p> Name Type Required Description checkout_mandate Checkout Mandate No SD-JWT+kb proving user authorized this checkout."},{"location":"specification/ap2-mandates/#error-codes","title":"Error Codes","text":"<p>Error codes specific to AP2 mandate verification.</p> <p>Enum: <code>mandate_required</code>, <code>agent_missing_key</code>, <code>mandate_invalid_signature</code>, <code>mandate_expired</code>, <code>mandate_scope_mismatch</code>, <code>merchant_authorization_invalid</code>, <code>merchant_authorization_missing</code></p> Error Code Description <code>mandate_required</code> AP2 was negotiated, but the request lacks <code>ap2.checkout_mandate</code>. <code>agent_missing_key</code> Platform profile lacks a valid <code>signing_keys</code> entry. <code>mandate_invalid_signature</code> The mandate signature cannot be verified. <code>mandate_expired</code> The mandate <code>exp</code> timestamp has passed. <code>mandate_scope_mismatch</code> The mandate is bound to a different checkout. <code>merchant_authorization_invalid</code> The business authorization signature could not be verified."},{"location":"specification/buyer-consent/","title":"Buyer Consent Extension","text":""},{"location":"specification/buyer-consent/#buyer-consent-extension","title":"Buyer Consent Extension","text":""},{"location":"specification/buyer-consent/#overview","title":"Overview","text":"<p>The Buyer Consent extension enables platforms to transmit buyer consent choices to businesses regarding data usage and communication preferences. It allows buyers to communicate their consent status for various categories, such as analytics, marketing, and data sales, helping businesses comply with privacy regulations like CCPA and GDPR.</p> <p>When this extension is supported, the <code>buyer</code> object in checkout is extended with a <code>consent</code> field containing boolean consent states.</p> <p>This extension can be included in <code>create_checkout</code> and <code>update_checkout</code> operations.</p>"},{"location":"specification/buyer-consent/#discovery","title":"Discovery","text":"<p>Businesses advertise consent support in their profile:</p> <pre><code>{\n  \"capabilities\": {\n    \"dev.ucp.shopping.buyer_consent\": [\n      {\n        \"version\": \"2026-01-11\",\n        \"extends\": \"dev.ucp.shopping.checkout\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/buyer-consent/#schema-composition","title":"Schema Composition","text":"<p>The consent extension extends the buyer object within checkout:</p> <ul> <li>Base schema extended: <code>checkout</code> via <code>buyer</code> object</li> <li>Path: <code>checkout.buyer.consent</code></li> <li>Schema reference: <code>buyer_consent.json</code></li> </ul>"},{"location":"specification/buyer-consent/#schema-definition","title":"Schema Definition","text":""},{"location":"specification/buyer-consent/#consent-object","title":"Consent Object","text":"<p>Error: Schema file 'buyer_consent_resp.json' not found in any schema directory.</p>"},{"location":"specification/buyer-consent/#usage","title":"Usage","text":"<p>The platform includes consent within the <code>buyer</code> object in checkout operations:</p>"},{"location":"specification/buyer-consent/#example-create-checkout-with-consent","title":"Example: Create Checkout with Consent","text":"<pre><code>POST /checkouts\n\n{\n  \"line_items\": [\n    {\n      \"item\": {\n        \"id\": \"prod_123\",\n        \"title\": \"Blue T-Shirt\",\n        \"price\": 1999\n      },\n      \"id\": \"li_1\",\n      \"quantity\": 1\n    }\n  ],\n  \"buyer\": {\n    \"email\": \"jane.doe@example.com\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Doe\",\n    \"consent\": {\n      \"analytics\": true,\n      \"preferences\": true,\n      \"marketing\": false,\n      \"sale_of_data\": false\n    }\n  }\n}\n</code></pre>"},{"location":"specification/buyer-consent/#example-checkout-response-with-consent","title":"Example: Checkout Response with Consent","text":"<pre><code>{\n  \"id\": \"checkout_456\",\n  \"status\": \"ready_for_payment\",\n  \"currency\": \"USD\",\n  \"buyer\": {\n    \"email\": \"jane.doe@example.com\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Doe\",\n    \"consent\": {\n      \"analytics\": true,\n      \"preferences\": true,\n      \"marketing\": false,\n      \"sale_of_data\": false\n    }\n  },\n  \"line_items\": [...],\n  \"totals\": [...],\n  \"links\": [\n    {\n      \"type\": \"privacy_policy\",\n      \"url\": \"https://example.com/privacy\"\n    }\n  ]\n}\n</code></pre>"},{"location":"specification/buyer-consent/#security-privacy-considerations","title":"Security &amp; Privacy Considerations","text":"<ol> <li>Consent is declarative - The protocol communicates consent, it does not enforce it</li> <li>Legal compliance remains the business's responsibility</li> <li>Platforms should not assume consent without explicit user action</li> <li>Default behavior when consent is not provided is business-specific</li> </ol>"},{"location":"specification/cart-mcp/","title":"MCP Binding","text":""},{"location":"specification/cart-mcp/#cart-capability-mcp-binding","title":"Cart Capability - MCP Binding","text":"<p>This document specifies the Model Context Protocol (MCP) binding for the Cart Capability.</p>"},{"location":"specification/cart-mcp/#protocol-fundamentals","title":"Protocol Fundamentals","text":""},{"location":"specification/cart-mcp/#discovery","title":"Discovery","text":"<p>Businesses advertise MCP transport availability through their UCP profile at <code>/.well-known/ucp</code>.</p> <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-15\",\n    \"services\": {\n      \"dev.ucp.shopping\": {\n        \"version\": \"2026-01-15\",\n        \"spec\": \"https://ucp.dev/specification/overview\",\n        \"mcp\": {\n          \"schema\": \"https://ucp.dev/services/shopping/mcp.openrpc.json\",\n          \"endpoint\": \"https://business.example.com/ucp/mcp\"\n        }\n      }\n    },\n    \"capabilities\": [\n      {\n        \"name\": \"dev.ucp.shopping.checkout\",\n        \"version\": \"2026-01-11\",\n        \"spec\": \"https://ucp.dev/specification/checkout\",\n        \"schema\": \"https://ucp.dev/schemas/shopping/checkout.json\"\n      },\n      {\n        \"name\": \"dev.ucp.shopping.cart\",\n        \"version\": \"2026-01-15\",\n        \"spec\": \"https://ucp.dev/specification/cart\",\n        \"schema\": \"https://ucp.dev/schemas/shopping/cart.json\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/cart-mcp/#platform-profile-advertisement","title":"Platform Profile Advertisement","text":"<p>MCP clients MUST include the UCP platform profile URI with every request. The platform profile is included in the <code>_meta.ucp</code> structure within the request parameters:</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"method\": \"create_cart\",\n  \"params\": {\n    \"_meta\": {\n      \"ucp\": {\n        \"profile\": \"https://platform.example/profiles/v2026-01/shopping-agent.json\"\n      }\n    },\n    \"idempotency_key\": \"...\"\n  }\n}\n</code></pre> <p>The <code>_meta.ucp.profile</code> field MUST be present in every MCP tool invocation to enable version compatibility checking and capability negotiation.</p>"},{"location":"specification/cart-mcp/#tools","title":"Tools","text":"<p>UCP Capabilities map 1:1 to MCP Tools.</p>"},{"location":"specification/cart-mcp/#identifier-pattern","title":"Identifier Pattern","text":"<p>MCP tools separate resource identification from payload data:</p> <ul> <li>Requests: For operations on existing carts (<code>get</code>, <code>update</code>, <code>cancel</code>),     a top-level <code>id</code> parameter identifies the target resource. The <code>cart</code>     object in the request payload MUST NOT contain an <code>id</code> field.</li> <li>Responses: All responses include <code>cart.id</code> as part of the full resource state.</li> <li>Create: The <code>create_cart</code> operation does not require an <code>id</code> in the     request, and the response includes the newly assigned <code>cart.id</code>.</li> </ul> Tool Operation Description <code>create_cart</code> Create Cart Create a cart session. <code>get_cart</code> Get Cart Get a cart session. <code>update_cart</code> Update Cart Update a cart session. <code>cancel_cart</code> Cancel Cart Cancel a cart session."},{"location":"specification/cart-mcp/#create_cart","title":"<code>create_cart</code>","text":"<p>Maps to the Create Cart operation.</p>"},{"location":"specification/cart-mcp/#input-schema","title":"Input Schema","text":"<p>Error: Schema 'cart.create' not found in any schema directory.</p>"},{"location":"specification/cart-mcp/#output-schema","title":"Output Schema","text":"Name Type Required Description ucp UCP Response Cart Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique cart identifier. line_items Array[Line Item Response] Yes Cart line items. Same structure as checkout. Full replacement on update. context Context No Buyer signals for localization (country, region, postal_code). Merchant uses for pricing, availability, currency. Falls back to geo-IP if omitted. buyer Buyer No Optional buyer information for personalized estimates. currency string Yes ISO 4217 currency code. Determined by merchant based on context or geo-IP. totals Array[Total Response] Yes Estimated cost breakdown. May be partial if shipping/tax not yet calculable. messages Array[Message] No Validation messages, warnings, or informational notices. links Array[Link] No Optional merchant links (policies, FAQs). continue_url string No URL for cart handoff and session recovery. Enables sharing and human-in-the-loop flows. expires_at string No Cart expiry timestamp (RFC 3339). Optional."},{"location":"specification/cart-mcp/#example","title":"Example","text":"RequestResponse <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"create_cart\",\n  \"params\": {\n    \"_meta\": {\n      \"ucp\": {\n        \"profile\": \"https://platform.example/profiles/v2026-01/shopping-agent.json\"\n      }\n    },\n    \"idempotency_key\": \"550e8400-e29b-41d4-a716-446655440000\",\n    \"cart\": {\n      \"line_items\": [\n        {\n          \"item\": {\n            \"id\": \"item_123\"\n          },\n          \"quantity\": 2\n        }\n      ],\n      \"context\": {\n        \"address_country\": \"US\",\n        \"address_region\": \"CA\",\n        \"postal_code\": \"94105\"\n      }\n    }\n  },\n  \"id\": 1\n}\n</code></pre> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"ucp\": {\n      \"version\": \"2026-01-15\",\n      \"capabilities\": [\n        {\n          \"name\": \"dev.ucp.shopping.checkout\",\n          \"version\": \"2026-01-11\"\n        },\n        {\n          \"name\": \"dev.ucp.shopping.cart\",\n          \"version\": \"2026-01-15\"\n        }\n      ]\n    },\n    \"id\": \"cart_abc123\",\n    \"line_items\": [\n      {\n        \"id\": \"li_1\",\n        \"item\": {\n          \"id\": \"item_123\",\n          \"title\": \"Red T-Shirt\",\n          \"price\": 2500\n        },\n        \"quantity\": 2,\n        \"totals\": [\n          {\"type\": \"subtotal\", \"amount\": 5000},\n          {\"type\": \"total\", \"amount\": 5000}\n        ]\n      }\n    ],\n    \"currency\": \"USD\",\n    \"totals\": [\n      {\n        \"type\": \"subtotal\",\n        \"amount\": 5000\n      },\n      {\n        \"type\": \"total\",\n        \"amount\": 5000\n      }\n    ],\n    \"continue_url\": \"https://business.example.com/checkout?cart=cart_abc123\",\n    \"expires_at\": \"2026-01-16T12:00:00Z\"\n  }\n}\n</code></pre>"},{"location":"specification/cart-mcp/#get_cart","title":"<code>get_cart</code>","text":"<p>Maps to the Get Cart operation.</p>"},{"location":"specification/cart-mcp/#input-schema_1","title":"Input Schema","text":"<ul> <li><code>id</code> (String, required): The ID of the cart session.</li> </ul>"},{"location":"specification/cart-mcp/#output-schema_1","title":"Output Schema","text":"Name Type Required Description ucp UCP Response Cart Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique cart identifier. line_items Array[Line Item Response] Yes Cart line items. Same structure as checkout. Full replacement on update. context Context No Buyer signals for localization (country, region, postal_code). Merchant uses for pricing, availability, currency. Falls back to geo-IP if omitted. buyer Buyer No Optional buyer information for personalized estimates. currency string Yes ISO 4217 currency code. Determined by merchant based on context or geo-IP. totals Array[Total Response] Yes Estimated cost breakdown. May be partial if shipping/tax not yet calculable. messages Array[Message] No Validation messages, warnings, or informational notices. links Array[Link] No Optional merchant links (policies, FAQs). continue_url string No URL for cart handoff and session recovery. Enables sharing and human-in-the-loop flows. expires_at string No Cart expiry timestamp (RFC 3339). Optional."},{"location":"specification/cart-mcp/#example_1","title":"Example","text":"RequestResponseNot Found <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"get_cart\",\n  \"params\": {\n    \"_meta\": {\n      \"ucp\": {\n        \"profile\": \"https://platform.example/profiles/v2026-01/shopping-agent.json\"\n      }\n    },\n    \"id\": \"cart_abc123\"\n  },\n  \"id\": 1\n}\n</code></pre> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"ucp\": {\n      \"version\": \"2026-01-15\",\n      \"capabilities\": [\n        {\n          \"name\": \"dev.ucp.shopping.checkout\",\n          \"version\": \"2026-01-11\"\n        },\n        {\n          \"name\": \"dev.ucp.shopping.cart\",\n          \"version\": \"2026-01-15\"\n        }\n      ]\n    },\n    \"id\": \"cart_abc123\",\n    \"line_items\": [\n      {\n        \"id\": \"li_1\",\n        \"item\": {\n          \"id\": \"item_123\",\n          \"title\": \"Red T-Shirt\",\n          \"price\": 2500\n        },\n        \"quantity\": 2,\n        \"totals\": [\n          {\"type\": \"subtotal\", \"amount\": 5000},\n          {\"type\": \"total\", \"amount\": 5000}\n        ]\n      }\n    ],\n    \"currency\": \"USD\",\n    \"totals\": [\n      {\n        \"type\": \"subtotal\",\n        \"amount\": 5000\n      },\n      {\n        \"type\": \"total\",\n        \"amount\": 5000\n      }\n    ],\n    \"continue_url\": \"https://business.example.com/checkout?cart=cart_abc123\",\n    \"expires_at\": \"2026-01-16T12:00:00Z\"\n  }\n}\n</code></pre> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"ucp\": {\n      \"version\": \"2026-01-15\",\n      \"capabilities\": [\n        {\n          \"name\": \"dev.ucp.shopping.cart\",\n          \"version\": \"2026-01-15\"\n        }\n      ]\n    },\n    \"messages\": [\n      {\n        \"type\": \"error\",\n        \"code\": \"NOT_FOUND\",\n        \"content\": \"Cart not found or has expired\"\n      }\n    ],\n    \"continue_url\": \"https://merchant.com/\"\n  }\n}\n</code></pre>"},{"location":"specification/cart-mcp/#update_cart","title":"<code>update_cart</code>","text":"<p>Maps to the Update Cart operation.</p>"},{"location":"specification/cart-mcp/#input-schema_2","title":"Input Schema","text":"<ul> <li><code>id</code> (String, required): The ID of the cart session to update.</li> </ul> <p>Error: Schema 'cart.update' not found in any schema directory.</p>"},{"location":"specification/cart-mcp/#output-schema_2","title":"Output Schema","text":"Name Type Required Description ucp UCP Response Cart Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique cart identifier. line_items Array[Line Item Response] Yes Cart line items. Same structure as checkout. Full replacement on update. context Context No Buyer signals for localization (country, region, postal_code). Merchant uses for pricing, availability, currency. Falls back to geo-IP if omitted. buyer Buyer No Optional buyer information for personalized estimates. currency string Yes ISO 4217 currency code. Determined by merchant based on context or geo-IP. totals Array[Total Response] Yes Estimated cost breakdown. May be partial if shipping/tax not yet calculable. messages Array[Message] No Validation messages, warnings, or informational notices. links Array[Link] No Optional merchant links (policies, FAQs). continue_url string No URL for cart handoff and session recovery. Enables sharing and human-in-the-loop flows. expires_at string No Cart expiry timestamp (RFC 3339). Optional."},{"location":"specification/cart-mcp/#example_2","title":"Example","text":"RequestResponse <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"update_cart\",\n  \"params\": {\n    \"_meta\": {\n      \"ucp\": {\n        \"profile\": \"https://platform.example/profiles/v2026-01/shopping-agent.json\"\n      }\n    },\n    \"id\": \"cart_abc123\",\n    \"cart\": {\n      \"line_items\": [\n        {\n          \"item\": {\n            \"id\": \"item_123\"\n          },\n          \"quantity\": 3\n        },\n        {\n          \"item\": {\n            \"id\": \"item_456\"\n          },\n          \"quantity\": 1\n        }\n      ],\n      \"context\": {\n        \"address_country\": \"US\",\n        \"address_region\": \"CA\",\n        \"postal_code\": \"94105\"\n      }\n    }\n  },\n  \"id\": 2\n}\n</code></pre> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 2,\n  \"result\": {\n    \"ucp\": {\n      \"version\": \"2026-01-15\",\n      \"capabilities\": [\n        {\n          \"name\": \"dev.ucp.shopping.checkout\",\n          \"version\": \"2026-01-11\"\n        },\n        {\n          \"name\": \"dev.ucp.shopping.cart\",\n          \"version\": \"2026-01-15\"\n        }\n      ]\n    },\n    \"id\": \"cart_abc123\",\n    \"line_items\": [\n      {\n        \"id\": \"li_1\",\n        \"item\": {\n          \"id\": \"item_123\",\n          \"title\": \"Red T-Shirt\",\n          \"price\": 2500\n        },\n        \"quantity\": 3,\n        \"totals\": [\n          {\"type\": \"subtotal\", \"amount\": 7500},\n          {\"type\": \"total\", \"amount\": 7500}\n        ]\n      },\n      {\n        \"id\": \"li_2\",\n        \"item\": {\n          \"id\": \"item_456\",\n          \"title\": \"Blue Jeans\",\n          \"price\": 7500\n        },\n        \"quantity\": 1,\n        \"totals\": [\n          {\"type\": \"subtotal\", \"amount\": 7500},\n          {\"type\": \"total\", \"amount\": 7500}\n        ]\n      }\n    ],\n    \"currency\": \"USD\",\n    \"totals\": [\n      {\n        \"type\": \"subtotal\",\n        \"amount\": 15000\n      },\n      {\n        \"type\": \"total\",\n        \"amount\": 15000\n      }\n    ],\n    \"continue_url\": \"https://business.example.com/checkout?cart=cart_abc123\",\n    \"expires_at\": \"2026-01-16T12:00:00Z\"\n  }\n}\n</code></pre>"},{"location":"specification/cart-mcp/#cancel_cart","title":"<code>cancel_cart</code>","text":"<p>Maps to the Cancel Cart operation.</p>"},{"location":"specification/cart-mcp/#input-schema_3","title":"Input Schema","text":"<ul> <li><code>id</code> (String, required): The ID of the cart session.</li> <li><code>idempotency_key</code> (String, UUID, required): Unique key for retry safety.</li> </ul>"},{"location":"specification/cart-mcp/#output-schema_3","title":"Output Schema","text":"Name Type Required Description ucp UCP Response Cart Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique cart identifier. line_items Array[Line Item Response] Yes Cart line items. Same structure as checkout. Full replacement on update. context Context No Buyer signals for localization (country, region, postal_code). Merchant uses for pricing, availability, currency. Falls back to geo-IP if omitted. buyer Buyer No Optional buyer information for personalized estimates. currency string Yes ISO 4217 currency code. Determined by merchant based on context or geo-IP. totals Array[Total Response] Yes Estimated cost breakdown. May be partial if shipping/tax not yet calculable. messages Array[Message] No Validation messages, warnings, or informational notices. links Array[Link] No Optional merchant links (policies, FAQs). continue_url string No URL for cart handoff and session recovery. Enables sharing and human-in-the-loop flows. expires_at string No Cart expiry timestamp (RFC 3339). Optional."},{"location":"specification/cart-mcp/#example_3","title":"Example","text":"RequestResponse <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"cancel_cart\",\n  \"params\": {\n    \"_meta\": {\n      \"ucp\": {\n        \"profile\": \"https://platform.example/profiles/v2026-01/shopping-agent.json\"\n      }\n    },\n    \"id\": \"cart_abc123\",\n    \"idempotency_key\": \"660e8400-e29b-41d4-a716-446655440001\"\n  },\n  \"id\": 1\n}\n</code></pre> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"ucp\": {\n      \"version\": \"2026-01-15\",\n      \"capabilities\": [\n        {\n          \"name\": \"dev.ucp.shopping.checkout\",\n          \"version\": \"2026-01-11\"\n        },\n        {\n          \"name\": \"dev.ucp.shopping.cart\",\n          \"version\": \"2026-01-15\"\n        }\n      ]\n    },\n    \"id\": \"cart_abc123\",\n    \"line_items\": [\n      {\n        \"id\": \"li_1\",\n        \"item\": {\n          \"id\": \"item_123\",\n          \"title\": \"Red T-Shirt\",\n          \"price\": 2500\n        },\n        \"quantity\": 2,\n        \"totals\": [\n          {\"type\": \"subtotal\", \"amount\": 5000},\n          {\"type\": \"total\", \"amount\": 5000}\n        ]\n      }\n    ],\n    \"currency\": \"USD\",\n    \"totals\": [\n      {\n        \"type\": \"subtotal\",\n        \"amount\": 5000\n      },\n      {\n        \"type\": \"total\",\n        \"amount\": 5000\n      }\n    ],\n    \"continue_url\": \"https://business.example.com/checkout?cart=cart_abc123\"\n  }\n}\n</code></pre>"},{"location":"specification/cart-mcp/#error-handling","title":"Error Handling","text":"<p>See the Core Specification for negotiation error handling (discovery failures, negotiation failures).</p>"},{"location":"specification/cart-mcp/#business-outcomes","title":"Business Outcomes","text":"<p>Business outcomes (including not found and validation errors) are returned as JSON-RPC <code>result</code> with the UCP envelope and <code>messages</code>:</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"ucp\": {\n      \"version\": \"2026-01-11\",\n      \"capabilities\": {\n        \"dev.ucp.shopping.cart\": [{\"version\": \"2026-01-11\"}]\n      }\n    },\n    \"messages\": [\n      {\n        \"type\": \"error\",\n        \"code\": \"NOT_FOUND\",\n        \"content\": \"Cart not found or has expired\"\n      }\n    ],\n    \"continue_url\": \"https://merchant.com/\"\n  }\n}\n</code></pre>"},{"location":"specification/cart-mcp/#conformance","title":"Conformance","text":"<p>A conforming MCP transport implementation MUST:</p> <ol> <li>Implement JSON-RPC 2.0 protocol correctly.</li> <li>Provide all core cart tools defined in this specification.</li> <li>Return negotiation failures per the     Core Specification.</li> <li>Return business outcomes as JSON-RPC <code>result</code> with UCP envelope and     <code>messages</code> array.</li> <li>Validate tool inputs against UCP schemas.</li> <li>Support HTTP transport with streaming.</li> </ol>"},{"location":"specification/cart-rest/","title":"HTTP/REST Binding","text":""},{"location":"specification/cart-rest/#cart-capability-rest-binding","title":"Cart Capability - REST Binding","text":"<p>This document specifies the REST binding for the Cart Capability.</p>"},{"location":"specification/cart-rest/#protocol-fundamentals","title":"Protocol Fundamentals","text":""},{"location":"specification/cart-rest/#discovery","title":"Discovery","text":"<p>Businesses advertise REST transport availability through their UCP profile at <code>/.well-known/ucp</code>.</p> <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-15\",\n    \"services\": {\n      \"dev.ucp.shopping\": {\n        \"version\": \"2026-01-15\",\n        \"spec\": \"https://ucp.dev/specification/overview\",\n        \"rest\": {\n          \"schema\": \"https://ucp.dev/services/shopping/rest.openapi.json\",\n          \"endpoint\": \"https://business.example.com/ucp/v1\"\n        }\n      }\n    },\n    \"capabilities\": [\n      {\n        \"name\": \"dev.ucp.shopping.checkout\",\n        \"version\": \"2026-01-11\",\n        \"spec\": \"https://ucp.dev/specification/checkout\",\n        \"schema\": \"https://ucp.dev/schemas/shopping/checkout.json\"\n      },\n      {\n        \"name\": \"dev.ucp.shopping.cart\",\n        \"version\": \"2026-01-15\",\n        \"spec\": \"https://ucp.dev/specification/cart\",\n        \"schema\": \"https://ucp.dev/schemas/shopping/cart.json\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/cart-rest/#base-url","title":"Base URL","text":"<p>All UCP REST endpoints are relative to the business's base URL, which is discovered through the UCP profile at <code>/.well-known/ucp</code>. The endpoint for the cart capability is defined in the <code>rest.endpoint</code> field of the business profile.</p>"},{"location":"specification/cart-rest/#content-types","title":"Content Types","text":"<ul> <li>Request: <code>application/json</code></li> <li>Response: <code>application/json</code></li> </ul> <p>All request and response bodies MUST be valid JSON as specified in RFC 8259.</p>"},{"location":"specification/cart-rest/#transport-security","title":"Transport Security","text":"<p>All REST endpoints MUST be served over HTTPS with minimum TLS version 1.3.</p>"},{"location":"specification/cart-rest/#operations","title":"Operations","text":"Operation Method Endpoint Description Create Cart <code>POST</code> <code>/carts</code> Create a cart session. Get Cart <code>GET</code> <code>/carts/{id}</code> Get a cart session. Update Cart <code>PUT</code> <code>/carts/{id}</code> Update a cart session. Cancel Cart <code>POST</code> <code>/carts/{id}/cancel</code> Cancel a cart session."},{"location":"specification/cart-rest/#create-cart","title":"Create Cart","text":""},{"location":"specification/cart-rest/#input-schema","title":"Input Schema","text":"<p>Error: Schema 'cart.create' not found in any schema directory.</p>"},{"location":"specification/cart-rest/#output-schema","title":"Output Schema","text":"Name Type Required Description ucp UCP Response Cart Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique cart identifier. line_items Array[Line Item Response] Yes Cart line items. Same structure as checkout. Full replacement on update. context Context No Buyer signals for localization (country, region, postal_code). Merchant uses for pricing, availability, currency. Falls back to geo-IP if omitted. buyer Buyer No Optional buyer information for personalized estimates. currency string Yes ISO 4217 currency code. Determined by merchant based on context or geo-IP. totals Array[Total Response] Yes Estimated cost breakdown. May be partial if shipping/tax not yet calculable. messages Array[Message] No Validation messages, warnings, or informational notices. links Array[Link] No Optional merchant links (policies, FAQs). continue_url string No URL for cart handoff and session recovery. Enables sharing and human-in-the-loop flows. expires_at string No Cart expiry timestamp (RFC 3339). Optional."},{"location":"specification/cart-rest/#example","title":"Example","text":"RequestResponse <pre><code>POST /carts HTTP/1.1\nUCP-Agent: profile=\"https://platform.example/profile\"\nContent-Type: application/json\n\n{\n  \"line_items\": [\n    {\n      \"item\": {\n        \"id\": \"item_123\"\n      },\n      \"quantity\": 2\n    }\n  ],\n  \"context\": {\n    \"address_country\": \"US\",\n    \"address_region\": \"CA\",\n    \"postal_code\": \"94105\"\n  }\n}\n</code></pre> <pre><code>HTTP/1.1 201 Created\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-15\",\n    \"capabilities\": [\n      {\n        \"name\": \"dev.ucp.shopping.checkout\",\n        \"version\": \"2026-01-11\"\n      },\n      {\n        \"name\": \"dev.ucp.shopping.cart\",\n        \"version\": \"2026-01-15\"\n      }\n    ]\n  },\n  \"id\": \"cart_abc123\",\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"quantity\": 2,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 5000},\n        {\"type\": \"total\", \"amount\": 5000}\n      ]\n    }\n  ],\n  \"currency\": \"USD\",\n  \"totals\": [\n    {\n      \"type\": \"subtotal\",\n      \"amount\": 5000\n    },\n    {\n      \"type\": \"total\",\n      \"amount\": 5000,\n      \"display_text\": \"Estimated total (taxes calculated at checkout)\"\n    }\n  ],\n  \"continue_url\": \"https://business.example.com/checkout?cart=cart_abc123\",\n  \"expires_at\": \"2026-01-16T12:00:00Z\"\n}\n</code></pre>"},{"location":"specification/cart-rest/#get-cart","title":"Get Cart","text":""},{"location":"specification/cart-rest/#input-schema_1","title":"Input Schema","text":"<ul> <li><code>id</code> (String, required): The cart session ID (path parameter).</li> </ul>"},{"location":"specification/cart-rest/#output-schema_1","title":"Output Schema","text":"Name Type Required Description ucp UCP Response Cart Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique cart identifier. line_items Array[Line Item Response] Yes Cart line items. Same structure as checkout. Full replacement on update. context Context No Buyer signals for localization (country, region, postal_code). Merchant uses for pricing, availability, currency. Falls back to geo-IP if omitted. buyer Buyer No Optional buyer information for personalized estimates. currency string Yes ISO 4217 currency code. Determined by merchant based on context or geo-IP. totals Array[Total Response] Yes Estimated cost breakdown. May be partial if shipping/tax not yet calculable. messages Array[Message] No Validation messages, warnings, or informational notices. links Array[Link] No Optional merchant links (policies, FAQs). continue_url string No URL for cart handoff and session recovery. Enables sharing and human-in-the-loop flows. expires_at string No Cart expiry timestamp (RFC 3339). Optional."},{"location":"specification/cart-rest/#example_1","title":"Example","text":"RequestResponseNot Found <pre><code>GET /carts/{id} HTTP/1.1\nUCP-Agent: profile=\"https://platform.example/profile\"\n</code></pre> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-15\",\n    \"capabilities\": [\n      {\n        \"name\": \"dev.ucp.shopping.checkout\",\n        \"version\": \"2026-01-11\"\n      },\n      {\n        \"name\": \"dev.ucp.shopping.cart\",\n        \"version\": \"2026-01-15\"\n      }\n    ]\n  },\n  \"id\": \"cart_abc123\",\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"quantity\": 2,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 5000},\n        {\"type\": \"total\", \"amount\": 5000}\n      ]\n    }\n  ],\n  \"currency\": \"USD\",\n  \"totals\": [\n    {\n      \"type\": \"subtotal\",\n      \"amount\": 5000\n    },\n    {\n      \"type\": \"total\",\n      \"amount\": 5000\n    }\n  ],\n  \"continue_url\": \"https://business.example.com/checkout?cart=cart_abc123\",\n  \"expires_at\": \"2026-01-16T12:00:00Z\"\n}\n</code></pre> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-15\",\n    \"capabilities\": [\n      {\n        \"name\": \"dev.ucp.shopping.cart\",\n        \"version\": \"2026-01-15\"\n      }\n    ]\n  },\n  \"messages\": [\n    {\n      \"type\": \"error\",\n      \"code\": \"NOT_FOUND\",\n      \"content\": \"Cart not found or has expired\"\n    }\n  ],\n  \"continue_url\": \"https://merchant.com/\"\n}\n</code></pre>"},{"location":"specification/cart-rest/#update-cart","title":"Update Cart","text":""},{"location":"specification/cart-rest/#input-schema_2","title":"Input Schema","text":"<ul> <li><code>id</code> (String, required): The cart session ID (path parameter).</li> </ul> <p>Error: Schema 'cart.update' not found in any schema directory.</p>"},{"location":"specification/cart-rest/#output-schema_2","title":"Output Schema","text":"Name Type Required Description ucp UCP Response Cart Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique cart identifier. line_items Array[Line Item Response] Yes Cart line items. Same structure as checkout. Full replacement on update. context Context No Buyer signals for localization (country, region, postal_code). Merchant uses for pricing, availability, currency. Falls back to geo-IP if omitted. buyer Buyer No Optional buyer information for personalized estimates. currency string Yes ISO 4217 currency code. Determined by merchant based on context or geo-IP. totals Array[Total Response] Yes Estimated cost breakdown. May be partial if shipping/tax not yet calculable. messages Array[Message] No Validation messages, warnings, or informational notices. links Array[Link] No Optional merchant links (policies, FAQs). continue_url string No URL for cart handoff and session recovery. Enables sharing and human-in-the-loop flows. expires_at string No Cart expiry timestamp (RFC 3339). Optional."},{"location":"specification/cart-rest/#example_2","title":"Example","text":"RequestResponse <pre><code>PUT /carts/{id} HTTP/1.1\nUCP-Agent: profile=\"https://platform.example/profile\"\nContent-Type: application/json\n\n{\n  \"id\": \"cart_abc123\",\n  \"line_items\": [\n    {\n      \"item\": {\n        \"id\": \"item_123\"\n      },\n      \"id\": \"li_1\",\n      \"quantity\": 3\n    },\n    {\n      \"item\": {\n        \"id\": \"item_456\"\n      },\n      \"id\": \"li_2\",\n      \"quantity\": 1\n    }\n  ],\n  \"context\": {\n    \"address_country\": \"US\",\n    \"address_region\": \"CA\",\n    \"postal_code\": \"94105\"\n  }\n}\n</code></pre> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-15\",\n    \"capabilities\": [\n      {\n        \"name\": \"dev.ucp.shopping.checkout\",\n        \"version\": \"2026-01-11\"\n      },\n      {\n        \"name\": \"dev.ucp.shopping.cart\",\n        \"version\": \"2026-01-15\"\n      }\n    ]\n  },\n  \"id\": \"cart_abc123\",\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"quantity\": 3,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 7500},\n        {\"type\": \"total\", \"amount\": 7500}\n      ]\n    },\n    {\n      \"id\": \"li_2\",\n      \"item\": {\n        \"id\": \"item_456\",\n        \"title\": \"Blue Jeans\",\n        \"price\": 7500\n      },\n      \"quantity\": 1,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 7500},\n        {\"type\": \"total\", \"amount\": 7500}\n      ]\n    }\n  ],\n  \"currency\": \"USD\",\n  \"totals\": [\n    {\n      \"type\": \"subtotal\",\n      \"amount\": 15000\n    },\n    {\n      \"type\": \"total\",\n      \"amount\": 15000\n    }\n  ],\n  \"continue_url\": \"https://business.example.com/checkout?cart=cart_abc123\",\n  \"expires_at\": \"2026-01-16T12:00:00Z\"\n}\n</code></pre>"},{"location":"specification/cart-rest/#cancel-cart","title":"Cancel Cart","text":""},{"location":"specification/cart-rest/#input-schema_3","title":"Input Schema","text":"<ul> <li><code>id</code> (String, required): The cart session ID (path parameter).</li> </ul>"},{"location":"specification/cart-rest/#output-schema_3","title":"Output Schema","text":"Name Type Required Description ucp UCP Response Cart Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique cart identifier. line_items Array[Line Item Response] Yes Cart line items. Same structure as checkout. Full replacement on update. context Context No Buyer signals for localization (country, region, postal_code). Merchant uses for pricing, availability, currency. Falls back to geo-IP if omitted. buyer Buyer No Optional buyer information for personalized estimates. currency string Yes ISO 4217 currency code. Determined by merchant based on context or geo-IP. totals Array[Total Response] Yes Estimated cost breakdown. May be partial if shipping/tax not yet calculable. messages Array[Message] No Validation messages, warnings, or informational notices. links Array[Link] No Optional merchant links (policies, FAQs). continue_url string No URL for cart handoff and session recovery. Enables sharing and human-in-the-loop flows. expires_at string No Cart expiry timestamp (RFC 3339). Optional."},{"location":"specification/cart-rest/#example_3","title":"Example","text":"RequestResponse <pre><code>POST /carts/{id}/cancel HTTP/1.1\nUCP-Agent: profile=\"https://platform.example/profile\"\nContent-Type: application/json\n\n{}\n</code></pre> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-15\",\n    \"capabilities\": [\n      {\n        \"name\": \"dev.ucp.shopping.checkout\",\n        \"version\": \"2026-01-11\"\n      },\n      {\n        \"name\": \"dev.ucp.shopping.cart\",\n        \"version\": \"2026-01-15\"\n      }\n    ]\n  },\n  \"id\": \"cart_abc123\",\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"quantity\": 2,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 5000},\n        {\"type\": \"total\", \"amount\": 5000}\n      ]\n    }\n  ],\n  \"currency\": \"USD\",\n  \"totals\": [\n    {\n      \"type\": \"subtotal\",\n      \"amount\": 5000\n    },\n    {\n      \"type\": \"total\",\n      \"amount\": 5000\n    }\n  ],\n  \"continue_url\": \"https://business.example.com/checkout?cart=cart_abc123\"\n}\n</code></pre>"},{"location":"specification/cart-rest/#http-headers","title":"HTTP Headers","text":"<p>The following headers are defined for the HTTP binding and apply to all operations unless otherwise noted.</p> <p>Error processing OpenAPI: [Errno 2] No such file or directory: 'source/services/shopping/rest.openapi.json'</p>"},{"location":"specification/cart-rest/#specific-header-requirements","title":"Specific Header Requirements","text":"<ul> <li>UCP-Agent: All requests MUST include the <code>UCP-Agent</code> header     containing the platform profile URI using Dictionary Structured Field syntax     (RFC 8941).     Format: <code>profile=\"https://platform.example/profile\"</code>.</li> <li>Idempotency-Key: Operations that modify state SHOULD support     idempotency. When provided, the server MUST:<ol> <li>Store the key with the operation result for at least 24 hours.</li> <li>Return the cached result for duplicate keys.</li> <li>Return <code>409 Conflict</code> if the key is reused with different parameters.</li> </ol> </li> </ul>"},{"location":"specification/cart-rest/#protocol-mechanics","title":"Protocol Mechanics","text":""},{"location":"specification/cart-rest/#status-codes","title":"Status Codes","text":"Status Code Description <code>200 OK</code> The request was successful. <code>201 Created</code> The cart was successfully created. <code>400 Bad Request</code> The request was invalid or cannot be served. <code>401 Unauthorized</code> Authentication is required and has failed or has not been provided. <code>403 Forbidden</code> The request is authenticated but the user does not have the necessary permissions. <code>409 Conflict</code> The request could not be completed due to a conflict (e.g., idempotent key reuse). <code>422 Unprocessable Entity</code> The profile content is malformed (discovery failure). <code>424 Failed Dependency</code> The profile URL is valid but fetch failed (discovery failure). <code>429 Too Many Requests</code> Rate limit exceeded. <code>500 Internal Server Error</code> An unexpected condition was encountered on the server. <code>503 Service Unavailable</code> Temporary unavailability."},{"location":"specification/cart-rest/#error-responses","title":"Error Responses","text":"<p>See the Core Specification for negotiation error handling (discovery failures, negotiation failures).</p>"},{"location":"specification/cart-rest/#business-outcomes","title":"Business Outcomes","text":"<p>Business outcomes (including not found and validation errors) are returned with HTTP 200 and the UCP envelope containing <code>messages</code>:</p> <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {\n      \"dev.ucp.shopping.cart\": [{\"version\": \"2026-01-11\"}]\n    }\n  },\n  \"messages\": [\n    {\n      \"type\": \"error\",\n      \"code\": \"NOT_FOUND\",\n      \"content\": \"Cart not found or has expired\"\n    }\n  ],\n  \"continue_url\": \"https://merchant.com/\"\n}\n</code></pre>"},{"location":"specification/cart-rest/#security-considerations","title":"Security Considerations","text":""},{"location":"specification/cart-rest/#authentication","title":"Authentication","text":"<p>Authentication is optional and depends on business requirements. When authentication is required, the REST transport MAY use:</p> <ol> <li>Open API: No authentication required for public operations.</li> <li>API Keys: Via <code>X-API-Key</code> header.</li> <li>OAuth 2.0: Via <code>Authorization: Bearer {token}</code> header, following     RFC 6749.</li> <li>Mutual TLS: For high-security environments.</li> </ol> <p>Businesses MAY require authentication for some operations while leaving others open (e.g., public cart without authentication).</p>"},{"location":"specification/cart/","title":"Overview","text":""},{"location":"specification/cart/#cart-capability","title":"Cart Capability","text":"<ul> <li>Capability Name: <code>dev.ucp.shopping.cart</code></li> <li>Version: <code>DRAFT</code></li> </ul>"},{"location":"specification/cart/#overview","title":"Overview","text":"<p>The Cart capability enables basket building without the complexity of checkout. While Checkout manages payment handlers, status lifecycle, and order finalization, cart provides a lightweight CRUD interface for item collection before purchase intent is established.</p> <p>When to use Cart vs Checkout:</p> <ul> <li>Cart: User is exploring, comparing, saving items for later. No payment   configuration needed. Platform/agent can freely add, remove, update items.</li> <li>Checkout: User has expressed purchase intent. Payment handlers are   configured, status lifecycle begins, session moves toward completion.</li> </ul> <p>The typical flow: <code>cart session</code> \u2192 <code>checkout session</code> \u2192 <code>order</code></p> <p>Carts support:</p> <ul> <li>Incremental building: Add/remove items across sessions</li> <li>Localized estimates: Context-aware pricing without full checkout overhead</li> <li>Sharing: <code>continue_url</code> enables cart sharing and recovery</li> </ul>"},{"location":"specification/cart/#cart-vs-checkout","title":"Cart vs Checkout","text":"Aspect Cart Checkout Purpose Pre-purchase exploration Purchase finalization Payment None Required (handlers, instruments) Status Binary (exists/not found) Lifecycle (<code>incomplete</code> \u2192 <code>completed</code>) Complete Operation No Yes Totals Estimates (may be partial) Final pricing"},{"location":"specification/cart/#cart-to-checkout-conversion","title":"Cart-to-Checkout Conversion","text":"<p>When the cart capability is negotiated, platforms can convert a cart to checkout by providing <code>cart_id</code> in the Create Checkout request. The cart contents (<code>line_items</code>, <code>context</code>, <code>buyer</code>) initialize the checkout session.</p> <pre><code>{\n  \"cart_id\": \"cart_abc123\",\n  \"line_items\": []\n}\n</code></pre> <p>Business MUST use cart contents and MUST ignore overlapping fields in checkout payload. The <code>cart_id</code> parameter is only available when the cart capability is advertised in the business profile.</p> <p>Idempotent conversion:</p> <p>If an incomplete checkout already exists for the given <code>cart_id</code>, the business MUST return the existing checkout session rather than creating a new one. This ensures a single active checkout per cart and prevents conflicting sessions.</p> <p>Cart lifecycle after conversion:</p> <p>When checkout is initialized via <code>cart_id</code>, the cart and checkout sessions SHOULD be linked for the duration of the checkout.</p> <ul> <li> <p>During active checkout \u2014 Business SHOULD maintain the cart and reflect     relevant checkout modifications (quantity changes, item removals) back to     the cart. This supports back-to-storefront flows when buyers transition     between checkout and storefront.</p> </li> <li> <p>After checkout completion \u2014 Business MAY clear the cart based on TTL,     completion of the checkout, or other business logic. Subsequent operations     on a cleared cart ID return <code>NOT_FOUND</code>; the platform can start a new     session with <code>create_cart</code>.</p> </li> </ul>"},{"location":"specification/cart/#guidelines","title":"Guidelines","text":""},{"location":"specification/cart/#platform","title":"Platform","text":"<ul> <li>MAY use carts for pre-purchase exploration and session persistence.</li> <li>SHOULD convert cart to checkout when user expresses purchase intent.</li> <li>MAY display <code>continue_url</code> for handoff to business UI.</li> <li>SHOULD handle <code>NOT_FOUND</code> gracefully when cart expires or is canceled.</li> </ul>"},{"location":"specification/cart/#business","title":"Business","text":"<ul> <li>SHOULD provide <code>continue_url</code> for cart handoff and session recovery.</li> <li>TODO: discuss <code>continue_url</code> destination - cart vs checkout.</li> <li>SHOULD provide estimated totals when calculable.</li> <li>MAY omit fulfillment totals until checkout when address is unknown.</li> <li>SHOULD return informational messages for validation warnings.</li> <li>MAY set cart expiry via <code>expires_at</code>.</li> <li>SHOULD follow cart lifecycle requirements     when checkout is initialized via <code>cart_id</code>.</li> </ul>"},{"location":"specification/cart/#cart-schema-definition","title":"Cart Schema Definition","text":"Name Type Required Description ucp UCP Response Cart Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique cart identifier. line_items Array[Line Item Response] Yes Cart line items. Same structure as checkout. Full replacement on update. context Context No Buyer signals for localization (country, region, postal_code). Merchant uses for pricing, availability, currency. Falls back to geo-IP if omitted. buyer Buyer No Optional buyer information for personalized estimates. currency string Yes ISO 4217 currency code. Determined by merchant based on context or geo-IP. totals Array[Total Response] Yes Estimated cost breakdown. May be partial if shipping/tax not yet calculable. messages Array[Message] No Validation messages, warnings, or informational notices. links Array[Link] No Optional merchant links (policies, FAQs). continue_url string No URL for cart handoff and session recovery. Enables sharing and human-in-the-loop flows. expires_at string No Cart expiry timestamp (RFC 3339). Optional."},{"location":"specification/cart/#operations","title":"Operations","text":"<p>The Cart capability defines the following logical operations.</p> Operation Description Create Cart Creates a new cart session. Get Cart Retrieves the current state of a cart session. Update Cart Updates a cart session. Cancel Cart Cancels a cart session."},{"location":"specification/cart/#create-cart","title":"Create Cart","text":"<p>Creates a new cart session with line items and optional buyer/context information for localized pricing estimates.</p> <ul> <li>REST Binding</li> <li>MCP Binding</li> </ul>"},{"location":"specification/cart/#get-cart","title":"Get Cart","text":"<p>Retrieves the latest state of a cart session. Returns <code>NOT_FOUND</code> if the cart does not exist, has expired, or was canceled.</p> <ul> <li>REST Binding</li> <li>MCP Binding</li> </ul>"},{"location":"specification/cart/#update-cart","title":"Update Cart","text":"<p>Performs a full replacement of the cart session. The platform MUST send the entire cart resource. The provided resource replaces the existing cart state on the business side.</p> <ul> <li>REST Binding</li> <li>MCP Binding</li> </ul>"},{"location":"specification/cart/#cancel-cart","title":"Cancel Cart","text":"<p>Cancels a cart session. Business MUST return the cart state before deletion. Subsequent operations for this cart ID SHOULD return <code>NOT_FOUND</code>.</p> <ul> <li>REST Binding</li> <li>MCP Binding</li> </ul>"},{"location":"specification/cart/#entities","title":"Entities","text":"<p>Cart reuses the same entity schemas as Checkout. This ensures consistent data structures when converting a cart to a checkout session.</p>"},{"location":"specification/cart/#line-item","title":"Line Item","text":""},{"location":"specification/cart/#line-item-create-request","title":"Line Item Create Request","text":"<p>Error: Schema 'types/line_item.create' not found in any schema directory.</p>"},{"location":"specification/cart/#line-item-update-request","title":"Line Item Update Request","text":"<p>Error: Schema 'types/line_item.update' not found in any schema directory.</p>"},{"location":"specification/cart/#line-item-response","title":"Line Item Response","text":"Name Type Required Description id string Yes item Item Yes quantity integer Yes Quantity of the item being purchased. totals Array[Total] Yes Line item totals breakdown. parent_id string No Parent line item identifier for any nested structures."},{"location":"specification/cart/#buyer","title":"Buyer","text":"Name Type Required Description first_name string No First name of the buyer. last_name string No Last name of the buyer. email string No Email of the buyer. phone_number string No E.164 standard."},{"location":"specification/cart/#context","title":"Context","text":"Name Type Required Description address_country string No The country. Recommended to be in 2-letter ISO 3166-1 alpha-2 format, for example \"US\". For backward compatibility, a 3-letter ISO 3166-1 alpha-3 country code such as \"SGP\" or a full country name such as \"Singapore\" can also be used. Optional hint for market context (currency, availability, pricing)\u2014higher-resolution data (e.g., shipping address) supersedes this value. address_region string No The region in which the locality is, and which is in the country. For example, California or another appropriate first-level Administrative division. Optional hint for progressive localization\u2014higher-resolution data (e.g., shipping address) supersedes this value. postal_code string No The postal code. For example, 94043. Optional hint for regional refinement\u2014higher-resolution data (e.g., shipping address) supersedes this value. intent string No Background context describing buyer's intent (e.g., 'looking for a gift under $50', 'need something durable for outdoor use'). Informs relevance, recommendations, and personalization."},{"location":"specification/cart/#total","title":"Total","text":"Name Type Required Description type string Yes Type of total categorization.Enum: <code>items_discount</code>, <code>subtotal</code>, <code>discount</code>, <code>fulfillment</code>, <code>tax</code>, <code>fee</code>, <code>total</code> display_text string No Text to display against the amount. Should reflect appropriate method (e.g., 'Shipping', 'Delivery'). amount integer Yes If type == total, sums subtotal - discount + fulfillment + tax + fee. Should be &gt;= 0. Amount in minor (cents) currency units. <p>Taxes MAY be included where calculable. Platforms SHOULD assume cart totals are estimates; accurate taxes are computed at checkout.</p>"},{"location":"specification/cart/#message","title":"Message","text":"<p>This object MUST be one of the following types: Message Error, Message Warning, Message Info.</p>"},{"location":"specification/cart/#message-error","title":"Message Error","text":"Name Type Required Description type string Yes Constant = error. Message type discriminator. code string Yes Error code. Possible values include: missing, invalid, out_of_stock, payment_declined, requires_sign_in, requires_3ds, requires_identity_linking. Freeform codes also allowed. path string No RFC 9535 JSONPath to the component the message refers to (e.g., $.items[1]). content_type string No Content format, default = plain.Enum: <code>plain</code>, <code>markdown</code> content string Yes Human-readable message. severity string Yes Declares who resolves this error. 'recoverable': agent can fix via API. 'requires_buyer_input': merchant requires information their API doesn't support collecting programmatically (checkout incomplete). 'requires_buyer_review': buyer must authorize before order placement due to policy, regulatory, or entitlement rules (checkout complete). Errors with 'requires_' severity contribute to 'status: requires_escalation'.Enum:* <code>recoverable</code>, <code>requires_buyer_input</code>, <code>requires_buyer_review</code>"},{"location":"specification/cart/#message-info","title":"Message Info","text":"Name Type Required Description type string Yes Constant = info. Message type discriminator. path string No RFC 9535 JSONPath to the component the message refers to. code string No Info code for programmatic handling. content_type string No Content format, default = plain.Enum: <code>plain</code>, <code>markdown</code> content string Yes Human-readable message."},{"location":"specification/cart/#message-warning","title":"Message Warning","text":"Name Type Required Description type string Yes Constant = warning. Message type discriminator. path string No JSONPath (RFC 9535) to related field (e.g., $.line_items[0]). code string Yes Warning code. Machine-readable identifier for the warning type (e.g., final_sale, prop65, fulfillment_changed, age_restricted, etc.). content string Yes Human-readable warning message that MUST be displayed. content_type string No Content format, default = plain.Enum: <code>plain</code>, <code>markdown</code>"},{"location":"specification/cart/#link","title":"Link","text":"Name Type Required Description type string Yes Type of link. Well-known values: <code>privacy_policy</code>, <code>terms_of_service</code>, <code>refund_policy</code>, <code>shipping_policy</code>, <code>faq</code>. Consumers SHOULD handle unknown values gracefully by displaying them using the <code>title</code> field or omitting the link. url string Yes The actual URL pointing to the content to be displayed. title string No Optional display text for the link. When provided, use this instead of generating from type."},{"location":"specification/checkout-a2a/","title":"A2A Binding","text":""},{"location":"specification/checkout-a2a/#checkout-capability-a2a-binding","title":"Checkout Capability - A2A Binding","text":"<p>This document specifies the Agent2Agent Protocol (A2A) binding for Checkout Capability.</p>"},{"location":"specification/checkout-a2a/#transport-discovery","title":"Transport Discovery","text":"<p>Businesses that support A2A transport must specify the agent card endpoint as part of <code>services</code> in UCP Profile at <code>/.well-known/ucp</code>. This allows capable platforms to interact with the business services over A2A Protocol.</p> <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"services\": {\n      \"dev.ucp.shopping\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/overview\",\n          \"transport\": \"a2a\",\n          \"endpoint\": \"https://example-business.com/.well-known/agent-card.json\"\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/checkout-a2a/#shopping-agent-profile-advertisement","title":"Shopping Agent Profile Advertisement","text":"<p>Shopping platforms interacting with the business agent must send their profile URI as <code>UCP-Agent</code> request headers with every request.</p> <pre><code>UCP-Agent: profile=\"https://agent.example/profiles/v2025-11/shopping-agent.json\"\nContent-Type: application/json\n</code></pre>"},{"location":"specification/checkout-a2a/#header-mapping-reference","title":"Header Mapping Reference","text":"<p>The following table defines the required headers for enabling an A2A Agent to communicate UCP data types with platforms.</p> Header Name Description <code>UCP-Agent</code> Shopping platform application profile URI. <code>X-A2A-Extensions</code> UCP Extension URI (specified below)."},{"location":"specification/checkout-a2a/#a2a-interactions","title":"A2A Interactions","text":"<p>The A2A Protocol provides a strong foundation for inter-agent communication. A2A extensions enable communication between agents with structured data types. This enables businesses to build AI applications to leverage UCP data types for communication with platforms.</p> <p>The URI for UCP A2A extension: <code>https://ucp.dev/specification/reference?v=2026-01-11</code></p> <p>Businesses supporting UCP must advertise the extension and any optional capabilities in their A2A Agent Card to allow platforms to activate the extension.</p> <p>An example:</p> <pre><code>{\n  \"extensions\": [\n    {\n      \"uri\": \"https://ucp.dev/specification/reference?v=2026-01-11\",\n      \"description\": \"Business agent supporting UCP\",\n      \"params\": {\n        \"capabilities\": {\n          \"dev.ucp.shopping.checkout\": [\n            {\"version\": \"2026-01-11\"}\n          ],\n          \"dev.ucp.shopping.fulfillment\": [\n            {\n              \"version\": \"2026-01-11\",\n              \"extends\": \"dev.ucp.shopping.checkout\"\n            }\n          ]\n        }\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"specification/checkout-a2a/#agent2agent-negotiation","title":"Agent2Agent Negotiation","text":"<p>The business agents can leverage A2A <code>Message</code> objects for allowing interaction with shopping agents/platforms. The A2A <code>Message</code> object returned by the agent will return structured data in <code>DataPart</code> objects within the message. Platforms must pass the business agent generated <code>contextId</code> for subsequent turns in a session to preserve the current context.</p> <p>Business agents may also leverage A2A <code>Task</code> objects for scenarios where applicable. In such scenarios, the business agent will return <code>Task</code> objects with appropriate payload for interaction with the platforms. Platforms must pass the server generated <code>taskId</code> along with the <code>contextId</code> for subsequent turns until the task is completed.</p> <p>Platforms must be capable of handling further negotiation in the same session even after a task reaches a terminal state (e.g. user places an order and wants to place another order in the same context or if the task reaches a failed state due to an exception). Platforms must reset the <code>taskId</code> once a task reaches terminal state to allow further interactions with the agent, although the current <code>contextId</code> can be reused for subsequent interactions.</p>"},{"location":"specification/checkout-a2a/#request-idempotency","title":"Request Idempotency","text":"<p>Business agents must leverage the <code>messageId</code> sent as part of the A2A <code>Message</code> to detect duplicate messages from platform retries.</p>"},{"location":"specification/checkout-a2a/#checkout-functionality","title":"Checkout Functionality","text":"<p>The Checkout capability allows consumers to manage items in a checkout session and complete the purchase process. The business agent typically integrates with the business's checkout APIs for offering this functionality.</p> <p>The extension defines the data schema for representing the Checkout functionality by business agent for any checkout related actions, completing or canceling the checkout. <code>Checkout</code> entity is a profile of an A2A <code>Message</code>. The Checkout entity must be returned by the business agent to the platform that activated UCP-A2A Extension in an A2A <code>Message</code>'s <code>DataPart</code>. The checkout object MUST be returned as part of a <code>DataPart</code> object with key <code>a2a.ucp.checkout</code>.</p> <p>Request format: Agentic applications can accept natural language input from users interacting with the agent to identify the user's intent, negotiate with the user to capture any required information and then invoke the appropriate tools to perform the operation. Inputs from platforms can be sent to the remote business agent as an A2A <code>Message</code>.</p> <p>Examples:</p> <ul> <li>Natural language input</li> </ul> <pre><code>{\n  \"message\": {\n    \"role\": \"user\",\n    \"parts\": [\n      {\n        \"type\": \"text\",\n        \"text\": \"add Pixel 10 Pro to my checkout\"\n      }\n    ],\n    \"messageId\": \"69da8f87-991b-479e-80dc-ed92fcb57cbe\",\n    \"kind\": \"message\",\n    \"contextId\": \"aad14abc-4082-4748-84ca-4afff85aedfa\"\n  }\n}\n</code></pre> <ul> <li>Structured inputs on user actions</li> </ul> <pre><code>{\n  \"message\": {\n    \"role\": \"user\",\n    \"parts\": [\n      {\n        \"type\": \"data\",\n        \"data\": {\n          \"action\": \"add_to_checkout\",\n          \"product_id\": \"PIXEL-10-PRO\",\n          \"quantity\": 1\n        }\n      }\n    ],\n    \"messageId\": \"e94a8c10-69f4-4c4c-b988-21a298302da6\",\n    \"kind\": \"message\",\n    \"contextId\": \"aad14abc-4082-4748-84ca-4afff85aedfa\"\n  }\n}\n</code></pre> <p>Response format: Following is an example response from a business agent implementing Checkout functionality:</p> <pre><code>{\n  \"id\": 33,\n  \"jsonrpc\": \"2.0\",\n  \"result\": {\n    \"contextId\": \"4629ea79-7201-4ece-bc7a-ce19fff76e61\",\n    \"kind\": \"message\",\n    \"messageId\": \"8e8566e0-6d7c-4f29-bd90-26a132385baa\",\n    \"parts\": [\n      {\n        \"data\": {\n          \"a2a.ucp.checkout\": {...checkoutObject}\n        },\n        \"kind\": \"data\"\n      }\n    ],\n    \"role\": \"agent\"\n  }\n}\n</code></pre>"},{"location":"specification/checkout-a2a/#checkout-completion","title":"Checkout Completion","text":"<p>When a user is ready to make a payment, <code>payment</code> must be submitted to the business agent to complete the checkout process. <code>payment</code> is a structured data type specified as part of UCP. When processing a payment to complete the checkout, <code>payment</code> must be submitted to the business agent as a <code>DataPart</code> with attribute name <code>a2a.ucp.checkout.payment</code>. Any associated risk signals should be sent with attribute name <code>a2a.ucp.checkout.risk_signals</code>.</p> <p>Upon completion of the checkout process, the business agent must return the checkout object containing an <code>order</code> attribute with <code>id</code> and <code>permalink_url</code>.</p> <p>Request format:</p> <pre><code>{\n  \"message\": {\n    \"role\": \"user\",\n    \"parts\": [\n      {\n        \"type\": \"data\",\n        \"data\": {\"action\":\"complete_checkout\"}\n      },\n      {\n        \"kind\": \"data\",\n        \"data\": {\n          \"a2a.ucp.checkout.payment\": {\n            ...paymentObject\n          },\n          \"a2a.ucp.checkout.risk_signals\":{...content}\n        }\n      }\n    ],\n    \"messageId\": \"e94a8c10-69f4-4c4c-b988-21a298302da6\",\n    \"kind\": \"message\",\n    \"contextId\": \"aad14abc-4082-4748-84ca-4afff85aedfa\"\n  }\n}\n</code></pre> <p>Response format: Following is an example response from a business agent implementing Checkout functionality:</p> <pre><code>{\n  \"id\": 33,\n  \"jsonrpc\": \"2.0\",\n  \"result\": {\n    \"contextId\": \"4629ea79-7201-4ece-bc7a-ce19fff76e61\",\n    \"kind\": \"message\",\n    \"messageId\": \"8e8566e0-6d7c-4f29-bd90-26a132385baa\",\n    \"parts\": [\n      {\n        \"data\": {\n          \"a2a.ucp.checkout\": { ...checkoutObject }\n        },\n        \"kind\": \"data\"\n      }\n    ],\n    \"role\": \"agent\"\n  }\n}\n</code></pre>"},{"location":"specification/checkout-a2a/#ap2-based-checkout-completion","title":"AP2 based Checkout Completion","text":"<p>Business agents can implement AP2 mandates extension that enables secure exchange of user intents and authorizations for Agent-to-Agent payment interactions. Businesses that support AP2 mandates extension for UCP must specify this in the UCP discovery document and the A2A agent card. The AP2 mandates extension is considered implicitly active when a platform and business agent advertise AP2 mandates extension in their respective profiles.</p> <p>When AP2 mandates extension is enabled, the business agent must create a detached JWS for the checkout object and must return the generated signature as part of the <code>DataPart</code> as <code>ap2.merchant_authorization</code>. This will allow the platform to cryptographically verify the checkout payload against the business's public keys.</p> <pre><code>{\n  \"id\": 33,\n  \"jsonrpc\": \"2.0\",\n  \"result\": {\n    \"contextId\": \"4629ea79-7201-4ece-bc7a-ce19fff76e61\",\n    \"kind\": \"message\",\n    \"messageId\": \"8e8566e0-6d7c-4f29-bd90-26a132385baa\",\n    \"parts\": [\n      {\n        \"data\": {\n          \"a2a.ucp.checkout\": {\n            ...checkoutObject,\n            \"ap2\": {\n              \"merchant_authorization\": \"&lt;detached jws signature&gt;\"\n            }\n          }\n        },\n        \"kind\": \"data\"\n      }\n    ],\n    \"role\": \"agent\"\n  }\n}\n</code></pre> <p>When the user confirms the payment on a platform, the user signed checkout and payment mandate objects must be sent as <code>DataPart</code>s to the business agent for completing checkout. The <code>payment</code> which includes the payment mandate must be submitted as part of a <code>DataPart</code> with attribute name <code>a2a.ucp.checkout.payment</code>. Signed checkout mandate must be specified in the <code>DataPart</code> as <code>ap2.checkout_mandate</code>. The <code>token</code> attribute of <code>payment.instruments[*].credential</code> contains the payment mandate. Refer to AP2 Mandates Extension documentation for more details about verification and processing of the mandates to complete the checkout.</p> <p>Request format:</p> <pre><code>{\n  \"message\": {\n    \"role\": \"user\",\n    \"parts\": [\n      {\n        \"type\": \"data\",\n        \"data\": {\n          \"action\": \"complete_checkout\"\n        }\n      },\n      {\n        \"kind\": \"data\",\n        \"data\": {\n          \"a2a.ucp.checkout.payment\": {\n            \"instruments\": [\n              {\n                \"id\": \"instr_1\",\n                \"handler_id\": \"gpay_1234\",\n                \"type\": \"card\",\n                \"selected\": true,\n                \"display\": {\n                  \"description\": \"Visa\u2006\u2022\u2022\u2022\u2022\u20061234\",\n                },\n                \"billing_address\": {\n                  \"street_address\": \"123 Main St\",\n                  \"address_locality\": \"Anytown\",\n                  \"address_region\": \"CA\",\n                  \"address_country\": \"US\",\n                  \"postal_code\": \"12345\"\n                },\n                \"credential\": {\n                  \"type\": \"PAYMENT_GATEWAY\",\n                  \"token\": \"examplePaymentMethodToken\"\n                }\n              }\n            ]\n          },\n          \"ap2\": {\n            \"checkout_mandate\": \"eyJhbGciOiJFUz...\"\n          }\n        }\n      }\n    ],\n    \"messageId\": \"e94a8c10-69f4-4c4c-b988-21a298302da6\",\n    \"kind\": \"message\",\n    \"contextId\": \"aad14abc-4082-4748-84ca-4afff85aedfa\"\n  }\n}\n</code></pre>"},{"location":"specification/checkout-mcp/","title":"MCP Binding","text":""},{"location":"specification/checkout-mcp/#checkout-capability-mcp-binding","title":"Checkout Capability - MCP Binding","text":"<p>This document specifies the Model Context Protocol (MCP) binding for the Checkout Capability.</p>"},{"location":"specification/checkout-mcp/#protocol-fundamentals","title":"Protocol Fundamentals","text":""},{"location":"specification/checkout-mcp/#discovery","title":"Discovery","text":"<p>Businesses advertise MCP transport availability through their UCP profile at <code>/.well-known/ucp</code>.</p> <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"services\": {\n      \"dev.ucp.shopping\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/overview\",\n          \"transport\": \"mcp\",\n          \"schema\": \"https://ucp.dev/services/shopping/mcp.openrpc.json\",\n          \"endpoint\": \"https://business.example.com/ucp/mcp\"\n        }\n      ]\n    },\n    \"capabilities\": {\n      \"dev.ucp.shopping.checkout\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/checkout\",\n          \"schema\": \"https://ucp.dev/schemas/shopping/checkout.json\"\n        }\n      ],\n      \"dev.ucp.shopping.fulfillment\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/fulfillment\",\n          \"schema\": \"https://ucp.dev/schemas/shopping/fulfillment.json\",\n          \"extends\": \"dev.ucp.shopping.checkout\"\n        }\n      ]\n    },\n    \"payment_handlers\": {\n      \"com.example.vendor.delegate_payment\": [\n        {\n          \"id\": \"handler_1\",\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://example.vendor.com/specs/delegate-payment\",\n          \"schema\": \"https://example.vendor.com/schemas/delegate-payment-config.json\",\n          \"config\": {}\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/checkout-mcp/#request-metadata","title":"Request Metadata","text":"<p>MCP clients MUST include a <code>meta</code> object in every request containing protocol metadata:</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"create_checkout\",\n    \"arguments\": {\n      \"meta\": {\n        \"ucp-agent\": {\n          \"profile\": \"https://platform.example/profiles/shopping-agent.json\"\n        },\n        \"idempotency-key\": \"550e8400-e29b-41d4-a716-446655440000\"\n      },\n      \"checkout\": { ... }\n    }\n  }\n}\n</code></pre> <p>The <code>meta[\"ucp-agent\"]</code> field is required on all requests to enable capability negotiation. The <code>complete_checkout</code> and <code>cancel_checkout</code> operations also require <code>meta[\"idempotency-key\"]</code> for retry safety. Platforms MAY include additional metadata fields.</p>"},{"location":"specification/checkout-mcp/#tools","title":"Tools","text":"<p>UCP Capabilities map 1:1 to MCP Tools.</p>"},{"location":"specification/checkout-mcp/#identifier-pattern","title":"Identifier Pattern","text":"<p>MCP tools separate resource identification from payload data:</p> <ul> <li>Requests: For operations on existing checkouts (<code>get</code>, <code>update</code>,     <code>complete</code>, <code>cancel</code>), a top-level <code>id</code> parameter identifies the target     resource. The <code>checkout</code> object in the request payload MUST NOT contain     an <code>id</code> field.</li> <li>Responses: All responses include <code>checkout.id</code> as part of the full resource state.</li> <li>Create: The <code>create_checkout</code> operation does not require an <code>id</code> in the request, and the response includes the newly assigned <code>checkout.id</code>.</li> </ul> Tool Operation Description <code>create_checkout</code> Create Checkout Create a checkout session. <code>get_checkout</code> Get Checkout Get a checkout session. <code>update_checkout</code> Update Checkout Update a checkout session. <code>complete_checkout</code> Complete Checkout Place the order. <code>cancel_checkout</code> Cancel Checkout Cancel a checkout session."},{"location":"specification/checkout-mcp/#create_checkout","title":"<code>create_checkout</code>","text":"<p>Maps to the Create Checkout operation.</p>"},{"location":"specification/checkout-mcp/#input-schema","title":"Input Schema","text":"<ul> <li><code>checkout</code> (Checkout): Required. Contains     the initial checkout session data and optional extensions.<ul> <li>Extensions (Optional):<ul> <li><code>dev.ucp.shopping.buyer_consent</code>: Buyer Consent</li> <li><code>dev.ucp.shopping.fulfillment</code>: Fulfillment</li> <li><code>dev.ucp.shopping.discount</code>: Discount</li> <li><code>dev.ucp.shopping.ap2_mandate</code>: AP2 Mandates</li> </ul> </li> </ul> </li> </ul>"},{"location":"specification/checkout-mcp/#output-schema","title":"Output Schema","text":"<ul> <li>Checkout object.</li> </ul>"},{"location":"specification/checkout-mcp/#example","title":"Example","text":"RequestResponse <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"create_checkout\",\n  \"params\": {\n    \"meta\": {\n      \"ucp-agent\": {\n        \"profile\": \"https://platform.example/profiles/v2026-01/shopping-agent.json\"\n      }\n    },\n    \"checkout\": {\n      \"buyer\": {\n        \"email\": \"jane.doe@example.com\",\n        \"first_name\": \"Jane\",\n        \"last_name\": \"Doe\"\n      },\n      \"line_items\": [\n        {\n          \"item\": {\n            \"id\": \"item_123\"\n          },\n          \"quantity\": 1\n        }\n      ],\n      \"currency\": \"USD\",\n      \"fulfillment\": {\n        \"methods\": [\n          {\n            \"type\": \"shipping\",\n            \"destinations\": [\n              {\n                \"street_address\": \"123 Main St\",\n                \"address_locality\": \"Springfield\",\n                \"address_region\": \"IL\",\n                \"postal_code\": \"62701\",\n                \"address_country\": \"US\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n  },\n  \"id\": 1\n}\n</code></pre> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"ucp\": {\n      \"version\": \"2026-01-11\",\n      \"capabilities\": {\n        \"dev.ucp.shopping.checkout\": [\n          {\"version\": \"2026-01-11\"}\n        ],\n        \"dev.ucp.shopping.fulfillment\": [\n          {\"version\": \"2026-01-11\"}\n        ]\n      },\n      \"payment_handlers\": {\n        \"com.example.vendor.delegate_payment\": [\n          {\"id\": \"handler_1\", \"version\": \"2026-01-11\", \"config\": {}}\n        ]\n      }\n    },\n    \"id\": \"checkout_abc123\",\n    \"status\": \"incomplete\",\n    \"buyer\": {\n      \"email\": \"jane.doe@example.com\",\n      \"first_name\": \"Jane\",\n      \"last_name\": \"Doe\"\n    },\n    \"line_items\": [\n      {\n        \"id\": \"item_123\",\n        \"item\": {\n          \"id\": \"item_123\",\n          \"title\": \"Blue Jeans\",\n          \"price\": 5000\n        },\n        \"quantity\": 1,\n        \"totals\": [\n          {\"type\": \"subtotal\", \"amount\": 5000},\n          {\"type\": \"total\", \"amount\": 5000}\n        ]\n      }\n    ],\n    \"currency\": \"USD\",\n    \"totals\": [\n      {\n        \"type\": \"subtotal\",\n        \"amount\": 5000\n      },\n      {\n        \"type\": \"fulfillment\",\n        \"display_text\": \"Shipping\",\n        \"amount\": 500\n      },\n      {\n        \"type\": \"total\",\n        \"amount\": 5500\n      }\n    ],\n    \"fulfillment\": {\n      \"methods\": [\n        {\n          \"id\": \"shipping_1\",\n          \"type\": \"shipping\",\n          \"line_item_ids\": [\"item_123\"],\n          \"selected_destination_id\": \"dest_home\",\n          \"destinations\": [\n            {\n              \"id\": \"dest_home\",\n              \"street_address\": \"123 Main St\",\n              \"address_locality\": \"Springfield\",\n              \"address_region\": \"IL\",\n              \"postal_code\": \"62701\",\n              \"address_country\": \"US\"\n            }\n          ],\n          \"groups\": [\n            {\n              \"id\": \"package_1\",\n              \"line_item_ids\": [\"item_123\"],\n              \"selected_option_id\": \"standard\",\n              \"options\": [\n                {\n                  \"id\": \"standard\",\n                  \"title\": \"Standard Shipping\",\n                  \"description\": \"Arrives in 5-7 business days\",\n                  \"totals\": [\n                    {\n                      \"type\": \"total\",\n                      \"amount\": 500\n                    }\n                  ]\n                },\n                {\n                  \"id\": \"express\",\n                  \"title\": \"Express Shipping\",\n                  \"description\": \"Arrives in 2-3 business days\",\n                  \"totals\": [\n                    {\n                      \"type\": \"total\",\n                      \"amount\": 1000\n                    }\n                  ]\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    },\n    \"links\": [\n      {\n        \"type\": \"privacy_policy\",\n        \"url\": \"https://business.example.com/privacy\"\n      },\n      {\n        \"type\": \"terms_of_service\",\n        \"url\": \"https://business.example.com/terms\"\n      }\n    ],\n    \"continue_url\": \"https://business.example.com/checkout-sessions/checkout_abc123\",\n    \"expires_at\": \"2026-01-11T18:30:00Z\"\n  }\n}\n</code></pre>"},{"location":"specification/checkout-mcp/#get_checkout","title":"<code>get_checkout</code>","text":"<p>Maps to the Get Checkout operation.</p>"},{"location":"specification/checkout-mcp/#input-schema_1","title":"Input Schema","text":"<ul> <li><code>id</code> (String): Required. The ID of the checkout session.</li> </ul>"},{"location":"specification/checkout-mcp/#output-schema_1","title":"Output Schema","text":"<ul> <li>Checkout object.</li> </ul>"},{"location":"specification/checkout-mcp/#update_checkout","title":"<code>update_checkout</code>","text":"<p>Maps to the Update Checkout operation.</p>"},{"location":"specification/checkout-mcp/#input-schema_2","title":"Input Schema","text":"<ul> <li><code>id</code> (String): Required. The ID of the checkout session to update.</li> <li><code>checkout</code> (Checkout): Required.     Contains the updated checkout session data.<ul> <li>Extensions (Optional):<ul> <li><code>dev.ucp.shopping.buyer_consent</code>: Buyer Consent</li> <li><code>dev.ucp.shopping.fulfillment</code>: Fulfillment</li> <li><code>dev.ucp.shopping.discount</code>: Discount</li> <li><code>dev.ucp.shopping.ap2_mandate</code>: AP2 Mandates</li> </ul> </li> </ul> </li> </ul>"},{"location":"specification/checkout-mcp/#output-schema_2","title":"Output Schema","text":"<ul> <li>Checkout object.</li> </ul>"},{"location":"specification/checkout-mcp/#example_1","title":"Example","text":"RequestResponse <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"update_checkout\",\n  \"params\": {\n    \"meta\": {\n      \"ucp-agent\": {\n        \"profile\": \"https://platform.example/profiles/v2026-01/shopping-agent.json\"\n      }\n    },\n    \"id\": \"checkout_abc123\",\n    \"checkout\": {\n      \"buyer\": {\n        \"email\": \"jane.doe@example.com\",\n        \"first_name\": \"Jane\",\n        \"last_name\": \"Doe\"\n      },\n      \"line_items\": [\n        {\n          \"item\": {\n            \"id\": \"item_123\"\n          },\n          \"quantity\": 1\n        }\n      ],\n      \"currency\": \"USD\",\n      \"fulfillment\": {\n        \"methods\": [\n          {\n            \"id\": \"shipping_1\",\n            \"line_item_ids\": [\"item_123\"],\n            \"groups\": [\n              {\n                \"id\": \"package_1\",\n                \"selected_option_id\": \"express\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n  },\n  \"id\": 2\n}\n</code></pre> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 2,\n  \"result\": {\n    \"ucp\": {\n      \"version\": \"2026-01-11\",\n      \"capabilities\": {\n        \"dev.ucp.shopping.checkout\": [\n          {\"version\": \"2026-01-11\"}\n        ],\n        \"dev.ucp.shopping.fulfillment\": [\n          {\"version\": \"2026-01-11\"}\n        ]\n      },\n      \"payment_handlers\": {\n        \"com.example.vendor.delegate_payment\": [\n          {\"id\": \"handler_1\", \"version\": \"2026-01-11\", \"config\": {}}\n        ]\n      }\n    },\n    \"id\": \"checkout_abc123\",\n    \"status\": \"incomplete\",\n    \"buyer\": {\n      \"email\": \"jane.doe@example.com\",\n      \"first_name\": \"Jane\",\n      \"last_name\": \"Doe\"\n    },\n    \"line_items\": [\n      {\n        \"id\": \"item_123\",\n        \"item\": {\n          \"id\": \"item_123\",\n          \"title\": \"Blue Jeans\",\n          \"price\": 5000\n        },\n        \"quantity\": 1,\n        \"totals\": [\n          {\"type\": \"subtotal\", \"amount\": 5000},\n          {\"type\": \"total\", \"amount\": 5000}\n        ]\n      }\n    ],\n    \"currency\": \"USD\",\n    \"totals\": [\n      {\n        \"type\": \"subtotal\",\n        \"amount\": 5000\n      },\n      {\n        \"type\": \"fulfillment\",\n        \"display_text\": \"Shipping\",\n        \"amount\": 1000\n      },\n      {\n        \"type\": \"total\",\n        \"amount\": 6000\n      }\n    ],\n    \"fulfillment\": {\n      \"methods\": [\n        {\n          \"id\": \"shipping_1\",\n          \"type\": \"shipping\",\n          \"line_item_ids\": [\"item_123\"],\n          \"selected_destination_id\": \"dest_home\",\n          \"destinations\": [\n            {\n              \"id\": \"dest_home\",\n              \"street_address\": \"123 Main St\",\n              \"address_locality\": \"Springfield\",\n              \"address_region\": \"IL\",\n              \"postal_code\": \"62701\",\n              \"address_country\": \"US\"\n            }\n          ],\n          \"groups\": [\n            {\n              \"id\": \"package_1\",\n              \"line_item_ids\": [\"item_123\"],\n              \"selected_option_id\": \"express\",\n              \"options\": [\n                {\n                  \"id\": \"standard\",\n                  \"title\": \"Standard Shipping\",\n                  \"description\": \"Arrives in 5-7 business days\",\n                  \"totals\": [\n                    {\n                      \"type\": \"total\",\n                      \"amount\": 500\n                    }\n                  ]\n                },\n                {\n                  \"id\": \"express\",\n                  \"title\": \"Express Shipping\",\n                  \"description\": \"Arrives in 2-3 business days\",\n                  \"totals\": [\n                    {\n                      \"type\": \"total\",\n                      \"amount\": 1000\n                    }\n                  ]\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    },\n    \"links\": [\n      {\n        \"type\": \"privacy_policy\",\n        \"url\": \"https://business.example.com/privacy\"\n      },\n      {\n        \"type\": \"terms_of_service\",\n        \"url\": \"https://business.example.com/terms\"\n      }\n    ],\n    \"continue_url\": \"https://business.example.com/checkout-sessions/checkout_abc123\",\n    \"expires_at\": \"2026-01-11T18:30:00Z\"\n  }\n}\n</code></pre>"},{"location":"specification/checkout-mcp/#complete_checkout","title":"<code>complete_checkout</code>","text":"<p>Maps to the Complete Checkout operation.</p>"},{"location":"specification/checkout-mcp/#input-schema_3","title":"Input Schema","text":"<ul> <li><code>meta</code> (Object): Required. Request metadata containing:<ul> <li><code>ucp-agent</code> (Object): Required. Platform agent identification.</li> <li><code>idempotency-key</code> (String, UUID): Required. Unique key for retry safety.</li> </ul> </li> <li><code>id</code> (String): Required. The ID of the checkout session.</li> <li><code>checkout</code> (Checkout): Required.     Contains payment credentials and other finalization data to execute the transaction.</li> </ul>"},{"location":"specification/checkout-mcp/#output-schema_3","title":"Output Schema","text":"<ul> <li>Checkout object, containing a partial    <code>order</code> that holds only <code>id</code> and <code>permalink_url</code>.</li> </ul>"},{"location":"specification/checkout-mcp/#cancel_checkout","title":"<code>cancel_checkout</code>","text":"<p>Maps to the Cancel Checkout operation.</p>"},{"location":"specification/checkout-mcp/#input-schema_4","title":"Input Schema","text":"<ul> <li><code>meta</code> (Object): Required. Request metadata containing:<ul> <li><code>ucp-agent</code> (Object): Required. Platform agent identification.</li> <li><code>idempotency-key</code> (String, UUID): Required. Unique key for retry safety.</li> </ul> </li> <li><code>id</code> (String): Required. The ID of the checkout session.</li> </ul>"},{"location":"specification/checkout-mcp/#output-schema_4","title":"Output Schema","text":"<ul> <li>Checkout object with <code>status: canceled</code>.</li> </ul>"},{"location":"specification/checkout-mcp/#error-handling","title":"Error Handling","text":"<p>See the Core Specification for negotiation error handling (discovery failures, negotiation failures).</p>"},{"location":"specification/checkout-mcp/#business-outcomes","title":"Business Outcomes","text":"<p>Business outcomes (including errors like unavailable merchandise) are returned as JSON-RPC <code>result</code> with the UCP envelope and <code>messages</code>:</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"ucp\": {\n      \"version\": \"2026-01-11\",\n      \"capabilities\": {\n        \"dev.ucp.shopping.checkout\": [{\"version\": \"2026-01-11\"}]\n      }\n    },\n    \"id\": \"checkout_abc123\",\n    \"status\": \"incomplete\",\n    \"line_items\": [\n      {\n        \"id\": \"item_456\",\n        \"quantity\": 100,\n        \"available_quantity\": 12\n      }\n    ],\n    \"messages\": [\n      {\n        \"type\": \"error\",\n        \"code\": \"INSUFFICIENT_STOCK\",\n        \"content\": \"Requested 100 units but only 12 available\",\n        \"severity\": \"requires_buyer_input\",\n        \"path\": \"$.line_items[0].quantity\"\n      }\n    ],\n    \"continue_url\": \"https://merchant.com/checkout/checkout_abc123\"\n  }\n}\n</code></pre>"},{"location":"specification/checkout-mcp/#conformance","title":"Conformance","text":"<p>A conforming MCP transport implementation MUST:</p> <ol> <li>Implement JSON-RPC 2.0 protocol correctly.</li> <li>Provide all core checkout tools defined in this specification.</li> <li>Return negotiation failures per the     Core Specification.</li> <li>Return business outcomes as JSON-RPC <code>result</code> with UCP envelope and     <code>messages</code> array.</li> <li>Validate tool inputs against UCP schemas.</li> <li>Support HTTP transport with streaming.</li> </ol>"},{"location":"specification/checkout-mcp/#implementation","title":"Implementation","text":"<p>UCP operations are defined using OpenRPC (JSON-RPC schema format). The MCP specification requires all tool invocations to use a <code>tools/call</code> method with the operation name and arguments wrapped in <code>params</code>. Implementers MUST apply this transformation:</p> OpenRPC MCP <code>method</code> <code>params.name</code> <code>params</code> <code>params.arguments</code> <p>Param conventions:</p> <ul> <li><code>meta</code> contains request metadata</li> <li><code>id</code> identifies the target resource (path parameter equivalent)</li> <li><code>checkout</code> contains the domain payload (body equivalent)</li> </ul> <p>Example: Given the <code>complete_checkout</code> operation defined in OpenRPC:</p> <pre><code>{\n  \"method\": \"complete_checkout\",\n  \"params\": {\n    \"meta\": {\n      \"ucp-agent\": { \"profile\": \"https://...\" },\n      \"idempotency-key\": \"550e8400-e29b-41d4-a716-446655440000\"\n    },\n    \"id\": \"checkout_abc123\",\n    \"checkout\": { \"payment\": {...} }\n  }\n}\n</code></pre> <p>Implementers MUST expose this as an MCP <code>tools/call</code> endpoint:</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"complete_checkout\",\n    \"arguments\": {\n      \"meta\": {\n        \"ucp-agent\": { \"profile\": \"https://...\" },\n        \"idempotency-key\": \"550e8400-e29b-41d4-a716-446655440000\"\n      },\n      \"id\": \"checkout_abc123\",\n      \"checkout\": { \"payment\": {...} }\n    }\n  }\n}\n</code></pre>"},{"location":"specification/checkout-rest/","title":"HTTP/REST Binding","text":""},{"location":"specification/checkout-rest/#checkout-capability-rest-binding","title":"Checkout Capability - REST Binding","text":"<p>This document specifies the REST binding for the Checkout Capability.</p>"},{"location":"specification/checkout-rest/#protocol-fundamentals","title":"Protocol Fundamentals","text":""},{"location":"specification/checkout-rest/#base-url","title":"Base URL","text":"<p>All UCP REST endpoints are relative to the business's base URL, which is discovered through the UCP profile at <code>/.well-known/ucp</code>. The endpoint for the checkout capability is defined in the <code>rest.endpoint</code> field of the business profile.</p>"},{"location":"specification/checkout-rest/#content-types","title":"Content Types","text":"<ul> <li>Request: <code>application/json</code></li> <li>Response: <code>application/json</code></li> </ul> <p>All request and response bodies MUST be valid JSON as specified in RFC 8259.</p>"},{"location":"specification/checkout-rest/#transport-security","title":"Transport Security","text":"<p>All REST endpoints MUST be served over HTTPS with minimum TLS version 1.3.</p>"},{"location":"specification/checkout-rest/#operations","title":"Operations","text":"Operation Method Endpoint Description Create Checkout <code>POST</code> <code>/checkout-sessions</code> Create a checkout session. Get Checkout <code>GET</code> <code>/checkout-sessions/{id}</code> Get a checkout session. Update Checkout <code>PUT</code> <code>/checkout-sessions/{id}</code> Update a checkout session. Complete Checkout <code>POST</code> <code>/checkout-sessions/{id}/complete</code> Place the order. Cancel Checkout <code>POST</code> <code>/checkout-sessions/{id}/cancel</code> Cancel a checkout session."},{"location":"specification/checkout-rest/#examples","title":"Examples","text":""},{"location":"specification/checkout-rest/#create-checkout","title":"Create Checkout","text":"RequestResponse <pre><code>POST /checkout-sessions HTTP/1.1\nUCP-Agent: profile=\"https://platform.example/profile\"\nContent-Type: application/json\n\n{\n  \"line_items\": [\n    {\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"id\": \"li_1\",\n      \"quantity\": 2\n    }\n  ]\n}\n</code></pre> <pre><code>HTTP/1.1 201 Created\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {\n      \"dev.ucp.shopping.checkout\": [\n        {\"version\": \"2026-01-11\"}\n      ]\n    },\n    \"payment_handlers\": {\n      \"com.shopify.shop_pay\": [\n        {\n          \"id\": \"shop_pay_1234\",\n          \"version\": \"2026-01-11\",\n          \"config\": {\n            \"merchant_id\": \"shop_merchant_123\"\n          }\n        }\n      ]\n    }\n  },\n  \"id\": \"chk_1234567890\",\n  \"status\": \"incomplete\",\n  \"messages\": [\n    {\n      \"type\": \"error\",\n      \"code\": \"missing\",\n      \"path\": \"$.buyer.email\",\n      \"content\": \"Buyer email is required\",\n      \"severity\": \"recoverable\"\n    }\n  ],\n  \"currency\": \"USD\",\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"quantity\": 2,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 5000},\n        {\"type\": \"total\", \"amount\": 5000}\n      ]\n    }\n  ],\n  \"totals\": [\n    {\n      \"type\": \"subtotal\",\n      \"amount\": 5000\n    },\n    {\n      \"type\": \"tax\",\n      \"amount\": 400\n    },\n    {\n      \"type\": \"total\",\n      \"amount\": 5400\n    }\n  ],\n  \"links\": [\n    {\n      \"type\": \"terms_of_service\",\n      \"url\": \"https://business.example.com/terms\"\n    }\n  ],\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"instr_shop_pay_1\",\n        \"handler_id\": \"shop_pay_1234\",\n        \"type\": \"shop_pay\",\n        \"selected\": true,\n        \"display\": {\n          \"email\": \"buyer@example.com\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/checkout-rest/#update-checkout","title":"Update Checkout","text":""},{"location":"specification/checkout-rest/#update-buyer-info","title":"Update Buyer Info","text":"<p>All fields in <code>buyer</code> are optional, allowing clients to progressively build the checkout state across multiple calls. Each PUT replaces the entire session, so clients must include all previously set fields they wish to retain.</p> RequestResponse <pre><code>PUT /checkout-sessions/{id} HTTP/1.1\nUCP-Agent: profile=\"https://platform.example/profile\"\nContent-Type: application/json\n\n{\n  \"id\": \"chk_123456789\",\n  \"buyer\": {\n    \"email\": \"jane@example.com\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Doe\"\n  },\n  \"line_items\": [\n    {\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"id\": \"li_1\",\n      \"quantity\": 2\n    }\n  ]\n}\n</code></pre> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {\n      \"dev.ucp.shopping.checkout\": [\n        {\"version\": \"2026-01-11\"}\n      ]\n    },\n    \"payment_handlers\": {\n      \"com.shopify.shop_pay\": [\n        {\n          \"id\": \"shop_pay_1234\",\n          \"version\": \"2026-01-11\",\n          \"config\": {\n            \"merchant_id\": \"shop_merchant_123\"\n          }\n        }\n      ]\n    }\n  },\n  \"id\": \"chk_1234567890\",\n  \"status\": \"incomplete\",\n  \"messages\": [\n    {\n      \"type\": \"error\",\n      \"code\": \"missing\",\n      \"path\": \"$.fulfillment.method[0].selected_destination_id\",\n      \"content\": \"Fulfillment address is required\",\n      \"severity\": \"recoverable\"\n    }\n  ],\n  \"currency\": \"USD\",\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"quantity\": 2,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 5000},\n        {\"type\": \"total\", \"amount\": 5000}\n      ]\n    }\n  ],\n  \"buyer\": {\n    \"email\": \"jane@example.com\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Doe\"\n  },\n  \"totals\": [\n    {\n      \"type\": \"subtotal\",\n      \"amount\": 5000\n    },\n    {\n      \"type\": \"tax\",\n      \"amount\": 400\n    },\n    {\n      \"type\": \"total\",\n      \"amount\": 5400\n    }\n  ],\n  \"links\": [\n    {\n      \"type\": \"terms_of_service\",\n      \"url\": \"https://business.example.com/terms\"\n    }\n  ],\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"instr_shop_pay_1\",\n        \"handler_id\": \"shop_pay_1234\",\n        \"type\": \"shop_pay\",\n        \"selected\": true,\n        \"display\": {\n          \"email\": \"buyer@example.com\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/checkout-rest/#update-fulfillment","title":"Update Fulfillment","text":"<p>Fulfillment is an extension to the checkout capability. Most fields are provided by the business based on buyer inputs, which includes desired fulfillment type &amp; addresses.</p> RequestResponse <pre><code>PUT /checkout-sessions/{id} HTTP/1.1\nUCP-Agent: profile=\"https://platform.example/profile\"\nContent-Type: application/json\n\n{\n  \"id\": \"chk_123456789\",\n  \"buyer\": {\n    \"email\": \"jane@example.com\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Doe\"\n  },\n  \"line_items\": [\n    {\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"id\": \"li_1\",\n      \"quantity\": 2\n    }\n  ],\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"type\": \"shipping\",\n        \"destinations\": [\n          {\n            \"street_address\": \"123 Main St\",\n            \"address_locality\": \"Springfield\",\n            \"address_region\": \"IL\",\n            \"postal_code\": \"62701\",\n            \"address_country\": \"US\"\n          }\n        ]\n      }\n    ]\n  }\n}\n</code></pre> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {\n      \"dev.ucp.shopping.checkout\": [\n        {\"version\": \"2026-01-11\"}\n      ]\n    },\n    \"payment_handlers\": {\n      \"com.google.pay\": [\n        {\n          \"id\": \"gpay_1234\",\n          \"version\": \"2026-01-11\",\n          \"config\": {\n            \"allowed_payment_methods\": [\n              {\n                \"type\": \"CARD\",\n                \"parameters\": {\n                  \"allowed_card_networks\": [\"VISA\", \"MASTERCARD\", \"AMEX\"]\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  },\n  \"id\": \"chk_1234567890\",\n  \"status\": \"incomplete\",\n  \"messages\": [\n    {\n      \"type\": \"error\",\n      \"code\": \"missing\",\n      \"path\": \"$.selected_fulfillment_option\",\n      \"content\": \"Please select a fulfillment option\",\n      \"severity\": \"recoverable\"\n    }\n  ],\n  \"currency\": \"USD\",\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"quantity\": 2,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 5000},\n        {\"type\": \"total\", \"amount\": 5000}\n      ]\n    }\n  ],\n  \"buyer\": {\n    \"email\": \"jane@example.com\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Doe\"\n  },\n  \"totals\": [\n    {\n      \"type\": \"subtotal\",\n      \"amount\": 5000\n    },\n    {\n      \"type\": \"tax\",\n      \"amount\": 400\n    },\n    {\n      \"type\": \"total\",\n      \"amount\": 5400\n    }\n  ],\n  \"links\": [\n    {\n      \"type\": \"terms_of_service\",\n      \"url\": \"https://merchant.com/terms\"\n    }\n  ],\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"id\": \"shipping_1\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"item_123\"],\n        \"selected_destination_id\": \"dest_home\",\n        \"destinations\": [\n          {\n            \"id\": \"dest_home\",\n            \"street_address\": \"123 Main St\",\n            \"address_locality\": \"Springfield\",\n            \"address_region\": \"IL\",\n            \"postal_code\": \"62701\",\n            \"address_country\": \"US\"\n          }\n        ],\n        \"groups\": [\n          {\n            \"id\": \"package_1\",\n            \"line_item_ids\": [\"item_123\"],\n            \"selected_option_id\": \"standard\",\n            \"options\": [\n              {\n                \"id\": \"standard\",\n                \"title\": \"Standard Shipping\",\n                \"description\": \"Arrives in 5-7 business days\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 500\n                  }\n                ]\n              },\n              {\n                \"id\": \"express\",\n                \"title\": \"Express Shipping\",\n                \"description\": \"Arrives in 2-3 business days\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 1000\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  },\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"pi_gpay_5678\",\n        \"handler_id\": \"gpay_1234\",\n        \"type\": \"card\",\n        \"selected\": true,\n        \"display\": {\n          \"brand\": \"mastercard\",\n          \"last_digits\": \"5678\",\n          \"rich_text_description\": \"Google Pay \u2022\u2022\u2022\u2022 5678\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/checkout-rest/#update-fulfillment-selection","title":"Update Fulfillment Selection","text":"<p>Follow-up calls after initial <code>fulfillment</code> data to update selection.</p> RequestResponse <pre><code>PUT /checkout-sessions/{id} HTTP/1.1\nUCP-Agent: profile=\"https://platform.example/profile\"\nContent-Type: application/json\n\n{\n  \"id\": \"chk_123456789\",\n  \"buyer\": {\n    \"email\": \"jane@example.com\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Doe\"\n  },\n  \"line_items\": [\n    {\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"id\": \"li_1\",\n      \"quantity\": 2,\n    }\n  ],\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"id\": \"shipping_1\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"item_123\"],\n        \"selected_destination_id\": \"dest_home\",\n        \"destinations\": [\n          {\n            \"id\": \"dest_home\",\n            \"street_address\": \"123 Main St\",\n            \"address_locality\": \"Springfield\",\n            \"address_region\": \"IL\",\n            \"postal_code\": \"62701\",\n            \"address_country\": \"US\"\n          }\n        ],\n        \"groups\": [\n          {\n            \"id\": \"package_1\",\n            \"selected_option_id\": \"express\"\n          }\n        ]\n      }\n    ]\n  }\n}\n</code></pre> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {\n      \"dev.ucp.shopping.checkout\": [\n        {\"version\": \"2026-01-11\"}\n      ]\n    },\n    \"payment_handlers\": {\n      \"com.shopify.shop_pay\": [\n        {\n          \"id\": \"shop_pay_1234\",\n          \"version\": \"2026-01-11\",\n          \"config\": {\n            \"merchant_id\": \"shop_merchant_123\"\n          }\n        }\n      ]\n    }\n  },\n  \"id\": \"chk_1234567890\",\n  \"status\": \"ready_for_complete\",\n  \"currency\": \"USD\",\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"quantity\": 2,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 5000},\n        {\"type\": \"total\", \"amount\": 5000}\n      ]\n    }\n  ],\n  \"buyer\": {\n    \"email\": \"jane@example.com\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Doe\"\n  },\n  \"totals\": [\n    {\n      \"type\": \"subtotal\",\n      \"amount\": 5000\n    },\n    {\n      \"type\": \"tax\",\n      \"amount\": 400\n    },\n    {\n      \"type\": \"total\",\n      \"amount\": 5400\n    }\n  ],\n  \"links\": [\n    {\n      \"type\": \"terms_of_service\",\n      \"url\": \"https://merchant.com/terms\"\n    }\n  ],\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"id\": \"shipping_1\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"item_123\"],\n        \"selected_destination_id\": \"dest_home\",\n        \"destinations\": [\n          {\n            \"id\": \"dest_home\",\n            \"street_address\": \"123 Main St\",\n            \"address_locality\": \"Springfield\",\n            \"address_region\": \"IL\",\n            \"postal_code\": \"62701\",\n            \"address_country\": \"US\"\n          }\n        ],\n        \"groups\": [\n          {\n            \"id\": \"package_1\",\n            \"line_item_ids\": [\"item_123\"],\n            \"selected_option_id\": \"express\",\n            \"options\": [\n              {\n                \"id\": \"standard\",\n                \"title\": \"Standard Shipping\",\n                \"description\": \"Arrives in 5-7 business days\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 500\n                  }\n                ]\n              },\n              {\n                \"id\": \"express\",\n                \"title\": \"Express Shipping\",\n                \"description\": \"Arrives in 2-3 business days\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 1000\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  },\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"instr_shop_pay_1\",\n        \"handler_id\": \"shop_pay_1234\",\n        \"type\": \"shop_pay\",\n        \"selected\": true,\n        \"display\": {\n          \"email\": \"buyer@example.com\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/checkout-rest/#complete-checkout","title":"Complete Checkout","text":"<p>If businesses have specific logic to enforce field existence in <code>buyer</code> and addresses (i.e. <code>fulfillment_address</code>, <code>billing_address</code>), this is the right place to set these expectations via <code>messages</code>.</p> RequestResponse <pre><code>POST /checkout-sessions/{id}/complete\nUCP-Agent: profile=\"https://platform.example/profile\"\nContent-Type: application/json\n\n{\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"pi_gpay_5678\",\n        \"handler_id\": \"gpay_1234\",\n        \"type\": \"card\",\n        \"selected\": true,\n        \"display\": {\n          \"brand\": \"mastercard\",\n          \"last_digits\": \"5678\",\n          \"card_art\": \"https://cart-art-1.html\",\n          \"description\": \"Google Pay \u2022\u2022\u2022\u2022 5678\"\n        },\n        \"billing_address\": {\n          \"street_address\": \"123 Main St\",\n          \"address_locality\": \"Anytown\",\n          \"address_region\": \"CA\",\n          \"address_country\": \"US\",\n          \"postal_code\": \"12345\"\n        },\n        \"credential\": {\n          \"type\": \"PAYMENT_GATEWAY\",\n          \"token\": \"examplePaymentMethodToken\"\n        }\n      }\n    ]\n  },\n  \"risk_signals\": {\n    //... risk signal related data (device fingerprint / risk token)\n  }\n}\n</code></pre> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {\n      \"dev.ucp.shopping.checkout\": [\n        {\"version\": \"2026-01-11\"}\n      ]\n    },\n    \"payment_handlers\": {\n      \"com.google.pay\": [\n        {\n          \"id\": \"gpay_1234\",\n          \"version\": \"2026-01-11\",\n          \"config\": {\n            \"allowed_payment_methods\": [\n              {\n                \"type\": \"CARD\",\n                \"parameters\": {\n                  \"allowed_card_networks\": [\"VISA\", \"MASTERCARD\", \"AMEX\"]\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  },\n  \"id\": \"chk_123456789\",\n  \"status\": \"completed\",\n  \"currency\": \"USD\",\n  \"order\": {\n    \"id\": \"ord_99887766\",\n    \"permalink_url\": \"https://merchant.com/orders/ord_99887766\"\n  },\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"quantity\": 2,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 5000},\n        {\"type\": \"total\", \"amount\": 5000}\n      ]\n    }\n  ],\n  \"buyer\": {\n    \"email\": \"jane@example.com\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Doe\"\n  },\n  \"totals\": [\n    {\n      \"type\": \"subtotal\",\n      \"amount\": 5000\n    },\n    {\n      \"type\": \"tax\",\n      \"amount\": 400\n    },\n    {\n      \"type\": \"total\",\n      \"amount\": 5400\n    }\n  ],\n  \"links\": [\n    {\n      \"type\": \"terms_of_service\",\n      \"url\": \"https://merchant.com/terms\"\n    }\n  ],\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"id\": \"shipping_1\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"item_123\"],\n        \"selected_destination_id\": \"dest_home\",\n        \"destinations\": [\n          {\n            \"id\": \"dest_home\",\n            \"street_address\": \"123 Main St\",\n            \"address_locality\": \"Springfield\",\n            \"address_region\": \"IL\",\n            \"postal_code\": \"62701\",\n            \"address_country\": \"US\"\n          }\n        ],\n        \"groups\": [\n          {\n            \"id\": \"package_1\",\n            \"line_item_ids\": [\"item_123\"],\n            \"selected_option_id\": \"express\",\n            \"options\": [\n              {\n                \"id\": \"standard\",\n                \"title\": \"Standard Shipping\",\n                \"description\": \"Arrives in 5-7 business days\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 500\n                  }\n                ]\n              },\n              {\n                \"id\": \"express\",\n                \"title\": \"Express Shipping\",\n                \"description\": \"Arrives in 2-3 business days\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 1000\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  },\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"pi_gpay_5678\",\n        \"handler_id\": \"gpay_1234\",\n        \"type\": \"card\",\n        \"selected\": true,\n        \"display\": {\n          \"brand\": \"mastercard\",\n          \"last_digits\": \"5678\",\n          \"rich_text_description\": \"Google Pay \u2022\u2022\u2022\u2022 5678\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/checkout-rest/#get-checkout","title":"Get Checkout","text":"RequestResponse <pre><code>GET /checkout-sessions/{id}\nUCP-Agent: profile=\"https://platform.example/profile\"\nContent-Type: application/json\n\n{}\n</code></pre> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {\n      \"dev.ucp.shopping.checkout\": [\n        {\"version\": \"2026-01-11\"}\n      ]\n    },\n    \"payment_handlers\": {\n      \"com.shopify.shop_pay\": [\n        {\n          \"id\": \"shop_pay_1234\",\n          \"version\": \"2026-01-11\",\n          \"config\": {\n            \"merchant_id\": \"shop_merchant_123\"\n          }\n        }\n      ]\n    }\n  },\n  \"id\": \"chk_123456789\",\n  \"status\": \"completed\",\n  \"currency\": \"USD\",\n  \"order\": {\n    \"id\": \"ord_99887766\",\n    \"permalink_url\": \"https://merchant.com/orders/ord_99887766\"\n  },\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"quantity\": 2,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 5000},\n        {\"type\": \"total\", \"amount\": 5000}\n      ]\n    }\n  ],\n  \"buyer\": {\n    \"email\": \"jane@example.com\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Doe\"\n  },\n  \"totals\": [\n    {\n      \"type\": \"subtotal\",\n      \"amount\": 5000\n    },\n    {\n      \"type\": \"tax\",\n      \"amount\": 400\n    },\n    {\n      \"type\": \"total\",\n      \"amount\": 5400\n    }\n  ],\n  \"links\": [\n    {\n      \"type\": \"terms_of_service\",\n      \"url\": \"https://merchant.com/terms\"\n    }\n  ],\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"id\": \"shipping_1\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"item_123\"],\n        \"selected_destination_id\": \"dest_home\",\n        \"destinations\": [\n          {\n            \"id\": \"dest_home\",\n            \"street_address\": \"123 Main St\",\n            \"address_locality\": \"Springfield\",\n            \"address_region\": \"IL\",\n            \"postal_code\": \"62701\",\n            \"address_country\": \"US\"\n          }\n        ],\n        \"groups\": [\n          {\n            \"id\": \"package_1\",\n            \"line_item_ids\": [\"item_123\"],\n            \"selected_option_id\": \"express\",\n            \"options\": [\n              {\n                \"id\": \"standard\",\n                \"title\": \"Standard Shipping\",\n                \"description\": \"Arrives in 5-7 business days\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 500\n                  }\n                ]\n              },\n              {\n                \"id\": \"express\",\n                \"title\": \"Express Shipping\",\n                \"description\": \"Arrives in 2-3 business days\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 1000\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  },\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"instr_shop_pay_1\",\n        \"handler_id\": \"shop_pay_1234\",\n        \"type\": \"shop_pay\",\n        \"selected\": true,\n        \"display\": {\n          \"email\": \"buyer@example.com\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/checkout-rest/#cancel-checkout","title":"Cancel Checkout","text":"RequestResponse <pre><code>POST /checkout-sessions/{id}/cancel\nUCP-Agent: profile=\"https://platform.example/profile\"\nContent-Type: application/json\n\n{}\n</code></pre> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {\n      \"dev.ucp.shopping.checkout\": [\n        {\"version\": \"2026-01-11\"}\n      ]\n    },\n    \"payment_handlers\": {\n      \"com.google.pay\": [\n        {\n          \"id\": \"gpay_1234\",\n          \"version\": \"2026-01-11\",\n          \"config\": {\n            \"allowed_payment_methods\": [\n              {\n                \"type\": \"CARD\",\n                \"parameters\": {\n                  \"allowed_card_networks\": [\"VISA\", \"MASTERCARD\", \"AMEX\"]\n                }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  },\n  \"id\": \"chk_123456789\",\n  \"status\": \"canceled\", // Status is updated to canceled.\n  \"currency\": \"USD\",\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"item_123\",\n        \"title\": \"Red T-Shirt\",\n        \"price\": 2500\n      },\n      \"quantity\": 2,\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 5000},\n        {\"type\": \"total\", \"amount\": 5000}\n      ]\n    }\n  ],\n  \"buyer\": {\n    \"email\": \"jane@example.com\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Doe\"\n  },\n  \"totals\": [\n    {\n      \"type\": \"subtotal\",\n      \"amount\": 5000\n    },\n    {\n      \"type\": \"tax\",\n      \"amount\": 400\n    },\n    {\n      \"type\": \"total\",\n      \"amount\": 5400\n    }\n  ],\n  \"links\": [\n    {\n      \"type\": \"terms_of_service\",\n      \"url\": \"https://merchant.com/terms\"\n    }\n  ],\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"id\": \"shipping_1\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"item_123\"],\n        \"selected_destination_id\": \"dest_home\",\n        \"destinations\": [\n          {\n            \"id\": \"dest_home\",\n            \"street_address\": \"123 Main St\",\n            \"address_locality\": \"Springfield\",\n            \"address_region\": \"IL\",\n            \"postal_code\": \"62701\",\n            \"address_country\": \"US\"\n          }\n        ],\n        \"groups\": [\n          {\n            \"id\": \"package_1\",\n            \"line_item_ids\": [\"item_123\"],\n            \"selected_option_id\": \"express\",\n            \"options\": [\n              {\n                \"id\": \"standard\",\n                \"title\": \"Standard Shipping\",\n                \"description\": \"Arrives in 5-7 business days\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 500\n                  }\n                ]\n              },\n              {\n                \"id\": \"express\",\n                \"title\": \"Express Shipping\",\n                \"description\": \"Arrives in 2-3 business days\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 1000\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  },\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"pi_gpay_5678\",\n        \"handler_id\": \"gpay_1234\",\n        \"type\": \"card\",\n        \"selected\": true,\n        \"display\": {\n          \"brand\": \"mastercard\",\n          \"last_digits\": \"5678\",\n          \"rich_text_description\": \"Google Pay \u2022\u2022\u2022\u2022 5678\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/checkout-rest/#http-headers","title":"HTTP Headers","text":"<p>The following headers are defined for the HTTP binding and apply to all operations unless otherwise noted.</p> <p>Error processing OpenAPI: [Errno 2] No such file or directory: 'source/services/shopping/rest.openapi.json'</p>"},{"location":"specification/checkout-rest/#specific-header-requirements","title":"Specific Header Requirements","text":"<ul> <li>UCP-Agent: All requests MUST include the <code>UCP-Agent</code> header     containing the platform profile URI using Dictionary Structured Field syntax     (RFC 8941).     Format: <code>profile=\"https://platform.example/profile\"</code>.</li> <li>Idempotency-Key: Operations that modify state SHOULD support     idempotency. When provided, the server MUST:<ol> <li>Store the key with the operation result for at least 24 hours.</li> <li>Return the cached result for duplicate keys.</li> <li>Return <code>409 Conflict</code> if the key is reused with different parameters.</li> </ol> </li> </ul>"},{"location":"specification/checkout-rest/#protocol-mechanics","title":"Protocol Mechanics","text":""},{"location":"specification/checkout-rest/#status-codes","title":"Status Codes","text":"<p>UCP uses standard HTTP status codes to indicate the success or failure of an API request.</p> Status Code Description <code>200 OK</code> The request was successful. <code>201 Created</code> The resource was successfully created. <code>400 Bad Request</code> The request was invalid or cannot be served. <code>401 Unauthorized</code> Authentication is required and has failed or has not been provided. <code>403 Forbidden</code> The request is authenticated but the user does not have the necessary permissions. <code>409 Conflict</code> The request could not be completed due to a conflict (e.g., idempotent key reuse). <code>422 Unprocessable Entity</code> The profile content is malformed (discovery failure). <code>424 Failed Dependency</code> The profile URL is valid but fetch failed (discovery failure). <code>429 Too Many Requests</code> Rate limit exceeded. <code>503 Service Unavailable</code> Temporary unavailability. <code>500 Internal Server Error</code> An unexpected condition was encountered on the server."},{"location":"specification/checkout-rest/#error-responses","title":"Error Responses","text":"<p>See the Core Specification for negotiation error handling (discovery failures, negotiation failures).</p>"},{"location":"specification/checkout-rest/#business-outcomes","title":"Business Outcomes","text":"<p>Business outcomes (including errors like unavailable merchandise) are returned with HTTP 200 and the UCP envelope containing <code>messages</code>:</p> <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {\n      \"dev.ucp.shopping.checkout\": [{\"version\": \"2026-01-11\"}]\n    }\n  },\n  \"id\": \"checkout_abc123\",\n  \"status\": \"incomplete\",\n  \"line_items\": [\n    {\n      \"id\": \"item_456\",\n      \"quantity\": 100,\n      \"available_quantity\": 12\n    }\n  ],\n  \"messages\": [\n    {\n      \"type\": \"error\",\n      \"code\": \"INSUFFICIENT_STOCK\",\n      \"content\": \"Requested 100 units but only 12 available\",\n      \"severity\": \"requires_buyer_input\",\n      \"path\": \"$.line_items[0].quantity\"\n    }\n  ],\n  \"continue_url\": \"https://merchant.com/checkout/checkout_abc123\"\n}\n</code></pre>"},{"location":"specification/checkout-rest/#security-considerations","title":"Security Considerations","text":""},{"location":"specification/checkout-rest/#authentication","title":"Authentication","text":"<p>Authentication is optional and depends on business requirements. When authentication is required, the REST transport MAY use:</p> <ol> <li>Open API: No authentication required for public operations.</li> <li>API Keys: Via <code>X-API-Key</code> header.</li> <li>OAuth 2.0: Via <code>Authorization: Bearer {token}</code> header, following     RFC 6749.</li> <li>Mutual TLS: For high-security environments.</li> </ol> <p>Businesses MAY require authentication for some operations while leaving others open (e.g., public checkout without authentication).</p>"},{"location":"specification/checkout/","title":"Overview","text":""},{"location":"specification/checkout/#checkout-capability","title":"Checkout Capability","text":"<ul> <li>Capability Name: <code>dev.ucp.shopping.checkout</code></li> </ul>"},{"location":"specification/checkout/#overview","title":"Overview","text":"<p>Allows platforms to facilitate checkout sessions. The checkout has to be finalized manually by the user through a trusted UI unless the AP2 Mandates extension is supported.</p> <p>The business remains the Merchant of Record (MoR), and they don't need to become PCI DSS compliant to accept card payments through this Capability.</p>"},{"location":"specification/checkout/#flow-overview","title":"Flow overview","text":""},{"location":"specification/checkout/#payments","title":"Payments","text":"<p>Payment handlers are discovered from the business's UCP profile at <code>/.well-known/ucp</code> and checkout.ucp.payment_handlers. The handlers define the processing specifications for collecting payment instruments (e.g., Google Pay, Shop Pay). When the buyer submits payment, the platform populates the <code>payment.instruments</code> array with the collected instrument data.</p> <p>The <code>payment</code> object is optional on checkout creation and may be omitted for use cases that don't require payment processing (e.g., quote generation, cart management).</p>"},{"location":"specification/checkout/#fulfillment","title":"Fulfillment","text":"<p>Fulfillment is modelled as an extension in UCP to account for diverse use cases.</p> <p>Fulfillment is optional in the checkout object. This is done to enable a platform to perform checkout for digital goods without needing to furnish fulfillment details more relevant for physical goods.</p>"},{"location":"specification/checkout/#checkout-status-lifecycle","title":"Checkout Status Lifecycle","text":"<p>The checkout <code>status</code> field indicates the current phase of the session and determines what action is required next. The business sets the status; the platform receives messages indicating what's needed to progress.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 incomplete \u2502\u25c0\u2500\u2500\u25b6\u2502 requires_escalation \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502                     \u2502\n      \u2502           \u2502  (buyer handoff     \u2502\n      \u2502           \u2502   via continue_url) \u2502\n      \u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n      \u2502                      \u2502\n      \u2502 all info collected   \u2502 continue_url\n      \u25bc                      \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502ready_for_complete\u2502         \u2502\n\u2502                  \u2502         \u2502\n\u2502 (platform can    \u2502         \u2502\n\u2502 call Complete    \u2502         \u2502\n\u2502   Checkout).     \u2502         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n         \u2502                   \u2502\n         \u2502 Complete Checkout \u2502\n         \u25bc                   \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502complete_in_progress\u2502       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n          \u2502                  \u2502\n          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                   \u25bc\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u2502  completed  \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u2502  canceled   \u2502  (session invalid/expired - can occur from any state)\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"specification/checkout/#status-values","title":"Status Values","text":"<ul> <li> <p><code>incomplete</code>: Checkout session is missing required information or has     issues that need resolution. Platform should inspect <code>messages</code> array for     context and should attempt to resolve via Update Checkout.</p> </li> <li> <p><code>requires_escalation</code>: Checkout session requires information that     cannot be provided via API, or buyer input is required. Platform should     inspect <code>messages</code> to understand what's needed (see Error Handling below).     If any <code>recoverable</code> errors exist, resolve those first.     Then hand off to buyer via <code>continue_url</code>.</p> </li> <li> <p><code>ready_for_complete</code>: Checkout session has all necessary information     and platform can finalize programmatically. Platform can call     Complete Checkout.</p> </li> <li> <p><code>complete_in_progress</code>: Business is processing the Complete Checkout     request.</p> </li> <li> <p><code>completed</code>: Order placed successfully.</p> </li> <li> <p><code>canceled</code>: Checkout session is invalid or expired. Platform should     start a new checkout session if needed.</p> </li> </ul>"},{"location":"specification/checkout/#error-handling","title":"Error Handling","text":"<p>The <code>messages</code> array contains errors, warnings, and informational messages about the checkout state. Error messages include a <code>severity</code> field that declares who resolves the error:</p> Severity Meaning Platform Action <code>recoverable</code> Platform can fix via API Resolve using Update Checkout <code>requires_buyer_input</code> Business requires input not available via API Hand off via <code>continue_url</code> <code>requires_buyer_review</code> Buyer review and authorization is required Hand off via <code>continue_url</code> <p>Errors with <code>requires_*</code> severity contribute to <code>status: requires_escalation</code>. Both result in buyer handoff, but represent different checkout states.</p> <ul> <li><code>requires_buyer_input</code> means the checkout is incomplete \u2014 the business requires information their API doesn't support collecting programmatically.</li> <li><code>requires_buyer_review</code> means the checkout is complete \u2014 but policy, regulatory, or entitlement rules require buyer authorization before order placement (e.g., high-value order approval, first-purchase policy).</li> </ul>"},{"location":"specification/checkout/#error-processing-algorithm","title":"Error Processing Algorithm","text":"<p>When status is <code>incomplete</code> or <code>requires_escalation</code>, platforms should process errors as a prioritized stack. The example below illustrates a checkout with three error types: a recoverable error (invalid phone), a buyer input requirement (delivery scheduling), and a review requirement (high-value order). The latter two require handoff and serve as explicit signals to the platform. Businesses SHOULD surface such messages as early as possible, and platforms SHOULD prioritize resolving recoverable errors before initiating handoff.</p> <pre><code>{\n  \"status\": \"requires_escalation\",\n  \"messages\": [\n    {\n      \"type\": \"error\",\n      \"code\": \"invalid_phone\",\n      \"severity\": \"recoverable\",\n      \"content\": \"Phone number format is invalid\"\n    },\n    {\n      \"type\": \"error\",\n      \"code\": \"schedule_delivery\",\n      \"severity\": \"requires_buyer_input\",\n      \"content\": \"Select delivery window for your purchase\"\n    },\n    {\n      \"type\": \"error\",\n      \"code\": \"high_value_order\",\n      \"severity\": \"requires_buyer_review\",\n      \"content\": \"Orders over $500 require additional verification\"\n    }\n  ]\n}\n</code></pre> <p>Example error processing algorithm:</p> <pre><code>GIVEN checkout with messages array\nFILTER errors FROM messages WHERE type = \"error\"\n\nPARTITION errors INTO\n  recoverable           WHERE severity = \"recoverable\"\n  requires_buyer_input  WHERE severity = \"requires_buyer_input\"\n  requires_buyer_review WHERE severity = \"requires_buyer_review\"\n\nIF recoverable is not empty\n  FOR EACH error IN recoverable\n    ATTEMPT to fix error (e.g., reformat phone number)\n  CALL Update Checkout\n  RETURN and re-evaluate response\n\nIF requires_buyer_input is not empty\n  handoff_context = \"incomplete, additional input from buyer is required\"\nELSE IF requires_buyer_review is not empty\n  handoff_context = \"ready for final review by the buyer\"\n</code></pre>"},{"location":"specification/checkout/#continue-url","title":"Continue URL","text":"<p>The <code>continue_url</code> field enables checkout handoff from platform to business UI, allowing the buyer to continue and finalize the checkout session.</p>"},{"location":"specification/checkout/#availability","title":"Availability","text":"<p>Businesses MUST provide <code>continue_url</code> when returning <code>status</code> = <code>requires_escalation</code>. For all other non-terminal statuses (<code>incomplete</code>, <code>ready_for_complete</code>, <code>complete_in_progress</code>), businesses SHOULD provide <code>continue_url</code>. For terminal states (<code>completed</code>, <code>canceled</code>), <code>continue_url</code> SHOULD be omitted.</p>"},{"location":"specification/checkout/#format","title":"Format","text":"<p>The <code>continue_url</code> MUST be an absolute HTTPS URL and SHOULD preserve checkout state for seamless handoff. Businesses MAY implement state preservation using either approach:</p>"},{"location":"specification/checkout/#server-side-state-recommended","title":"Server-Side State (Recommended)","text":"<p>An opaque URL backed by server-side checkout state:</p> <pre><code>https://business.example.com/checkout-sessions/{checkout_id}\n</code></pre> <ul> <li>Server maintains checkout state tied to <code>checkout_id</code></li> <li>Simple, secure, recommended for most implementations</li> <li>URL lifetime typically tied to <code>expires_at</code></li> </ul>"},{"location":"specification/checkout/#checkout-permalink","title":"Checkout Permalink","text":"<p>A stateless URL that encodes checkout state directly, allowing reconstruction without server-side persistence. Businesses SHOULD implement support for this format to facilitate checkout handoff and accelerated entry\u2014for example, a platform can prefill checkout state when initiating a buy-now flow.</p> <p>Note: Checkout permalinks are a REST-specific construct that extends the REST transport binding. Accessing a permalink returns a redirect to the checkout UI or renders the checkout page directly.</p>"},{"location":"specification/checkout/#guidelines","title":"Guidelines","text":"<p>(In addition to the overarching guidelines)</p>"},{"location":"specification/checkout/#platform","title":"Platform","text":"<ul> <li>MAY engage an agent to facilitate the checkout session (e.g. add items     to the checkout session, select fulfillment address). However, the     agent must hand over the checkout session to a trusted and     deterministic UI for the user to review the checkout details and place the     order.</li> <li>MAY send the user from the trusted, deterministic UI back to the agent     at any time. For example, when the user decides to exit the checkout screen     to keep adding items to the cart.</li> <li>MAY provide agent context when the platform indicates that the request     was done by an agent.</li> <li>MUST use <code>continue_url</code> when checkout status is <code>requires_escalation</code>.</li> <li>MAY use <code>continue_url</code> to hand off to business UI in other situations.</li> <li>When performing handoff, SHOULD prefer business-provided     <code>continue_url</code> over platform-constructed checkout permalinks.</li> </ul>"},{"location":"specification/checkout/#business","title":"Business","text":"<ul> <li>MUST send a confirmation email after the checkout has been completed.</li> <li>SHOULD provide accurate error messages.</li> <li>Logic handling the checkout sessions MUST be deterministic.</li> <li>MUST provide <code>continue_url</code> when returning <code>status</code> =     <code>requires_escalation</code>.</li> <li>MUST include at least one message with <code>severity: escalation</code> when     returning <code>status</code> = <code>requires_escalation</code>.</li> <li>SHOULD provide <code>continue_url</code> in all non-terminal checkout responses.</li> <li>After a checkout session reaches the state \"completed\", it is considered     immutable.</li> </ul>"},{"location":"specification/checkout/#capability-schema-definition","title":"Capability Schema Definition","text":"Name Type Required Description ucp UCP Response Checkout Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique identifier of the checkout session. line_items Array[Line Item Response] Yes List of line items being checked out. buyer Buyer No Representation of the buyer. status string Yes Checkout state indicating the current phase and required action. See Checkout Status lifecycle documentation for state transition details.Enum: <code>incomplete</code>, <code>requires_escalation</code>, <code>ready_for_complete</code>, <code>complete_in_progress</code>, <code>completed</code>, <code>canceled</code> currency string Yes ISO 4217 currency code reflecting the merchant's market determination. Derived from address, context, and geo IP\u2014buyers provide signals, merchants determine currency. totals Array[Total Response] Yes Different cart totals. messages Array[Message] No List of messages with error and info about the checkout session state. links Array[Link] Yes Links to be displayed by the platform (Privacy Policy, TOS). Mandatory for legal compliance. expires_at string No RFC 3339 expiry timestamp. Default TTL is 6 hours from creation if not sent. continue_url string No URL for checkout handoff and session recovery. MUST be provided when status is requires_escalation. See specification for format and availability requirements. payment Payment No Payment configuration containing handlers. order Order Confirmation No Details about an order created for this checkout session."},{"location":"specification/checkout/#operations","title":"Operations","text":"<p>The Checkout capability defines the following logical operations.</p> Operation Description Create Checkout Initiates a new checkout session. Called as soon as a user adds an item to a cart. Get Checkout Retrieves the current state of a checkout session. Update Checkout Updates a checkout session. Complete Checkout Finalizes the checkout and places the order. Cancel Checkout Cancels a checkout session."},{"location":"specification/checkout/#create-checkout","title":"Create Checkout","text":"<p>To be invoked by the platform when the user has expressed purchase intent (e.g., click on Buy) to initiate the checkout session with the item details.</p> <p>Recommendation: To minimize discrepancies and a streamlined user experience, product data (price/title etc.) provided by the business through the feeds SHOULD match the actual attributes returned in the response.</p> <p>Error processing OpenAPI: [Errno 2] No such file or directory: 'source/services/shopping/rest.openapi.json'</p>"},{"location":"specification/checkout/#get-checkout","title":"Get Checkout","text":"<p>It provides the latest state of the checkout resource. After cancellation or completion it is up to the business on what to return (i.e this can be a long lived state or expire after a particular TTL - resulting in a 'not found' error). From the platform there is no specific enforcement for a TTL of the checkout.</p> <p>The platform will honor the TTL provided by the business via <code>expires_at</code> at the time of checkout session creation.</p> <p>Error processing OpenAPI: [Errno 2] No such file or directory: 'source/services/shopping/rest.openapi.json'</p>"},{"location":"specification/checkout/#update-checkout","title":"Update Checkout","text":"<p>Performs a full replacement of the checkout resource. The platform is REQUIRED to send the entire checkout resource containing any data updates to write-only data fields. The resource provided in the request will replace the existing checkout session state on the business side.</p> <p>Error processing OpenAPI: [Errno 2] No such file or directory: 'source/services/shopping/rest.openapi.json'</p>"},{"location":"specification/checkout/#complete-checkout","title":"Complete Checkout","text":"<p>This is the final checkout placement call. To be invoked when the user has committed to pay and place an order for the chosen items. The response of this call is the checkout object with the <code>order</code> field populated in it. The returned <code>order</code> provides necessary identifiers, such as <code>id</code> and <code>permalink_url</code>, that can be used to reference the full state of the placed order. At the time of order persistence, fields from <code>Checkout</code> MAY be used to construct the order representation (i.e. information like <code>line_items</code>, <code>fulfillment</code> will be used to create the initial order representation).</p> <p>After this call, other details will be updated through subsequent events as the order, and its associated items, moves through the supply chain.</p> <p>Error processing OpenAPI: [Errno 2] No such file or directory: 'source/services/shopping/rest.openapi.json'</p>"},{"location":"specification/checkout/#cancel-checkout","title":"Cancel Checkout","text":"<p>This operation will be used to cancel a checkout session, if it can be canceled. If the checkout session cannot be canceled (e.g. checkout session is already canceled or completed), then businesses SHOULD send back an error indicating the operation is not allowed. Any checkout session with a status that is not equal to <code>completed</code> or <code>canceled</code> SHOULD be cancelable.</p> <p>Error processing OpenAPI: [Errno 2] No such file or directory: 'source/services/shopping/rest.openapi.json'</p>"},{"location":"specification/checkout/#transport-bindings","title":"Transport Bindings","text":"<p>The abstract operations above are bound to specific transport protocols as defined below:</p> <ul> <li>REST Binding: RESTful API mapping using standard HTTP verbs and JSON payloads.</li> <li>MCP Binding: Model Context Protocol mapping for agentic interaction.</li> <li>A2A Binding: Agent-to-Agent Protocol mapping for agentic interactions.</li> <li>Embedded Checkout Binding: JSON-RPC for powering embedded checkout.</li> </ul>"},{"location":"specification/checkout/#entities","title":"Entities","text":""},{"location":"specification/checkout/#buyer","title":"Buyer","text":"Name Type Required Description first_name string No First name of the buyer. last_name string No Last name of the buyer. email string No Email of the buyer. phone_number string No E.164 standard."},{"location":"specification/checkout/#context","title":"Context","text":"<p>Context signals are provisional hints. Businesses SHOULD use these values when authoritative data (e.g. address) is absent, and MAY ignore unsupported values without returning errors. This differs from authoritative selections which require explicit validation and error feedback.</p> Name Type Required Description address_country string No The country. Recommended to be in 2-letter ISO 3166-1 alpha-2 format, for example \"US\". For backward compatibility, a 3-letter ISO 3166-1 alpha-3 country code such as \"SGP\" or a full country name such as \"Singapore\" can also be used. Optional hint for market context (currency, availability, pricing)\u2014higher-resolution data (e.g., shipping address) supersedes this value. address_region string No The region in which the locality is, and which is in the country. For example, California or another appropriate first-level Administrative division. Optional hint for progressive localization\u2014higher-resolution data (e.g., shipping address) supersedes this value. postal_code string No The postal code. For example, 94043. Optional hint for regional refinement\u2014higher-resolution data (e.g., shipping address) supersedes this value. intent string No Background context describing buyer's intent (e.g., 'looking for a gift under $50', 'need something durable for outdoor use'). Informs relevance, recommendations, and personalization."},{"location":"specification/checkout/#fulfillment-option","title":"Fulfillment Option","text":"<p>Error: Schema file 'fulfillment_resp.json' not found in any schema directory.</p>"},{"location":"specification/checkout/#item","title":"Item","text":""},{"location":"specification/checkout/#item-create-request","title":"Item Create Request","text":"<p>Error: Schema 'types/item.create' not found in any schema directory.</p>"},{"location":"specification/checkout/#item-update-request","title":"Item Update Request","text":"<p>Error: Schema 'types/item.update' not found in any schema directory.</p>"},{"location":"specification/checkout/#item-response","title":"Item Response","text":"Name Type Required Description id string Yes The product identifier, often the SKU, required to resolve the product details associated with this line item. Should be recognized by both the Platform, and the Business. title string Yes Product title. price integer Yes Unit price in minor (cents) currency units. image_url string No Product image URI."},{"location":"specification/checkout/#line-item","title":"Line Item","text":""},{"location":"specification/checkout/#line-item-create-request","title":"Line Item Create Request","text":"<p>Error: Schema 'types/line_item.create' not found in any schema directory.</p>"},{"location":"specification/checkout/#line-item-update-request","title":"Line Item Update Request","text":"<p>Error: Schema 'types/line_item.update' not found in any schema directory.</p>"},{"location":"specification/checkout/#line-item-response","title":"Line Item Response","text":"Name Type Required Description id string Yes item Item Yes quantity integer Yes Quantity of the item being purchased. totals Array[Total] Yes Line item totals breakdown. parent_id string No Parent line item identifier for any nested structures."},{"location":"specification/checkout/#link","title":"Link","text":"Name Type Required Description type string Yes Type of link. Well-known values: <code>privacy_policy</code>, <code>terms_of_service</code>, <code>refund_policy</code>, <code>shipping_policy</code>, <code>faq</code>. Consumers SHOULD handle unknown values gracefully by displaying them using the <code>title</code> field or omitting the link. url string Yes The actual URL pointing to the content to be displayed. title string No Optional display text for the link. When provided, use this instead of generating from type."},{"location":"specification/checkout/#well-known-link-types","title":"Well-Known Link Types","text":"<p>Businesses SHOULD provide all relevant links for the transaction. The following are the recommended well-known types:</p> Type Description <code>privacy_policy</code> Link to the business's privacy policy <code>terms_of_service</code> Link to the business's terms of service <code>refund_policy</code> Link to the business's refund policy <code>shipping_policy</code> Link to the business's shipping policy <code>faq</code> Link to the business's frequently asked questions <p>Businesses MAY define custom types for domain-specific needs. Platforms SHOULD handle unknown types gracefully by displaying them using the <code>title</code> field or omitting them.</p>"},{"location":"specification/checkout/#message","title":"Message","text":"<p>This object MUST be one of the following types: Message Error, Message Warning, Message Info.</p>"},{"location":"specification/checkout/#message-error","title":"Message Error","text":"Name Type Required Description type string Yes Constant = error. Message type discriminator. code string Yes Error code. Possible values include: missing, invalid, out_of_stock, payment_declined, requires_sign_in, requires_3ds, requires_identity_linking. Freeform codes also allowed. path string No RFC 9535 JSONPath to the component the message refers to (e.g., $.items[1]). content_type string No Content format, default = plain.Enum: <code>plain</code>, <code>markdown</code> content string Yes Human-readable message. severity string Yes Declares who resolves this error. 'recoverable': agent can fix via API. 'requires_buyer_input': merchant requires information their API doesn't support collecting programmatically (checkout incomplete). 'requires_buyer_review': buyer must authorize before order placement due to policy, regulatory, or entitlement rules (checkout complete). Errors with 'requires_' severity contribute to 'status: requires_escalation'.Enum:* <code>recoverable</code>, <code>requires_buyer_input</code>, <code>requires_buyer_review</code>"},{"location":"specification/checkout/#message-info","title":"Message Info","text":"Name Type Required Description type string Yes Constant = info. Message type discriminator. path string No RFC 9535 JSONPath to the component the message refers to. code string No Info code for programmatic handling. content_type string No Content format, default = plain.Enum: <code>plain</code>, <code>markdown</code> content string Yes Human-readable message."},{"location":"specification/checkout/#message-warning","title":"Message Warning","text":"Name Type Required Description type string Yes Constant = warning. Message type discriminator. path string No JSONPath (RFC 9535) to related field (e.g., $.line_items[0]). code string Yes Warning code. Machine-readable identifier for the warning type (e.g., final_sale, prop65, fulfillment_changed, age_restricted, etc.). content string Yes Human-readable warning message that MUST be displayed. content_type string No Content format, default = plain.Enum: <code>plain</code>, <code>markdown</code>"},{"location":"specification/checkout/#payment","title":"Payment","text":"Name Type Required Description instruments Array[Selected Payment Instrument] No The payment instruments available for this payment. Each instrument is associated with a specific handler via the handler_id field. Handlers can extend the base payment_instrument schema to add handler-specific fields."},{"location":"specification/checkout/#payment-instrument","title":"Payment Instrument","text":"Name Type Required Description id string Yes A unique identifier for this instrument instance, assigned by the platform. handler_id string Yes The unique identifier for the handler instance that produced this instrument. This corresponds to the 'id' field in the Payment Handler definition. type string Yes The broad category of the instrument (e.g., 'card', 'tokenized_card'). Specific schemas will constrain this to a constant value. billing_address Postal Address No The billing address associated with this payment method. credential Payment Credential No The base definition for any payment credential. Handlers define specific credential types. display object No Display information for this payment instrument. Each payment instrument schema defines its specific display properties, as outlined by the payment handler."},{"location":"specification/checkout/#payment-credential","title":"Payment Credential","text":"Name Type Required Description type string Yes The credential type discriminator. Specific schemas will constrain this to a constant value."},{"location":"specification/checkout/#postal-address","title":"Postal Address","text":"Name Type Required Description extended_address string No An address extension such as an apartment number, C/O or alternative name. street_address string No The street address. address_locality string No The locality in which the street address is, and which is in the region. For example, Mountain View. address_region string No The region in which the locality is, and which is in the country. Required for applicable countries (i.e. state in US, province in CA). For example, California or another appropriate first-level Administrative division. address_country string No The country. Recommended to be in 2-letter ISO 3166-1 alpha-2 format, for example \"US\". For backward compatibility, a 3-letter ISO 3166-1 alpha-3 country code such as \"SGP\" or a full country name such as \"Singapore\" can also be used. postal_code string No The postal code. For example, 94043. first_name string No Optional. First name of the contact associated with the address. last_name string No Optional. Last name of the contact associated with the address. phone_number string No Optional. Phone number of the contact associated with the address."},{"location":"specification/checkout/#response","title":"Response","text":"Name Type Required Description Error: Failed to resolve ''. Ensure ucp-schema is installed: <code>cargo install ucp-schema</code>"},{"location":"specification/checkout/#total","title":"Total","text":""},{"location":"specification/checkout/#total-response","title":"Total Response","text":"Name Type Required Description type string Yes Type of total categorization.Enum: <code>items_discount</code>, <code>subtotal</code>, <code>discount</code>, <code>fulfillment</code>, <code>tax</code>, <code>fee</code>, <code>total</code> display_text string No Text to display against the amount. Should reflect appropriate method (e.g., 'Shipping', 'Delivery'). amount integer Yes If type == total, sums subtotal - discount + fulfillment + tax + fee. Should be &gt;= 0. Amount in minor (cents) currency units."},{"location":"specification/checkout/#ucp-response-checkout","title":"UCP Response Checkout","text":"Name Type Required Description Error: Failed to resolve ''. Ensure ucp-schema is installed: <code>cargo install ucp-schema</code> services any No capabilities any No payment_handlers any Yes"},{"location":"specification/checkout/#order-confirmation","title":"Order Confirmation","text":"Name Type Required Description id string Yes Unique order identifier. permalink_url string Yes Permalink to access the order on merchant site."},{"location":"specification/discount/","title":"Discounts Extension","text":""},{"location":"specification/discount/#discount-extension","title":"Discount Extension","text":""},{"location":"specification/discount/#overview","title":"Overview","text":"<p>Discount extension allows businesses to indicate that they support discount codes on checkout sessions, and specifies how the discount codes are to be shared between the platform and the business.</p> <p>Key features:</p> <ul> <li>Submit one or more discount codes</li> <li>Receive applied discounts with human-readable titles and amounts</li> <li>Rejected codes communicated via <code>messages[]</code> with detailed error codes</li> <li>Automatic discounts surfaced alongside code-based discounts</li> </ul> <p>Dependencies:</p> <ul> <li>Checkout Capability</li> </ul>"},{"location":"specification/discount/#discovery","title":"Discovery","text":"<p>Businesses advertise discount support in their profile:</p> <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {\n      \"dev.ucp.shopping.discount\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"extends\": \"dev.ucp.shopping.checkout\",\n          \"spec\": \"https://ucp.dev/specification/discount\",\n          \"schema\": \"https://ucp.dev/schemas/shopping/discount.json\"\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/discount/#schema","title":"Schema","text":"<p>When this capability is active, checkout is extended with a <code>discounts</code> object.</p>"},{"location":"specification/discount/#discounts-object","title":"Discounts Object","text":"<p>Error: Schema file 'discount_resp.json' not found in any schema directory.</p>"},{"location":"specification/discount/#applied-discount","title":"Applied Discount","text":"<p>Error: Schema file 'discount_resp.json' not found in any schema directory.</p>"},{"location":"specification/discount/#allocation","title":"Allocation","text":"<p>Error: Schema file 'discount_resp.json' not found in any schema directory.</p>"},{"location":"specification/discount/#allocation-details","title":"Allocation Details","text":"<p>The <code>applied</code> array explains how discounts were calculated and distributed.</p>"},{"location":"specification/discount/#allocation-method","title":"Allocation Method","text":"<p>The <code>method</code> field indicates how the discount was calculated:</p> Method Meaning Example <code>each</code> Applied independently per eligible item \"10% off each item\" \u2192 10% \u00d7 item price <code>across</code> Split proportionally by value \"$10 off order\" \u2192 $6 to $60 item, $4 to $40 item"},{"location":"specification/discount/#stacking-order","title":"Stacking Order","text":"<p>When multiple discounts are applied, <code>priority</code> indicates the calculation order. Lower numbers are applied first:</p> <pre><code>Cart: $100\nDiscount A (priority: 1): 20% off \u2192 $100 \u00d7 0.8 = $80\nDiscount B (priority: 2): $10 off \u2192 $80 - $10 = $70\n</code></pre> <p>The order matters because percentage discounts compound differently depending on when they're applied.</p>"},{"location":"specification/discount/#allocations-array","title":"Allocations Array","text":"<p>The <code>allocations</code> array breaks down where each discount dollar landed, using JSONPath to identify targets:</p> Path Pattern Target <code>$.line_items[0]</code> First line item <code>$.line_items[1]</code> Second line item <code>$.totals.shipping</code> Shipping cost <p>This enables platforms to explain exactly how much each discount contributed to each line item, even when multiple discounts stack.</p> <p>Invariant: Sum of <code>allocations[].amount</code> equals <code>applied_discount.amount</code>.</p>"},{"location":"specification/discount/#operations","title":"Operations","text":"<p>Discount codes are submitted via standard checkout create/update operations.</p> <p>Request behavior:</p> <ul> <li>Replacement semantics: Submitting <code>discounts.codes</code> replaces any previously submitted codes</li> <li>Clear codes: Send empty array <code>\"codes\": []</code> to remove all discount codes</li> <li>Case-insensitive: Codes are matched case-insensitively by business</li> </ul> <p>Response behavior:</p> <ul> <li><code>discounts.applied</code> contains all active discounts (code-based + automatic)</li> <li>Rejected codes communicated via <code>messages[]</code> (see below)</li> <li>Discount amounts reflected in <code>totals[]</code> and <code>line_items[].discount</code></li> </ul>"},{"location":"specification/discount/#rejected-codes","title":"Rejected Codes","text":"<p>When a submitted discount code cannot be applied, businesses communicate this via the <code>messages[]</code> array:</p> <pre><code>{\n  \"messages\": [\n    {\n      \"type\": \"warning\",\n      \"code\": \"discount_code_expired\",\n      \"path\": \"$.discounts.codes[0]\",\n      \"content\": \"Code 'SUMMER20' expired on December 1st\"\n    }\n  ]\n}\n</code></pre> <p>Implementation guidance: Operations that affect order totals, or the user's expectation of the total, SHOULD use <code>type: \"warning\"</code> to ensure they are surfaced to the user rather than silently handled by platforms. Rejected discounts are a prime example\u2014the user expects a discount but won't receive it, so they should be informed.</p> <p>Error codes for rejected discounts:</p> Code Description <code>discount_code_expired</code> Code has expired <code>discount_code_invalid</code> Code not found or malformed <code>discount_code_already_applied</code> Code is already applied <code>discount_code_combination_disallowed</code> Cannot combine with another active discount <code>discount_code_user_not_logged_in</code> Code requires authenticated user <code>discount_code_user_ineligible</code> User does not meet eligibility criteria"},{"location":"specification/discount/#automatic-discounts","title":"Automatic Discounts","text":"<p>Businesses may apply discounts automatically based on cart contents, customer segment, or promotional rules:</p> <ul> <li>Appear in <code>discounts.applied</code> with <code>automatic: true</code> and no <code>code</code> field</li> <li>Applied without platform action</li> <li>Cannot be removed by the platform</li> <li>Surfaced for transparency (platform can explain to user why discount was applied)</li> </ul>"},{"location":"specification/discount/#impact-on-line-items-and-totals","title":"Impact on Line Items and Totals","text":"<p>Applied discounts are reflected in the core checkout fields using two distinct total types:</p> Total Type When to Use <code>items_discount</code> Discounts allocated to line items (<code>$.line_items[*]</code>) <code>discount</code> Order-level discounts (shipping, fees, flat order amount) <p>Determining the type: If a discount has <code>allocations</code> pointing to line items, it contributes to <code>items_discount</code>. Discounts without allocations, or with allocations to shipping/fees, contribute to <code>discount</code>.</p> Discount Type Where Reflected Line-item discount <code>line_items[].discount</code> + <code>items_discount</code> Order-level discount <code>totals[]</code> with <code>type: \"discount\"</code> <p>Invariant: <code>totals[type=items_discount].amount</code> equals <code>sum(line_items[].discount)</code>.</p> <p>The <code>discounts.applied</code> array shows what was applied. The <code>totals[]</code> and <code>line_items[].discount</code> show where and how much.</p> <p>Amount convention: All discount amounts are positive integers in minor currency units. When presenting totals to users, display discount types as subtractive (e.g., \"-$13.99\").</p>"},{"location":"specification/discount/#examples","title":"Examples","text":""},{"location":"specification/discount/#order-level-discount","title":"Order-level discount","text":"<p>A flat discount applied to the order total. No allocations\u2014the discount applies to the order as a whole and uses <code>type: \"discount\"</code> in totals.</p> <p>Request:</p> <pre><code>{\n  \"discounts\": {\n    \"codes\": [\"SAVE10\"]\n  }\n}\n</code></pre> <p>Response:</p> <pre><code>{\n  \"discounts\": {\n    \"codes\": [\"SAVE10\"],\n    \"applied\": [\n      {\n        \"code\": \"SAVE10\",\n        \"title\": \"$10 Off Your Order\",\n        \"amount\": 1000\n      }\n    ]\n  },\n  \"totals\": [\n    {\"type\": \"subtotal\", \"display_text\": \"Subtotal\", \"amount\": 5000},\n    {\"type\": \"discount\", \"display_text\": \"Order Discount\", \"amount\": 1000},\n    {\"type\": \"total\", \"display_text\": \"Total\", \"amount\": 4000}\n  ]\n}\n</code></pre>"},{"location":"specification/discount/#mixed-discounts-item-order-level","title":"Mixed discounts (item + order level)","text":"<p>This example shows both discount types: a per-item discount (20% off) allocated to line items, and an automatic shipping discount at the order level.</p> <p>Request:</p> <pre><code>{\n  \"discounts\": {\n    \"codes\": [\"SUMMER20\"]\n  }\n}\n</code></pre> <p>Response:</p> <pre><code>{\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"id\": \"prod_1\",\n        \"quantity\": 2,\n        \"title\": \"T-Shirt\",\n        \"price\": 2000\n      },\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 4000},\n        {\"type\": \"items_discount\", \"amount\": 800},\n        {\"type\": \"total\", \"amount\": 3200}\n      ]\n    }\n  ],\n  \"discounts\": {\n    \"codes\": [\"SUMMER20\"],\n    \"applied\": [\n      {\n        \"code\": \"SUMMER20\",\n        \"title\": \"Summer Sale 20% Off\",\n        \"amount\": 800,\n        \"allocations\": [\n          {\"path\": \"$.line_items[0]\", \"amount\": 800}\n        ]\n      },\n      {\n        \"title\": \"Free shipping on orders over $30\",\n        \"amount\": 599,\n        \"automatic\": true\n      }\n    ]\n  },\n  \"totals\": [\n    {\"type\": \"subtotal\", \"display_text\": \"Subtotal\", \"amount\": 4000},\n    {\"type\": \"items_discount\", \"display_text\": \"Item Discounts\", \"amount\": 800},\n    {\"type\": \"discount\", \"display_text\": \"Order Discounts\", \"amount\": 599},\n    {\"type\": \"fulfillment\", \"display_text\": \"Shipping\", \"amount\": 0},\n    {\"type\": \"total\", \"display_text\": \"Total\", \"amount\": 2601}\n  ]\n}\n</code></pre>"},{"location":"specification/discount/#rejected-discount-code","title":"Rejected discount code","text":"<p>When a discount code cannot be applied, the rejection is communicated via the <code>messages[]</code> array. The code still appears in <code>discounts.codes</code> (echoed back) but not in <code>discounts.applied</code>.</p> <p>Request:</p> <pre><code>{\n  \"discounts\": {\n    \"codes\": [\"SAVE10\", \"EXPIRED50\"]\n  }\n}\n</code></pre> <p>Response:</p> <pre><code>{\n  \"discounts\": {\n    \"codes\": [\"SAVE10\", \"EXPIRED50\"],\n    \"applied\": [\n      {\n        \"code\": \"SAVE10\",\n        \"title\": \"$10 Off Your Order\",\n        \"amount\": 1000\n      }\n    ]\n  },\n  \"totals\": [\n    {\"type\": \"subtotal\", \"display_text\": \"Subtotal\", \"amount\": 5000},\n    {\"type\": \"discount\", \"display_text\": \"Order Discount\", \"amount\": 1000},\n    {\"type\": \"total\", \"display_text\": \"Total\", \"amount\": 4000}\n  ],\n  \"messages\": [\n    {\n      \"type\": \"warning\",\n      \"code\": \"discount_code_expired\",\n      \"path\": \"$.discounts.codes[1]\",\n      \"content\": \"Code 'EXPIRED50' expired on December 1st\"\n    }\n  ]\n}\n</code></pre>"},{"location":"specification/discount/#stacked-discounts-with-allocations","title":"Stacked discounts with allocations","text":"<p>Multiple discounts applied with full allocation breakdown:</p> <p>Response:</p> <pre><code>{\n  \"line_items\": [\n    {\n      \"id\": \"li_1\",\n      \"item\": {\n        \"title\": \"T-Shirt\",\n        \"price\": 6000\n      },\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 6000},\n        {\"type\": \"items_discount\", \"amount\": 1500},\n        {\"type\": \"total\", \"amount\": 4500}\n      ]\n    },\n    {\n      \"id\": \"li_2\",\n      \"item\": {\n        \"title\": \"Socks\",\n        \"price\": 4000\n      },\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 4000},\n        {\"type\": \"items_discount\", \"amount\": 1000},\n        {\"type\": \"total\", \"amount\": 3000}\n      ]\n    }\n  ],\n  \"discounts\": {\n    \"codes\": [\"SUMMER20\", \"LOYALTY5\"],\n    \"applied\": [\n      {\n        \"code\": \"SUMMER20\",\n        \"title\": \"Summer Sale 20% Off\",\n        \"amount\": 2000,\n        \"method\": \"each\",\n        \"priority\": 1,\n        \"allocations\": [\n          {\"path\": \"$.line_items[0]\", \"amount\": 1200},\n          {\"path\": \"$.line_items[1]\", \"amount\": 800}\n        ]\n      },\n      {\n        \"code\": \"LOYALTY5\",\n        \"title\": \"$5 Loyalty Reward\",\n        \"amount\": 500,\n        \"method\": \"across\",\n        \"priority\": 2,\n        \"allocations\": [\n          {\"path\": \"$.line_items[0]\", \"amount\": 300},\n          {\"path\": \"$.line_items[1]\", \"amount\": 200}\n        ]\n      }\n    ]\n  },\n  \"totals\": [\n    {\"type\": \"subtotal\", \"display_text\": \"Subtotal\", \"amount\": 10000},\n    {\"type\": \"items_discount\", \"display_text\": \"Item Discounts\", \"amount\": 2500},\n    {\"type\": \"total\", \"display_text\": \"Total\", \"amount\": 7500}\n  ]\n}\n</code></pre> <p>With this data, an agent can explain:</p> <p>\"Your T-Shirt ($60) got $12 off from the 20% summer sale, plus $3 from your</p>"},{"location":"specification/embedded-checkout/","title":"EP Binding","text":""},{"location":"specification/embedded-checkout/#checkout-capability-ep-binding","title":"Checkout Capability - EP Binding","text":""},{"location":"specification/embedded-checkout/#introduction","title":"Introduction","text":"<p>Embedded Checkout Protocol (ECP) is a checkout-specific implementation of UCP's Embedded Protocol (EP) transport binding that enables a host to embed a business's checkout interface, receive events as the buyer interacts with the checkout, and delegate key user actions such as address and payment selection. ECP is a transport binding (like REST)\u2014it defines how to communicate, not what data exists.</p>"},{"location":"specification/embedded-checkout/#w3c-payment-request-conceptual-alignment","title":"W3C Payment Request Conceptual Alignment","text":"<p>ECP draws inspiration from the W3C Payment Request API, adapting its mental model for embedded checkout scenarios. Developers familiar with Payment Request will recognize similar patterns, though the execution model differs:</p> <p>W3C Payment Request: Browser-controlled. The business calls <code>show()</code> and the browser renders a native payment sheet. Events flow from the payment handler to the business.</p> <p>Embedded Checkout: Business-controlled. The host embeds the business's checkout UI in an iframe/webview. Events flow bidirectionally, with optional delegation allowing the host to handle specific interactions natively.</p> Concept W3C Payment Request Embedded Checkout Initialization <code>new PaymentRequest()</code> Load embedded context with <code>continue_url</code> UI Ready <code>show()</code> returns Promise <code>ec.start</code> notification Payment Method Change <code>paymentmethodchange</code> event <code>ec.payment.change</code> notification Address Change <code>shippingaddresschange</code> event <code>ec.fulfillment.change</code> and <code>ec.fulfillment.address_change_request</code> Submit Payment User accepts \u2192 <code>PaymentResponse</code> Delegated <code>ec.payment.credential_request</code> Completion <code>response.complete()</code> <code>ec.complete</code> notification Errors/Messages Promise rejection <code>ec.messages.change</code> notification <p>Key difference: In W3C Payment Request, the browser orchestrates the payment flow. In Embedded Checkout, the business orchestrates within the embedded context, optionally delegating specific UI (payment method selection, address picker) to the host for native experiences.</p>"},{"location":"specification/embedded-checkout/#terminology-actors","title":"Terminology &amp; Actors","text":""},{"location":"specification/embedded-checkout/#commerce-roles","title":"Commerce Roles","text":"<ul> <li>Business: The seller providing goods/services and the checkout     experience.</li> <li>Buyer: The end user making a purchase.</li> </ul>"},{"location":"specification/embedded-checkout/#technical-components","title":"Technical Components","text":"<ul> <li>Host: The application embedding the checkout (e.g., AI Agent app,     Super     App, Browser). Responsible for the Payment Handler and user     authentication.</li> <li>Embedded Checkout: The business's checkout interface rendered in an     iframe or webview. Responsible for the checkout flow and order creation.</li> <li>Payment Handler: The secure component that performs user authentication     (biometric/PIN) and credential issuance.</li> </ul>"},{"location":"specification/embedded-checkout/#requirements","title":"Requirements","text":""},{"location":"specification/embedded-checkout/#discovery","title":"Discovery","text":"<p>ECP availability is signaled at two levels: service-level discovery declares capability, checkout responses confirm availability and allowed per-session configuration.</p>"},{"location":"specification/embedded-checkout/#service-level-discovery","title":"Service-Level Discovery","text":"<p>When a business advertises the <code>embedded</code> transport in their <code>/.well-known/ucp</code> profile, they declare support for the Embedded Checkout Protocol.</p> <p>Service Discovery Example:</p> <pre><code>{\n    \"services\": {\n        \"dev.ucp.shopping\": [\n            {\n                \"version\": \"2026-01-11\",\n                \"transport\": \"rest\",\n                \"schema\": \"https://ucp.dev/services/shopping/rest.openapi.json\",\n                \"endpoint\": \"https://merchant.example.com/ucp/v1\"\n            },\n            {\n                \"version\": \"2026-01-11\",\n                \"transport\": \"mcp\",\n                \"schema\": \"https://ucp.dev/services/shopping/mcp.openrpc.json\",\n                \"endpoint\": \"https://merchant.example.com/ucp/mcp\"\n            },\n            {\n                \"version\": \"2026-01-11\",\n                \"transport\": \"embedded\",\n                \"schema\": \"https://ucp.dev/services/shopping/embedded.openrpc.json\"\n            }\n        ]\n    }\n}\n</code></pre> <p>When <code>embedded</code> is absent from the service definition, the business only supports redirect-based checkout continuation via <code>continue_url</code>.</p>"},{"location":"specification/embedded-checkout/#per-checkout-configuration","title":"Per-Checkout Configuration","text":"<p>Service-level discovery declares that a business supports ECP, but does not guarantee that every checkout session will enable it. Businesses MUST include an embedded service binding with <code>config.delegate</code> in checkout responses to indicate ECP availability and allowed delegations for a specific session.</p> <p>Checkout Response Example:</p> <pre><code>{\n    \"id\": \"checkout_abc123\",\n    \"status\": \"open\",\n    \"continue_url\": \"https://merchant.example.com/checkout/abc123\",\n    \"ucp\": {\n        \"version\": \"2026-01-11\",\n        \"services\": {\n            \"dev.ucp.shopping\": [\n                {\n                    \"version\": \"2026-01-11\",\n                    \"transport\": \"embedded\",\n                    \"config\": {\n                        \"delegate\": [\"payment.credential\", \"fulfillment.address_change\"]\n                    }\n                }\n            ]\n        },\n        \"capabilities\": {...},\n        \"payment_handlers\": {...}\n    }\n}\n</code></pre> <p>The <code>config.delegate</code> array confirms the delegations the business accepted for this checkout session\u2014the intersection of what the host requested via <code>ec_delegate</code> and what the business allows. This may vary based on:</p> <ul> <li>Cart contents: Some products may require business-handled payment flows</li> <li>Agent authorization: Authenticated agents may receive more delegations</li> <li>Business policy: Risk rules, regional restrictions, etc.</li> </ul> <p>When an embedded service binding with <code>config.delegate</code> is present:</p> <ul> <li>ECP is available for this checkout via <code>continue_url</code></li> <li><code>config.delegate</code> confirms which delegations the business accepted</li> <li>This mirrors the <code>delegate</code> field in the <code>ec.ready</code> handshake</li> </ul> <p>When the embedded service binding is absent from a checkout response (even if service-level discovery advertises embedded support), the checkout only supports redirect-based continuation via <code>continue_url</code>.</p>"},{"location":"specification/embedded-checkout/#loading-an-embedded-checkout-url","title":"Loading an Embedded Checkout URL","text":"<p>When a host receives a checkout response with an embedded service binding, it MAY initiate an ECP session by loading the <code>continue_url</code> in an embedded context.</p> <p>Before loading the embedded context, the host SHOULD:</p> <ol> <li>Check <code>config.delegate</code> for available delegations</li> <li>Prepare handlers for delegations the host wants to support</li> <li>Optionally prepare authentication credentials if required by the business</li> </ol> <p>To initiate the session, the host MUST augment the <code>continue_url</code> with ECP query parameters using the <code>ec_</code> prefix.</p> <p>All ECP parameters are passed via URL query string, not HTTP headers, to ensure maximum compatibility across different embedding environments. Parameters use the <code>ec_</code> prefix to avoid namespace pollution and clearly distinguish ECP parameters from business-specific query parameters:</p> <ul> <li><code>ec_version</code> (string, REQUIRED): The UCP version for this session     (format: <code>YYYY-MM-DD</code>). Must match the version from the checkout response.</li> <li><code>ec_auth</code> (string, OPTIONAL): Authentication token in business-defined     format</li> <li><code>ec_delegate</code> (string, OPTIONAL): Comma-delimited list of delegations     the host wants to handle. SHOULD be a subset of <code>config.delegate</code>     from the embedded service binding.</li> </ul>"},{"location":"specification/embedded-checkout/#authentication","title":"Authentication","text":"<p>Token Format:</p> <ul> <li>The <code>auth</code> parameter format is entirely business-defined</li> <li>Common formats include JWT, OAuth tokens, API keys, or session identifiers</li> <li>Businesses MUST document their expected token format and validation process</li> </ul> <p>Example (Informative - JWT-based):</p> <pre><code>// One possible implementation using JWT\n{\n  \"alg\": \"HS256\",\n  \"typ\": \"JWT\"\n}\n{\n  \"iat\": 1234567890,\n  \"exp\": 1234568190,\n  \"jti\": \"unique-id\",\n  // ... business-specific claims ...\n}\n</code></pre> <p>Businesses MUST validate authentication according to their security requirements.</p> <p>Example initialization with authentication:</p> <pre><code>https://example.com/checkout/abc123?ec_version=2026-01-11&amp;ec_auth=eyJ...\n</code></pre> <p>Note: All query parameter values must be properly URL-encoded per RFC 3986.</p>"},{"location":"specification/embedded-checkout/#delegation","title":"Delegation","text":"<p>The optional <code>ec_delegate</code> parameter declares which operations the host wants to handle natively, instead of having a buyer handle them in the Embedded Checkout UI. Each delegation identifier maps to a corresponding <code>_request</code> message following a consistent pattern: <code>ec.{delegation}_request</code></p> <p>Example delegation identifiers:</p> <code>ec_delegate</code> value Corresponding message <code>payment.instruments_change</code> <code>ec.payment.instruments_change_request</code> <code>payment.credential</code> <code>ec.payment.credential_request</code> <code>fulfillment.address_change</code> <code>ec.fulfillment.address_change_request</code> <p>Extensions define their own delegation identifiers; see each extension's specification for available options.</p> <pre><code>?ec_version=2026-01-11&amp;ec_delegate=payment.instruments_change,payment.credential,fulfillment.address_change\n</code></pre>"},{"location":"specification/embedded-checkout/#delegation-negotiation","title":"Delegation Negotiation","text":"<p>Delegation follows a narrowing chain from business policy to final acceptance:</p> <pre><code>config.delegate \u2287 ec_delegate \u2287 ec.ready delegate\n</code></pre> <ol> <li>Business allows (<code>config.delegate</code> in checkout response): The set of     delegations the business permits for this checkout session</li> <li>Host requests (<code>ec_delegate</code> URL parameter): The subset the host wants     to handle natively</li> <li>ECP accepts (<code>delegate</code> in <code>ec.ready</code>): The final subset the Embedded     Checkout will actually delegate</li> </ol> <p>Each stage is a subset of the previous:</p> <ul> <li>The host SHOULD only request delegations present in <code>config.delegate</code></li> <li>The business SHOULD NOT accept delegations not present in     <code>config.delegate</code> and MUST confirm accepted delegations in <code>ec.ready</code></li> </ul>"},{"location":"specification/embedded-checkout/#delegation-contract","title":"Delegation Contract","text":"<p>Delegation creates a binding contract between the host and Embedded Checkout. However, the Embedded Checkout MAY restrict delegation to authenticated or approved hosts based on business policy.</p>"},{"location":"specification/embedded-checkout/#delegation-acceptance","title":"Delegation Acceptance","text":"<p>The Embedded Checkout determines which delegations to honor based on:</p> <ul> <li>Authentication status (via <code>ec_auth</code> parameter)</li> <li>host authorization level</li> <li>Business policy</li> </ul> <p>The Embedded Checkout MUST indicate accepted delegations in the <code>ec.ready</code> request via the <code>delegate</code> field (see <code>ec.ready</code>). If a requested delegation is not accepted, the Embedded Checkout MUST handle that capability using its own UI.</p>"},{"location":"specification/embedded-checkout/#binding-requirements","title":"Binding Requirements","text":"<p>Once delegation is accepted, both parties enter a binding contract:</p> <p>Embedded Checkout responsibilities:</p> <ol> <li>MUST fire the appropriate <code>{action}_request</code> message when that action is     triggered</li> <li>MUST wait for the host's response before proceeding</li> <li>MUST NOT show its own UI for that delegated action</li> </ol> <p>Host responsibilities:</p> <ol> <li>MUST respond to every <code>{action}_request</code> message it receives</li> <li>MUST respond with an appropriate error if the user cancels</li> <li>SHOULD show loading/processing states while handling delegation</li> </ol>"},{"location":"specification/embedded-checkout/#333-delegation-flow","title":"3.3.3 Delegation Flow","text":"<ol> <li>Request: Embedded Checkout sends an <code>ec.{capability}.{action}_request</code>     message with current state (includes <code>id</code>)</li> <li>Native UI: Host presents native UI for the delegated action</li> <li>Response: host sends back a JSON-RPC response with matching <code>id</code> and     <code>result</code> or <code>error</code></li> <li>Update: Embedded Checkout updates its state and may send subsequent     change notifications</li> </ol> <p>See Payment Extension and Fulfillment Extension for capability-specific delegation details.</p>"},{"location":"specification/embedded-checkout/#navigation-constraints","title":"Navigation Constraints","text":"<p>When checkout is rendered in embedded mode, the implementation SHOULD prevent off-checkout navigation to maintain a focused checkout experience. The embedded view is intended to provide a checkout flow, not a general-purpose browser.</p> <p>Navigation Requirements:</p> <ul> <li>The embedded checkout SHOULD block or intercept navigation attempts to     URLs outside the checkout flow</li> <li>The embedded checkout SHOULD remove or disable UI elements that would     navigate away from checkout (e.g., external links, navigation bars)</li> <li>The embedder MAY implement additional navigation restrictions at the     container level</li> </ul> <p>Permitted Exceptions: The following navigation scenarios MAY be allowed when required for checkout completion:</p> <ul> <li>Payment provider redirects: off-site payment flows</li> <li>3D Secure verification: card authentication frames and redirects</li> <li>Bank authorization: open banking or similar authorization flows</li> <li>Identity verification: KYC/AML compliance checks when required</li> </ul> <p>These exceptions SHOULD return the user to the checkout flow upon completion.</p>"},{"location":"specification/embedded-checkout/#transport-messaging","title":"Transport &amp; Messaging","text":""},{"location":"specification/embedded-checkout/#message-format","title":"Message Format","text":"<p>All ECP messages MUST use JSON-RPC 2.0 format (RFC 7159). Each message MUST contain:</p> <ul> <li><code>jsonrpc</code>: MUST be <code>\"2.0\"</code></li> <li><code>method</code>: The message name (e.g., <code>\"ec.start\"</code>)</li> <li><code>params</code>: Message-specific payload (may be empty object)</li> <li><code>id</code>: (Optional) Present only for requests that expect responses</li> </ul>"},{"location":"specification/embedded-checkout/#message-types","title":"Message Types","text":"<p>Requests (with <code>id</code> field):</p> <ul> <li>Require a response from the receiver</li> <li>MUST include a unique <code>id</code> field</li> <li>Receiver MUST respond with matching <code>id</code></li> <li>Response MUST be either a <code>result</code> or <code>error</code> object</li> <li>Used for operations requiring acknowledgment or data</li> </ul> <p>Notifications (without <code>id</code> field):</p> <ul> <li>Informational only, no response expected</li> <li>MUST NOT include an <code>id</code> field</li> <li>Receiver MUST NOT send a response</li> <li>Used for state updates and informational events</li> </ul>"},{"location":"specification/embedded-checkout/#response-handling","title":"Response Handling","text":"<p>For requests (messages with <code>id</code>), receivers MUST respond with either:</p> <p>Success Response:</p> <pre><code>{ \"jsonrpc\": \"2.0\", \"id\": \"...\", \"result\": {...} }\n</code></pre> <p>Error Response:</p> <pre><code>{ \"jsonrpc\": \"2.0\", \"id\": \"...\", \"error\": {...} }\n</code></pre>"},{"location":"specification/embedded-checkout/#communication-channels","title":"Communication Channels","text":""},{"location":"specification/embedded-checkout/#communication-channel-for-web-based-hosts","title":"Communication Channel for Web-Based Hosts","text":"<p>When the host is a web application, communication starts using <code>postMessage</code> between the host and Checkout windows. The host MUST listen for <code>postMessage</code> calls from the embedded window, and when a message is received, they MUST validate the origin matches the <code>checkout_url</code> used to start the checkout.</p> <p>Upon validation, the host MAY create a <code>MessageChannel</code>, and transfer one of its ports in the result of the <code>ec.ready</code> response. When a host responds with a <code>MessagePort</code>, all subsequent messages MUST be sent over that channel. Otherwise, the host and business MUST continue using <code>postMessage()</code> between their <code>window</code> objects, including origin validation.</p>"},{"location":"specification/embedded-checkout/#communication-channel-for-native-hosts","title":"Communication Channel for Native Hosts","text":"<p>When the host is a native application, they MUST inject globals into the Embedded Checkout that allows <code>postMessage</code> communication between the web and native environments. The host MUST create at least one of the following globals:</p> <ul> <li><code>window.EmbeddedCheckoutProtocolConsumer</code> (preferred)</li> <li><code>window.webkit.messageHandlers.EmbeddedCheckoutProtocolConsumer</code></li> </ul> <p>This object MUST implement the following interface:</p> <pre><code>{\n  postMessage(message: string): void\n}\n</code></pre> <p>Where <code>message</code> is a JSON-stringified JSON-RPC 2.0 message. The host MUST parse the JSON string before processing.</p> <p>For messages traveling from the host to the Embedded Checkout, the host MUST inject JavaScript in the webview that will call <code>window.EmbeddedCheckoutProtocol.postMessage()</code> with the JSON RPC message. The Embedded Checkout MUST initialize this global object \u2014 and start listening for <code>postMessage()</code> calls \u2014 before the <code>ec.ready</code> message is sent.</p>"},{"location":"specification/embedded-checkout/#message-api-reference","title":"Message API Reference","text":""},{"location":"specification/embedded-checkout/#message-categories","title":"Message Categories","text":""},{"location":"specification/embedded-checkout/#core-messages","title":"Core Messages","text":"<p>Core messages are defined by the ECP specification and MUST be supported by all implementations. All messages are sent from Embedded Checkout to host.</p> Category Purpose Pattern Core Messages Handshake Establish connection between host and Embedded Checkout Request <code>ec.ready</code> Lifecycle Inform of checkout state transitions Notification <code>ec.start</code>, <code>ec.complete</code> State Change Inform of checkout field changes Notification <code>ec.line_items.change</code>, <code>ec.buyer.change</code>, <code>ec.payment.change</code>, <code>ec.messages.change</code>"},{"location":"specification/embedded-checkout/#extension-messages","title":"Extension Messages","text":"<p>Extensions MAY extend the Embedded protocol by defining additional messages. Extension messages MUST follow the naming convention:</p> <ul> <li>Notifications: <code>ec.{capability}.change</code> \u2014 state change notifications (no     <code>id</code>)</li> <li>Delegation requests: <code>ec.{capability}.{action}_request</code> \u2014 requires     response (has <code>id</code>)</li> </ul> <p>Where:</p> <ul> <li><code>{capability}</code> matches the capability identifier from discovery</li> <li><code>{action}</code> describes the specific action being delegated (e.g.,     <code>instruments_change</code>, <code>address_change</code>)</li> <li><code>_request</code> suffix signals this is a delegation point requiring a response</li> </ul>"},{"location":"specification/embedded-checkout/#handshake-messages","title":"Handshake Messages","text":""},{"location":"specification/embedded-checkout/#ecready","title":"<code>ec.ready</code>","text":"<p>Upon rendering, the Embedded Checkout MUST broadcast readiness to the parent context using the <code>ec.ready</code> message. This message initializes a secure communication channel between the host and Embedded Checkout, communicates which delegations were accepted, and allows the host to provide additional, display-only state for the checkout that was not communicated over UCP checkout actions.</p> <ul> <li>Direction: Embedded Checkout \u2192 host</li> <li>Type: Request</li> <li>Payload:<ul> <li><code>delegate</code> (array of strings, REQUIRED): List of delegation     identifiers accepted by the Embedded Checkout. MUST be a subset of     both <code>ec_delegate</code> (what host requested) and <code>config.delegate</code> from the     checkout response (what business allows). An empty array means no     delegations were accepted.</li> </ul> </li> </ul> <p>Example Message (no delegations accepted):</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"ready_1\",\n    \"method\": \"ec.ready\",\n    \"params\": {\n        \"delegate\": []\n    }\n}\n</code></pre> <p>Example Message (delegations accepted):</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"ready_1\",\n    \"method\": \"ec.ready\",\n    \"params\": {\n        \"delegate\": [\"payment.credential\", \"fulfillment.address_change\"]\n    }\n}\n</code></pre> <p>The <code>ec.ready</code> message is a request, which means that the host MUST respond to complete the handshake.</p> <ul> <li>Direction: host \u2192 Embedded Checkout</li> <li>Type: Response</li> <li>Result Payload:<ul> <li><code>upgrade</code> (object, OPTIONAL): An object describing how the Embedded     Checkout should update the communication channel it uses to communicate     with the host.</li> <li><code>checkout</code> (object, OPTIONAL): Additional, display-only state for     the checkout that was not communicated over UCP checkout actions. This     is used to populate the checkout UI, and may only be used to populate     the following fields, under specific conditions:<ul> <li><code>payment.instruments</code>: can be overwritten when the host and Embedded     Checkout both accept the <code>payment.instruments_change</code> delegation.</li> </ul> </li> </ul> </li> </ul> <p>Example Message:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"ready_1\",\n    \"result\": {}\n}\n</code></pre> <p>Hosts MAY respond with an <code>upgrade</code> field to update the communication channel between host and Embedded Checkout. Currently, this object only supports a <code>port</code> field, which MUST be a <code>MessagePort</code> object, and MUST be transferred to the embedded checkout context (e.g., with <code>{transfer: [port2]}</code> on the host's <code>iframe.contentWindow.postMessage()</code> call):</p> <p>Example Message:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"ready_1\",\n    \"result\": {\n        \"upgrade\": {\n            \"port\": \"[Transferable MessagePort]\"\n        }\n    }\n}\n</code></pre> <p>When the host responds with an <code>upgrade</code> object, the Embedded Checkout MUST discard any other information in the message, send a new <code>ec.ready</code> message over the upgraded communication channel, and wait for a new response. All subsequent messages MUST be sent only over the upgraded communication channel.</p> <p>The host MAY also respond with a <code>checkout</code> object, which will be used to populate the checkout UI according to the delegation contract between host and business.</p> <p>Example Message: Providing payment instruments, including display information:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"ready_1\",\n    \"result\": {\n        \"checkout\": {\n            \"payment\": {\n                // The instrument structure is defined by the handler's instrument schema\n                \"instruments\": [\n                    {\n                        \"id\": \"payment_instrument_123\",\n                        \"handler_id\": \"merchant_psp_handler_123\",\n                        \"type\": \"card\",\n                        \"selected\": true,\n                        \"display\": {\n                            \"brand\": \"visa\",\n                            \"expiry_month\": 12,\n                            \"expiry_year\": 2026,\n                            \"last_digits\": \"1111\",\n                            \"description\": \"Visa \u2022\u2022\u2022\u2022 1111\",\n                            \"card_art\": \"https://host.com/cards/visa-gold.png\"\n                        }\n                    }\n                ]\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"specification/embedded-checkout/#lifecycle-messages","title":"Lifecycle Messages","text":""},{"location":"specification/embedded-checkout/#ecstart","title":"<code>ec.start</code>","text":"<p>Signals that checkout is visible and ready for interaction.</p> <ul> <li>Direction: Embedded Checkout \u2192 host</li> <li>Type: Notification</li> <li>Payload:<ul> <li><code>checkout</code>: The latest state of the checkout, using the same structure     as the <code>checkout</code> object in UCP responses.</li> </ul> </li> </ul> <p>Example Message:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"ec.start\",\n    \"params\": {\n        \"checkout\": {\n            \"id\": \"checkout_123\",\n            \"status\": \"incomplete\",\n            \"messages\": [\n                {\n                    \"type\": \"error\",\n                    \"code\": \"missing\",\n                    \"path\": \"$.buyer.shipping_address\",\n                    \"content\": \"Shipping address is required\",\n                    \"severity\": \"recoverable\"\n                }\n            ],\n            \"totals\": [/* ... */],\n            \"line_items\": [/* ... */],\n            \"buyer\": {/* ... */},\n            \"payment\": {/* ... */}\n        }\n    }\n}\n</code></pre>"},{"location":"specification/embedded-checkout/#eccomplete","title":"<code>ec.complete</code>","text":"<p>Indicates successful checkout completion.</p> <ul> <li>Direction: Embedded Checkout \u2192 host</li> <li>Type: Notification</li> <li>Payload:<ul> <li><code>checkout</code>: The latest state of the checkout, using the same structure     as the <code>checkout</code> object in UCP responses.</li> </ul> </li> </ul> <p>Example Message:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"ec.complete\",\n    \"params\": {\n        \"checkout\": {\n            \"id\": \"checkout_123\",\n            // ... other checkout fields\n            \"order\": {\n                \"id\": \"ord_99887766\",\n                \"permalink_url\": \"https://merchant.com/orders/ord_99887766\"\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"specification/embedded-checkout/#state-change-messages","title":"State Change Messages","text":"<p>State change messages inform the embedder of changes that have already occurred in the checkout interface. These are informational only. The checkout has already applied the changes and rendered the updated UI.</p>"},{"location":"specification/embedded-checkout/#ecline_itemschange","title":"<code>ec.line_items.change</code>","text":"<p>Line items have been modified (quantity changed, items added/removed) in the checkout UI.</p> <ul> <li>Direction: Embedded Checkout \u2192 host</li> <li>Type: Notification</li> <li>Payload:<ul> <li><code>checkout</code>: The latest state of the checkout</li> </ul> </li> </ul> <p>Example Message:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"ec.line_items.change\",\n    \"params\": {\n        \"checkout\": {\n            \"id\": \"checkout_123\",\n            // The entire checkout object is provided, including the updated line items and totals\n            \"totals\": [\n                /* ... */\n            ],\n            \"line_items\": [\n                /* ... */\n            ]\n            // ...\n        }\n    }\n}\n</code></pre>"},{"location":"specification/embedded-checkout/#ecbuyerchange","title":"<code>ec.buyer.change</code>","text":"<p>Buyer information has been updated in the checkout UI.</p> <ul> <li>Direction: Embedded Checkout \u2192 host</li> <li>Type: Notification</li> <li>Payload:<ul> <li><code>checkout</code>: The latest state of the checkout</li> </ul> </li> </ul> <p>Example Message:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"ec.buyer.change\",\n    \"params\": {\n        \"checkout\": {\n            \"id\": \"checkout_123\",\n            // The entire checkout object is provided, including the updated buyer information\n            \"buyer\": {\n                /* ... */\n            }\n            // ...\n        }\n    }\n}\n</code></pre>"},{"location":"specification/embedded-checkout/#ecmessageschange","title":"<code>ec.messages.change</code>","text":"<p>Checkout messages have been updated. Messages include errors, warnings, and informational notices about the checkout state.</p> <ul> <li>Direction: Embedded Checkout \u2192 host</li> <li>Type: Notification</li> <li>Payload:<ul> <li><code>checkout</code>: The latest state of the checkout</li> </ul> </li> </ul> <p>Example Message:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"ec.messages.change\",\n    \"params\": {\n        \"checkout\": {\n            \"id\": \"checkout_123\",\n            \"messages\": [\n                {\n                    \"type\": \"error\",\n                    \"code\": \"invalid_address\",\n                    \"path\": \"$.buyer.shipping_address\",\n                    \"content\": \"We cannot ship to this address\",\n                    \"severity\": \"recoverable\"\n                },\n                {\n                    \"type\": \"info\",\n                    \"code\": \"free_shipping\",\n                    \"content\": \"Free shipping applied!\"\n                }\n            ]\n            // ...\n        }\n    }\n}\n</code></pre>"},{"location":"specification/embedded-checkout/#ecpaymentchange","title":"<code>ec.payment.change</code>","text":"<p>Payment state has been updated. See <code>ec.payment.change</code> for full documentation.</p>"},{"location":"specification/embedded-checkout/#payment-extension","title":"Payment Extension","text":"<p>The payment extension defines how a host can use state change notifications and delegation requests to orchestrate user escalation flows. When a checkout URL includes <code>ec_delegate=payment.instruments_change,payment.credential</code>, the host gains control over payment method selection and token acquisition, providing state updates to the Embedded Checkout in response.</p>"},{"location":"specification/embedded-checkout/#payment-overview-host-choice","title":"Payment Overview &amp; Host Choice","text":"<p>Payment delegation allows for two different patterns of orchestrating the host and Embedded Checkout:</p> <p>Option A: Host Delegates to Embedded Checkout The host does NOT include payment delegation in the URL. The Embedded Checkout handles payment selection and processing using its own UI and payment flows. This is the standard, non-delegated flow.</p> <p>Option B: Host Takes Control The host includes <code>ec_delegate=payment.instruments_change,payment.credential</code> in the Checkout URL, informing the Embedded Checkout to delegate payment UI and token acquisition to the host. When delegated:</p> <ul> <li>Embedded Checkout responsibilities:<ul> <li>Display current payment method with a change intent (e.g., \"Change     Payment Method\" button)</li> <li>Wait for a response to the <code>ec.payment.credential_request</code> message     before submitting the payment</li> </ul> </li> <li>Host responsibilities:<ul> <li>Respond to the <code>ec.payment.instruments_change_request</code> by rendering     native UI for the buyer to select alternative payment methods, then     respond with the selected method</li> <li>Respond to the <code>ec.payment.credential_request</code> by obtaining a payment     token for the selected payment method, and sending that token to the     Embedded Checkout</li> </ul> </li> </ul>"},{"location":"specification/embedded-checkout/#payment-message-api-reference","title":"Payment Message API Reference","text":""},{"location":"specification/embedded-checkout/#ecpaymentchange_1","title":"<code>ec.payment.change</code>","text":"<p>Informs the host that something has changed in the payment section of the checkout UI, such as a new payment method being selected.</p> <ul> <li>Direction: Embedded Checkout \u2192 host</li> <li>Type: Notification</li> <li>Payload:<ul> <li><code>checkout</code>: The latest state of the checkout</li> </ul> </li> </ul> <p>Example Message:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"ec.payment.change\",\n    \"params\": {\n        \"checkout\": {\n            \"id\": \"checkout_123\",\n            // The entire checkout object is provided, including the updated payment details\n            \"payment\": {\n                \"instruments\": [\n                    {\n                        \"id\": \"payment_instrument_123\",\n                        \"selected\": true\n                        /* ... */\n                    }\n                ]\n            }\n            // ...\n        }\n    }\n}\n</code></pre>"},{"location":"specification/embedded-checkout/#ecpaymentinstruments_change_request","title":"<code>ec.payment.instruments_change_request</code>","text":"<p>Requests the host to present payment instrument selection UI.</p> <ul> <li>Direction: Embedded Checkout \u2192 host</li> <li>Type: Request</li> <li>Payload:<ul> <li><code>checkout</code>: The latest state of the checkout</li> </ul> </li> </ul> <p>Example Message:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"payment_instruments_change_request_1\",\n    \"method\": \"ec.payment.instruments_change_request\",\n    \"params\": {\n        \"checkout\": {\n            \"id\": \"checkout_123\",\n            // The entire checkout object is provided, including the current payment details\n            \"payment\": {\n                /* ... */\n            }\n            // ...\n        }\n    }\n}\n</code></pre> <p>The host MUST respond with either an error, or the newly-selected payment instruments. In successful responses, the host MUST respond with a partial update to the <code>checkout</code> object, with only the <code>payment.instruments</code> field updated. The Embedded Checkout MUST treat this update as a PUT-style change by entirely replacing the existing state for the provided fields, rather than attempting to merge the new data with existing state.</p> <ul> <li>Direction: host \u2192 Embedded Checkout</li> <li>Type: Response</li> <li>Payload:<ul> <li><code>checkout</code>: The update to apply to the checkout object</li> </ul> </li> </ul> <p>Example Success Response:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"payment_instruments_change_request_1\",\n    \"result\": {\n        \"checkout\": {\n            \"payment\": {\n                // The instrument structure is defined by the handler's instrument schema\n                \"instruments\": [\n                    {\n                        \"id\": \"payment_instrument_123\",\n                        \"handler_id\": \"merchant_psp_handler_123\",\n                        \"type\": \"card\",\n                        \"selected\": true,\n                        \"display\": {\n                            \"brand\": \"visa\",\n                            \"expiry_month\": 12,\n                            \"expiry_year\": 2026,\n                            \"last_digits\": \"1111\",\n                            \"description\": \"Visa \u2022\u2022\u2022\u2022 1111\",\n                            \"card_art\": \"https://host.com/cards/visa-gold.png\"\n                        }\n                        // No `credential` yet; it will be attached in the `ec.payment.credential_request` response\n                    }\n                ]\n            }\n        }\n    }\n}\n</code></pre> <p>Example Error Response:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"payment_instruments_change_request_1\",\n    \"error\": {\n        \"code\": \"abort_error\",\n        \"message\": \"User closed the payment sheet without authorizing.\"\n    }\n}\n</code></pre>"},{"location":"specification/embedded-checkout/#ecpaymentcredential_request","title":"<code>ec.payment.credential_request</code>","text":"<p>Requests a credential for the selected payment instrument during checkout submission.</p> <ul> <li>Direction: Embedded Checkout \u2192 Host</li> <li>Type: Request</li> <li>Payload:<ul> <li><code>checkout</code>: The latest state of the checkout</li> </ul> </li> </ul> <p>Example Message:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"payment_credential_request_1\",\n    \"method\": \"ec.payment.credential_request\",\n    \"params\": {\n        \"checkout\": {\n            \"id\": \"checkout_123\",\n            // The entire checkout object is provided, including the current payment details\n            \"payment\": {\n                \"instruments\": [\n                    {\n                        \"id\": \"payment_instrument_123\",\n                        \"selected\": true\n                        /* ... */\n                    }\n                ]\n            }\n            // ...\n        }\n    }\n}\n</code></pre> <p>The host MUST respond with either an error, or the credential for the selected payment instrument. In successful responses, the host MUST supply a partial update to the <code>checkout</code> object, updating the instrument with <code>selected: true</code> with the new <code>credentials</code> field. The Embedded Checkout MUST treat this update as a PUT-style change by entirely replacing the existing state for <code>payment.instruments</code>, rather than attempting to merge the new data with existing state.</p> <ul> <li>Direction: host \u2192 Embedded Checkout</li> <li>Type: Response</li> <li>Payload:<ul> <li><code>checkout</code>: The update to apply to the checkout object</li> </ul> </li> </ul> <p>Example Success Response:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"payment_credential_request_1\",\n    \"result\": {\n        \"checkout\": {\n            \"payment\": {\n                \"instruments\": [\n                    {\n                        \"id\": \"payment_instrument_123\",\n                        \"handler_id\": \"merchant_psp_handler_123\",\n                        \"type\": \"card\",\n                        \"selected\": true,\n                        \"display\": {\n                            \"brand\": \"visa\",\n                            \"expiry_month\": 12,\n                            \"expiry_year\": 2026,\n                            \"last_digits\": \"1111\",\n                            \"description\": \"Visa \u2022\u2022\u2022\u2022 1111\",\n                            \"card_art\": \"https://host.com/cards/visa-gold.png\"\n                        },\n                        // The credential structure is defined by the handler's instrument schema\n                        \"credential\": {\n                            \"type\": \"token\",\n                            \"token\": \"tok_123\"\n                        }\n                    }\n                ]\n            }\n        }\n    }\n}\n</code></pre> <p>Example Error Response:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"payment_credential_request_1\",\n    \"error\": {\n        \"code\": \"abort_error\",\n        \"message\": \"User closed the payment sheet without authorizing.\"\n    }\n}\n</code></pre> <p>Host responsibilities during payment token delegation:</p> <ol> <li>Confirmation: Host displays the Trusted Payment UI (Payment Sheet /     Biometric Prompt). The host MUST NOT silently release a token based     solely on the message.</li> <li>Auth: host performs User Authorization via the Payment Handler.</li> <li>AP2 Integration (Optional): If <code>ucp.ap2_mandate</code> is active (see     AP2 extension), the host generates the     <code>payment_mandate</code> here using trusted user interface.</li> </ol>"},{"location":"specification/embedded-checkout/#fulfillment-extension","title":"Fulfillment Extension","text":"<p>The fulfillment extension defines how a host can delegate address selection to provide a native address picker experience. When a checkout URL includes <code>ec_delegate=fulfillment.address_change</code>, the host gains control over shipping address selection, providing address updates to the Embedded Checkout in response.</p>"},{"location":"specification/embedded-checkout/#fulfillment-overview-host-choice","title":"Fulfillment Overview &amp; Host Choice","text":"<p>Fulfillment delegation allows for two different patterns:</p> <p>Option A: Host Delegates to Embedded Checkout The host does NOT include fulfillment delegation in the URL. The Embedded Checkout handles address input using its own UI and address forms. This is the standard, non-delegated flow.</p> <p>Option B: host Takes Control The host includes <code>ec_delegate=fulfillment.address_change</code> in the Checkout URL, informing the Embedded Checkout to delegate address selection UI to the host. When delegated:</p> <p>Embedded Checkout responsibilities:</p> <ul> <li>Display current shipping address with a change intent (e.g., \"Change     Address\" button)</li> <li>Send <code>ec.fulfillment.address_change_request</code> when the buyer triggers address     change</li> <li>Update shipping options based on the address returned by the host</li> </ul> <p>Host responsibilities:</p> <ul> <li>Respond to the <code>ec.fulfillment.address_change_request</code> by rendering native     UI for the buyer to select or enter a shipping address</li> <li>Respond with the selected address in UCP PostalAddress format</li> </ul>"},{"location":"specification/embedded-checkout/#fulfillment-message-api-reference","title":"Fulfillment Message API Reference","text":""},{"location":"specification/embedded-checkout/#ecfulfillmentchange","title":"<code>ec.fulfillment.change</code>","text":"<p>Informs the host that the fulfillment details have been changed in the checkout UI.</p> <ul> <li>Direction: Embedded Checkout \u2192 Host</li> <li>Type: Notification</li> <li>Payload:<ul> <li><code>checkout</code>: The latest state of the checkout</li> </ul> </li> </ul> <p>Example Message:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"ec.fulfillment.change\",\n    \"params\": {\n        \"checkout\": {\n            \"id\": \"checkout_123\",\n            // The entire checkout object is provided, including the updated fulfillment details\n            \"fulfillment\": {\n                /* ... */\n            }\n            // ...\n        }\n    }\n}\n</code></pre>"},{"location":"specification/embedded-checkout/#ecfulfillmentaddress_change_request","title":"<code>ec.fulfillment.address_change_request</code>","text":"<p>Requests the host to present address selection UI for a shipping fulfillment method.</p> <ul> <li>Direction: Embedded Checkout \u2192 Host</li> <li>Type: Request</li> <li>Payload:<ul> <li><code>checkout</code>: The latest state of the checkout</li> </ul> </li> </ul> <p>Example Message:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"fulfillment_address_change_request_1\",\n    \"method\": \"ec.fulfillment.address_change_request\",\n    \"params\": {\n        \"checkout\": {\n            \"id\": \"checkout_123\",\n            // The entire checkout object is provided, including the current fulfillment details\n            \"fulfillment\": {\n                \"methods\": [\n                    {\n                        \"id\": \"method_1\",\n                        \"type\": \"shipping\",\n                        \"selected_destination_id\": \"address_123\",\n                        \"destinations\": [\n                            {\n                                \"id\": \"address_123\",\n                                \"address_street\": \"456 Old Street\"\n                                // ...\n                            }\n                        ]\n                        // ...\n                    }\n                ]\n            }\n            // ...\n        }\n    }\n}\n</code></pre> <p>The host MUST respond with either an error, or the newly-selected address. In successful responses, the host MUST respond with an updated <code>fulfillment.methods</code> object, updating the <code>selected_destination_id</code> and <code>destinations</code> fields for fulfillment methods, and otherwise preserving the existing state. The Embedded Checkout MUST treat this update as a PUT-style change by entirely replacing the existing state for <code>fulfillment.methods</code>, rather than attempting to merge the new data with existing state.</p> <ul> <li>Direction: host \u2192 Embedded Checkout</li> <li>Type: Response</li> <li>Payload:<ul> <li><code>checkout</code>: The update to apply to the checkout object</li> </ul> </li> </ul> <p>Example Success Response:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"fulfillment_address_change_request_1\",\n    \"result\": {\n        \"checkout\": {\n            \"fulfillment\": {\n                \"methods\": [\n                    {\n                        \"id\": \"method_1\",\n                        \"type\": \"shipping\",\n                        \"selected_destination_id\": \"address_789\",\n                        \"destinations\": [\n                            {\n                                \"id\": \"address_789\",\n                                \"first_name\": \"John\",\n                                \"last_name\": \"Doe\",\n                                \"street_address\": \"123 New Street\"\n                            }\n                        ]\n                    }\n                ]\n            }\n        }\n    }\n}\n</code></pre> <p>Example Error Response:</p> <pre><code>{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"fulfillment_address_change_request_1\",\n    \"error\": {\n        \"code\": \"abort_error\",\n        \"message\": \"User cancelled address selection.\"\n    }\n}\n</code></pre>"},{"location":"specification/embedded-checkout/#address-format","title":"Address Format","text":"<p>The address object uses the UCP PostalAddress format:</p> Name Type Required Description extended_address string No An address extension such as an apartment number, C/O or alternative name. street_address string No The street address. address_locality string No The locality in which the street address is, and which is in the region. For example, Mountain View. address_region string No The region in which the locality is, and which is in the country. Required for applicable countries (i.e. state in US, province in CA). For example, California or another appropriate first-level Administrative division. address_country string No The country. Recommended to be in 2-letter ISO 3166-1 alpha-2 format, for example \"US\". For backward compatibility, a 3-letter ISO 3166-1 alpha-3 country code such as \"SGP\" or a full country name such as \"Singapore\" can also be used. postal_code string No The postal code. For example, 94043. first_name string No Optional. First name of the contact associated with the address. last_name string No Optional. Last name of the contact associated with the address. phone_number string No Optional. Phone number of the contact associated with the address."},{"location":"specification/embedded-checkout/#security-error-handling","title":"Security &amp; Error Handling","text":""},{"location":"specification/embedded-checkout/#error-codes","title":"Error Codes","text":"<p>Responses to delegation request messages from the embedded checkout may resolve to errors. The message responder SHOULD use error codes mapped to W3C DOMException names where possible.</p> Code Description <code>abort_error</code> The user cancelled the interaction (e.g., closed the sheet). <code>security_error</code> The host origin validation failed. <code>not_supported_error</code> The requested payment method is not supported by the host. <code>invalid_state_error</code> Handshake was attempted out of order. <code>not_allowed_error</code> The request was missing valid User Activation (see Prevention of Unsolicited Payment Requests)."},{"location":"specification/embedded-checkout/#security-for-web-based-hosts","title":"Security for Web-Based Hosts","text":""},{"location":"specification/embedded-checkout/#content-security-policy-csp","title":"Content Security Policy (CSP)","text":"<p>To ensure security, both parties MUST implement appropriate Content Security Policy (CSP) directives:</p> <ul> <li> <p>Business: MUST set <code>frame-ancestors &lt;host_origin&gt;;</code> to ensure it's     only embedded by trusted hosts.</p> </li> <li> <p>Host:</p> <ul> <li>Direct Embedding: If the host directly embeds the business's page,     specifying a <code>frame-src</code> directive listing every potential business     origin can be impractical, especially if there are many businesses. In     this scenario, while a strict <code>frame-src</code> is ideal, other security     measures like those in Iframe Sandbox Attributes     and Credentialless Iframes are critical.</li> <li>Intermediate Iframe: The host MAY use an intermediate iframe     (e.g., on a host-controlled subdomain) to embed the business's page.     This offers better control:<ul> <li>The host's main page only needs to allow the origin of the     intermediate iframe in its <code>frame-src</code> (e.g.,     <code>frame-src &lt;intermediate_iframe_origin&gt;;</code>).</li> <li>The intermediate iframe MUST implement a strict <code>frame-src</code>     policy, dynamically set to allow only the specific     <code>&lt;merchant_origin&gt;</code> for the current embedded session (e.g.,     <code>frame-src &lt;merchant_origin&gt;;</code>). This can be set via HTTP headers     when serving the intermediate iframe content.</li> </ul> </li> </ul> </li> </ul>"},{"location":"specification/embedded-checkout/#iframe-sandbox-attributes","title":"Iframe Sandbox Attributes","text":"<p>All business iframes MUST be sandboxed to restrict their capabilities. The following sandbox attributes SHOULD be applied, but a host and business MAY negotiate additional capabilities:</p> <pre><code>&lt;iframe sandbox=\"allow-scripts allow-forms allow-same-origin\"&gt;&lt;/iframe&gt;\n</code></pre>"},{"location":"specification/embedded-checkout/#credentialless-iframes","title":"Credentialless Iframes","text":"<p>Hosts SHOULD use the <code>credentialless</code> attribute on the iframe to load it in a new, ephemeral context. This prevents the business from correlating user activity across contexts or accessing existing sessions, protecting user privacy.</p> <pre><code>&lt;iframe credentialless src=\"https://business.example.com/checkout\"&gt;&lt;/iframe&gt;\n</code></pre>"},{"location":"specification/embedded-checkout/#strict-origin-validation","title":"Strict Origin Validation","text":"<p>Enforce strict validation of the <code>origin</code> for all <code>postMessage</code> communications between frames.</p>"},{"location":"specification/embedded-checkout/#prevention-of-unsolicited-payment-requests","title":"Prevention of Unsolicited Payment Requests","text":"<p>Vulnerability: A malicious or compromised business could programmatically trigger <code>ec.payment.credential_request</code> without user interaction.</p> <p>Mitigation (Host-Controlled Execution): To eliminate this risk, the host is designated as the sole trusted initiator of the payment execution. The host SHOULD display a User Confirmation UI before releasing the token. Silent tokenization is strictly PROHIBITED when the trigger originates from the Embedded Checkout.</p>"},{"location":"specification/embedded-checkout/#schema-definitions","title":"Schema Definitions","text":"<p>The following schemas define the data structures used within the Embedded Checkout protocol and its extensions.</p>"},{"location":"specification/embedded-checkout/#checkout","title":"Checkout","text":"<p>The core object representing the current state of the transaction, including line items, totals, and buyer information.</p> Name Type Required Description ucp UCP Response Checkout Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique identifier of the checkout session. line_items Array[Line Item Response] Yes List of line items being checked out. buyer Buyer No Representation of the buyer. status string Yes Checkout state indicating the current phase and required action. See Checkout Status lifecycle documentation for state transition details.Enum: <code>incomplete</code>, <code>requires_escalation</code>, <code>ready_for_complete</code>, <code>complete_in_progress</code>, <code>completed</code>, <code>canceled</code> currency string Yes ISO 4217 currency code reflecting the merchant's market determination. Derived from address, context, and geo IP\u2014buyers provide signals, merchants determine currency. totals Array[Total Response] Yes Different cart totals. messages Array[Message] No List of messages with error and info about the checkout session state. links Array[Link] Yes Links to be displayed by the platform (Privacy Policy, TOS). Mandatory for legal compliance. expires_at string No RFC 3339 expiry timestamp. Default TTL is 6 hours from creation if not sent. continue_url string No URL for checkout handoff and session recovery. MUST be provided when status is requires_escalation. See specification for format and availability requirements. payment Payment No Payment configuration containing handlers. order Order Confirmation No Details about an order created for this checkout session."},{"location":"specification/embedded-checkout/#order","title":"Order","text":"<p>The object returned upon successful completion of a checkout, containing confirmation details.</p> Name Type Required Description ucp UCP Response Order Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique order identifier. checkout_id string Yes Associated checkout ID for reconciliation. permalink_url string Yes Permalink to access the order on merchant site. line_items Array[Order Line Item] Yes Immutable line items \u2014 source of truth for what was ordered. fulfillment object Yes Fulfillment data: buyer expectations and what actually happened. adjustments Array[Adjustment] No Append-only event log of money movements (refunds, returns, credits, disputes, cancellations, etc.) that exist independently of fulfillment. totals Array[Total Response] Yes Different totals for the order."},{"location":"specification/embedded-checkout/#payment","title":"Payment","text":"Name Type Required Description instruments Array[Selected Payment Instrument] No The payment instruments available for this payment. Each instrument is associated with a specific handler via the handler_id field. Handlers can extend the base payment_instrument schema to add handler-specific fields."},{"location":"specification/embedded-checkout/#payment-instrument","title":"Payment Instrument","text":"<p>Represents a specific method of payment (e.g., a specific credit card, bank account, or wallet credential) available to the buyer.</p> Name Type Required Description id string Yes A unique identifier for this instrument instance, assigned by the platform. handler_id string Yes The unique identifier for the handler instance that produced this instrument. This corresponds to the 'id' field in the Payment Handler definition. type string Yes The broad category of the instrument (e.g., 'card', 'tokenized_card'). Specific schemas will constrain this to a constant value. billing_address Postal Address No The billing address associated with this payment method. credential Payment Credential No The base definition for any payment credential. Handlers define specific credential types. display object No Display information for this payment instrument. Each payment instrument schema defines its specific display properties, as outlined by the payment handler."},{"location":"specification/embedded-checkout/#payment-handler-response","title":"Payment Handler Response","text":"<p>Represents the processor or wallet provider responsible for authenticating and processing a specific payment instrument (e.g., Google Pay, Stripe, or a Bank App).</p> <p>No properties defined.</p>"},{"location":"specification/fulfillment/","title":"Fulfillment Extension","text":""},{"location":"specification/fulfillment/#fulfillment-extension","title":"Fulfillment Extension","text":""},{"location":"specification/fulfillment/#overview","title":"Overview","text":"<p>The fulfillment extension enables businesses to advertise support for physical goods fulfillment (shipping, pickup, etc).</p> <p>This extension adds a <code>fulfillment</code> field to Checkout containing:</p> <ul> <li><code>methods[]</code> \u2014 fulfillment methods applicable to cart items (shipping, pickup, etc.)<ul> <li><code>line_item_ids</code> \u2014 which items this method fulfills</li> <li><code>destinations[]</code> \u2014 where to fulfill (address, store location)</li> <li><code>groups[]</code> \u2014 business-generated packages, each with selectable <code>options[]</code></li> </ul> </li> <li><code>available_methods[]</code> \u2014 inventory availability per item (optional)</li> </ul> <p>Mental model:</p> <ul> <li><code>methods[0]</code> Shipping<ul> <li><code>line_item_ids</code> \ud83d\udc55\ud83d\udc56</li> <li><code>selected_destination_id</code> = <code>destinations[0].id</code> \ud83d\udd18\u2705 123 Fake St</li> <li><code>groups[0]</code> \ud83d\udce6\ud83d\udc55\ud83d\udc56<ul> <li><code>selected_option_id</code> = <code>options[0].id</code> \ud83d\udd18\u2705 Standard $5</li> <li><code>options[1]</code> \ud83d\udd18 Express $10</li> </ul> </li> </ul> </li> <li><code>methods[1]</code> Pick Up in Store<ul> <li><code>line_item_ids</code> \ud83d\udc5e</li> <li><code>selected_destination_id</code> = <code>destinations[0].id</code> \ud83d\udd18\u2705 Uptown Store</li> <li><code>groups[0]</code> \ud83d\udce6\ud83d\udc5e<ul> <li><code>selected_option_id</code> = <code>options[0].id</code> \ud83d\udd18\u2705 In-Store Pickup</li> <li><code>options[1]</code> \ud83d\udd18 Curbside Pickup</li> </ul> </li> </ul> </li> </ul>"},{"location":"specification/fulfillment/#schema","title":"Schema","text":"<p>Fulfillment applies only to items requiring physical delivery. Items not requiring fulfillment (e.g., digital goods) do not need to be assigned to a method.</p>"},{"location":"specification/fulfillment/#properties","title":"Properties","text":"<p>Error loading extension 'fulfillment_resp': [Errno 2] No such file or directory: 'source/schemas/shopping/fulfillment_resp.json'</p>"},{"location":"specification/fulfillment/#entities","title":"Entities","text":""},{"location":"specification/fulfillment/#fulfillment","title":"Fulfillment","text":"Name Type Required Description methods Array[Fulfillment Method] No Fulfillment methods for cart items. available_methods Array[Fulfillment Available Method] No Inventory availability hints."},{"location":"specification/fulfillment/#fulfillment-method-response","title":"Fulfillment Method Response","text":"Name Type Required Description id string Yes Unique fulfillment method identifier. type string Yes Fulfillment method type.Enum: <code>shipping</code>, <code>pickup</code> line_item_ids Array[string] Yes Line item IDs fulfilled via this method. destinations Array[Fulfillment Destination] No Available destinations. For shipping: addresses. For pickup: retail locations. selected_destination_id ['string', 'null'] No ID of the selected destination. groups Array[Fulfillment Group] No Fulfillment groups for selecting options. Agent sets selected_option_id on groups to choose shipping method."},{"location":"specification/fulfillment/#fulfillment-destination-response","title":"Fulfillment Destination Response","text":"<p>This object MUST be one of the following types: Shipping Destination, Retail Location.</p>"},{"location":"specification/fulfillment/#shipping-destination-response","title":"Shipping Destination Response","text":"Name Type Required Description extended_address string No An address extension such as an apartment number, C/O or alternative name. street_address string No The street address. address_locality string No The locality in which the street address is, and which is in the region. For example, Mountain View. address_region string No The region in which the locality is, and which is in the country. Required for applicable countries (i.e. state in US, province in CA). For example, California or another appropriate first-level Administrative division. address_country string No The country. Recommended to be in 2-letter ISO 3166-1 alpha-2 format, for example \"US\". For backward compatibility, a 3-letter ISO 3166-1 alpha-3 country code such as \"SGP\" or a full country name such as \"Singapore\" can also be used. postal_code string No The postal code. For example, 94043. first_name string No Optional. First name of the contact associated with the address. last_name string No Optional. Last name of the contact associated with the address. phone_number string No Optional. Phone number of the contact associated with the address. id string Yes ID specific to this shipping destination."},{"location":"specification/fulfillment/#retail-location-response","title":"Retail Location Response","text":"Name Type Required Description id string Yes Unique location identifier. name string Yes Location name (e.g., store name). address Postal Address No Physical address of the location."},{"location":"specification/fulfillment/#fulfillment-group-response","title":"Fulfillment Group Response","text":"Name Type Required Description id string Yes Group identifier for referencing merchant-generated groups in updates. line_item_ids Array[string] Yes Line item IDs included in this group/package. options Array[Fulfillment Option] No Available fulfillment options for this group. selected_option_id ['string', 'null'] No ID of the selected fulfillment option for this group."},{"location":"specification/fulfillment/#fulfillment-option-response","title":"Fulfillment Option Response","text":"Name Type Required Description id string Yes Unique fulfillment option identifier. title string Yes Short label (e.g., 'Express Shipping', 'Curbside Pickup'). description string No Complete context for buyer decision (e.g., 'Arrives Dec 12-15 via FedEx'). carrier string No Carrier name (for shipping). earliest_fulfillment_time string No Earliest fulfillment date. latest_fulfillment_time string No Latest fulfillment date. totals Array[Total] Yes Fulfillment option totals breakdown."},{"location":"specification/fulfillment/#fulfillment-available-method-response","title":"Fulfillment Available Method Response","text":"Name Type Required Description type string Yes Fulfillment method type this availability applies to.Enum: <code>shipping</code>, <code>pickup</code> line_item_ids Array[string] Yes Line items available for this fulfillment method. fulfillable_on ['string', 'null'] No 'now' for immediate availability, or ISO 8601 date for future (preorders, transfers). description string No Human-readable availability info (e.g., 'Available for pickup at Downtown Store today')."},{"location":"specification/fulfillment/#total-response","title":"Total Response","text":"Name Type Required Description type string Yes Type of total categorization.Enum: <code>items_discount</code>, <code>subtotal</code>, <code>discount</code>, <code>fulfillment</code>, <code>tax</code>, <code>fee</code>, <code>total</code> display_text string No Text to display against the amount. Should reflect appropriate method (e.g., 'Shipping', 'Delivery'). amount integer Yes If type == total, sums subtotal - discount + fulfillment + tax + fee. Should be &gt;= 0. Amount in minor (cents) currency units."},{"location":"specification/fulfillment/#postal-address","title":"Postal Address","text":"Name Type Required Description extended_address string No An address extension such as an apartment number, C/O or alternative name. street_address string No The street address. address_locality string No The locality in which the street address is, and which is in the region. For example, Mountain View. address_region string No The region in which the locality is, and which is in the country. Required for applicable countries (i.e. state in US, province in CA). For example, California or another appropriate first-level Administrative division. address_country string No The country. Recommended to be in 2-letter ISO 3166-1 alpha-2 format, for example \"US\". For backward compatibility, a 3-letter ISO 3166-1 alpha-3 country code such as \"SGP\" or a full country name such as \"Singapore\" can also be used. postal_code string No The postal code. For example, 94043. first_name string No Optional. First name of the contact associated with the address. last_name string No Optional. Last name of the contact associated with the address. phone_number string No Optional. Phone number of the contact associated with the address."},{"location":"specification/fulfillment/#example","title":"Example","text":"<pre><code>{\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"id\": \"method_1\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"shirt\", \"pants\"],\n        \"selected_destination_id\": \"dest_1\",\n        \"destinations\": [\n          {\n            \"id\": \"dest_1\",\n            \"street_address\": \"123 Main St\",\n            \"address_locality\": \"Springfield\",\n            \"address_region\": \"IL\",\n            \"postal_code\": \"62701\",\n            \"address_country\": \"US\"\n          }\n        ],\n        \"groups\": [\n          {\n            \"id\": \"package_1\",\n            \"line_item_ids\": [\"shirt\", \"pants\"],\n            \"selected_option_id\": \"standard\",\n            \"options\": [\n              {\n                \"id\": \"standard\",\n                \"title\": \"Standard Shipping\",\n                \"description\": \"Arrives Dec 12-15 via USPS\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 500\n                  }\n                ]\n              },\n              {\n                \"id\": \"express\",\n                \"title\": \"Express Shipping\",\n                \"description\": \"Arrives Dec 10-11 via FedEx\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 1000\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/fulfillment/#rendering","title":"Rendering","text":"<p>Fulfillment options are designed for method-agnostic rendering. Platforms do not need to understand specific method types (shipping, pickup, etc.) to present options meaningfully. The business provides precomputed, human-readable fields that platforms render directly.</p>"},{"location":"specification/fulfillment/#human-readable-fields","title":"Human-Readable Fields","text":"Location Field Required Purpose <code>groups[].options[]</code> <code>title</code> Yes Primary label that distinguishes from siblings <code>groups[].options[]</code> <code>description</code> No Supplementary context for the title <code>groups[].options[]</code> <code>total</code> Yes Price in minor units (may be null if not yet available) <code>available_methods[]</code> <code>description</code> No Standalone explanation of alternative availability"},{"location":"specification/fulfillment/#business-responsibilities","title":"Business Responsibilities","text":"<p>For <code>options[].title</code>:</p> <ul> <li>MUST distinguish this option from its siblings</li> <li>SHOULD include method and speed (e.g., \"Express Shipping\", \"Curbside Pickup\")</li> <li>MUST be sufficient for buyer decision if <code>description</code> is absent</li> </ul> <p>For <code>options[].description</code>:</p> <ul> <li>MUST NOT repeat <code>title</code> or <code>total</code>\u2014provides supplementary context only</li> <li>SHOULD include timing, carrier, or other decision-relevant details</li> <li>SHOULD be a complete phrase (e.g., \"Arrives Dec 12-15 via FedEx\")</li> <li>MAY be omitted if title is self-explanatory</li> </ul> <p>For <code>available_methods[].description</code>:</p> <ul> <li>MUST be a standalone sentence explaining what, when, and where</li> <li>SHOULD be usable verbatim in platform dialogue (e.g., \"Pants available     for pickup at Downtown Store today at 2pm\")</li> </ul> <p>For ordering:</p> <ul> <li>Businesses SHOULD return <code>options[]</code> in a meaningful order (e.g., cheapest     first, fastest first)</li> <li>Platforms SHOULD render options in the provided order</li> </ul>"},{"location":"specification/fulfillment/#platform-responsibilities","title":"Platform Responsibilities","text":"<p>Platforms SHOULD treat fulfillment as a generic, renderable structure:</p> <ul> <li>Render each option as a card using <code>title</code>, <code>description</code>, and <code>total</code></li> <li>Present options in the order provided by the business</li> <li>Present all methods returned\u2014method selection is a buyer decision</li> <li>Use <code>available_methods[].description</code> to surface alternatives to the buyer</li> </ul> <p>Platforms MAY provide enhanced UX for recognized method types (store selectors for pickup, carrier logos for shipping), but this is optional. The baseline contract is: <code>title</code> + <code>description</code> + <code>total</code> is sufficient to render any option.</p> <p>When a buyer selects an option the platform cannot fully process, the platform SHOULD use <code>continue_url</code> to hand off to the business's checkout.</p>"},{"location":"specification/fulfillment/#available-methods","title":"Available Methods","text":"<p>Available methods indicate whether an item can be fulfilled with a given method, and when. Use cases:</p> <ul> <li>Alternative methods: \"These pants are also available for pickup at Downtown Store\"</li> <li>Fulfill later: Preorders, items shipping from a distant warehouse, pickup when store gets inventory</li> </ul> <pre><code>{\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"id\": \"shipping\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"shirt\", \"pants\"]\n      },\n      {\n        \"id\": \"pickup\",\n        \"type\": \"pickup\",\n        \"line_item_ids\": []\n      }\n    ],\n    \"available_methods\": [\n      {\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"shirt\", \"pants\"],\n        \"fulfillable_on\": \"now\"\n      },\n      {\n        \"type\": \"pickup\",\n        \"line_item_ids\": [\"pants\"],\n        \"fulfillable_on\": \"2026-12-01T10:00:00Z\",\n        \"description\": \"Available for pickup at Downtown Store today at 2pm\"\n      }\n    ]\n  }\n}\n</code></pre> <p>The <code>description</code> field enables platforms to surface alternatives to buyers:</p> <p>\ud83e\udd16 The shirt and pants ship for $5, arriving in 5-8 days. Or the pants can be picked up at Downtown Store in 4 hours.</p> <p>If the buyer chooses pickup but the platform doesn't support split fulfillment, the platform SHOULD use <code>continue_url</code> to hand off to the business's checkout.</p>"},{"location":"specification/fulfillment/#configuration","title":"Configuration","text":"<p>Businesses and platforms declare fulfillment constraints in their profiles. Businesses fetch platform profiles to adapt responses accordingly.</p>"},{"location":"specification/fulfillment/#platform-profile","title":"Platform Profile","text":"<p>Platforms declare their rendering capabilities using <code>platform_schema</code>:</p> Name Type Required Description supports_multi_group boolean No Enables multiple groups per method. <p>Platforms that omit config or set <code>supports_multi_group: false</code> receive single-group responses. The response shape is always <code>methods[].groups[]</code>\u2014the difference is whether <code>groups.length</code> can exceed 1 within each method.</p> <pre><code>// Default: single group per method\n{ \"dev.ucp.shopping.fulfillment\": [{\"version\": \"2026-01-11\"}] }\n\n// Opt-in: business MAY return multiple groups per method\n{ \"dev.ucp.shopping.fulfillment\": [{\"version\": \"2026-01-11\", \"config\": { \"supports_multi_group\": true }}] }\n</code></pre>"},{"location":"specification/fulfillment/#business-profile","title":"Business Profile","text":"<p>Businesses declare what fulfillment configurations they support using <code>merchant_config</code>:</p> Name Type Required Description allows_multi_destination object No Permits multiple destinations per method type. allows_method_combinations Array[array] No Allowed method type combinations. <pre><code>{\n  \"capabilities\": {\n    \"dev.ucp.shopping.fulfillment\": [\n      {\n        \"version\": \"2026-01-11\",\n        \"config\": {\n          \"allows_multi_destination\": {\n            \"shipping\": true\n          },\n          \"allows_method_combinations\": [[\"shipping\", \"pickup\"]]\n        }\n      }\n    ]\n  }\n}\n</code></pre> <p>This example says: shipping can go to multiple addresses, and carts can mix shipping+pickup.</p>"},{"location":"specification/fulfillment/#business-response-behavior","title":"Business Response Behavior","text":"<p>When <code>supports_multi_group: false</code> (default):</p> <ul> <li>Business MUST consolidate all items into a single group per method</li> <li>Response still uses array structure: <code>methods[].groups[]</code> with <code>groups.length === 1</code></li> <li>Business MAY still return multiple methods (e.g., shipping + pickup) if     cart items require it</li> </ul> <p>When <code>supports_multi_group: true</code>:</p> <ul> <li>Business MAY return multiple groups per method based on inventory,     packaging, or warehouse logic</li> <li>Platform is responsible for rendering group selection UI (e.g., choose     shipping speed per package)</li> </ul>"},{"location":"specification/fulfillment/#adding-new-methods","title":"Adding New Methods","text":"<p>Extensions that extend fulfillment with new method types (e.g., <code>local_delivery</code>) MUST add an extension schema that:</p> <ol> <li>Adds the method to the <code>type</code> enum in <code>fulfillment_method</code></li> <li>Adds corresponding business config options:<ul> <li><code>allows_multi_destination.local_delivery: boolean</code></li> <li><code>allows_method_combinations</code> items enum (includes <code>\"local_delivery\"</code>)</li> </ul> </li> </ol> <p>Note: Platform's <code>supports_multi_group</code> is method-agnostic (single boolean), so no extension needed.</p>"},{"location":"specification/fulfillment/#examples","title":"Examples","text":""},{"location":"specification/fulfillment/#basic","title":"Basic","text":"<p>Config: None required (default behavior)</p> <pre><code>{\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"id\": \"method_1\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"shirt\", \"pants\"],\n        \"selected_destination_id\": \"dest_1\",\n        \"destinations\": [\n          {\n            \"id\": \"dest_1\",\n            \"street_address\": \"123 Main St\",\n            \"address_locality\": \"Springfield\",\n            \"address_region\": \"IL\",\n            \"postal_code\": \"62701\",\n            \"address_country\": \"US\"\n          }\n        ],\n        \"groups\": [\n          {\n            \"id\": \"package_1\",\n            \"line_item_ids\": [\"shirt\", \"pants\"],\n            \"selected_option_id\": \"standard\",\n            \"options\": [\n              {\n                \"id\": \"standard\",\n                \"title\": \"Standard Shipping\",\n                \"description\": \"Arrives Dec 12-15 via USPS\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 500\n                  }\n                ]\n              },\n              {\n                \"id\": \"express\",\n                \"title\": \"Express Shipping\",\n                \"description\": \"Arrives Dec 10-11 via FedEx\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 1000\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/fulfillment/#split-groups","title":"Split Groups","text":"<p>Config: Platform profile requires <code>config.supports_multi_group: true</code></p> <p>Business splits items into multiple packages; buyer selects shipping rate per package.</p> <pre><code>{\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"id\": \"method_1\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"shirt\", \"pants\"],\n        \"selected_destination_id\": \"dest_1\",\n        \"destinations\": [\n          {\n            \"id\": \"dest_1\",\n            \"street_address\": \"123 Main St\",\n            \"address_locality\": \"Springfield\",\n            \"address_region\": \"IL\",\n            \"postal_code\": \"62701\",\n            \"address_country\": \"US\"\n          }\n        ],\n        \"groups\": [\n          {\n            \"id\": \"package_1\",\n            \"line_item_ids\": [\"shirt\"],\n            \"selected_option_id\": \"standard\",\n            \"options\": [\n              {\n                \"id\": \"standard\",\n                \"title\": \"Standard\",\n                \"totals\": [ {\"type\": \"total\", \"amount\": 500} ]\n              },\n              {\n                \"id\": \"express\",\n                \"title\": \"Express\",\n                \"totals\": [ {\"type\": \"total\", \"amount\": 1000} ]\n              }\n            ]\n          },\n          {\n            \"id\": \"package_2\",\n            \"line_item_ids\": [\"pants\"],\n            \"selected_option_id\": \"express\",\n            \"options\": [\n              {\n                \"id\": \"standard\",\n                \"title\": \"Standard\",\n                \"totals\": [ {\"type\": \"total\", \"amount\": 500} ]\n              },\n              {\n                \"id\": \"express\",\n                \"title\": \"Express\",\n                \"totals\": [ {\"type\": \"total\", \"amount\": 1000} ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/fulfillment/#split-destinations","title":"Split Destinations","text":"<p>Config: Business profile requires <code>config.allows_multi_destination.shipping: true</code></p> <p>Shirt ships to mom (US), pants ship to grandma (Hong Kong). Two methods of the same type, each with its own destination.</p> <pre><code>{\n  \"fulfillment\": {\n    \"methods\": [\n      {\n        \"id\": \"method_1\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"shirt\"],\n        \"selected_destination_id\": \"dest_mom\",\n        \"destinations\": [\n          {\n            \"id\": \"dest_mom\",\n            \"street_address\": \"123 Mom St\",\n            \"address_locality\": \"Springfield\",\n            \"address_region\": \"IL\",\n            \"postal_code\": \"62701\",\n            \"address_country\": \"US\"\n          }\n        ],\n        \"groups\": [\n          {\n            \"id\": \"package_1\",\n            \"line_item_ids\": [\"shirt\"],\n            \"selected_option_id\": \"standard\",\n            \"options\": [\n              {\n                \"id\": \"standard\",\n                \"title\": \"Standard\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 500\n                  }\n                ]\n              },\n              {\n                \"id\": \"express\",\n                \"title\": \"Express\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 1000\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      },\n      {\n        \"id\": \"method_2\",\n        \"type\": \"shipping\",\n        \"line_item_ids\": [\"pants\"],\n        \"selected_destination_id\": \"dest_grandma\",\n        \"destinations\": [\n          {\n            \"id\": \"dest_grandma\",\n            \"street_address\": \"88 Queensway\",\n            \"address_locality\": \"Hong Kong\",\n            \"address_country\": \"HK\"\n          }\n        ],\n        \"groups\": [\n          {\n            \"id\": \"package_2\",\n            \"line_item_ids\": [\"pants\"],\n            \"selected_option_id\": \"standard\",\n            \"options\": [\n              {\n                \"id\": \"standard\",\n                \"title\": \"Standard\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 500\n                  }\n                ]\n              },\n              {\n                \"id\": \"express\",\n                \"title\": \"Express\",\n                \"totals\": [\n                  {\n                    \"type\": \"total\",\n                    \"amount\": 1000\n                  }\n                ]\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/identity-linking/","title":"Identity Linking Capability","text":""},{"location":"specification/identity-linking/#identity-linking-capability","title":"Identity Linking Capability","text":"<ul> <li>Capability Name: <code>dev.ucp.common.identity_linking</code></li> </ul>"},{"location":"specification/identity-linking/#overview","title":"Overview","text":"<p>The Identity Linking capability enables a platform (e.g., Google, an agentic service) to obtain authorization to perform actions on behalf of a user on a business's site.</p> <p>This linkage is foundational for commerce experiences, such as accessing loyalty benefits, utilizing personalized offers, managing wishlists, and executing authenticated checkouts.</p> <p>This specification leverages OAuth 2.0 as the mechanism for securely linking a user's platform account with their business account.</p>"},{"location":"specification/identity-linking/#general-guidelines","title":"General guidelines","text":"<p>(In addition to the overarching guidelines)</p>"},{"location":"specification/identity-linking/#for-platforms","title":"For platforms","text":"<ul> <li>MUST authenticate using their <code>client_id</code> and <code>client_secret</code>     (RFC 6749 2.3.1)     through HTTP Basic Authentication     (RFC 7617)     when exchanging codes for tokens.<ul> <li>MAY support Client Metadata</li> <li>MAY support Dynamic Client Registration mechanisms to supersede     static credential exchange.</li> </ul> </li> <li>The platform must include the token in the HTTP Authorization header using     the Bearer schema (<code>Authorization: Bearer &lt;access_token&gt;</code>)</li> <li>MUST implement the OAuth 2.0 Authorization Code flow     (RFC 6749 4.1)     as the primary linking mechanism.</li> <li>SHOULD include a unique, unguessable state parameter in the     authorization request to prevent Cross-Site Request Forgery (CSRF)     (RFC 6749 10.12)     (part of     OAuth 2.1 draft)     .</li> <li>Revocation and security events<ul> <li>SHOULD call the business's revocation endpoint     (RFC 7009) when a user     initiates an unlink action on the platform side.</li> <li>SHOULD support     OpenID RISC Profile 1.0     to handle asynchronous account updates, unlinking events, and     cross-account protection.</li> </ul> </li> </ul>"},{"location":"specification/identity-linking/#for-businesses","title":"For businesses","text":"<ul> <li>MUST implement OAuth 2.0     (RFC 6749)</li> <li>MUST adhere to RFC 8414 to     declare the location of their OAuth 2.0 endpoints     (<code>/.well-known/oauth-authorization-server</code>)<ul> <li>SHOULD implement     RFC 9728 (HTTP     Resource Metadata) to allow platforms to discover the Authorization     Server associated with specific resources.</li> <li>SHOULD fill in <code>scopes_supported</code> as part of     RFC 8414.</li> </ul> </li> <li>MUST enforce Client Authentication at the Token Endpoint.</li> <li>MUST provide an account creation flow if the user does not already have     an account.</li> <li>MUST support standard UCP scopes, as defined in the Scopes section,     granting the tokens permission to all associated Operations for a given     resource.</li> <li>Additional permissions MAY be granted beyond those explicitly requested,     provided that the requested scopes are, at minimum, included.</li> <li>The platform and business MAY define additional custom scopes beyond the     minimum scope requirements.</li> <li>Revocation and security events<ul> <li>MUST implement standard Token Revocation as defined in     RFC 7009.</li> <li>MUST revoke the specified token and SHOULD recursively revoke     all associated tokens (e.g., revoking a <code>refresh_token</code> MUST also     immediately revoke all active <code>access_token</code>s issued from it).</li> <li>MUST support revocation requests authenticated with the same client     credentials used for the token endpoint.</li> <li>SHOULD support     OpenID RISC Profile 1.0     to enable Cross-Account Protection and securely signal revocation or     account state changes initiated by the business side.     (See Cross-Account protection)</li> </ul> </li> </ul>"},{"location":"specification/identity-linking/#scopes","title":"Scopes","text":"<p>We'd ask users to authorize the platform to have access to all the scopes that could be required for UCP, regardless of whether the business supports them.</p>"},{"location":"specification/identity-linking/#structure","title":"Structure","text":"<p>The scope complexity should be hidden in the consent screen shown to the user: they shouldn't see one row for each action, but rather a general one, for example \"Allow [platform] to manage checkout sessions\".</p>"},{"location":"specification/identity-linking/#mapping-between-resources-actions-and-capabilities","title":"Mapping between resources, actions and capabilities","text":"Resources Operation Scope Action CheckoutSession Get <code>ucp:scopes:checkout_session</code> CheckoutSession Create <code>ucp:scopes:checkout_session</code> CheckoutSession Update <code>ucp:scopes:checkout_session</code> CheckoutSession Delete <code>ucp:scopes:checkout_session</code> CheckoutSession Cancel <code>ucp:scopes:checkout_session</code> CheckoutSession Complete <code>ucp:scopes:checkout_session</code> <p>A scope covering a capability must grant access to all operations associated to the capability. For example, ucp:scopes:checkout_session must grant all of: Get, Create, Update, Delete, Cancel, Complete.</p>"},{"location":"specification/identity-linking/#examples","title":"Examples","text":""},{"location":"specification/identity-linking/#authorization-server-metadata","title":"Authorization server metadata","text":"<p>Example of metadata supposed to be hosted in /.well-known/oauth-authorization-server as per RFC 8414:</p> <pre><code>{\n  \"issuer\": \"https://merchant.example.com\",\n  \"authorization_endpoint\": \"https://merchant.example.com/oauth2/authorize\",\n  \"token_endpoint\": \"https://merchant.example.com/oauth2/token\",\n  \"revocation_endpoint\": \"https://merchant.example.com/oauth2/revoke\",\n  \"scopes_supported\": [\n    \"ucp:scopes:checkout_session\",\n  ],\n  \"response_types_supported\": [\n    \"code\"\n  ],\n  \"grant_types_supported\": [\n    \"authorization_code\",\n    \"refresh_token\"\n  ],\n  \"token_endpoint_auth_methods_supported\": [\n    \"client_secret_basic\"\n  ],\n  \"service_documentation\": \"https://merchant.example.com/docs/oauth2\"\n}\n</code></pre>"},{"location":"specification/order/","title":"Order Capability","text":""},{"location":"specification/order/#order-capability","title":"Order Capability","text":"<ul> <li>Capability Name: <code>dev.ucp.shopping.order</code></li> </ul>"},{"location":"specification/order/#overview","title":"Overview","text":"<p>Orders represent confirmed transactions resulting from a successful checkout submission. It provides a complete record of what was purchased, how it will be delivered, and what has happened since order placement.</p>"},{"location":"specification/order/#key-concepts","title":"Key Concepts","text":"<p>Orders have three main components:</p> <p>Line Items \u2014 what was purchased at checkout:</p> <ul> <li>Includes current quantity counts (total, fulfilled)</li> </ul> <p>Fulfillment \u2014 how items get delivered:</p> <ul> <li>Expectations \u2014 buyer-facing promises about when/how items will arrive</li> <li>Events (append-only log) \u2014 what actually happened (e.g. \ud83d\udc55 was shipped)</li> </ul> <p>Adjustments (append-only log) \u2014 post-order events independent of fulfillment:</p> <ul> <li>Typically money movements (refunds, returns, credits, disputes, cancellations)</li> <li>Can be any post-order change</li> <li>Can happen before, during, or after fulfillment</li> </ul>"},{"location":"specification/order/#data-model","title":"Data Model","text":""},{"location":"specification/order/#line-items","title":"Line Items","text":"<p>Line items reflect what was purchased at checkout and their current state:</p> <ul> <li>Item details (product, price, quantity ordered)</li> <li>Quantity counts and status are derived</li> </ul>"},{"location":"specification/order/#fulfillment","title":"Fulfillment","text":"<p>Fulfillment tracks how items are delivered to the buyer.</p>"},{"location":"specification/order/#expectations","title":"Expectations","text":"<p>Expectations are buyer-facing groupings of items (e.g., \"package \ud83d\udce6\"). They represent:</p> <ul> <li>What items are grouped together</li> <li>Where they're going (<code>destination</code>)</li> <li>How they're being delivered (<code>method_type</code>)</li> <li>When they'll arrive (<code>description</code>, <code>fulfillable_on</code>)</li> </ul> <p>Expectations can be split, merged, or adjusted post-order. For example:</p> <ul> <li>Group everything by delivery date: \"what is coming when\"</li> <li>Use a single expectation with a wide date range for flexibility</li> <li>The goal is setting buyer expectations - for the best buyer experience</li> </ul>"},{"location":"specification/order/#fulfillment-events","title":"Fulfillment Events","text":"<p>Fulfillment Events are an append-only log tracking physical shipments:</p> <ul> <li>Reference line items by ID and quantity</li> <li>Include tracking information</li> <li>Type is an open string field - businesses can use any values that make sense   (common examples: <code>processing</code>, <code>shipped</code>, <code>in_transit</code>, <code>delivered</code>,   <code>failed_attempt</code>, <code>canceled</code>, <code>undeliverable</code>, <code>returned_to_sender</code>)</li> </ul>"},{"location":"specification/order/#adjustments","title":"Adjustments","text":"<p>Adjustments are an append-only log of events that exist independently of fulfillment:</p> <ul> <li>Type is an open string field - businesses can use any values that make sense   (typically money movements like <code>refund</code>, <code>return</code>, <code>credit</code>,   <code>price_adjustment</code>, <code>dispute</code>, <code>cancellation</code>)</li> <li>Can be any post-order change</li> <li>Optionally link to line items (or order-level for things like shipping refunds)</li> <li>Include amount when relevant</li> <li>Can happen at any time regardless of fulfillment status</li> </ul>"},{"location":"specification/order/#schema","title":"Schema","text":""},{"location":"specification/order/#order","title":"Order","text":"Name Type Required Description ucp UCP Response Order Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique order identifier. checkout_id string Yes Associated checkout ID for reconciliation. permalink_url string Yes Permalink to access the order on merchant site. line_items Array[Order Line Item] Yes Immutable line items \u2014 source of truth for what was ordered. fulfillment object Yes Fulfillment data: buyer expectations and what actually happened. adjustments Array[Adjustment] No Append-only event log of money movements (refunds, returns, credits, disputes, cancellations, etc.) that exist independently of fulfillment. totals Array[Total Response] Yes Different totals for the order."},{"location":"specification/order/#order-line-item","title":"Order Line Item","text":"<p>Line items reflect what was purchased at checkout and their current state. Status and quantity counts should reflect the event logs.</p> Name Type Required Description id string Yes Line item identifier. item Item Yes Product data (id, title, price, image_url). quantity object Yes Quantity tracking. Both total and fulfilled are derived from events. totals Array[Total] Yes Line item totals breakdown. status string Yes Derived status: fulfilled if quantity.fulfilled == quantity.total, partial if quantity.fulfilled &gt; 0, otherwise processing.Enum: <code>processing</code>, <code>partial</code>, <code>fulfilled</code> parent_id string No Parent line item identifier for any nested structures. <p>Quantity Structure:</p> <pre><code>{\n  \"total\": 3,      // Current total quantity\n  \"fulfilled\": 2   // What has been fulfilled\n}\n</code></pre> <p>Status Derivation:</p> <pre><code>if (fulfilled == total) \u2192 \"fulfilled\"\nelse if (fulfilled &gt; 0) \u2192 \"partial\"\nelse \u2192 \"processing\"\n</code></pre>"},{"location":"specification/order/#expectation","title":"Expectation","text":"<p>Expectations are buyer-facing groupings representing when/how items will be delivered. They represent the current promise to the buyer and can be split, merged, or adjusted post-order.</p> Name Type Required Description id string Yes Expectation identifier. line_items Array[object] Yes Which line items and quantities are in this expectation. method_type string Yes Delivery method type (shipping, pickup, digital).Enum: <code>shipping</code>, <code>pickup</code>, <code>digital</code> destination Postal Address Yes Delivery destination address. description string No Human-readable delivery description (e.g., 'Arrives in 5-8 business days'). fulfillable_on string No When this expectation can be fulfilled: 'now' or ISO 8601 timestamp for future date (backorder, pre-order)."},{"location":"specification/order/#fulfillment-event","title":"Fulfillment Event","text":"<p>Events are append-only records tracking actual shipments. The <code>type</code> field is an open string - businesses can use any values that make sense for their fulfillment process.</p> Name Type Required Description id string Yes Fulfillment event identifier. occurred_at string Yes RFC 3339 timestamp when this fulfillment event occurred. type string Yes Fulfillment event type. Common values include: processing (preparing to ship), shipped (handed to carrier), in_transit (in delivery network), delivered (received by buyer), failed_attempt (delivery attempt failed), canceled (fulfillment canceled), undeliverable (cannot be delivered), returned_to_sender (returned to merchant). line_items Array[object] Yes Which line items and quantities are fulfilled in this event. tracking_number string No Carrier tracking number (required if type != processing). tracking_url string No URL to track this shipment (required if type != processing). carrier string No Carrier name (e.g., 'FedEx', 'USPS'). description string No Human-readable description of the shipment status or delivery information (e.g., 'Delivered to front door', 'Out for delivery'). <p>Examples: <code>processing</code>, <code>shipped</code>, <code>in_transit</code>, <code>delivered</code>, <code>failed_attempt</code>, <code>canceled</code>, <code>undeliverable</code>, <code>returned_to_sender</code>, etc.</p>"},{"location":"specification/order/#adjustment","title":"Adjustment","text":"<p>Adjustments are polymorphic events that exist independently of fulfillment. The <code>type</code> field is an open string - businesses can use any values that make sense to them.</p> Name Type Required Description id string Yes Adjustment event identifier. type string Yes Type of adjustment (open string). Typically money-related like: refund, return, credit, price_adjustment, dispute, cancellation. Can be any value that makes sense for the merchant's business. occurred_at string Yes RFC 3339 timestamp when this adjustment occurred. status string Yes Adjustment status.Enum: <code>pending</code>, <code>completed</code>, <code>failed</code> line_items Array[object] No Which line items and quantities are affected (optional). amount integer No Amount in minor units (cents) for refunds, credits, price adjustments (optional). description string No Human-readable reason or description (e.g., 'Defective item', 'Customer requested'). <p>Examples: <code>refund</code>, <code>return</code>, <code>credit</code>, <code>price_adjustment</code>, <code>dispute</code>, <code>cancellation</code>, etc.</p>"},{"location":"specification/order/#example","title":"Example","text":"<pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {\n      \"dev.ucp.shopping.order\": [{\"version\": \"2026-01-11\"}]\n    }\n  },\n  \"id\": \"order_abc123\",\n  \"checkout_id\": \"checkout_xyz789\",\n  \"permalink_url\": \"https://business.com/orders/abc123\",\n  \"line_items\": [\n    {\n      \"id\": \"li_shoes\",\n      \"item\": { \"id\": \"prod_shoes\", \"title\": \"Running Shoes\", \"price\": 3000 },\n      \"quantity\": { \"total\": 3, \"fulfilled\": 3 },\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 9000},\n        {\"type\": \"total\", \"amount\": 9000}\n      ],\n      \"status\": \"fulfilled\"\n    },\n    {\n      \"id\": \"li_shirts\",\n      \"item\": { \"id\": \"prod_shirts\", \"title\": \"Cotton T-Shirt\", \"price\": 2000 },\n      \"quantity\": { \"total\": 2, \"fulfilled\": 0 },\n      \"totals\": [\n        {\"type\": \"subtotal\", \"amount\": 4000},\n        {\"type\": \"total\", \"amount\": 4000}\n      ],\n      \"status\": \"processing\"\n    }\n  ],\n  \"fulfillment\": {\n    \"expectations\": [\n      {\n        \"id\": \"exp_1\",\n        \"line_items\": [{ \"id\": \"li_shoes\", \"quantity\": 3 }],\n        \"method_type\": \"shipping\",\n        \"destination\": {\n          \"street_address\": \"123 Main St\",\n          \"address_locality\": \"Austin\",\n          \"address_region\": \"TX\",\n          \"address_country\": \"US\",\n          \"postal_code\": \"78701\"\n        },\n        \"description\": \"Arrives in 2-3 business days\",\n        \"fulfillable_on\": \"now\"\n      },\n      {\n        \"id\": \"exp_2\",\n        \"line_items\": [{ \"id\": \"li_shirts\", \"quantity\": 2 }],\n        \"method_type\": \"shipping\",\n        \"destination\": {\n          \"street_address\": \"123 Main St\",\n          \"address_locality\": \"Austin\",\n          \"address_region\": \"TX\",\n          \"address_country\": \"US\",\n          \"postal_code\": \"78701\"\n        },\n        \"description\": \"Backordered - ships Jan 15, arrives in 7-10 days\",\n        \"fulfillable_on\": \"2025-01-15T00:00:00Z\"\n      }\n    ],\n    \"events\": [\n      {\n        \"id\": \"evt_1\",\n        \"occurred_at\": \"2025-01-08T10:30:00Z\",\n        \"type\": \"delivered\",\n        \"line_items\": [{ \"id\": \"li_shoes\", \"quantity\": 3 }],\n        \"tracking_number\": \"123456789\",\n        \"tracking_url\": \"https://fedex.com/track/123456789\",\n        \"description\": \"Delivered to front door\"\n      }\n    ]\n  },\n  \"adjustments\": [\n    {\n      \"id\": \"adj_1\",\n      \"type\": \"refund\",\n      \"occurred_at\": \"2025-01-10T14:30:00Z\",\n      \"status\": \"completed\",\n      \"line_items\": [{ \"id\": \"li_shoes\", \"quantity\": 1 }],\n      \"amount\": 3000,\n      \"description\": \"Defective item\"\n    }\n  ],\n  \"totals\": [\n    { \"type\": \"subtotal\", \"amount\": 13000 },\n    { \"type\": \"shipping\", \"amount\": 1200 },\n    { \"type\": \"tax\", \"amount\": 1142 },\n    { \"type\": \"total\", \"amount\": 15342 }\n  ]\n}\n</code></pre>"},{"location":"specification/order/#events","title":"Events","text":"<p>Businesses send order status changes as events after order placement.</p> Event Mechanism Method Endpoint Description Order Event Webhook <code>POST</code> Platform-provided URL Business sends order lifecycle events to the platform."},{"location":"specification/order/#order-event-webhook","title":"Order Event Webhook","text":"<p>Businesses POST order events to a webhook URL provided by the platform during partner onboarding. The URL format is platform-specific.</p> <p>Error processing OpenAPI: [Errno 2] No such file or directory: 'source/services/shopping/rest.openapi.json'</p>"},{"location":"specification/order/#webhook-url-configuration","title":"Webhook URL Configuration","text":"<p>The platform provides its webhook URL in the order capability's <code>config</code> field during capability negotiation. The business discovers this URL from the platform's profile and uses it to send order lifecycle events.</p> Name Type Required Description webhook_url string Yes URL where merchant sends order lifecycle events (webhooks). <p>Example:</p> <pre><code>{\n  \"dev.ucp.shopping.order\": [\n    {\n      \"version\": \"2026-01-11\",\n      \"config\": {\n        \"webhook_url\": \"https://platform.example.com/webhooks/ucp/orders\"\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"specification/order/#webhook-signature-verification","title":"Webhook Signature Verification","text":"<p>Webhook payloads MUST be signed by the business and verified by the platform to ensure authenticity and integrity.</p>"},{"location":"specification/order/#signing-business","title":"Signing (Business)","text":"<ol> <li>Select a key from the <code>signing_keys</code> array in UCP profile.</li> <li>Create a detached JWT (RFC 7797) over the request body using the selected key.</li> <li>Include the JWT in the <code>Request-Signature</code> header.</li> <li>Include the key ID in the JWT header's <code>kid</code> claim to allow the receiver to     identify which key to use for verification.</li> </ol>"},{"location":"specification/order/#verification-platform","title":"Verification (Platform)","text":"<ol> <li>Extract the <code>Request-Signature</code> header from the incoming webhook request.</li> <li>Parse the JWT header to retrieve the <code>kid</code> (key ID).</li> <li>Fetch the business's UCP profile from <code>/.well-known/ucp</code> (cache as appropriate).</li> <li>Locate the key in <code>signing_keys</code> with the matching <code>kid</code>.</li> <li>Verify the JWT signature against the request body using the public key.</li> <li>If verification fails, reject the webhook with an appropriate error response.</li> </ol>"},{"location":"specification/order/#key-rotation","title":"Key Rotation","text":"<p>The <code>signing_keys</code> array supports multiple keys to enable zero-downtime rotation:</p> <ul> <li>Adding a new key: Add the new key to <code>signing_keys</code>, then start signing     with it. Verifiers will find it by <code>kid</code>.</li> <li>Removing an old key: After sufficient time for all in-flight webhooks to     be delivered, remove the old key from <code>signing_keys</code>.</li> </ul>"},{"location":"specification/order/#guidelines","title":"Guidelines","text":"<p>Platform:</p> <ul> <li>MUST respond quickly with a 2xx HTTP status code to acknowledge receipt</li> <li>Process events asynchronously after responding</li> </ul> <p>Business:</p> <ul> <li>MUST sign all webhook payloads using a key from their <code>signing_keys</code>   array (published in <code>/.well-known/ucp</code>). The signature MUST be included   in the <code>Request-Signature</code> header as a detached JWT (RFC 7797).</li> <li>MUST send \"Order created\" event with fully populated order entity</li> <li>MUST send full order entity on updates (not incremental deltas)</li> <li>MUST retry failed webhook deliveries</li> <li>MUST include business identifier in webhook path or headers</li> </ul>"},{"location":"specification/order/#entities","title":"Entities","text":""},{"location":"specification/order/#item-response","title":"Item Response","text":"Name Type Required Description id string Yes The product identifier, often the SKU, required to resolve the product details associated with this line item. Should be recognized by both the Platform, and the Business. title string Yes Product title. price integer Yes Unit price in minor (cents) currency units. image_url string No Product image URI."},{"location":"specification/order/#postal-address","title":"Postal Address","text":"Name Type Required Description extended_address string No An address extension such as an apartment number, C/O or alternative name. street_address string No The street address. address_locality string No The locality in which the street address is, and which is in the region. For example, Mountain View. address_region string No The region in which the locality is, and which is in the country. Required for applicable countries (i.e. state in US, province in CA). For example, California or another appropriate first-level Administrative division. address_country string No The country. Recommended to be in 2-letter ISO 3166-1 alpha-2 format, for example \"US\". For backward compatibility, a 3-letter ISO 3166-1 alpha-3 country code such as \"SGP\" or a full country name such as \"Singapore\" can also be used. postal_code string No The postal code. For example, 94043. first_name string No Optional. First name of the contact associated with the address. last_name string No Optional. Last name of the contact associated with the address. phone_number string No Optional. Phone number of the contact associated with the address."},{"location":"specification/order/#response","title":"Response","text":"Name Type Required Description Error: Failed to resolve ''. Ensure ucp-schema is installed: <code>cargo install ucp-schema</code>"},{"location":"specification/order/#total-response","title":"Total Response","text":"Name Type Required Description type string Yes Type of total categorization.Enum: <code>items_discount</code>, <code>subtotal</code>, <code>discount</code>, <code>fulfillment</code>, <code>tax</code>, <code>fee</code>, <code>total</code> display_text string No Text to display against the amount. Should reflect appropriate method (e.g., 'Shipping', 'Delivery'). amount integer Yes If type == total, sums subtotal - discount + fulfillment + tax + fee. Should be &gt;= 0. Amount in minor (cents) currency units."},{"location":"specification/order/#ucp-response-order","title":"UCP Response Order","text":"Name Type Required Description Error: Failed to resolve ''. Ensure ucp-schema is installed: <code>cargo install ucp-schema</code> capabilities any No"},{"location":"specification/overview/","title":"Overview","text":""},{"location":"specification/overview/#universal-commerce-protocol-ucp-official-specification","title":"Universal Commerce Protocol (UCP) Official Specification","text":""},{"location":"specification/overview/#overarching-guidelines","title":"Overarching guidelines","text":"<p>The key words MUST, MUST NOT, REQUIRED, SHALL, SHALL NOT, SHOULD, SHOULD NOT, RECOMMENDED, MAY, and OPTIONAL in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p> <p>Schema notes:</p> <ul> <li>Date format: Always specified as     RFC 3339     unless otherwise specified</li> <li>Amounts format: Minor units (cents)</li> </ul>"},{"location":"specification/overview/#discovery-governance-and-negotiation","title":"Discovery, Governance, and Negotiation","text":"<p>UCP employs a server-selects architecture where the business (server) chooses the protocol version and capabilities from the intersection of both parties' capabilities. Both business and platform profiles can be cached by both parties, allowing efficient capability negotiation within the normal request/response flow between platform and business.</p>"},{"location":"specification/overview/#namespace-governance","title":"Namespace Governance","text":"<p>UCP uses reverse-domain naming to encode governance authority directly into capability identifiers. This eliminates the need for a central registry.</p>"},{"location":"specification/overview/#naming-convention","title":"Naming Convention","text":"<p>All capability and service names MUST use the format:</p> <pre><code>{reverse-domain}.{service}.{capability}\n</code></pre> <p>Components:</p> <ul> <li><code>{reverse-domain}</code> - Authority identifier derived from domain ownership</li> <li><code>{service}</code> - Service/vertical category (e.g., <code>shopping</code>, <code>common</code>)</li> <li><code>{capability}</code> - The specific capability name</li> </ul> <p>Examples:</p> Name Authority Service Capability <code>dev.ucp.shopping.checkout</code> ucp.dev shopping checkout <code>dev.ucp.shopping.fulfillment</code> ucp.dev shopping fulfillment <code>dev.ucp.common.identity_linking</code> ucp.dev common identity_linking <code>com.example.payments.installments</code> example.com payments installments"},{"location":"specification/overview/#spec-url-binding","title":"Spec URL Binding","text":"<p>The <code>spec</code> and <code>schema</code> fields are REQUIRED for all capabilities. The origin of these URLs MUST match the namespace authority:</p> Namespace Required Origin <code>dev.ucp.*</code> <code>https://ucp.dev/...</code> <code>com.example.*</code> <code>https://example.com/...</code> <p>Platform MUST validate this binding and SHOULD reject capabilities where the spec origin does not match the namespace authority.</p>"},{"location":"specification/overview/#governance-model","title":"Governance Model","text":"Namespace Pattern Authority Governance <code>dev.ucp.*</code> ucp.dev UCP governing body <code>com.{vendor}.*</code> {vendor}.com Vendor organization <code>org.{org}.*</code> {org}.org Organization <p>The <code>dev.ucp.*</code> namespace is reserved for capabilities sanctioned by the UCP governing body. Vendors MUST use their own reverse-domain namespace for custom capabilities.</p>"},{"location":"specification/overview/#services","title":"Services","text":"<p>A service defines the API surface for a vertical (shopping, common, etc.). Services include operations, events, and transport bindings defined via standard formats:</p> <ul> <li>REST: OpenAPI 3.x (JSON format)</li> <li>MCP: OpenRPC (JSON format)</li> <li>A2A: Agent Card Specification</li> <li>EP(embedded): OpenRPC (JSON format)</li> </ul>"},{"location":"specification/overview/#service-definition","title":"Service Definition","text":"Field Type Required Description <code>version</code> string Yes Service version (YYYY-MM-DD format) <code>spec</code> string Yes URL to service documentation <code>rest</code> object No REST transport binding <code>rest.schema</code> string Yes URL to OpenAPI spec (JSON) <code>rest.endpoint</code> string Yes Business's REST endpoint <code>mcp</code> object No MCP transport binding <code>mcp.schema</code> string Yes URL to OpenRPC spec (JSON) <code>mcp.endpoint</code> string Yes Business's MCP endpoint <code>a2a</code> object No A2A transport binding <code>a2a.endpoint</code> string Yes Business's A2A Agent Card URL <code>embedded</code> string No Embedded transport binding <code>embedded.schema</code> string Yes URL to OpenRPC spec (JSON) <p>Transport definitions MUST be thin: they declare method names and reference base schemas only. See Requirements for details.</p>"},{"location":"specification/overview/#endpoint-resolution","title":"Endpoint Resolution","text":"<p>The <code>endpoint</code> field provides the base URL for API calls. OpenAPI paths are appended to this endpoint to form the complete URL.</p> <p>Example:</p> <pre><code>{\n  \"version\": \"2026-01-11\",\n  \"transport\": \"rest\",\n  \"schema\": \"https://ucp.dev/services/shopping/rest.openapi.json\",\n  \"endpoint\": \"https://business.example.com/api/v2\"\n}\n</code></pre> <p>With OpenAPI path <code>/checkout-sessions</code>, the resolved URL is:</p> <pre><code>POST https://business.example.com/api/v2/checkout-sessions\n</code></pre> <p>Rules:</p> <ul> <li><code>endpoint</code> MUST be a valid URL with scheme (https)</li> <li><code>endpoint</code> SHOULD NOT have a trailing slash</li> <li>OpenAPI paths are relative and appended directly to endpoint</li> <li>Same resolution applies to MCP endpoints for JSON-RPC calls</li> <li><code>endpoint</code> for A2A transport refers to the Agent Card URL for the agent</li> </ul>"},{"location":"specification/overview/#capabilities","title":"Capabilities","text":"<p>A capability is a feature within a service. It declares what functionality is supported and where to find documentation and schemas.</p>"},{"location":"specification/overview/#capability-definition","title":"Capability Definition","text":"<p>Error: Definition '#/$defs/discovery' not found in 'source/schemas/capability.json'</p>"},{"location":"specification/overview/#extensions","title":"Extensions","text":"<p>An extension is an optional module that augments another capability. Extensions use the <code>extends</code> field to declare their parent(s):</p> <pre><code>{\n  \"dev.ucp.shopping.fulfillment\": [\n    {\n      \"version\": \"2026-01-23\",\n      \"spec\": \"https://ucp.dev/2026-01-23/specification/fulfillment\",\n      \"schema\": \"https://ucp.dev/2026-01-23/schemas/shopping/fulfillment.json\",\n      \"extends\": \"dev.ucp.shopping.checkout\"\n    }\n  ]\n}\n</code></pre>"},{"location":"specification/overview/#multi-parent-extensions","title":"Multi-Parent Extensions","text":"<p>Extensions MAY extend multiple parent capabilities by using an array:</p> <pre><code>{\n  \"dev.ucp.shopping.discount\": [\n    {\n      \"version\": \"2026-01-23\",\n      \"spec\": \"https://ucp.dev/2026-01-23/specification/discount\",\n      \"schema\": \"https://ucp.dev/2026-01-23/schemas/shopping/discount.json\",\n      \"extends\": [\"dev.ucp.shopping.checkout\", \"dev.ucp.shopping.cart\"]\n    }\n  ]\n}\n</code></pre> <p>When an extension declares multiple parents:</p> <ul> <li>The extension MAY define different fields for each capability it extends     (e.g., <code>loyalty_earned</code> for checkout, <code>loyalty_preview</code> for cart)</li> <li>See Intersection Algorithm for negotiation rules</li> </ul> <p>Extensions can be:</p> <ul> <li>Official: <code>dev.ucp.shopping.fulfillment</code> extends <code>dev.ucp.shopping.checkout</code></li> <li>Vendor: <code>com.example.installments</code> extends <code>dev.ucp.shopping.checkout</code></li> </ul>"},{"location":"specification/overview/#schema-composition","title":"Schema Composition","text":"<p>Extensions can add new fields and modify shared structures (e.g., discounts modify <code>totals</code>, fulfillment adds fulfillment to <code>totals.type</code>).</p>"},{"location":"specification/overview/#requirements","title":"Requirements","text":"<ul> <li>Transport definitions (OpenAPI/OpenRPC) MUST reference base schemas     only. They MUST NOT enumerate fields or define payload shapes inline.</li> <li>Extensions MUST be self-describing. Each extension schema MUST     declare the types it introduces and how it modifies base types using <code>allOf</code>     composition.</li> <li>Platforms MUST resolve schemas client-side by fetching and composing     base schemas with active extension schemas.</li> </ul>"},{"location":"specification/overview/#extension-schema-pattern","title":"Extension Schema Pattern","text":"<p>Extension schemas define composed types using <code>allOf</code>. The <code>$defs</code> key MUST use the full parent capability name (reverse-domain format) to enable deterministic schema resolution:</p> <pre><code>{\n  \"$defs\": {\n    \"discounts_object\": { ... },\n    \"dev.ucp.shopping.checkout\": {\n      \"title\": \"Checkout with Discount\",\n      \"allOf\": [\n        {\"$ref\": \"checkout.json\"},\n        {\n          \"type\": \"object\",\n          \"properties\": {\n            \"discounts\": {\n              \"$ref\": \"#/$defs/discounts_object\"\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre> <p>Requirements:</p> <ul> <li>Extension schemas MUST have a <code>$defs</code> entry for each parent declared in     <code>extends</code></li> <li>The <code>$defs</code> key MUST match the parent's full capability name exactly</li> </ul> <p>This convention ensures:</p> <ul> <li>Self-documenting: The schema declares exactly which parents it extends</li> <li>Deterministic resolution: The <code>extends</code> value maps directly to the <code>$defs</code> key</li> <li>Verifiable: Build-time checks can confirm each <code>extends</code> entry has a     matching <code>$defs</code> key</li> </ul>"},{"location":"specification/overview/#schema-resolution-convention","title":"Schema Resolution Convention","text":"<p>To validate payloads, implementations resolve extension schemas as follows:</p> <ol> <li>Determine the root capability from the operation (e.g., checkout operations     use <code>dev.ucp.shopping.checkout</code>)</li> <li>For each active extension, resolve and apply its <code>$defs[{root_capability}]</code></li> </ol> <p>Example: A checkout response includes the discount extension.</p> <ul> <li>Root capability: <code>dev.ucp.shopping.checkout</code></li> <li>Extension schema: <code>discount.json</code></li> <li>Resolve: <code>discount.json#/$defs/dev.ucp.shopping.checkout</code></li> </ul>"},{"location":"specification/overview/#resolution-flow","title":"Resolution Flow","text":"<p>Platforms MUST resolve schemas following this sequence:</p> <ol> <li>Discovery: Fetch business profile from <code>/.well-known/ucp</code></li> <li>Negotiation: Compute capability intersection (see     Intersection Algorithm)</li> <li>Schema Fetch: Fetch base schema and all active extension schemas</li> <li>Compose: Merge schemas via <code>allOf</code> chains based on active extensions</li> <li>Validate: Validate requests and responses against the composed schema</li> </ol>"},{"location":"specification/overview/#profile-structure","title":"Profile Structure","text":""},{"location":"specification/overview/#business-profile","title":"Business Profile","text":"<p>Businesses publish their profile at <code>/.well-known/ucp</code>. An example:</p> <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"services\": {\n      \"dev.ucp.shopping\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/overview\",\n          \"transport\": \"rest\",\n          \"endpoint\": \"https://business.example.com/ucp/v1\",\n          \"schema\": \"https://ucp.dev/services/shopping/rest.openapi.json\"\n        },\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/overview\",\n          \"transport\": \"mcp\",\n          \"endpoint\": \"https://business.example.com/ucp/mcp\",\n          \"schema\": \"https://ucp.dev/services/shopping/mcp.openrpc.json\"\n        },\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/overview\",\n          \"transport\": \"a2a\",\n          \"endpoint\": \"https://business.example.com/.well-known/agent-card.json\"\n        },\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/overview\",\n          \"transport\": \"embedded\",\n          \"schema\": \"https://ucp.dev/services/shopping/embedded.openrpc.json\"\n        }\n      ]\n    },\n    \"capabilities\": {\n      \"dev.ucp.shopping.checkout\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/checkout\",\n          \"schema\": \"https://ucp.dev/schemas/shopping/checkout.json\"\n        }\n      ],\n      \"dev.ucp.shopping.fulfillment\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/fulfillment\",\n          \"schema\": \"https://ucp.dev/schemas/shopping/fulfillment.json\",\n          \"extends\": \"dev.ucp.shopping.checkout\"\n        }\n      ],\n      \"dev.ucp.shopping.discount\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/discount\",\n          \"schema\": \"https://ucp.dev/schemas/shopping/discount.json\",\n          \"extends\": \"dev.ucp.shopping.checkout\"\n        }\n      ]\n    },\n    \"payment_handlers\": {\n      \"com.example.processor_tokenizer\": [\n        {\n          \"id\": \"processor_tokenizer\",\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://example.com/specs/payments/processor_tokenizer\",\n          \"schema\": \"https://example.com/specs/payments/merchant_tokenizer.json\",\n          \"config\": {\n            \"type\": \"CARD\",\n            \"tokenization_specification\": {\n              \"type\": \"PUSH\",\n              \"parameters\": {\n                \"token_retrieval_url\": \"https://api.psp.example.com/v1/tokens\"\n              }\n            }\n          }\n        }\n      ]\n    }\n  },\n  \"signing_keys\": [\n    {\n      \"kid\": \"business_2025\",\n      \"kty\": \"EC\",\n      \"crv\": \"P-256\",\n      \"x\": \"WbbXwVYGdJoP4Xm3qCkGvBRcRvKtEfXDbWvPzpPS8LA\",\n      \"y\": \"sP4jHHxYqC89HBo8TjrtVOAGHfJDflYxw7MFMxuFMPY\",\n      \"use\": \"sig\",\n      \"alg\": \"ES256\"\n    }\n  ]\n}\n</code></pre> <p>The <code>ucp</code> object contains protocol metadata: version, services, capabilities, and payment handlers. The <code>signing_keys</code> array contains public keys (JWK format) used to verify signatures on webhooks and other authenticated messages from the business.</p>"},{"location":"specification/overview/#platform-profile","title":"Platform Profile","text":"<p>Platform profiles are similar and include signing keys for capabilities requiring cryptographic verification. Capabilities MAY include a <code>config</code> object for capability-specific settings (e.g., callback URLs, feature flags). An example:</p> <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"services\": {\n      \"dev.ucp.shopping\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/overview\",\n          \"transport\": \"rest\",\n          \"schema\": \"https://ucp.dev/services/shopping/rest.openapi.json\"\n        }\n      ]\n    },\n    \"capabilities\": {\n      \"dev.ucp.shopping.checkout\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/checkout\",\n          \"schema\": \"https://ucp.dev/schemas/shopping/checkout.json\"\n        }\n      ],\n      \"dev.ucp.shopping.fulfillment\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/fulfillment\",\n          \"schema\": \"https://ucp.dev/schemas/shopping/fulfillment.json\",\n          \"extends\": \"dev.ucp.shopping.checkout\"\n        }\n      ],\n      \"dev.ucp.shopping.order\": [\n        {\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specification/order\",\n          \"schema\": \"https://ucp.dev/schemas/shopping/order.json\",\n          \"config\": {\n            \"webhook_url\": \"https://platform.example.com/webhooks/ucp/orders\"\n          }\n        }\n      ]\n    },\n    \"payment_handlers\": {\n      \"com.google.pay\": [\n        {\n          \"id\": \"gpay_1234\",\n          \"version\": \"2024-12-03\",\n          \"spec\": \"https://developers.google.com/merchant/ucp/guides/gpay-payment-handler\",\n          \"schema\": \"https://pay.google.com/gp/p/ucp/2026-01-11/schemas/gpay_config.json\"\n        }\n      ],\n      \"dev.shopify.shop_pay\": [\n        {\n          \"id\": \"shop_pay_1234\",\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://shopify.dev/ucp/shop-pay-handler\",\n          \"schema\": \"https://shopify.dev/ucp/schemas/shop-pay-config.json\"\n        }\n      ],\n      \"dev.ucp.processor_tokenizer\": [\n        {\n          \"id\": \"processor_tokenizer\",\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://example.com/specs/payments/processor_tokenizer-payment\",\n          \"schema\": \"https://ucp.dev/schemas/payments/delegate-payment.json\"\n        }\n      ]\n    }\n  },\n  \"signing_keys\": [\n    {\n      \"kid\": \"platform_2025\",\n      \"kty\": \"EC\",\n      \"crv\": \"P-256\",\n      \"x\": \"MKBCTNIcKUSDii11ySs3526iDZ8AiTo7Tu6KPAqv7D4\",\n      \"y\": \"4Etl6SRW2YiLUrN5vfvVHuhp7x8PxltmWWlbbM4IFyM\",\n      \"use\": \"sig\",\n      \"alg\": \"ES256\"\n    }\n  ]\n}\n</code></pre>"},{"location":"specification/overview/#platform-advertisement-on-request","title":"Platform Advertisement on Request","text":"<p>Platforms MUST communicate their profile URI with each request to enable capability negotiation.</p> <p>HTTP Transport: Platforms MUST use Dictionary Structured Field syntax (RFC 8941) in the UCP-Agent header:</p> <pre><code>POST /checkout HTTP/1.1\nUCP-Agent: profile=\"https://agent.example/profiles/shopping-agent.json\"\nContent-Type: application/json\n\n{\"line_items\": [...]}\n</code></pre> <p>MCP Transport: Platforms MUST include a <code>meta</code> object containing request metadata:</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"create_checkout\",\n  \"params\": {\n    \"meta\": {\n      \"ucp-agent\": {\n        \"profile\": \"https://agent.example/profiles/shopping-agent.json\"\n      },\n      \"idempotency-key\": \"550e8400-e29b-41d4-a716-446655440000\"\n    },\n    \"checkout\": {\n      \"line_items\": [...]\n    }\n  },\n  \"id\": 1\n}\n</code></pre>"},{"location":"specification/overview/#negotiation-protocol","title":"Negotiation Protocol","text":""},{"location":"specification/overview/#platform-requirements","title":"Platform Requirements","text":"<ol> <li>Profile Advertisement: Platforms MUST include their profile URI in     every request using the transport-appropriate mechanism.</li> <li>Discovery: Platforms MAY fetch the business profile from     <code>/.well-known/ucp</code> before initiating requests. If fetched, platforms     SHOULD cache the profile according to HTTP cache-control directives.</li> <li>Namespace Validation: Platforms MUST validate that capability <code>spec</code>     URI origins match namespace authorities.</li> <li>Schema Resolution: Platforms MUST fetch and compose schemas for     negotiated capabilities before making requests.</li> </ol>"},{"location":"specification/overview/#business-requirements","title":"Business Requirements","text":"<ol> <li>Profile Resolution: Upon receiving a request with a platform profile     URI, businesses MUST fetch and validate the platform profile unless     already cached.</li> <li>Capability Intersection: Businesses MUST compute the intersection of     platform and business capabilities.</li> <li>Extension Validation: Extensions without their parent capability in the     intersection MUST be excluded.</li> <li>Response Requirements: Businesses MUST include the <code>ucp</code> field in     every response containing:<ul> <li><code>version</code>: The UCP version used to process the request</li> <li><code>capabilities</code>: Array of active capabilities for this response</li> </ul> </li> </ol>"},{"location":"specification/overview/#intersection-algorithm","title":"Intersection Algorithm","text":"<p>The capability intersection algorithm determines which capabilities are active for a session:</p> <ol> <li> <p>Compute intersection: For each business capability, include it in the     result if a platform capability with the same <code>name</code> exists.</p> </li> <li> <p>Prune orphaned extensions: Remove any capability where <code>extends</code> is     set but none of its parent capabilities are in the intersection.</p> <ul> <li>For single-parent extensions (<code>extends: \"string\"</code>): parent must be present</li> <li>For multi-parent extensions (<code>extends: [\"a\", \"b\"]</code>): at least one parent     must be present</li> </ul> </li> <li> <p>Repeat pruning: Continue step 2 until no more capabilities are removed     (handles transitive extension chains).</p> </li> </ol> <p>The result is the set of capabilities both parties support, with extension dependencies satisfied.</p>"},{"location":"specification/overview/#error-handling","title":"Error Handling","text":"<p>UCP negotiation can fail in two ways:</p> <ol> <li> <p>Discovery failure: The business cannot fetch or parse the platform's    profile.</p> </li> <li> <p>Negotiation failure: The provided profile is valid but capability    intersection is empty or versions are incompatible.</p> </li> </ol> <p>These failure types require different handling:</p> <ul> <li>Discovery failure \u2192 transport error with optional <code>continue_url</code></li> <li>Negotiation failure \u2192 UCP response with optional <code>continue_url</code></li> </ul>"},{"location":"specification/overview/#error-codes","title":"Error Codes","text":"Code Description REST MCP <code>INVALID_PROFILE_URL</code> Profile URL is malformed, missing, or unresolvable 400 error <code>PROFILE_UNREACHABLE</code> Resolved URL but fetch failed (timeout, non-2xx) 424 error <code>PROFILE_MALFORMED</code> Fetched content is not valid JSON or violates schema 422 error <code>CAPABILITIES_INCOMPATIBLE</code> No compatible capabilities in intersection 200 result <code>VERSION_UNSUPPORTED</code> Platform's UCP version is not supported 200 result"},{"location":"specification/overview/#the-continue_url-field","title":"The <code>continue_url</code> Field","text":"<p>When UCP negotiation fails, <code>continue_url</code> provides a fallback web experience. Businesses SHOULD provide the most contextually relevant URL:</p> <ul> <li>For checkout operations: link to the cart or checkout page</li> <li>For catalog operations: link to the product or search results</li> <li>As a fallback: link to the storefront homepage</li> </ul> <p>This enables graceful degradation\u2014agents can redirect buyers to complete their task through the standard web interface.</p>"},{"location":"specification/overview/#transport-bindings","title":"Transport Bindings","text":"RESTMCP <p>Discovery Failure (424):</p> <pre><code>HTTP/1.1 424 Failed Dependency\nContent-Type: application/json\n\n{\n  \"code\": \"PROFILE_UNREACHABLE\",\n  \"content\": \"Unable to fetch agent profile: connection timeout\",\n  \"continue_url\": \"https://merchant.com/cart\"\n}\n</code></pre> <p>Negotiation Failure (200):</p> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {}\n  },\n  \"messages\": [\n    {\n      \"type\": \"error\",\n      \"code\": \"VERSION_UNSUPPORTED\",\n      \"content\": \"Platform UCP version 2024-01-01 is not supported\",\n      \"severity\": \"requires_buyer_input\"\n    }\n  ],\n  \"continue_url\": \"https://merchant.com/cart\"\n}\n</code></pre> <p>Discovery Failure (JSON-RPC error):</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"error\": {\n    \"code\": -32001,\n    \"message\": \"UCP discovery failed\",\n    \"data\": {\n      \"code\": \"PROFILE_UNREACHABLE\",\n      \"content\": \"Unable to fetch agent profile: connection timeout\",\n      \"continue_url\": \"https://merchant.com/cart\"\n    }\n  }\n}\n</code></pre> <p>Negotiation Failure (JSON-RPC result):</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"ucp\": {\n      \"version\": \"2026-01-11\",\n      \"capabilities\": {}\n    },\n    \"messages\": [\n      {\n        \"type\": \"error\",\n        \"code\": \"VERSION_UNSUPPORTED\",\n        \"content\": \"Platform UCP version 2024-01-01 is not supported\",\n        \"severity\": \"requires_buyer_input\"\n      }\n    ],\n    \"continue_url\": \"https://merchant.com/cart\"\n  }\n}\n</code></pre>"},{"location":"specification/overview/#capability-declaration-in-responses","title":"Capability Declaration in Responses","text":"<p>The <code>capabilities</code> registry in responses indicates active capabilities:</p> <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": {\n      \"dev.ucp.shopping.checkout\": [\n        {\"version\": \"2026-01-11\"}\n      ],\n      \"dev.ucp.shopping.fulfillment\": [\n        {\"version\": \"2026-01-11\"}\n      ]\n    },\n    \"payment_handlers\": {\n      \"com.example.processor_tokenizer\": [\n        {\"id\": \"processor_tokenizer\", \"version\": \"2026-01-11\"}\n      ]\n    }\n  },\n  \"id\": \"checkout_123\",\n  \"line_items\": [...]\n  ... other fields\n}\n</code></pre>"},{"location":"specification/overview/#response-capability-selection","title":"Response Capability Selection","text":"<p>Businesses MUST include in <code>ucp.capabilities</code> only the capabilities that are:</p> <ol> <li>In the negotiated intersection for this session, AND</li> <li>Relevant to this response's operation type</li> </ol> <p>Root Capability Relevance:</p> <p>A root capability is relevant if it matches the operation type:</p> <ul> <li><code>create_checkout</code> / <code>update_checkout</code> / <code>complete_checkout</code> \u2192     <code>dev.ucp.shopping.checkout</code></li> <li><code>create_cart</code> / <code>update_cart</code> \u2192 <code>dev.ucp.shopping.cart</code></li> <li>Order webhooks \u2192 <code>dev.ucp.shopping.order</code></li> </ul> <p>Extension Relevance:</p> <p>An extension is relevant if any of its <code>extends</code> values matches a relevant root capability.</p> <p>Selection Examples:</p> Response Type Includes Does NOT Include Checkout checkout, discount, fulfillment cart, order Cart cart, discount checkout, fulfillment, order Order order checkout, cart, discount"},{"location":"specification/overview/#payment-architecture","title":"Payment Architecture","text":"<p>UCP adopts a decoupled architecture for payments to solve the \"N-to-N\" complexity problem between platforms, businesses, and payment credential providers. This design separates Payment Instruments (what is accepted) from Payment Handlers (the specifications for how instruments are processed), ensuring security and scalability.</p>"},{"location":"specification/overview/#security-and-trust-model","title":"Security and Trust Model","text":"<p>The payment architecture is built on a \"Trust-by-Design\" philosophy. It assumes that while the business and payment credential provider have a trusted legal relationship, the platform (Client) acts as an intermediary that SHOULD NOT touch raw financial credentials.</p>"},{"location":"specification/overview/#the-trust-triangle","title":"The Trust Triangle","text":"<ol> <li>Business \u2194 Payment Credential Provider: A pre-existing legal and technical relationship. The business holds API keys and a contract with the payment credential provider.</li> <li>Platform \u2194 Payment Credential Provider: The platform interacts with the payment credential provider's interface (e.g., an iframe or API) to tokenize data but is not the \"owner\" of the funds.</li> <li>Platform \u2194 Business: The platform passes the result (a token or mandate) to the business to finalize the order.</li> </ol>"},{"location":"specification/overview/#enhanced-security-for-autonomous-commerce","title":"Enhanced Security for Autonomous Commerce","text":"<p>For scenarios requiring cryptographic proof of user authorization (e.g., autonomous AI agents), UCP supports the AP2 Mandates Extension (<code>dev.ucp.shopping.ap2_mandate</code>). This optional extension provides non-repudiable authorization through verifiable digital credentials.</p> <p>See Transaction Integrity and AP2 Mandates Extension for details on when and how to use this extension.</p>"},{"location":"specification/overview/#credential-flow-pci-scope","title":"Credential Flow &amp; PCI Scope","text":"<p>To minimize compliance overhead (PCI-DSS):</p> <ol> <li>Unidirectional Flow: Credentials flow Platform \u2192 Business only. Businesses MUST NOT echo credentials back in responses.</li> <li>Opaque Credentials: Platforms handle tokens (such as network tokens), encrypted payloads, or mandates, not raw PANs.</li> <li>Handler ID Routing: The <code>handler_id</code> in the payload ensures the business knows exactly which payment credential provider key to use for decryption/charging, preventing key confusion attacks.</li> </ol>"},{"location":"specification/overview/#roles-responsibilities-who-implements-what","title":"Roles &amp; Responsibilities: Who Implements What?","text":"<p>A common source of confusion is the division of labor. The UCP payment model splits responsibilities as follows:</p> Role Responsibility Action Payment Credential Provider Defines the Spec Creates the Handler Definition. They publish the \"Blueprint\" (JSON Schemas) that dictates how to tokenize a card and what config inputs are needed.Example: \"Here is the schema for the 'com.psp-x.tokenization' handler.\" Business Configures the Handler Selects the Handler they want to use and provides their specific Configuration (Public Keys, Merchant IDs) in the UCP Checkout Response. Example: \"I accept Visa using 'com.psp-x.tokenization' with this Publishable Key.\" Platform Executes the Protocol Reads the business's config and executes the logic defined by the payment credential provider's Spec to acquire a token. Example: \"I see the Business uses a payment credential provider. I will call the provider's SDK with the Business's Key to get a token.\""},{"location":"specification/overview/#payment-in-the-checkout-lifecycle","title":"Payment in the Checkout Lifecycle","text":"<p>When payment is required, the payment process follows a standard 3-step lifecycle within UCP: Negotiation, Acquisition, and Completion.</p> <p></p> <ol> <li>Negotiation (Business \u2192 Platform): The business advertises available payment handlers in their UCP profile. This tells the platform how to pay (e.g., \"Use this specific payment credential provider endpoint with this public key\").</li> <li>Acquisition (Platform \u2194 Payment Credential Provider): The platform executes the handler's logic. This happens client-side or agent-side, directly with the payment credential provider (e.g., exchanging credentials for a network token). The business is not involved, ensuring raw data never touches the business's frontend API.</li> <li>Completion (Platform \u2192 Business): The platform submits the opaque credential (token) to the business. The business uses it to capture funds via their backend integration with the payment credential provider.</li> </ol>"},{"location":"specification/overview/#payment-handlers","title":"Payment Handlers","text":"<p>Payment Handlers are specifications (not entities) that define how payment instruments are processed. They are the contract that binds the three participants together.</p> <p>Important distinction:</p> <ul> <li>Payment Credential Provider = The participant (entity like Google Pay, Shop Pay)</li> <li>Payment Handler = The specification the provider authors (e.g., <code>com.google.pay</code>, <code>dev.shopify.shop_pay</code>)</li> </ul> <p>Payment handlers allow for a variety of different payment instruments and token-types to be supported, including network tokens. They are standardized definitions typically authored by payment credential providers or the UCP governing body.</p> <p>Dynamic Filtering: Businesses MUST filter the <code>handlers</code> list based on the context of the cart (e.g., removing \"Buy Now Pay Later\" for subscription items, or filtering regional methods based on shipping address).</p>"},{"location":"specification/overview/#risk-signals","title":"Risk Signals","text":"<p>To aid in fraud assessment, the Platform MAY include additional risk signals in the <code>complete</code> call, providing the Business with more context about the transaction's legitimacy. The structure and content of these risk signals are not strictly defined by this specification, allowing flexibility based on the agreement between the Platform and Business or specific payment handler requirements.</p> <p>Example (Flexible Structure):</p> <pre><code>{\n  \"risk_signals\": {\n    \"session_id\": \"abc_123_xyz\",\n    \"score\": 0.95,\n  }\n}\n</code></pre>"},{"location":"specification/overview/#implementation-scenarios","title":"Implementation Scenarios","text":"<p>The following scenarios illustrate how different payment handlers and instruments are negotiated and executed using concrete data examples.</p>"},{"location":"specification/overview/#scenario-a-digital-wallet","title":"Scenario A: Digital Wallet","text":"<p>In this scenario, the platform identifies a payment credential provider (e.g., <code>com.google.pay</code>, <code>dev.shopify.shop_pay</code>) and uses their API to acquire an encrypted payment token.</p>"},{"location":"specification/overview/#1-business-advertisement-response-from-create-checkout","title":"1. Business Advertisement (Response from Create Checkout)","text":"<pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"payment_handlers\": {\n      \"com.google.pay\": [\n        {\n          \"id\": \"8c9202bd-63cc-4241-8d24-d57ce69ea31c\",\n          \"version\": \"2026-01-11\",\n          \"config\": {\n            \"api_version\": 2,\n            \"api_version_minor\": 0,\n            \"environment\": \"TEST\",\n            \"merchant_info\": {\n              \"merchant_name\": \"Example Merchant\",\n              \"merchant_id\": \"01234567890123456789\",\n              \"merchant_origin\": \"checkout.merchant.com\"\n            },\n            \"allowed_payment_methods\": [\n              {\n                \"type\": \"CARD\",\n                \"parameters\": {\n                  \"allowed_auth_methods\": [\"PAN_ONLY\"],\n                  \"allowed_card_networks\": [\"VISA\", \"MASTERCARD\"]\n                },\n                \"tokenization_specification\": {\n                  \"type\": \"PAYMENT_GATEWAY\",\n                  \"parameters\": {\n                    \"gateway\": \"example\",\n                    \"gatewayMerchantId\": \"exampleGatewayMerchantId\"\n                  }\n                }\n              }\n            ]\n          }\n        }\n      ],\n      \"dev.shopify.shop_pay\": [\n        {\n          \"id\": \"shop_pay_1234\",\n          \"version\": \"2026-01-11\",\n          \"config\": {\n            \"shop_id\": \"shopify-559128571\",\n            \"environment\": \"production\"\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/overview/#2-token-execution-platform-side","title":"2. Token Execution (Platform Side)","text":"<p>The platform recognizes <code>com.google.pay</code> or <code>dev.shopify.shop_pay</code>. It passes the <code>config</code> into the respective handler API. The handler returns the encrypted token data.</p>"},{"location":"specification/overview/#3-complete-checkout-request-to-business","title":"3. Complete Checkout (Request to Business)","text":"<p>The Platform wraps the payment handler response into a payment instrument.</p> <pre><code>POST /checkout-sessions/{id}/complete\n\n{\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"pm_1234567890abc\",\n        \"handler_id\": \"8c9202bd-63cc-4241-8d24-d57ce69ea31c\",\n        \"type\": \"card\",\n        \"selected\": true,\n        \"display\": {\n          \"brand\": \"visa\",\n          \"last_digits\": \"4242\"\n        },\n        \"billing_address\": {\n          \"street_address\": \"123 Main Street\",\n          \"extended_address\": \"Suite 400\",\n          \"address_locality\": \"Charleston\",\n          \"address_region\": \"SC\",\n          \"postal_code\": \"29401\",\n          \"address_country\": \"US\",\n          \"first_name\": \"Jane\",\n          \"last_name\": \"Smith\"\n        },\n        \"credential\": {\n          \"type\": \"PAYMENT_GATEWAY\",\n          \"token\": \"{\\\"signature\\\":\\\"...\\\",\\\"protocolVersion\\\":\\\"ECv2\\\"...}\"\n        }\n      }\n    ]\n  },\n  \"risk_signals\": {\n      // ...\n  }\n}\n</code></pre>"},{"location":"specification/overview/#scenario-b-direct-tokenization-with-challenge-sca","title":"Scenario B: Direct Tokenization with Challenge (SCA)","text":"<p>In this scenario, the platform uses a generic tokenizer to request a session token or network tokens. The bank requires Strong Customer Authentication (SCA/3DS), forcing the business to pause completion and request a challenge.</p>"},{"location":"specification/overview/#1-business-advertisement","title":"1. Business Advertisement","text":"<pre><code>{\n  \"ucp\": {\n    \"payment_handlers\": {\n      \"com.example.tokenizer\": [\n        {\n          \"id\": \"merchant_tokenizer\",\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://example.com/specs/tokenizer\",\n          \"schema\": \"https://example.com/schemas/tokenizer.json\",\n          \"config\": {\n            \"token_url\": \"https://api.psp.com/tokens\",\n            \"public_key\": \"pk_123\"\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/overview/#2-token-execution-platform-side_1","title":"2. Token Execution (Platform Side)","text":"<p>The platform calls <code>https://api.psp.com/tokens</code> which identity SHOULD have previous legal binding connection with them and receives <code>tok_visa_123</code> (which could represent a vaulted card or network token).</p>"},{"location":"specification/overview/#3-complete-checkout-request-to-business_1","title":"3. Complete Checkout (Request to Business)","text":"<pre><code>POST /checkout-sessions/{id}/complete\n\n{\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"handler_id\": \"merchant_tokenizer\",\n        // ... more instrument required field\n        \"credential\": { \"token\": \"tok_visa_123\" }\n      }\n    ]\n  },\n  \"risk_signals\": {\n    // ... host could send risk_signals here\n  }\n}\n</code></pre>"},{"location":"specification/overview/#4-challenge-required-response-from-business","title":"4. Challenge Required (Response from Business)","text":"<p>The business attempts the charge, but the PSP returns a \"Soft Decline\" requiring 3DS.</p> <pre><code>HTTP/1.1 200 OK\n{\n  \"status\": \"requires_escalation\",\n  \"messages\": [{\n    \"type\": \"error\",\n    \"code\": \"requires_3ds\",\n    \"content\": \"bank requires verification.\",\n    \"severity\": \"requires_buyer_input\"\n  }],\n  \"continue_url\": \"https://psp.com/challenge/123\"\n}\n</code></pre> <p>The platform MUST now open <code>continue_url</code> in a WebView/Window for the user to complete the bank check, then retry the completion.</p>"},{"location":"specification/overview/#scenario-c-autonomous-agent-ap2","title":"Scenario C: Autonomous Agent (AP2)","text":"<p>This scenario demonstrates the Recommended Flow for Agents. Instead of a session token, the agent generates cryptographic mandates.</p>"},{"location":"specification/overview/#1-business-advertisement_1","title":"1. Business Advertisement","text":"<pre><code>{\n  \"ucp\": {\n    \"payment_handlers\": {\n      \"dev.ucp.ap2_mandate_compatible_handlers\": [\n        {\n          \"id\": \"ap2_234352\",\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://ucp.dev/specs/ap2-handler\",\n          \"schema\": \"https://ucp.dev/schemas/ap2-handler.json\"\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/overview/#2-agent-execution","title":"2. Agent Execution","text":"<p>The agent cryptographically signs objects using the user's private key on a non-agentic surface.</p>"},{"location":"specification/overview/#3-complete-checkout","title":"3. Complete Checkout","text":"<pre><code>POST /checkout-sessions/{id}/complete\n\n{\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"handler_id\": \"ap2_234352\",\n        // other required instruments fields\n        \"credential\": {\n          \"type\": \"card\",\n          \"token\": \"eyJhbGciOiJ...\", // Token would contain payment_mandate, the signed proof of funds auth\n        }\n      }\n    ]\n  },\n  \"risk_signals\": {\n    \"session_id\": \"abc_123_xyz\",\n    \"score\": 0.95\n  },\n  \"ap2\": {\n    \"checkout_mandate\": \"eyJhbGciOiJ...\", // Signed proof of checkout terms\n  }\n}\n</code></pre> <p>This provides the business with non-repudiable proof that the user authorized this specific transaction, enabling safe autonomous processing.</p>"},{"location":"specification/overview/#pci-dss-scope-management","title":"PCI-DSS Scope Management","text":""},{"location":"specification/overview/#platform-scope","title":"Platform Scope","text":"<p>Most platform implementations can avoid PCI-DSS scope by:</p> <ul> <li>Using handlers that provide opaque credentials (encrypted data, token     references, etc.)</li> <li>Never accessing or storing raw payment data (card numbers, CVV, etc.)</li> <li>Forwarding credentials without the ability to use them directly</li> <li>Using PSP tokenization payment handlers where raw credentials never pass     through the platform</li> </ul>"},{"location":"specification/overview/#business-scope","title":"Business Scope","text":"<p>Businesses can minimize PCI scope by:</p> <ul> <li>Using payment credential provider-hosted tokenization (provider stores     credentials, business receives token reference)</li> <li>Using wallet providers that provide encrypted credentials (Google Pay, Shop     Pay)</li> <li>Never logging raw credentials</li> <li>Delegating credential processing to PCI-certified payment credential providers</li> </ul>"},{"location":"specification/overview/#payment-credential-provider-scope","title":"Payment Credential Provider Scope","text":"<p>Payment credential providers (PSPs, wallets) are typically PCI-DSS Level 1 certified and handle:</p> <ul> <li>Raw credential collection</li> <li>Credential protection (tokenization, encryption, secure storage)</li> <li>Credential validation and processing</li> <li>PCI-compliant infrastructure</li> </ul>"},{"location":"specification/overview/#security-best-practices","title":"Security Best Practices","text":"<p>For Businesses:</p> <ol> <li>Validate handler_id before processing (ensure handler is in advertised set)</li> <li>Use separate PSP credentials for TEST vs PRODUCTION environments</li> <li>Implement idempotency for payment processing (prevent double-charges)</li> <li>Log payment events without logging credentials</li> <li>Set appropriate credential timeouts</li> <li>For autonomous commerce scenarios requiring cryptographic proof, consider     supporting the <code>dev.ucp.shopping.ap2_mandate</code> extension (see     AP2 Mandates Extension)</li> </ol> <p>For Platforms:</p> <ol> <li>Always use HTTPS for checkout API calls</li> <li>Validate handler configurations before executing protocols</li> <li>Implement timeout handling for credential acquisition</li> <li>Clear credentials from memory after submission</li> <li>Handle credential expiration gracefully (re-acquire if needed)</li> <li>For autonomous agents, consider using the <code>dev.ucp.shopping.ap2_mandate</code>     extension for cryptographic proof of authorization (see     AP2 Mandates Extension)</li> </ol> <p>For Payment Credential Providers:</p> <ol> <li>Secure credentials for the specific business (encryption, tokenization, or     other handler-specific methods)</li> <li>Implement rate limiting on credential acquisition</li> <li>Validate platform authorization before providing credentials</li> <li>Set reasonable credential expiration (e.g., 15 minutes for tokens, time-     limited encrypted payloads)</li> <li>Ensure credentials cannot be used by platforms directly (only by the     intended business)</li> </ol>"},{"location":"specification/overview/#fraud-prevention-integration","title":"Fraud Prevention Integration","text":"<p>While UCP does not define fraud prevention APIs, the payment architecture supports fraud signal integration:</p> <ul> <li>Businesses can require additional fields in handler configurations (e.g.,     3DS requirements)</li> <li>Platforms can submit device fingerprints and session data alongside credentials</li> <li>Payment credential providers can perform risk assessment during credential     acquisition</li> <li>Businesses can reject high-risk transactions and request additional     verification</li> </ul> <p>Future extensions MAY standardize fraud signal schemas, but the current architecture allows flexible integration with existing fraud prevention systems.</p>"},{"location":"specification/overview/#payment-architecture-extensions","title":"Payment Architecture Extensions","text":"<p>The core payment architecture described above can be extended for specialized use cases:</p> <ul> <li> <p>AP2 Mandates Extension (<code>dev.ucp.shopping.ap2_mandate</code>): Adds     cryptographic proof of user authorization for autonomous commerce scenarios     where non-repudiable evidence is required. See     AP2 Mandates Extension.</p> </li> <li> <p>Custom Handler Types: Payment credential providers can define custom     handlers to support new payment instruments. See     Payment Handler Guide for details.</p> </li> </ul> <p>The extension model ensures the core architecture remains simple while supporting advanced security and compliance requirements when needed.</p>"},{"location":"specification/overview/#transport-layer","title":"Transport Layer","text":"<p>UCP supports multiple transport protocols. Platforms and businesses effectively negotiate the transport via <code>services</code> on their profiles.</p>"},{"location":"specification/overview/#rest-transport-core","title":"REST Transport (Core)","text":"<p>The primary transport for UCP is HTTP/1.1 (or higher) using RESTful patterns.</p> <ul> <li>Content-Type: Requests and responses MUST use <code>application/json</code>.</li> <li>Methods: Implementations MUST use standard HTTP verbs (e.g., <code>POST</code>     for creation, <code>GET</code> for retrieval).</li> <li>Status Codes: Implementations MUST use standard HTTP status codes     (e.g., 200, 201, 400, 401, 500).</li> </ul>"},{"location":"specification/overview/#model-context-protocol-mcp","title":"Model Context Protocol (MCP)","text":"<p>UCP capabilities map 1:1 to MCP tools. A business MAY expose an MCP server that wraps their UCP implementation, allowing LLMs to call tools like <code>create_checkout</code> directly.</p>"},{"location":"specification/overview/#agent-to-agent-protocol-a2a","title":"Agent-to-Agent Protocol (A2A)","text":"<p>A business MAY expose an A2A agent that supports UCP as an A2A Extension, allowing integration with platforms over structured UCP data types.</p>"},{"location":"specification/overview/#embedded-protocol-ep","title":"Embedded Protocol (EP)","text":"<p>A business MAY embed an interface onto an eligible host that would receive events as the user interacts with the interface and delegate key user actions.</p> <p>Initiation comes through a <code>continue_url</code> that is returned by the business.</p>"},{"location":"specification/overview/#standard-capabilities","title":"Standard Capabilities","text":"<p>UCP defines a set of standard capabilities:</p> Capability Name ID (URI) Description Checkout <code>https://ucp.dev/schemas/shopping/checkout.json</code> Facilitates the creation and management of checkout sessions, including cart management and tax calculation. Identity Linking - Enables platforms to obtain authorization via OAuth 2.0 to perform actions on a user's behalf. Order <code>https://ucp.dev/schemas/shopping/order.json</code> Allows businesses to push asynchronous updates about an order's lifecycle (shipping, delivery, returns)."},{"location":"specification/overview/#definition-extensions","title":"Definition &amp; Extensions","text":"<p>Detailed definitions for endpoints, schemas, and valid extensions for each capability are provided in their respective specification files. Extensions are typically versioned and defined alongside their parent capability.</p>"},{"location":"specification/overview/#security-authentication","title":"Security &amp; Authentication","text":""},{"location":"specification/overview/#transport-security","title":"Transport Security","text":"<p>All UCP communication MUST occur over HTTPS.</p>"},{"location":"specification/overview/#request-authentication","title":"Request Authentication","text":"<ul> <li>Platform to Business: Requests SHOULD be authenticated using     standard headers (e.g., <code>Authorization: Bearer &lt;token&gt;</code>).</li> <li>Business to Platform (Webhooks): Webhooks MUST be signed using a     shared secret or asymmetric key to verify integrity and origin.</li> </ul>"},{"location":"specification/overview/#data-privacy","title":"Data Privacy","text":"<p>Sensitive data (such as Payment Credentials or PII) MUST be handled according to PCI-DSS and GDPR guidelines. UCP encourages the use of tokenized payment data to minimize business and platform liability.</p>"},{"location":"specification/overview/#transaction-integrity-and-non-repudiation","title":"Transaction Integrity and Non-Repudiation","text":"<p>For scenarios requiring cryptographic proof of authorization (e.g., autonomous agents, high-value transactions), UCP supports the AP2 Mandates Extension (<code>dev.ucp.shopping.ap2_mandate</code>). When this optional extension is negotiated:</p> <ul> <li>Businesses provide a cryptographic signature on checkout terms</li> <li>Platforms provide cryptographic mandates proving user authorization</li> </ul> <p>This mechanism provides strong, end-to-end cryptographic assurances about transaction details and participant consent, significantly reducing risks of tampering and disputes.</p> <p>See AP2 Mandates Extension for complete specification, implementation guide, and examples.</p>"},{"location":"specification/overview/#versioning","title":"Versioning","text":""},{"location":"specification/overview/#version-format","title":"Version Format","text":"<p>UCP uses date-based versioning in the format <code>YYYY-MM-DD</code>. This provides clear chronological ordering and unambiguous version comparison.</p>"},{"location":"specification/overview/#version-discovery-and-negotiation","title":"Version Discovery and Negotiation","text":"<p>UCP prioritizes strong backwards compatibility. Businesses implementing a version SHOULD handle requests from platforms using that version or older.</p> <p>Both businesses and platforms declare a single version in their profiles:</p>"},{"location":"specification/overview/#example","title":"Example","text":"Business ProfilePlatform Profile <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"services\": { ... },\n    \"capabilities\": { ... },\n    \"payment_handlers\": { ... }\n  }\n}\n</code></pre> <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"services\": { ... },\n    \"capabilities\": { ... },\n    \"payment_handlers\": { ... }\n  }\n}\n</code></pre>"},{"location":"specification/overview/#version-negotiation","title":"Version Negotiation","text":"<p>Businesses MUST validate the platform's version and determine compatibility:</p> <ol> <li>Platform declares version via profile referenced in request</li> <li>Business validates:<ul> <li>If platform version \u2264 business version: Business MUST     process the request</li> <li>If platform version &gt; business version: Business MUST return     <code>version_unsupported</code> error</li> </ul> </li> <li>Businesses MUST include the version used for processing in every     response.</li> </ol> <p>Response with version confirmation:</p> <pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"capabilities\": { ... },\n    \"payment_handlers\": { ... }\n  },\n  \"id\": \"checkout_123\",\n  \"status\": \"incomplete\"\n  ...other checkout fields\n}\n</code></pre> <p>Version unsupported error:</p> <pre><code>{\n  \"status\": \"requires_escalation\",\n  \"messages\": [{\n    \"type\": \"error\",\n    \"code\": \"version_unsupported\",\n    \"content\": \"Version 2026-01-12 is not supported. This business implements version 2026-01-11.\",\n    \"severity\": \"requires_buyer_input\"\n  }]\n}\n</code></pre>"},{"location":"specification/overview/#backwards-compatibility","title":"Backwards Compatibility","text":""},{"location":"specification/overview/#backwards-compatible-changes","title":"Backwards-Compatible Changes","text":"<p>The following changes MAY be introduced without a new version:</p> <ul> <li>Adding new non-required fields to responses</li> <li>Adding new non-required parameters to requests</li> <li>Adding new endpoints, methods, or operations to a transport</li> <li>Adding new error codes with existing error structures</li> <li>Adding new values to enums (unless explicitly documented as exhaustive)</li> <li>Changing the order of fields in responses</li> <li>Changing the length or format of opaque strings (IDs, tokens)</li> </ul>"},{"location":"specification/overview/#breaking-changes","title":"Breaking Changes","text":"<p>The following changes MUST NOT be introduced without a new version:</p> <ul> <li>Removing or renaming existing fields</li> <li>Changing field types or semantics</li> <li>Making non-required fields required</li> <li>Removing operations, methods, or endpoints</li> <li>Changing authentication or authorization requirements</li> <li>Modifying existing protocol flow or state machine</li> <li>Changing the meaning of existing error codes</li> </ul>"},{"location":"specification/overview/#independent-component-versioning","title":"Independent Component Versioning","text":"<ul> <li>UCP protocol versions independently from capabilities.</li> <li>Each capability versions independently from other capabilities.</li> <li>Capabilities MUST follow the same backwards compatibility rules as the     protocol.</li> <li>Businesses MUST validate capability version compatibility using the same     logic as what's described above.</li> <li>Transports MAY define their own version handling mechanisms.</li> </ul>"},{"location":"specification/overview/#ucp-capabilities-devucp","title":"UCP Capabilities (<code>dev.ucp.*</code>)","text":"<p>UCP-authored capabilities version with protocol releases by default. Individual capabilities MAY version independently when breaking changes are required outside the protocol release cycle.</p>"},{"location":"specification/overview/#vendor-capabilities-comvendor","title":"Vendor Capabilities (<code>com.{vendor}.*</code>)","text":"<p>Capabilities outside the <code>dev.ucp.*</code> namespace version fully independently. Vendors control their own release schedules and versioning strategy.</p>"},{"location":"specification/overview/#glossary","title":"Glossary","text":"Term Acronym Definition Agent Payments Protocol AP2 An open protocol designed to enable AI agents to securely interoperate and complete payments autonomously. UCP leverages AP2 for secure payment mandates. Agent2Agent Protocol A2A An open standard for secure, collaborative communication between diverse AI agents. UCP can use A2A as a transport layer. Capability - A standalone core feature that a business supports (e.g., Checkout, Identity Linking). Capabilities are the fundamental \"verbs\" of UCP. Credential Provider CP A trusted entity (like a digital wallet) responsible for securely managing and executing the user's payment and identity credentials. Extension - An optional capability that augments another capability via the <code>extends</code> field. Extensions appear in <code>ucp.capabilities[]</code> alongside core capabilities. Profile - A JSON document hosted by businesses and platforms at a well-known URI, declaring their identity, supported capabilities, and endpoints. Business - The entity selling goods or services. In UCP, they act as the Merchant of Record (MoR), retaining financial liability and ownership of the order. Model Context Protocol MCP A protocol standardizing how AI models connect to external data and tools. UCP capabilities map 1:1 to MCP tools. Universal Commerce Protocol UCP The standard defined in this document, enabling interoperability between commerce entities via standardized capabilities and discovery. Payment Service Provider PSP The financial infrastructure provider that processes payments, authorizations, and settlements on behalf of the business. Platform - The consumer-facing surface (AI agent, app, website) acting on behalf of the user to discover businesses and facilitate commerce. Verifiable Digital Credential VDC An Issuer-signed credential (set of claims) whose authenticity can be verified cryptographically. Used in UCP for secure payment authorizations."},{"location":"specification/payment-handler-guide/","title":"Guide","text":""},{"location":"specification/payment-handler-guide/#payment-handler-specification-guide","title":"Payment Handler Specification Guide","text":""},{"location":"specification/payment-handler-guide/#introduction","title":"Introduction","text":"<p>This guide defines the standard structure and vocabulary for specifying UCP payment handlers. All payment handler specifications SHOULD follow this structure to ensure consistency, completeness, and clarity for implementers.</p>"},{"location":"specification/payment-handler-guide/#purpose","title":"Purpose","text":"<p>Payment handlers enable \"N-to-N\" interoperability between platforms, businesses, and payment providers. A well-specified handler must answer these questions for each participant:</p> <ul> <li>Who participates? What participants are involved and what are their roles?</li> <li>What are the prerequisites? What onboarding or setup is required?</li> <li>How is it configured? What configuration is advertised or consumed?</li> <li>How is it executed? What protocol is followed to acquire or process instruments?</li> </ul> <p>This guide provides a framework that ensures every handler specification answers these questions systematically.</p>"},{"location":"specification/payment-handler-guide/#scope","title":"Scope","text":"<p>This guide applies to:</p> <ul> <li>Handlers (e.g., <code>com.google.pay</code>, <code>dev.shopify.shop_pay</code>) \u2014 Specific   payment method implementations</li> </ul>"},{"location":"specification/payment-handler-guide/#core-concepts","title":"Core Concepts","text":"<p>Every payment handler specification MUST define the core elements below.</p> <p>Note on Protocol Signatures:: The function signatures provided in this section (e.g., <code>PROCESSING(...)</code>) represent logical data flows, not literal function calls. Spec authors must map these logical flows to the actual transport protocol used by their implementation.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Payment Handler Framework                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                           \u2502\n\u2502   \u2502 PARTICIPANTS \u2502  Who participates in this handler?                        \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                           \u2502\n\u2502          \u2502                                                                   \u2502\n\u2502          \u25bc                                                                   \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                           \u2502\n\u2502   \u2502PREREQUISITES \u2502  How does each participant obtain identity &amp; configs?     \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                           \u2502\n\u2502          \u2502                                                                   \u2502\n\u2502          \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502          \u25bc                    \u25bc                      \u25bc                       \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502   \u2502   HANDLER    \u2502    \u2502  INSTRUMENT  \u2502      \u2502  PROCESSING  \u2502                 \u2502\n\u2502   \u2502 DECLARATION  \u2502    \u2502  ACQUISITION \u2502      \u2502              \u2502                 \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n\u2502   Business advertises  platform acquires     Participant                     \u2502\n\u2502   handler config       checkout instrument   processes instrument            \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"specification/payment-handler-guide/#participants","title":"Participants","text":"<p>Definition: The distinct actors that participate in the payment handler's lifecycle. Every handler has at minimum two participants (business and platform), but MAY define additional participants with specific roles.</p> <p>Note on Terminology:: While this guide refers to the participant as the \"Business\", technical schema fields may retain the standard industry nomenclature <code>merchant_*</code> (e.g., <code>merchant_id</code>, <code>merchant_name</code>). Specifications MUST explicitly document these field mappings.</p> <p>Standard Participants:</p> Participant Role Business Advertises handler configuration, processes payment instruments Platform Discovers handlers, acquires payment instruments, submits checkout <p>Extended Participants (example handler-specific participants):</p> Participant Example Role Tokenizer Stores raw credentials and issues token credentials PSP Processes payments on behalf of business using the checkout instrument"},{"location":"specification/payment-handler-guide/#prerequisites","title":"Prerequisites","text":"<p>Definition: The onboarding, setup, or configuration a participant must complete before participating in the handler's flows.</p> <p>Signature:</p> <pre><code>PREREQUISITES(participant, onboarding_input) \u2192 prerequisites_output\n</code></pre> Field Description <code>participant</code> The participant being onboarded (business, platform, etc.) <code>onboarding_input</code> What the participant provides during setup <code>prerequisites_output</code> The identity and any additional configuration received <p>Prerequisites Output:</p> <p>The <code>prerequisites_output</code> contains what a participant receives from onboarding. At minimum, this includes an identity (see Payment Identity). It MAY also include additional configuration, credentials, or settings specific to the handler.</p> <p>Payment handler specifications are not required to define a formal schema for <code>prerequisites_output</code>. Instead, the specification SHOULD clearly document:</p> <ul> <li>What identity is assigned (and how it maps to <code>PaymentIdentity</code>)</li> <li>What additional configuration is provided</li> <li>How the prerequisites output is used in Handler Declaration, Instrument Acquisition, or Processing</li> </ul> <p>Notes:</p> <ul> <li>Prerequisites typically occur out-of-band (portals, contracts, API calls)</li> <li>Multiple participants MAY have independent prerequisites</li> <li>The identity from prerequisites typically appears within the handler's   <code>config</code> object (e.g., as <code>merchant_id</code> or similar handler-specific field)</li> <li>Participants receiving raw credentials (e.g., businesses, PSPs) typically must complete security acknowledgements during onboarding, accepting responsibility for credential handling and compliance</li> </ul>"},{"location":"specification/payment-handler-guide/#handler-declaration","title":"Handler Declaration","text":"<p>Definition: The configuration a business advertises to indicate support for this handler and enable platforms to invoke it.</p> <p>Signature:</p> <pre><code>HANDLER_DECLARATION(prerequisites_output) \u2192 handler_declaration\n</code></pre> Field Description <code>prerequisites_output</code> The identity and configuration from business prerequisites <code>handler_declaration</code> The handler object advertised in <code>ucp.payment_handlers</code> <p>Output Structure:</p> <p>The handler declaration conforms to the <code>PaymentHandler</code> schema. The specification SHOULD define the available config and instrument schemas, and how to construct each based on the business's prerequisites output and desired configuration.</p> <pre><code>{\n  \"ucp\": {\n    \"payment_handlers\": {\n      \"com.example.handler\": [\n        {\n          \"id\": \"processor_tokenizer_1234\",\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://example.com/ucp/handler\",\n          \"schema\": \"https://example.com/ucp/handler/schema.json\",\n          \"config\": {\n            // Handler-specific configuration (see 2.3.1)\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/payment-handler-guide/#handler-declaration-variants","title":"Handler Declaration Variants","text":"<p>The <code>PaymentHandler</code> schema defines three variants for different contexts. While only <code>id</code> and <code>version</code> are technically required, each variant serves a distinct purpose and typically includes different configuration:</p> Variant Context Purpose business_schema Business discovery (<code>/.well-known/ucp</code>) Declares the business identity and how they're configured for this handler. Contains merchant-specific settings. platform_schema Platform profile (advertised URI) Declares the platform identity and how it supports this handler. Includes <code>spec</code> and <code>schema</code> URLs for implementers. response_schema Checkout/Order API responses Runtime configuration with merged context: merchant identity, available payment methods, tokenization specs, and other state needed to process the transaction. Often the richest of the three. <p>Business Schema Example (business declares handler configuration):</p> <pre><code>{\n  \"id\": \"processor_tokenizer_1234\",\n  \"version\": \"2026-01-11\",\n  \"spec\": \"https://example.com/ucp/handler\",\n  \"schema\": \"https://example.com/ucp/handler/schema.json\",\n  \"config\": {\n    \"environment\": \"production\",\n    \"business_id\": \"business_xyz_789\"\n  }\n}\n</code></pre> <p>Platform Schema Example (platform declares handler support):</p> <pre><code>{\n  \"id\": \"platform_tokenizer_2345\", // note: ids are for disambiguation, they may differ between business and platform\n  \"version\": \"2026-01-11\",\n  \"spec\": \"https://example.com/ucp/handler\",\n  \"schema\": \"https://example.com/ucp/handler/schema.json\",\n  \"config\": {\n    \"environment\": \"production\",\n    \"platform_id\": \"platform_abc_123\"\n  }\n}\n</code></pre> <p>Response Schema Example (runtime context for checkout):</p> <pre><code>{\n  \"id\": \"processor_tokenizer_1234\",\n  \"version\": \"2026-01-11\",\n  \"config\": {\n    \"api_version\": 2,\n    \"environment\": \"production\",\n    \"business_id\": \"business_xyz_789\",\n    \"available_instruments\": [\n      {\n        \"type\": \"token_alt\",\n        \"tokenization_specification\": {\n          \"type\": \"merchant_gateway\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"specification/payment-handler-guide/#defining-the-schema","title":"Defining the Schema","text":"<p>The <code>schema</code> field points to a JSON schema that defines handler-specific shapes. Authors typically define each shape in its own file and reference them:</p> <ul> <li>Config \u2014 Configuration for platform/business declarations and runtime responses</li> <li>Instrument \u2014 The payment instrument structure returned to platforms</li> <li>Credential \u2014 The credential structure within instruments</li> </ul> <p>Example Handler Schema:</p> <pre><code>{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"$id\": \"https://example.com/ucp/handlers/tokenizer/schema.json\",\n  \"title\": \"Tokenizer Handler Schema\",\n  \"description\": \"Schema for the com.example.tokenizer payment handler.\",\n  \"name\": \"com.example.tokenizer\",\n  \"version\": \"2026-01-11\",\n\n  \"$defs\": {\n    \"tokenizer_token\": { \"$ref\": \"types/tokenizer_token.json\" },\n    \"tokenizer_alt_token\": { \"$ref\": \"types/tokenizer_alt_token.json\" },\n\n    \"tokenizer_instrument\": { \"$ref\": \"types/tokenizer_instrument.json\" },\n    \"tokenizer_alt_instrument\": { \"$ref\": \"types/tokenizer_alt_instrument.json\" },\n\n    \"com.example.tokenizer\": {\n      \"payment_instrument\": {\n        \"title\": \"Tokenizer Payment Instrument\",\n        \"description\": \"Any instrument type supported by this handler.\",\n        \"oneOf\": [\n          { \"$ref\": \"#/$defs/tokenizer_instrument\" },\n          { \"$ref\": \"#/$defs/tokenizer_alt_instrument\" }\n        ]\n      },\n      \"platform_schema\": {\n        \"title\": \"Tokenizer (Platform)\",\n        \"description\": \"Platform-level handler configuration for discovery.\",\n        \"allOf\": [\n          { \"$ref\": \"https://ucp.dev/schemas/payment_handler.json#/$defs/platform_schema\" },\n          {\n            \"properties\": {\n              \"config\": {\n                \"$ref\": \"types/platform_config.json\",\n                \"description\": \"Platform configuration for this handler.\"\n              }\n            }\n          }\n        ]\n      },\n      \"business_schema\": {\n        \"title\": \"Tokenizer (Business)\",\n        \"description\": \"Business-level handler configuration for discovery.\",\n        \"allOf\": [\n          { \"$ref\": \"https://ucp.dev/schemas/payment_handler.json#/$defs/business_schema\" },\n          {\n            \"properties\": {\n              \"config\": {\n                \"$ref\": \"types/business_config.json\",\n                \"description\": \"Business configuration for this handler.\"\n              }\n            }\n          }\n        ]\n      },\n      \"response_schema\": {\n        \"title\": \"Tokenizer (Response)\",\n        \"description\": \"Runtime handler configuration in checkout responses.\",\n        \"allOf\": [\n          { \"$ref\": \"https://ucp.dev/schemas/payment_handler.json#/$defs/response_schema\" },\n          {\n            \"properties\": {\n              \"config\": {\n                \"$ref\": \"types/response_config.json\",\n                \"description\": \"Runtime configuration for this handler.\"\n              }\n            }\n          }\n        ]\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"specification/payment-handler-guide/#config-shapes","title":"Config Shapes","text":"<p>Each variant has its own config schema tailored to its context:</p> Variant Config File Purpose business_schema <code>types/business_config.json</code> Business identity and merchant-specific settings platform_schema <code>types/platform_config.json</code> Platform identity and platform-level settings response_schema <code>types/response_config.json</code> Full runtime state: identities, available methods, tokenization specs <p>Example <code>types/business_config.json</code>:</p> <pre><code>{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"$id\": \"https://example.com/ucp/handlers/tokenizer/types/business_config.json\",\n  \"title\": \"Tokenizer Business Config\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"environment\": {\n      \"type\": \"string\",\n      \"enum\": [\"sandbox\", \"production\"],\n      \"default\": \"production\"\n    },\n    \"business_id\": {\n      \"type\": \"string\",\n      \"description\": \"Business identifier for this handler.\"\n    }\n  }\n}\n</code></pre> <p>Example <code>types/platform_config.json</code>:</p> <pre><code>{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"$id\": \"https://example.com/ucp/handlers/tokenizer/types/platform_config.json\",\n  \"title\": \"Tokenizer Platform Config\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"environment\": {\n      \"type\": \"string\",\n      \"enum\": [\"sandbox\", \"production\"],\n      \"default\": \"production\"\n    },\n    \"platform_id\": {\n      \"type\": \"string\",\n      \"description\": \"Platform identifier for this handler.\"\n    }\n  }\n}\n</code></pre> <p>Example <code>types/response_config.json</code>:</p> <pre><code>{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"$id\": \"https://example.com/ucp/handlers/tokenizer/types/response_config.json\",\n  \"title\": \"Tokenizer Response Config\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"api_version\": { \"type\": \"integer\" },\n    \"environment\": {\n      \"type\": \"string\",\n      \"enum\": [\"sandbox\", \"production\"]\n    },\n    \"business_id\": {\n      \"type\": \"string\",\n      \"description\": \"Business identifier for this handler.\"\n    },\n    \"available_instruments\": {\n      \"type\": \"array\",\n      \"description\": \"Available instrument types for this checkout.\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"type\": { \"type\": \"string\" },\n          \"tokenization_specification\": { \"type\": \"object\" }\n        }\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"specification/payment-handler-guide/#instrument-shapes","title":"Instrument Shapes","text":"<p>Base Instrument Schemas:</p> Schema Description <code>payment_instrument.json</code> Base: id, handler_id, type, billing_address, credential, display <code>card_payment_instrument.json</code> Extends base with display: brand, last_digits, expiry, card art <p>UCP provides base schemas for universal payment instruments like <code>card</code>. Spec authors MAY extend any of the base instruments to add handler-specific display data or customize the credential reference. Handlers MAY define multiple instrument types for different payment flows.</p> <p>Example <code>types/tokenizer_instrument.json</code> (card-based):</p> <pre><code>{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"$id\": \"https://example.com/ucp/handlers/tokenizer/types/tokenizer_instrument.json\",\n  \"title\": \"Tokenizer Card Instrument\",\n  \"description\": \"Card-based payment instrument for com.example.tokenizer.\",\n  \"allOf\": [\n    { \"$ref\": \"https://ucp.dev/schemas/shopping/types/card_payment_instrument.json\" }\n  ],\n  \"type\": \"object\",\n  \"required\": [\"type\"],\n  \"properties\": {\n    \"type\": { \"const\": \"tokenizer_card\" },\n    \"credential\": {\n      \"oneOf\": [\n        { \"$ref\": \"tokenizer_token.json\" },\n        { \"$ref\": \"tokenizer_alt_token.json\" }\n      ]\n    },\n    \"special_tokenizer_context\": {\n      \"type\": \"object\",\n      \"description\": \"Handler-specific context for tokenizer instruments.\"\n    }\n  }\n}\n</code></pre> <p>Example <code>types/tokenizer_alt_instrument.json</code>:</p> <pre><code>{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"$id\": \"https://example.com/ucp/handlers/tokenizer/types/tokenizer_alt_instrument.json\",\n  \"title\": \"Tokenizer Alt Instrument\",\n  \"description\": \"Alternative payment instrument for com.example.tokenizer.\",\n  \"allOf\": [\n    { \"$ref\": \"https://ucp.dev/schemas/shopping/types/payment_instrument.json\" }\n  ],\n  \"type\": \"object\",\n  \"required\": [\"type\"],\n  \"properties\": {\n    \"type\": { \"const\": \"tokenizer_alt\" },\n    \"credential\": {\n      \"oneOf\": [\n        { \"$ref\": \"tokenizer_token.json\" },\n        { \"$ref\": \"tokenizer_alt_token.json\" }\n      ]\n    },\n    \"special_tokenizer_context\": {\n      \"type\": \"object\",\n      \"description\": \"Handler-specific context for tokenizer instruments.\"\n    }\n  }\n}\n</code></pre>"},{"location":"specification/payment-handler-guide/#credential-shapes","title":"Credential Shapes","text":"<p>Base Credential Schemas:</p> Schema Description <code>payment_credential.json</code> Base: type discriminator only <code>token_credential.json</code> Token: type + token string <p>UCP provides base schemas for universal payment credentials. Authors MAY extend these schemas to include handler-specific credential context. Handlers MAY define multiple credential types for different instrument flows.</p> <p>The specification MUST define which credential types are accepted by the handler.</p> <p>Important: If using token credentials, the schema MUST include an expiration field (<code>expiry</code>, <code>ttl</code>, or similar) to ensure platforms know when to refresh credentials.</p> <p>Example <code>types/tokenizer_token.json</code> (expiring token):</p> <pre><code>{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"$id\": \"https://example.com/ucp/handlers/tokenizer/types/tokenizer_token.json\",\n  \"title\": \"Tokenizer Card Token\",\n  \"description\": \"Card token credential for com.example.tokenizer.\",\n  \"allOf\": [\n    { \"$ref\": \"https://ucp.dev/schemas/shopping/types/token_credential.json\" }\n  ],\n  \"type\": \"object\",\n  \"required\": [\"type\", \"token\", \"expiry\"],\n  \"properties\": {\n    \"type\": {\n      \"const\": \"tokenizer_card_token\",\n      \"description\": \"Credential type discriminator.\"\n    },\n    \"expiry\": {\n      \"type\": \"string\",\n      \"format\": \"date-time\",\n      \"description\": \"Token expiration. Platforms must refresh before this time.\"\n    }\n  }\n}\n</code></pre> <p>Example <code>types/tokenizer_alt_token.json</code> (alt token):</p> <pre><code>{\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"$id\": \"https://example.com/ucp/handlers/tokenizer/types/tokenizer_alt_token.json\",\n  \"title\": \"Tokenizer Alt Token\",\n  \"description\": \"Alt token credential for com.example.tokenizer, adding routing hints\",\n  \"allOf\": [\n    { \"$ref\": \"https://ucp.dev/schemas/shopping/types/token_credential.json\" }\n  ],\n  \"type\": \"object\",\n  \"required\": [\"type\", \"token\", \"expiry\"],\n  \"properties\": {\n    \"type\": {\n      \"const\": \"tokenizer_alt_token\",\n      \"description\": \"Credential type discriminator.\"\n    },\n    \"expiry\": {\n      \"type\": \"string\",\n      \"format\": \"date-time\",\n      \"description\": \"Token expiration. Platforms must refresh before this time.\"\n    },\n    \"routing_hint\": {\n      \"type\": \"string\",\n      \"description\": \"Optional routing number hint.\"\n    }\n  }\n}\n</code></pre>"},{"location":"specification/payment-handler-guide/#instrument-acquisition","title":"Instrument Acquisition","text":"<p>Definition: The protocol a platform follows to acquire a payment instrument that can be submitted to the business's checkout.</p> <p>Signature:</p> <pre><code>INSTRUMENT_ACQUISITION(\n  platform_prerequisites_output,\n  handler_declaration,\n  binding,\n  buyer_input\n) \u2192 checkout_instrument\n</code></pre> Field Description <code>platform_prerequisites_output</code> platform's prerequisites output (config), if prerequisites were required <code>handler_declaration.config</code> Handler-specific configuration from the business <code>binding</code> (See 2.6) Context for binding the credential to a specific checkout <code>buyer_input</code> Buyer's payment selection or credentials <code>checkout_instrument</code> The payment instrument to submit at checkout <p>Payment handler specifications do NOT need to define a formal process for instrument acquisition. Instead, the specification SHOULD clearly document:</p> <ul> <li>How to apply the handler's <code>config</code> to construct a valid <code>checkout_instrument</code>.</li> <li>How to create an effective credential binding to the specific checkout and   business for usage, which is critical for security, based on the available   <code>config</code> and <code>checkout</code>.</li> </ul>"},{"location":"specification/payment-handler-guide/#processing","title":"Processing","text":"<p>Definition: The steps a participant (typically business or PSP) takes to process a received payment instrument and complete the transaction.</p> <p>Signature:</p> <pre><code>PROCESSING(\n  identity,\n  checkout_instrument,\n  binding,\n  transaction_context\n) \u2192 processing_result\n</code></pre> Field Description <code>identity</code> The processing participant's <code>PaymentIdentity</code> <code>checkout_instrument</code> The instrument received from the platform <code>binding</code> The binding context for verification <code>transaction_context</code> Checkout totals, line items, etc. <code>processing_result</code> Success/failure with payment details"},{"location":"specification/payment-handler-guide/#error-handling","title":"Error Handling","text":"<p>The specification MUST define a mapping for common failures (e.g., 'Declined', 'Insufficient Funds', 'Network Error') to standard UCP Error definitions. This ensures the platform can render localized, consistent error messages to the buyer regardless of the underlying processor.</p>"},{"location":"specification/payment-handler-guide/#key-definitions","title":"Key Definitions","text":"Term Definition Binding A cryptographic or logical association of a payment instrument to a specific checkout transaction and business identity. This prevents replay attacks where a valid credential intended for Business A is intercepted and used at Business B."},{"location":"specification/payment-handler-guide/#specification-template","title":"Specification Template","text":"<p>Handler specifications SHOULD use the standard template structure. Sections marked [REQUIRED] MUST be present; sections marked [CONDITIONAL] are required only when applicable.</p> <p>\u2192 Payment Handler Template</p>"},{"location":"specification/payment-handler-guide/#conformance-checklist-for-spec-authors","title":"Conformance Checklist for Spec Authors","text":"<p>Before publishing a payment handler specification, verify:</p>"},{"location":"specification/payment-handler-guide/#structure","title":"Structure","text":"<ul> <li> Uses the standard template structure</li> <li> All [REQUIRED] sections are present</li> <li> [CONDITIONAL] sections are present when applicable</li> </ul>"},{"location":"specification/payment-handler-guide/#participants_1","title":"Participants","text":"<ul> <li> All participants are listed</li> <li> Each participant's role is clearly described</li> <li> Note on \"Business\" vs \"Merchant\" terminology added if applicable</li> </ul>"},{"location":"specification/payment-handler-guide/#prerequisites_1","title":"Prerequisites","text":"<ul> <li> Prerequisites process is documented for each participant that requires it</li> <li> Onboarding inputs are specified</li> <li> Prerequisites output is described (identity + any additional config)</li> <li> Identity maps to <code>PaymentIdentity</code> structure (<code>access_token</code>)</li> </ul>"},{"location":"specification/payment-handler-guide/#handler-declaration_1","title":"Handler Declaration","text":"<ul> <li> Identity schema is documented (base or extended)</li> <li> Configuration schema is documented (if applicable) and includes environment</li> <li> Instrument schema is documented (base or extended)</li> </ul>"},{"location":"specification/payment-handler-guide/#instrument-acquisition_1","title":"Instrument Acquisition","text":"<ul> <li> Protocol steps are enumerated and clear</li> <li> Logical flow is mapped to actual protocol</li> <li> API calls or SDK usage is shown with examples</li> <li> Binding requirements are specified</li> <li> Checkout Payment Instrument creation and shape is well-defined</li> </ul>"},{"location":"specification/payment-handler-guide/#processing_1","title":"Processing","text":"<ul> <li> Processing steps are enumerated and clear</li> <li> Verification requirements are specified</li> <li> Error handling and mapping is addressed</li> </ul>"},{"location":"specification/payment-handler-guide/#security","title":"Security","text":"<ul> <li> Security requirements are listed</li> <li> Binding verification is required</li> <li> Credential handling guidance is provided</li> <li> Token expiry is defined (if applicable)</li> </ul>"},{"location":"specification/payment-handler-guide/#general","title":"General","text":"<ul> <li> Handler name follows reverse-DNS convention</li> <li> Version follows YYYY-MM-DD format</li> <li> All schema URLs match namespace authority</li> <li> References section includes all schemas</li> </ul>"},{"location":"specification/payment-handler-guide/#best-practices","title":"Best Practices","text":"<p>Follow these guidelines to create high-quality, maintainable handler specifications:</p>"},{"location":"specification/payment-handler-guide/#schema-design","title":"Schema Design","text":"Practice Description Extend, don't reinvent Use <code>allOf</code> to compose base schemas. Don't redefine <code>brand</code>, <code>last_digits</code>, etc. Use const for discriminators Define <code>credential.type</code> as a <code>const</code> to identify credential types unambiguously. Validate early Publish schemas at stable URLs before finalizing the spec so implementers can validate. Include Expiry When designing token credentials, always include <code>expiry</code> or <code>ttl</code>."},{"location":"specification/payment-handler-guide/#documentation","title":"Documentation","text":"Practice Description Show, don't just tell Include complete JSON examples for every schema and protocol step. Document error cases Specify what errors can occur and how participants should handle them. Version independently The handler version evolves independently of UCP core versions."},{"location":"specification/payment-handler-guide/#security_1","title":"Security","text":"Practice Description Require binding Always tie credentials to a specific checkout via <code>binding</code>. Minimize credential exposure Design flows so raw credentials (PANs, etc.) touch as few systems as possible. Specify token lifetimes Document whether tokens are single-use, time-limited, or session-scoped."},{"location":"specification/payment-handler-guide/#maintainability","title":"Maintainability","text":"Practice Description Host schemas at stable URLs Schema URLs should not change; use versioned paths if needed. Fail gracefully Define clear error responses for common failure scenarios. Link to examples Reference existing handler specs and the Tokenization Guide for common flows."},{"location":"specification/payment-handler-guide/#see-also","title":"See Also","text":"<ul> <li>Tokenization Guide \u2014 Guide for building   tokenization payment handlers</li> <li>Google Pay Handler   \u2014 Handler for Google Pay integration</li> <li>Shop Pay Handler   \u2014 Handler for Shop Pay integration</li> </ul>"},{"location":"specification/payment-handler-template/","title":"Template","text":""},{"location":"specification/payment-handler-template/#handler-name-payment-handler","title":"{Handler Name} Payment Handler","text":"<ul> <li>Handler Name: <code>{reverse-dns.name}</code></li> <li>Version: <code>{YYYY-MM-DD}</code></li> </ul>"},{"location":"specification/payment-handler-template/#introduction","title":"Introduction","text":"<p>{Brief description of what this handler enables and the payment flow it supports.}</p>"},{"location":"specification/payment-handler-template/#key-benefits","title":"Key Benefits","text":"<ul> <li>{Benefit 1}</li> <li>{Benefit 2}</li> <li>{Benefit 3}</li> </ul>"},{"location":"specification/payment-handler-template/#integration-guide","title":"Integration Guide","text":"Participant Integration Section Business Business Integration Platform Platform Integration"},{"location":"specification/payment-handler-template/#participants","title":"Participants","text":"<p>{Describe all participants in this handler and their roles.}</p> <p>Note on Terminology: While this specification refers to the participant as the \"business,\" technical schema fields may retain the standard industry nomenclature <code>merchant_*</code> (e.g., <code>merchant_id</code>). Mappings are documented below.</p> Participant Role Prerequisites Business {role description} {Yes/No \u2014 brief description} Platform {role description} {Yes/No \u2014 brief description} {Other Participant} {role description} {Yes/No \u2014 brief description} <p>{Optional: ASCII diagram showing participant relationships}</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502Platform \u2502     \u2502   {Provider}  \u2502     \u2502  Business  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                  \u2502                    \u2502\n     \u2502  {step 1}        \u2502                    \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502                    \u2502\n     \u2502                  \u2502                    \u2502\n     \u2502  {step 2}        \u2502                    \u2502\n     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                    \u2502\n     \u2502                  \u2502                    \u2502\n     \u2502  {step 3}                             \u2502\n     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n</code></pre>"},{"location":"specification/payment-handler-template/#business-integration","title":"Business Integration","text":""},{"location":"specification/payment-handler-template/#prerequisites","title":"Prerequisites","text":"<p>Before advertising this handler, businesses MUST complete:</p> <ol> <li>{Prerequisite 1, e.g., \"Register with {provider} to obtain a business identifier\"}</li> <li>{Prerequisite 2}</li> </ol> <p>Prerequisites Output:</p> Field Description <code>identity.access_token</code> {what identifier is assigned, e.g., business_id} {additional config} {any additional configuration from onboarding}"},{"location":"specification/payment-handler-template/#handler-configuration","title":"Handler Configuration","text":"<p>Businesses advertise support for this handler in their UCP profile's <code>payment_handlers</code> registry.</p>"},{"location":"specification/payment-handler-template/#handler-schema","title":"Handler Schema","text":"<p>Schema URL: <code>{schema_url}</code></p> <p>The handler schema defines three config variants for different contexts. See Payment Handler Guide: Defining the Schema for the full pattern.</p> Config Variant Context Purpose <code>business_config</code> Business discovery {describe business-specific fields} <code>platform_config</code> Platform discovery {describe platform-specific fields} <code>response_config</code> Checkout responses {describe runtime fields}"},{"location":"specification/payment-handler-template/#business-config-fields","title":"Business Config Fields","text":"Field Type Required Description {field} {type} {Yes/No} {description}"},{"location":"specification/payment-handler-template/#response-config-fields","title":"Response Config Fields","text":"Field Type Required Description {field} {type} {Yes/No} {description \u2014 include runtime fields like available instruments}"},{"location":"specification/payment-handler-template/#example-handler-declaration","title":"Example Handler Declaration","text":"<pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"payment_handlers\": {\n      \"{handler_name}\": [\n        {\n          \"id\": \"{handler_id}\",\n          \"version\": \"{version}\",\n          \"spec\": \"{spec_url}\",\n          \"schema\": \"{schema_url}\",\n          \"config\": {\n            // Handler-specific configuration\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/payment-handler-template/#processing-payments","title":"Processing Payments","text":"<p>Upon receiving a payment with this handler's instrument, businesses MUST:</p> <ol> <li>Validate Handler: Confirm <code>instrument.handler_id</code> matches an advertised handler.</li> <li>Ensure Idempotency: If the request is a retry (matches a previous   <code>checkout_id</code> or idempotency key), return the previous result immediately   without re-processing funds.</li> <li>{Step 3}: {description}</li> <li>{Step 4}: {description}</li> <li>Return Response: Respond with the finalized checkout state.</li> </ol> <p>{Include example request/response if the business calls an external service}</p>"},{"location":"specification/payment-handler-template/#platform-integration","title":"Platform Integration","text":""},{"location":"specification/payment-handler-template/#prerequisites_1","title":"Prerequisites","text":"<p>Before using this handler, Platforms MUST complete:</p> <ol> <li>{Prerequisite 1, e.g., \"Register with {provider} to obtain a Platform identifier\"}</li> <li>{Prerequisite 2}</li> </ol> <p>Prerequisites Output:</p> Field Description <code>identity.access_token</code> {what identifier is assigned} {additional config} {any additional configuration from onboarding}"},{"location":"specification/payment-handler-template/#handler-configuration_1","title":"Handler Configuration","text":"<p>Platforms advertise support for this handler in their UCP profile's <code>payment_handlers</code> registry using <code>platform_config</code>.</p>"},{"location":"specification/payment-handler-template/#platform-config-fields","title":"Platform Config Fields","text":"Field Type Required Description {field} {type} {Yes/No} {description}"},{"location":"specification/payment-handler-template/#example-platform-handler-declaration","title":"Example Platform Handler Declaration","text":"<pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"payment_handlers\": {\n      \"{handler_name}\": [\n        {\n          \"id\": \"{handler_id}\",\n          \"version\": \"{version}\",\n          \"spec\": \"{spec_url}\",\n          \"schema\": \"{schema_url}\",\n          \"config\": {\n            // Platform-specific configuration\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/payment-handler-template/#payment-protocol","title":"Payment Protocol","text":"<p>Platforms MUST follow this flow to acquire a payment instrument:</p>"},{"location":"specification/payment-handler-template/#step-1-discover-handler","title":"Step 1: Discover Handler","text":"<p>The Platform identifies <code>{handler_name}</code> in the business's UCP profile <code>payment_handlers</code> registry (from <code>/.well-known/ucp</code>).</p> <pre><code>{\n  \"ucp\": {\n    \"payment_handlers\": {\n      \"{handler_name}\": [\n        {\n          \"id\": \"{handler_id}\",\n          \"version\": \"{version}\",\n          \"config\": {\n            // Business's configuration\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/payment-handler-template/#step-2","title":"Step 2:","text":"<p>{Description of what the Platform does in this step.}</p> <p>{Code example if applicable:}</p> <pre><code>// Example SDK usage or API call\n</code></pre>"},{"location":"specification/payment-handler-template/#step-3","title":"Step 3:","text":"<p>{Continue for all steps...}</p>"},{"location":"specification/payment-handler-template/#step-n-complete-checkout","title":"Step N: Complete Checkout","text":"<p>The Platform submits the checkout with the constructed payment instrument.</p> <pre><code>POST /checkout-sessions/{checkout_id}/complete\nContent-Type: application/json\n\n{\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"{instrument_id}\",\n        \"handler_id\": \"{handler_id}\",\n        \"type\": \"{instrument_type}\",\n        \"credential\": {\n          \"type\": \"{credential_type}\",\n          // Credential fields\n        }\n        // Additional instrument fields\n      }\n    ]\n  },\n  \"risk_signals\": {\n    // risk signal objects here\n  }\n}\n</code></pre>"},{"location":"specification/payment-handler-template/#participant-integration","title":"{Participant} Integration","text":""},{"location":"specification/payment-handler-template/#prerequisites_2","title":"Prerequisites","text":"<p>Before participating in this handler's flow, {participants} MUST complete:</p> <ol> <li>{Prerequisite 1}</li> <li>{Prerequisite 2}</li> </ol> <p>Prerequisites Output:</p> Field Description <code>identity.access_token</code> {what identifier is assigned} {additional config} {any additional configuration from onboarding}"},{"location":"specification/payment-handler-template/#action-or-configuration","title":"{Action or Configuration}","text":"<p>{Describe what this participant needs to do.}</p> <p>{Include examples as appropriate.}</p>"},{"location":"specification/payment-handler-template/#security-considerations","title":"Security Considerations","text":"Requirement Description Binding required Credentials MUST be bound to <code>checkout_id</code> and <code>identity</code> to prevent reuse. Binding placement Binding data (e.g., <code>checkout_id</code>) SHOULD be included within the <code>credential</code> payload to ensure it is covered by the signature, rather than in transport headers. Binding verified The processing participant MUST verify binding matches before processing. Token Expiry {If using tokens: Tokens MUST expire after {duration} or single-use.} Data Residency {Specify if PII MUST be processed/stored in specific geographic regions (e.g., EU, US) to comply with local laws.} {Additional requirement} {description}"},{"location":"specification/payment-handler-template/#references","title":"References","text":"<ul> <li>Handler Spec: <code>{spec_url}</code></li> <li>Handler Schema: <code>{schema_url}</code> (defines config, instrument, and credential shapes)</li> </ul>"},{"location":"specification/reference/","title":"Reference","text":""},{"location":"specification/reference/#schema-reference","title":"Schema Reference","text":"<p>This page provides a reference for all the capability data models and types used within the UCP.</p>"},{"location":"specification/reference/#capability-schemas","title":"Capability Schemas","text":""},{"location":"specification/reference/#cart","title":"Cart","text":"Name Type Required Description ucp UCP Response Cart Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique cart identifier. line_items Array[Line Item] Yes Cart line items. Same structure as checkout. Full replacement on update. context Context No Buyer signals for localization (country, region, postal_code). Merchant uses for pricing, availability, currency. Falls back to geo-IP if omitted. buyer Buyer No Optional buyer information for personalized estimates. currency string Yes ISO 4217 currency code. Determined by merchant based on context or geo-IP. totals Array[Total] Yes Estimated cost breakdown. May be partial if shipping/tax not yet calculable. messages Array[Message] No Validation messages, warnings, or informational notices. links Array[Link] No Optional merchant links (policies, FAQs). continue_url string No URL for cart handoff and session recovery. Enables sharing and human-in-the-loop flows. expires_at string No Cart expiry timestamp (RFC 3339). Optional."},{"location":"specification/reference/#checkout","title":"Checkout","text":"Name Type Required Description ucp UCP Response Checkout Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique identifier of the checkout session. line_items Array[Line Item] Yes List of line items being checked out. buyer Buyer No Representation of the buyer. context Context No Provisional buyer signals for relevance and localization: product availability, pricing, currency, tax, shipping, payment methods, and eligibility (e.g., student or affiliation discounts). Businesses SHOULD use these values when authoritative data (e.g., address) is absent, and MAY ignore unsupported values without returning errors. Context SHOULD be non-identifying and can be disclosed progressively\u2014coarse signals early, finer resolution as the session progresses. Higher-resolution data (shipping address, billing address) supersedes context. Platforms SHOULD progressively enhance context throughout the buyer journey. status string Yes Checkout state indicating the current phase and required action. See Checkout Status lifecycle documentation for state transition details.Enum: <code>incomplete</code>, <code>requires_escalation</code>, <code>ready_for_complete</code>, <code>complete_in_progress</code>, <code>completed</code>, <code>canceled</code> currency string Yes ISO 4217 currency code reflecting the merchant's market determination. Derived from address, context, and geo IP\u2014buyers provide signals, merchants determine currency. totals Array[Total] Yes Different cart totals. messages Array[Message] No List of messages with error and info about the checkout session state. links Array[Link] Yes Links to be displayed by the platform (Privacy Policy, TOS). Mandatory for legal compliance. expires_at string No RFC 3339 expiry timestamp. Default TTL is 6 hours from creation if not sent. continue_url string No URL for checkout handoff and session recovery. MUST be provided when status is requires_escalation. See specification for format and availability requirements. payment Payment No Payment configuration containing handlers. order Order Confirmation No Details about an order created for this checkout session."},{"location":"specification/reference/#order","title":"Order","text":"Name Type Required Description ucp UCP Response Order Schema Yes Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields. id string Yes Unique order identifier. checkout_id string Yes Associated checkout ID for reconciliation. permalink_url string Yes Permalink to access the order on merchant site. line_items Array[Order Line Item] Yes Immutable line items \u2014 source of truth for what was ordered. fulfillment object Yes Fulfillment data: buyer expectations and what actually happened. adjustments Array[Adjustment] No Append-only event log of money movements (refunds, returns, credits, disputes, cancellations, etc.) that exist independently of fulfillment. totals Array[Total] Yes Different totals for the order."},{"location":"specification/reference/#payment","title":"Payment","text":"Name Type Required Description instruments Array[Selected Payment Instrument] No The payment instruments available for this payment. Each instrument is associated with a specific handler via the handler_id field. Handlers can extend the base payment_instrument schema to add handler-specific fields."},{"location":"specification/reference/#type-schemas","title":"Type Schemas","text":""},{"location":"specification/reference/#payment-account-info","title":"Payment Account Info","text":"Name Type Required Description payment_account_reference string No EMVCo PAR. A unique identifier linking a payment card to a specific account, enabling tracking across tokens (Apple Pay, physical card, etc)."},{"location":"specification/reference/#adjustment","title":"Adjustment","text":"Name Type Required Description id string Yes Adjustment event identifier. type string Yes Type of adjustment (open string). Typically money-related like: refund, return, credit, price_adjustment, dispute, cancellation. Can be any value that makes sense for the merchant's business. occurred_at string Yes RFC 3339 timestamp when this adjustment occurred. status string Yes Adjustment status.Enum: <code>pending</code>, <code>completed</code>, <code>failed</code> line_items Array[object] No Which line items and quantities are affected (optional). amount integer No Amount in minor units (cents) for refunds, credits, price adjustments (optional). description string No Human-readable reason or description (e.g., 'Defective item', 'Customer requested')."},{"location":"specification/reference/#binding","title":"Binding","text":"Name Type Required Description checkout_id string Yes The checkout session identifier this token is bound to. identity Payment Identity No The participant this token is bound to. Required when acting on behalf of another participant (e.g., agent tokenizing for merchant). Omit when the authenticated caller is the binding target."},{"location":"specification/reference/#business-fulfillment-config","title":"Business Fulfillment Config","text":"Name Type Required Description allows_multi_destination object No Permits multiple destinations per method type. allows_method_combinations Array[array] No Allowed method type combinations."},{"location":"specification/reference/#buyer","title":"Buyer","text":"Name Type Required Description first_name string No First name of the buyer. last_name string No Last name of the buyer. email string No Email of the buyer. phone_number string No E.164 standard."},{"location":"specification/reference/#card-credential","title":"Card Credential","text":"Name Type Required Description type string Yes The credential type discriminator. Specific schemas will constrain this to a constant value. type any Yes Constant = card. The credential type identifier for card credentials. card_number_type string Yes The type of card number. Network tokens are preferred with fallback to FPAN. See PCI Scope for more details.Enum: <code>fpan</code>, <code>network_token</code>, <code>dpan</code> number string No Card number. expiry_month integer No The month of the card's expiration date (1-12). expiry_year integer No The year of the card's expiration date. name string No Cardholder name. cvc string No Card CVC number. cryptogram string No Cryptogram provided with network tokens. eci_value string No Electronic Commerce Indicator / Security Level Indicator provided with network tokens."},{"location":"specification/reference/#card-payment-instrument","title":"Card Payment Instrument","text":"Name Type Required Description id string Yes A unique identifier for this instrument instance, assigned by the platform. handler_id string Yes The unique identifier for the handler instance that produced this instrument. This corresponds to the 'id' field in the Payment Handler definition. type string Yes The broad category of the instrument (e.g., 'card', 'tokenized_card'). Specific schemas will constrain this to a constant value. billing_address Postal Address No The billing address associated with this payment method. credential Payment Credential No The base definition for any payment credential. Handlers define specific credential types. display object No Display information for this payment instrument. Each payment instrument schema defines its specific display properties, as outlined by the payment handler. type string Yes Constant = card. Indicates this is a card payment instrument. display object No Display information for this card payment instrument."},{"location":"specification/reference/#context","title":"Context","text":"Name Type Required Description address_country string No The country. Recommended to be in 2-letter ISO 3166-1 alpha-2 format, for example \"US\". For backward compatibility, a 3-letter ISO 3166-1 alpha-3 country code such as \"SGP\" or a full country name such as \"Singapore\" can also be used. Optional hint for market context (currency, availability, pricing)\u2014higher-resolution data (e.g., shipping address) supersedes this value. address_region string No The region in which the locality is, and which is in the country. For example, California or another appropriate first-level Administrative division. Optional hint for progressive localization\u2014higher-resolution data (e.g., shipping address) supersedes this value. postal_code string No The postal code. For example, 94043. Optional hint for regional refinement\u2014higher-resolution data (e.g., shipping address) supersedes this value. intent string No Background context describing buyer's intent (e.g., 'looking for a gift under $50', 'need something durable for outdoor use'). Informs relevance, recommendations, and personalization."},{"location":"specification/reference/#expectation","title":"Expectation","text":"Name Type Required Description id string Yes Expectation identifier. line_items Array[object] Yes Which line items and quantities are in this expectation. method_type string Yes Delivery method type (shipping, pickup, digital).Enum: <code>shipping</code>, <code>pickup</code>, <code>digital</code> destination Postal Address Yes Delivery destination address. description string No Human-readable delivery description (e.g., 'Arrives in 5-8 business days'). fulfillable_on string No When this expectation can be fulfilled: 'now' or ISO 8601 timestamp for future date (backorder, pre-order)."},{"location":"specification/reference/#fulfillment","title":"Fulfillment","text":"Name Type Required Description methods Array[Fulfillment Method] No Fulfillment methods for cart items. available_methods Array[Fulfillment Available Method] No Inventory availability hints."},{"location":"specification/reference/#fulfillment-available-method","title":"Fulfillment Available Method","text":"Name Type Required Description type string Yes Fulfillment method type this availability applies to.Enum: <code>shipping</code>, <code>pickup</code> line_item_ids Array[string] Yes Line items available for this fulfillment method. fulfillable_on ['string', 'null'] No 'now' for immediate availability, or ISO 8601 date for future (preorders, transfers). description string No Human-readable availability info (e.g., 'Available for pickup at Downtown Store today')."},{"location":"specification/reference/#fulfillment-destination","title":"Fulfillment Destination","text":"<p>This object MUST be one of the following types: Shipping Destination, Retail Location.</p>"},{"location":"specification/reference/#fulfillment-event","title":"Fulfillment Event","text":"Name Type Required Description id string Yes Fulfillment event identifier. occurred_at string Yes RFC 3339 timestamp when this fulfillment event occurred. type string Yes Fulfillment event type. Common values include: processing (preparing to ship), shipped (handed to carrier), in_transit (in delivery network), delivered (received by buyer), failed_attempt (delivery attempt failed), canceled (fulfillment canceled), undeliverable (cannot be delivered), returned_to_sender (returned to merchant). line_items Array[object] Yes Which line items and quantities are fulfilled in this event. tracking_number string No Carrier tracking number (required if type != processing). tracking_url string No URL to track this shipment (required if type != processing). carrier string No Carrier name (e.g., 'FedEx', 'USPS'). description string No Human-readable description of the shipment status or delivery information (e.g., 'Delivered to front door', 'Out for delivery')."},{"location":"specification/reference/#fulfillment-group","title":"Fulfillment Group","text":"Name Type Required Description id string Yes Group identifier for referencing merchant-generated groups in updates. line_item_ids Array[string] Yes Line item IDs included in this group/package. options Array[Fulfillment Option] No Available fulfillment options for this group. selected_option_id ['string', 'null'] No ID of the selected fulfillment option for this group."},{"location":"specification/reference/#fulfillment-method","title":"Fulfillment Method","text":"Name Type Required Description id string Yes Unique fulfillment method identifier. type string Yes Fulfillment method type.Enum: <code>shipping</code>, <code>pickup</code> line_item_ids Array[string] Yes Line item IDs fulfilled via this method. destinations Array[Fulfillment Destination] No Available destinations. For shipping: addresses. For pickup: retail locations. selected_destination_id ['string', 'null'] No ID of the selected destination. groups Array[Fulfillment Group] No Fulfillment groups for selecting options. Agent sets selected_option_id on groups to choose shipping method."},{"location":"specification/reference/#fulfillment-option","title":"Fulfillment Option","text":"Name Type Required Description id string Yes Unique fulfillment option identifier. title string Yes Short label (e.g., 'Express Shipping', 'Curbside Pickup'). description string No Complete context for buyer decision (e.g., 'Arrives Dec 12-15 via FedEx'). carrier string No Carrier name (for shipping). earliest_fulfillment_time string No Earliest fulfillment date. latest_fulfillment_time string No Latest fulfillment date. totals Array[Total] Yes Fulfillment option totals breakdown."},{"location":"specification/reference/#item","title":"Item","text":"Name Type Required Description id string Yes The product identifier, often the SKU, required to resolve the product details associated with this line item. Should be recognized by both the Platform, and the Business. title string Yes Product title. price integer Yes Unit price in minor (cents) currency units. image_url string No Product image URI."},{"location":"specification/reference/#line-item","title":"Line Item","text":"Name Type Required Description id string Yes item Item Yes quantity integer Yes Quantity of the item being purchased. totals Array[Total] Yes Line item totals breakdown. parent_id string No Parent line item identifier for any nested structures."},{"location":"specification/reference/#link","title":"Link","text":"Name Type Required Description type string Yes Type of link. Well-known values: <code>privacy_policy</code>, <code>terms_of_service</code>, <code>refund_policy</code>, <code>shipping_policy</code>, <code>faq</code>. Consumers SHOULD handle unknown values gracefully by displaying them using the <code>title</code> field or omitting the link. url string Yes The actual URL pointing to the content to be displayed. title string No Optional display text for the link. When provided, use this instead of generating from type."},{"location":"specification/reference/#merchant-fulfillment-config","title":"Merchant Fulfillment Config","text":"Name Type Required Description allows_multi_destination object No Permits multiple destinations per method type. allows_method_combinations Array[array] No Allowed method type combinations."},{"location":"specification/reference/#message","title":"Message","text":"<p>This object MUST be one of the following types: Message Error, Message Warning, Message Info.</p>"},{"location":"specification/reference/#message-error","title":"Message Error","text":"Name Type Required Description type string Yes Constant = error. Message type discriminator. code string Yes Error code. Possible values include: missing, invalid, out_of_stock, payment_declined, requires_sign_in, requires_3ds, requires_identity_linking. Freeform codes also allowed. path string No RFC 9535 JSONPath to the component the message refers to (e.g., $.items[1]). content_type string No Content format, default = plain.Enum: <code>plain</code>, <code>markdown</code> content string Yes Human-readable message. severity string Yes Declares who resolves this error. 'recoverable': agent can fix via API. 'requires_buyer_input': merchant requires information their API doesn't support collecting programmatically (checkout incomplete). 'requires_buyer_review': buyer must authorize before order placement due to policy, regulatory, or entitlement rules (checkout complete). Errors with 'requires_' severity contribute to 'status: requires_escalation'.Enum:* <code>recoverable</code>, <code>requires_buyer_input</code>, <code>requires_buyer_review</code>"},{"location":"specification/reference/#message-info","title":"Message Info","text":"Name Type Required Description type string Yes Constant = info. Message type discriminator. path string No RFC 9535 JSONPath to the component the message refers to. code string No Info code for programmatic handling. content_type string No Content format, default = plain.Enum: <code>plain</code>, <code>markdown</code> content string Yes Human-readable message."},{"location":"specification/reference/#message-warning","title":"Message Warning","text":"Name Type Required Description type string Yes Constant = warning. Message type discriminator. path string No JSONPath (RFC 9535) to related field (e.g., $.line_items[0]). code string Yes Warning code. Machine-readable identifier for the warning type (e.g., final_sale, prop65, fulfillment_changed, age_restricted, etc.). content string Yes Human-readable warning message that MUST be displayed. content_type string No Content format, default = plain.Enum: <code>plain</code>, <code>markdown</code>"},{"location":"specification/reference/#order-confirmation","title":"Order Confirmation","text":"Name Type Required Description id string Yes Unique order identifier. permalink_url string Yes Permalink to access the order on merchant site."},{"location":"specification/reference/#order-line-item","title":"Order Line Item","text":"Name Type Required Description id string Yes Line item identifier. item Item Yes Product data (id, title, price, image_url). quantity object Yes Quantity tracking. Both total and fulfilled are derived from events. totals Array[Total] Yes Line item totals breakdown. status string Yes Derived status: fulfilled if quantity.fulfilled == quantity.total, partial if quantity.fulfilled &gt; 0, otherwise processing.Enum: <code>processing</code>, <code>partial</code>, <code>fulfilled</code> parent_id string No Parent line item identifier for any nested structures."},{"location":"specification/reference/#payment-credential","title":"Payment Credential","text":"Name Type Required Description type string Yes The credential type discriminator. Specific schemas will constrain this to a constant value."},{"location":"specification/reference/#payment-identity","title":"Payment Identity","text":"Name Type Required Description access_token string Yes Unique identifier for this participant, obtained during onboarding with the tokenizer."},{"location":"specification/reference/#payment-instrument","title":"Payment Instrument","text":"Name Type Required Description id string Yes A unique identifier for this instrument instance, assigned by the platform. handler_id string Yes The unique identifier for the handler instance that produced this instrument. This corresponds to the 'id' field in the Payment Handler definition. type string Yes The broad category of the instrument (e.g., 'card', 'tokenized_card'). Specific schemas will constrain this to a constant value. billing_address Postal Address No The billing address associated with this payment method. credential Payment Credential No The base definition for any payment credential. Handlers define specific credential types. display object No Display information for this payment instrument. Each payment instrument schema defines its specific display properties, as outlined by the payment handler."},{"location":"specification/reference/#platform-fulfillment-config","title":"Platform Fulfillment Config","text":"Name Type Required Description supports_multi_group boolean No Enables multiple groups per method."},{"location":"specification/reference/#postal-address","title":"Postal Address","text":"Name Type Required Description extended_address string No An address extension such as an apartment number, C/O or alternative name. street_address string No The street address. address_locality string No The locality in which the street address is, and which is in the region. For example, Mountain View. address_region string No The region in which the locality is, and which is in the country. Required for applicable countries (i.e. state in US, province in CA). For example, California or another appropriate first-level Administrative division. address_country string No The country. Recommended to be in 2-letter ISO 3166-1 alpha-2 format, for example \"US\". For backward compatibility, a 3-letter ISO 3166-1 alpha-3 country code such as \"SGP\" or a full country name such as \"Singapore\" can also be used. postal_code string No The postal code. For example, 94043. first_name string No Optional. First name of the contact associated with the address. last_name string No Optional. Last name of the contact associated with the address. phone_number string No Optional. Phone number of the contact associated with the address."},{"location":"specification/reference/#retail-location","title":"Retail Location","text":"Name Type Required Description id string Yes Unique location identifier. name string Yes Location name (e.g., store name). address Postal Address No Physical address of the location."},{"location":"specification/reference/#shipping-destination","title":"Shipping Destination","text":"Name Type Required Description extended_address string No An address extension such as an apartment number, C/O or alternative name. street_address string No The street address. address_locality string No The locality in which the street address is, and which is in the region. For example, Mountain View. address_region string No The region in which the locality is, and which is in the country. Required for applicable countries (i.e. state in US, province in CA). For example, California or another appropriate first-level Administrative division. address_country string No The country. Recommended to be in 2-letter ISO 3166-1 alpha-2 format, for example \"US\". For backward compatibility, a 3-letter ISO 3166-1 alpha-3 country code such as \"SGP\" or a full country name such as \"Singapore\" can also be used. postal_code string No The postal code. For example, 94043. first_name string No Optional. First name of the contact associated with the address. last_name string No Optional. Last name of the contact associated with the address. phone_number string No Optional. Phone number of the contact associated with the address. id string Yes ID specific to this shipping destination."},{"location":"specification/reference/#token-credential","title":"Token Credential","text":"Name Type Required Description type string Yes The credential type discriminator. Specific schemas will constrain this to a constant value. type string Yes The specific type of token produced by the handler (e.g., 'stripe_token'). token string Yes The token value."},{"location":"specification/reference/#total","title":"Total","text":"Name Type Required Description type string Yes Type of total categorization.Enum: <code>items_discount</code>, <code>subtotal</code>, <code>discount</code>, <code>fulfillment</code>, <code>tax</code>, <code>fee</code>, <code>total</code> display_text string No Text to display against the amount. Should reflect appropriate method (e.g., 'Shipping', 'Delivery'). amount integer Yes If type == total, sums subtotal - discount + fulfillment + tax + fee. Should be &gt;= 0. Amount in minor (cents) currency units."},{"location":"specification/reference/#extension-schemas","title":"Extension Schemas","text":""},{"location":"specification/reference/#ap2-mandate-extension","title":"AP2 Mandate Extension","text":""},{"location":"specification/reference/#merchant-authorization","title":"Merchant Authorization","text":"<p>JWS Detached Content signature (RFC 7515 Appendix F) over the checkout response body (excluding ap2 field). Format: <code>&lt;base64url-header&gt;..&lt;base64url-signature&gt;</code>. The header MUST contain 'alg' (ES256/ES384/ES512) and 'kid' claims. The signature covers both the header and JCS-canonicalized checkout payload.</p> <p>Pattern: <code>^[A-Za-z0-9_-]+\\.\\.[A-Za-z0-9_-]+$</code></p>"},{"location":"specification/reference/#checkout-mandate","title":"Checkout Mandate","text":"<p>SD-JWT+kb credential in <code>ap2.checkout_mandate</code>. Proving user authorization for the checkout. Contains the full checkout including <code>ap2.merchant_authorization</code>.</p> <p>Pattern: <code>^[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]*\\.[A-Za-z0-9_-]+(~[A-Za-z0-9_-]+)*$</code></p>"},{"location":"specification/reference/#ap2-with-merchant-authorization","title":"Ap2 With Merchant Authorization","text":"Name Type Required Description merchant_authorization Merchant Authorization No Merchant's signature proving checkout terms are authentic."},{"location":"specification/reference/#ap2-with-checkout-mandate","title":"Ap2 With Checkout Mandate","text":"Name Type Required Description checkout_mandate Checkout Mandate No SD-JWT+kb proving user authorized this checkout."},{"location":"specification/reference/#checkout-with-ap2-mandate","title":"Checkout with AP2 Mandate","text":"Name Type Required Description ucp any Yes UCP metadata for checkout responses. id string Yes Unique identifier of the checkout session. line_items Array[object] Yes List of line items being checked out. buyer object No Representation of the buyer. status string Yes Checkout state indicating the current phase and required action. See Checkout Status lifecycle documentation for state transition details.Enum: <code>incomplete</code>, <code>requires_escalation</code>, <code>ready_for_complete</code>, <code>complete_in_progress</code>, <code>completed</code>, <code>canceled</code> currency string Yes ISO 4217 currency code reflecting the merchant's market determination. Derived from address, context, and geo IP\u2014buyers provide signals, merchants determine currency. totals Array[object] Yes Different cart totals. messages Array[object] No List of messages with error and info about the checkout session state. links Array[object] Yes Links to be displayed by the platform (Privacy Policy, TOS). Mandatory for legal compliance. expires_at string No RFC 3339 expiry timestamp. Default TTL is 6 hours from creation if not sent. continue_url string No URL for checkout handoff and session recovery. MUST be provided when status is requires_escalation. See specification for format and availability requirements. payment object No Payment configuration containing handlers. order object No Details about an order created for this checkout session. ap2 any No"},{"location":"specification/reference/#ap2-error-code","title":"AP2 Error Code","text":"<p>Error codes specific to AP2 mandate verification.</p> <p>Enum: <code>mandate_required</code>, <code>agent_missing_key</code>, <code>mandate_invalid_signature</code>, <code>mandate_expired</code>, <code>mandate_scope_mismatch</code>, <code>merchant_authorization_invalid</code>, <code>merchant_authorization_missing</code></p>"},{"location":"specification/reference/#buyer-consent-extension","title":"Buyer Consent Extension","text":""},{"location":"specification/reference/#consent","title":"Consent","text":"Name Type Required Description analytics boolean No Consent for analytics and performance tracking. preferences boolean No Consent for storing user preferences. marketing boolean No Consent for marketing communications. sale_of_data boolean No Consent for selling data to third parties (CCPA)."},{"location":"specification/reference/#buyer-with-consent","title":"Buyer with Consent","text":"Name Type Required Description first_name string No First name of the buyer. last_name string No Last name of the buyer. email string No Email of the buyer. phone_number string No E.164 standard. consent Consent No Consent tracking fields."},{"location":"specification/reference/#checkout-with-buyer-consent","title":"Checkout with Buyer Consent","text":"Name Type Required Description ucp any Yes UCP metadata for checkout responses. id string Yes Unique identifier of the checkout session. line_items Array[object] Yes List of line items being checked out. buyer object No Representation of the buyer. status string Yes Checkout state indicating the current phase and required action. See Checkout Status lifecycle documentation for state transition details.Enum: <code>incomplete</code>, <code>requires_escalation</code>, <code>ready_for_complete</code>, <code>complete_in_progress</code>, <code>completed</code>, <code>canceled</code> currency string Yes ISO 4217 currency code reflecting the merchant's market determination. Derived from address, context, and geo IP\u2014buyers provide signals, merchants determine currency. totals Array[object] Yes Different cart totals. messages Array[object] No List of messages with error and info about the checkout session state. links Array[object] Yes Links to be displayed by the platform (Privacy Policy, TOS). Mandatory for legal compliance. expires_at string No RFC 3339 expiry timestamp. Default TTL is 6 hours from creation if not sent. continue_url string No URL for checkout handoff and session recovery. MUST be provided when status is requires_escalation. See specification for format and availability requirements. payment object No Payment configuration containing handlers. order object No Details about an order created for this checkout session. buyer Buyer No Buyer with consent tracking."},{"location":"specification/reference/#discount-extension","title":"Discount Extension","text":""},{"location":"specification/reference/#allocation","title":"Allocation","text":"Name Type Required Description path string Yes JSONPath to the allocation target (e.g., '$.line_items[0]', '$.totals.shipping'). amount integer Yes Amount allocated to this target in minor (cents) currency units."},{"location":"specification/reference/#applied-discount","title":"Applied Discount","text":"Name Type Required Description code string No The discount code. Omitted for automatic discounts. title string Yes Human-readable discount name (e.g., 'Summer Sale 20% Off'). amount integer Yes Total discount amount in minor (cents) currency units. automatic boolean No True if applied automatically by merchant rules (no code required). method string No Allocation method. 'each' = applied independently per item. 'across' = split proportionally by value.Enum: <code>each</code>, <code>across</code> priority integer No Stacking order for discount calculation. Lower numbers applied first (1 = first). allocations Array[Allocation] No Breakdown of where this discount was allocated. Sum of allocation amounts equals total amount."},{"location":"specification/reference/#discounts-object","title":"Discounts Object","text":"Name Type Required Description codes Array[string] No Discount codes to apply. Case-insensitive. Replaces previously submitted codes. Send empty array to clear. applied Array[Applied Discount] No Discounts successfully applied (code-based and automatic)."},{"location":"specification/reference/#checkout-with-discount","title":"Checkout with Discount","text":"Name Type Required Description ucp any Yes UCP metadata for checkout responses. id string Yes Unique identifier of the checkout session. line_items Array[object] Yes List of line items being checked out. buyer object No Representation of the buyer. status string Yes Checkout state indicating the current phase and required action. See Checkout Status lifecycle documentation for state transition details.Enum: <code>incomplete</code>, <code>requires_escalation</code>, <code>ready_for_complete</code>, <code>complete_in_progress</code>, <code>completed</code>, <code>canceled</code> currency string Yes ISO 4217 currency code reflecting the merchant's market determination. Derived from address, context, and geo IP\u2014buyers provide signals, merchants determine currency. totals Array[object] Yes Different cart totals. messages Array[object] No List of messages with error and info about the checkout session state. links Array[object] Yes Links to be displayed by the platform (Privacy Policy, TOS). Mandatory for legal compliance. expires_at string No RFC 3339 expiry timestamp. Default TTL is 6 hours from creation if not sent. continue_url string No URL for checkout handoff and session recovery. MUST be provided when status is requires_escalation. See specification for format and availability requirements. payment object No Payment configuration containing handlers. order object No Details about an order created for this checkout session. discounts Discounts Object No"},{"location":"specification/reference/#fulfillment-extension","title":"Fulfillment Extension","text":""},{"location":"specification/reference/#fulfillment-option_1","title":"Fulfillment Option","text":"Name Type Required Description id string Yes Unique fulfillment option identifier. title string Yes Short label (e.g., 'Express Shipping', 'Curbside Pickup'). description string No Complete context for buyer decision (e.g., 'Arrives Dec 12-15 via FedEx'). carrier string No Carrier name (for shipping). earliest_fulfillment_time string No Earliest fulfillment date. latest_fulfillment_time string No Latest fulfillment date. totals Array[object] Yes Fulfillment option totals breakdown."},{"location":"specification/reference/#fulfillment-group_1","title":"Fulfillment Group","text":"Name Type Required Description id string Yes Group identifier for referencing merchant-generated groups in updates. line_item_ids Array[string] Yes Line item IDs included in this group/package. options Array[object] No Available fulfillment options for this group. selected_option_id ['string', 'null'] No ID of the selected fulfillment option for this group."},{"location":"specification/reference/#fulfillment-method_1","title":"Fulfillment Method","text":"Name Type Required Description id string Yes Unique fulfillment method identifier. type string Yes Fulfillment method type.Enum: <code>shipping</code>, <code>pickup</code> line_item_ids Array[string] Yes Line item IDs fulfilled via this method. destinations Array[object] No Available destinations. For shipping: addresses. For pickup: retail locations. selected_destination_id ['string', 'null'] No ID of the selected destination. groups Array[object] No Fulfillment groups for selecting options. Agent sets selected_option_id on groups to choose shipping method."},{"location":"specification/reference/#fulfillment-available-method_1","title":"Fulfillment Available Method","text":"Name Type Required Description type string Yes Fulfillment method type this availability applies to.Enum: <code>shipping</code>, <code>pickup</code> line_item_ids Array[string] Yes Line items available for this fulfillment method. fulfillable_on ['string', 'null'] No 'now' for immediate availability, or ISO 8601 date for future (preorders, transfers). description string No Human-readable availability info (e.g., 'Available for pickup at Downtown Store today')."},{"location":"specification/reference/#fulfillment_1","title":"Fulfillment","text":"Name Type Required Description methods Array[object] No Fulfillment methods for cart items. available_methods Array[object] No Inventory availability hints."},{"location":"specification/reference/#checkout-with-fulfillment","title":"Checkout with Fulfillment","text":"Name Type Required Description ucp any Yes UCP metadata for checkout responses. id string Yes Unique identifier of the checkout session. line_items Array[object] Yes List of line items being checked out. buyer object No Representation of the buyer. status string Yes Checkout state indicating the current phase and required action. See Checkout Status lifecycle documentation for state transition details.Enum: <code>incomplete</code>, <code>requires_escalation</code>, <code>ready_for_complete</code>, <code>complete_in_progress</code>, <code>completed</code>, <code>canceled</code> currency string Yes ISO 4217 currency code reflecting the merchant's market determination. Derived from address, context, and geo IP\u2014buyers provide signals, merchants determine currency. totals Array[object] Yes Different cart totals. messages Array[object] No List of messages with error and info about the checkout session state. links Array[object] Yes Links to be displayed by the platform (Privacy Policy, TOS). Mandatory for legal compliance. expires_at string No RFC 3339 expiry timestamp. Default TTL is 6 hours from creation if not sent. continue_url string No URL for checkout handoff and session recovery. MUST be provided when status is requires_escalation. See specification for format and availability requirements. payment object No Payment configuration containing handlers. order object No Details about an order created for this checkout session. fulfillment Fulfillment No Fulfillment details."},{"location":"specification/reference/#devucpshoppingfulfillment","title":"Dev.Ucp.Shopping.Fulfillment","text":"<p>No properties defined.</p>"},{"location":"specification/reference/#ucp-metadata","title":"UCP Metadata","text":"<p>The following schemas define the structure of UCP metadata used in discovery and responses.</p>"},{"location":"specification/reference/#platform-discovery-profile","title":"Platform Discovery Profile","text":"<p>The top-level structure of a platform profile document (hosted at a URI advertised by the platform).</p> Name Type Required Description Error: Failed to resolve ''. Ensure ucp-schema is installed: <code>cargo install ucp-schema</code> services any Yes capabilities any No payment_handlers any Yes"},{"location":"specification/reference/#business-discovery-profile","title":"Business Discovery Profile","text":"<p>The top-level structure of a business discovery document (<code>/.well-known/ucp</code>).</p> Name Type Required Description Error: Failed to resolve ''. Ensure ucp-schema is installed: <code>cargo install ucp-schema</code> services any Yes capabilities any No payment_handlers any Yes"},{"location":"specification/reference/#checkout-response-metadata","title":"Checkout Response Metadata","text":"<p>The <code>ucp</code> object included in checkout responses.</p> Name Type Required Description Error: Failed to resolve ''. Ensure ucp-schema is installed: <code>cargo install ucp-schema</code> services any No capabilities any No payment_handlers any Yes"},{"location":"specification/reference/#order-response-metadata","title":"Order Response Metadata","text":"<p>The <code>ucp</code> object included in order responses or events.</p> Name Type Required Description Error: Failed to resolve ''. Ensure ucp-schema is installed: <code>cargo install ucp-schema</code> capabilities any No"},{"location":"specification/reference/#capability","title":"Capability","text":"<p>This object describes a single capability or extension. It appears in the <code>capabilities</code> array in discovery profiles and responses, with slightly different required fields in each context.</p>"},{"location":"specification/reference/#capability-discovery","title":"Capability (Discovery)","text":"<p>As seen in discovery profiles.</p> <p>Error: Definition '#/$defs/discovery' not found in 'source/schemas/capability.json'</p>"},{"location":"specification/reference/#capability-response","title":"Capability (Response)","text":"<p>As seen in response messages.</p> Name Type Required Description Error: Failed to resolve ''. Ensure ucp-schema is installed: <code>cargo install ucp-schema</code>"},{"location":"specification/tokenization-guide/","title":"Tokenization Guide","text":""},{"location":"specification/tokenization-guide/#tokenization-guide","title":"Tokenization Guide","text":"<p>OpenAPI: Tokenization API</p>"},{"location":"specification/tokenization-guide/#overview","title":"Overview","text":"<p>This guide is for implementers building tokenization payment handlers. It defines the shared API, security requirements, and conformance criteria that all tokenization handlers follow.</p> <p>Note: While the examples in this guide use card credentials, tokenization patterns apply to any sensitive credential type\u2014bank accounts, digital wallets, loyalty accounts, etc. Compliance requirements (e.g., PCI DSS for cards) vary by credential type.</p> <p>We offer a range of examples to utilize forms of tokenization in UCP:</p> Example Use Case Processor Tokenizer Business or PSP runs tokenization and processing Platform Tokenizer Platform tokenizes credentials for businesses/PSPs Encrypted Credential Handler Platform encrypts credentials instead of tokenizing"},{"location":"specification/tokenization-guide/#core-concepts","title":"Core Concepts","text":""},{"location":"specification/tokenization-guide/#credential-flow","title":"Credential Flow","text":"<p>Tokenization handlers transform credentials between source and checkout forms:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Tokenization Payment Flow                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                         \u2502\n\u2502   Platform has:            Tokenizer            Business receives:      \u2502\n\u2502   Source Credential  \u2500\u2500\u25b6  /tokenize  \u2500\u2500\u25b6         TokenCredential        \u2502\n\u2502                                                                         \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 source_         \u2502                      \u2502 checkout_               \u2502  \u2502\n\u2502   \u2502 credentials     \u2502    What goes IN      \u2502 credentials             \u2502  \u2502\n\u2502   \u2502                 \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500      \u2502                         \u2502  \u2502\n\u2502   \u2502 \u2022 card/fpan     \u2502                      \u2502 What comes OUT          \u2502  \u2502\n\u2502   \u2502 \u2022 card/dpan     \u2502                \u2500\u2500\u2500\u2500\u2500\u25b6\u2502 \u2022 token                 \u2502  \u2502\n\u2502   \u2502                 \u2502                      \u2502                         \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Tokenization handlers accept source credentials (e.g., card with FPAN) and produce checkout credentials (e.g., tokens).</p>"},{"location":"specification/tokenization-guide/#token-lifecycle","title":"Token Lifecycle","text":"<p>Tokens move through distinct phases. Your handler specification must document which lifecycle policy you use:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Generation  \u2502\u2500\u2500\u2500\u25b6\u2502   Storage    \u2502\u2500\u2500\u2500\u25b6\u2502 Detokenize   \u2502\u2500\u2500\u2500\u25b6\u2502 Invalidation \u2502\n\u2502              \u2502    \u2502              \u2502    \u2502              \u2502    \u2502              \u2502\n\u2502Platform calls\u2502    \u2502 Tokenizer    \u2502    \u2502 Business/PSP \u2502    \u2502 Token expires\u2502\n\u2502 /tokenize    \u2502    \u2502 holds token  \u2502    \u2502 calls        \u2502    \u2502 or is used   \u2502\n\u2502              \u2502    \u2502 \u2192 credential \u2502    \u2502 /detokenize  \u2502    \u2502              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> Policy Description Use Case Single-use Invalidated after first detokenization Most secure; recommended default TTL-based Expires after fixed duration (e.g., 15 min) Allows retries on transient failures Session-scoped Valid for checkout session duration Complex flows with multiple processing attempts"},{"location":"specification/tokenization-guide/#binding","title":"Binding","text":"<p>All tokenization requests require a <code>binding</code> object that ties the token to a specific context:</p> Field Required Description <code>checkout_id</code> Yes The checkout session this token is valid for <code>identity</code> Conditional The participant identity to bind to; required when caller acts on behalf of another participant <p>The tokenizer MUST verify binding matches on <code>/detokenize</code>. See Binding Schema.</p>"},{"location":"specification/tokenization-guide/#openapi","title":"OpenAPI","text":"<p>Tokenization handlers implement two endpoints. Your handler MAY implement one or both depending on your architecture. Or none, like our encrypted payload example, which defines its own mechanism to encrypt.</p>"},{"location":"specification/tokenization-guide/#post-tokenize","title":"POST /tokenize","text":"<p>Converts a raw credential into a token bound to a checkout and identity.</p> <p>When to implement: Always, unless you are an agent generating tokens internally.</p> <pre><code>POST /tokenize\nContent-Type: application/json\n\n{\n  \"credential\": {\n    \"type\": \"card\",\n    \"card_number_type\": \"fpan\",\n    \"number\": \"4111111111111111\",\n    \"expiry_month\": 12,\n    \"expiry_year\": 2026,\n    \"cvc\": \"123\"\n  },\n  \"binding\": {\n    \"checkout_id\": \"abc123\",\n    \"identity\": {\n      \"access_token\": \"merchant_001\"\n    }\n  }\n}\n</code></pre> <p>Response:</p> <pre><code>{\n  \"token\": \"tok_abc123xyz789\"\n}\n</code></pre>"},{"location":"specification/tokenization-guide/#post-detokenize","title":"POST /detokenize","text":"<p>Returns the original credential for a valid token. Binding must match.</p> <p>When to implement: Always, unless you combine detokenization with processing (see PSP example).</p> <pre><code>POST /detokenize\nContent-Type: application/json\nAuthorization: Bearer {caller_access_token}\n\n{\n  \"token\": \"tok_abc123xyz789\",\n  \"binding\": {\n    \"checkout_id\": \"abc123\"\n  }\n}\n</code></pre> <p>Response:</p> <pre><code>{\n  \"type\": \"card\",\n  \"card_number_type\": \"fpan\",\n  \"number\": \"4111111111111111\",\n  \"expiry_month\": 12,\n  \"expiry_year\": 2026,\n  \"cvc\": \"123\"\n}\n</code></pre> <p>Note: <code>binding.identity</code> is omitted when the authenticated caller is the binding target. Include it when acting on behalf of another participant (e.g., PSP detokenizing for business).</p> <p>See the full OpenAPI specification for complete request/response schemas.</p>"},{"location":"specification/tokenization-guide/#security-requirements","title":"Security Requirements","text":"Requirement Description Binding required Credentials MUST be bound to <code>checkout_id</code> and participant <code>identity</code> to prevent reuse Binding verified Tokenizer MUST verify binding matches before returning credentials Cryptographically random Use secure random generators; tokens must be unguessable Sufficient length Minimum 128 bits of entropy Non-reversible Cannot derive the credential from the token Scoped Token should only work with your tokenizer Time-limited Enforce TTL appropriate to use case (typically 5-30 minutes) Single-use preferred Invalidate after first detokenization when possible"},{"location":"specification/tokenization-guide/#handler-specification-requirements","title":"Handler Specification Requirements","text":"<p>When publishing your handler, your specification document MUST include:</p> Requirement Example Unique handler name <code>com.example.tokenization_payment</code> (reverse-DNS format) Endpoint URLs Production and sandbox base URLs Authentication requirements OAuth 2.0, API keys, etc. Onboarding process How participants register and receive identities Accepted credentials Which credential types are accepted for tokenization Token lifecycle policy Single-use, TTL, or session-scoped Security acknowledgements Participants receiving raw credentials must accept responsibility"},{"location":"specification/tokenization-guide/#example-specification-outline","title":"Example Specification Outline","text":"<pre><code>**Handler Name:** `com.acme.tokenization_payment`\n**OpenAPI:** [Tokenization API](https://ucp.dev/handlers/tokenization/openapi.json)\n\n| Environment | Base URL                           |\n| :---------- | :--------------------------------- |\n| Production  | `https://api.acme.com/ucp`         |\n| Sandbox     | `https://sandbox.api.acme.com/ucp` |\n\n**Supported Instruments:**\n\n| Instrument | Source Credentials           | Checkout Credentials |\n| :--------- | :--------------------------- | :------------------- |\n| `card`     | `card` (fpan, network_token) | `token`              |\n\n**Token Lifecycle:** Single-use (invalidated after detokenization)\n\n**Authentication:** OAuth 2.0 client credentials\n\n**Onboarding:** Register at portal.acme.com. Businesses receive `access_token` for handler identity.\n</code></pre>"},{"location":"specification/tokenization-guide/#conformance-checklist","title":"Conformance Checklist","text":"<p>A tokenizer handler conforms to this pattern if it:</p> <ul> <li> Publishes a handler specification at a stable URL with a unique, reverse-DNS <code>handler_name</code></li> <li> Implements <code>/tokenize</code> and/or <code>/detokenize</code> per the OpenAPI</li> <li> Defines authentication and onboarding requirements</li> <li> Documents credential transformation between source and checkout forms</li> <li> Produces tokens compatible with the <code>TokenCredential</code> schema</li> <li> Specifies token lifecycle policy (TTL, single-use, etc.)</li> <li> Requires <code>binding</code> with <code>checkout_id</code> on tokenization requests</li> <li> Uses <code>PaymentIdentity</code> for participant identification</li> <li> Verifies <code>binding</code> matches on detokenization requests</li> <li> Requires security acknowledgements from participants receiving raw credentials</li> </ul>"},{"location":"specification/tokenization-guide/#references","title":"References","text":"Resource URL Tokenization OpenAPI <code>https://ucp.dev/handlers/tokenization/openapi.json</code> Identity Schema <code>https://ucp.dev/schemas/shopping/types/payment_identity.json</code> Binding Schema <code>https://ucp.dev/schemas/shopping/types/binding.json</code> Token Credential Schema <code>https://ucp.dev/schemas/shopping/types/token_credential.json</code> Card Instrument Schema <code>https://ucp.dev/schemas/shopping/types/card_payment_instrument.json</code>"},{"location":"specification/tokenization-guide/#see-also","title":"See Also","text":"<ul> <li>Encrypted Credential Handler \u2014 Alternative pattern using encryption instead of tokenize/detokenize round-trips</li> <li>AP2 Mandates Extension \u2014 Add cryptographic proof of checkout agreement for PSP verification</li> </ul>"},{"location":"specification/versioning/","title":"Versioning","text":"<p>UCP uses date-based version identifiers following the format YYYY-MM-DD, to indicate the last date backwards incompatible changes were made.</p> <p>New development occurs on the <code>main</code> branch. We will maintain long-lived branches for all supported releases of the spec.</p> <ul> <li>When the Tech Council approves a new version of UCP, we will cut a   new branch named <code>release/YYYY-MM-DD</code> directly from the current state of   <code>main</code>.<ul> <li>We will implement a code freeze on the release branch the moment a   <code>release/YYYY-MM-DD branch</code> is cut. Only critical bug fixes should move   during this window.</li> <li>Critical issues discovered after cutting a release branch should be fixed   in one of two ways:</li> <li>The fix is made on the release branch and merged to <code>main</code>.</li> <li>The fix is made on <code>main</code> and cherry-picked to the release branch.</li> </ul> </li> <li>Once finalized, we will merge the release branch into <code>main</code> and tag it (e.g.   <code>git tag -a vYYYY-MM-DD</code>).  We will use a GitHub Action to detect the new Tag   and automatically generate a release notes draft and upload artifacts.</li> <li>Unlike temporary feature branches, release/YYYY-MM-DD branches are long-lived   and correspond to specific versions of the spec for historical reference and   maintenance.</li> </ul>"},{"location":"specification/versioning/#breaking-prs","title":"Breaking PRs","text":"<ul> <li>Breaking changes should include <code>!</code> in the PR title</li> <li>Timing: We will announce the breaking change in Discussions 2 weeks   before the change is merged.</li> </ul>"},{"location":"specification/examples/encrypted-credential-handler/","title":"Encrypted Credential","text":""},{"location":"specification/examples/encrypted-credential-handler/#encrypted-credential-handler","title":"Encrypted Credential Handler","text":"<ul> <li>Handler Name: <code>com.example.encrypted_credential</code></li> <li>Type: Payment Handler Example</li> </ul>"},{"location":"specification/examples/encrypted-credential-handler/#introduction","title":"Introduction","text":"<p>This example demonstrates a payment handler where the platform encrypts credentials directly for the business. Unlike tokenization patterns, there is no <code>/tokenize</code> or <code>/detokenize</code> endpoint\u2014the platform's compliant credential vault encrypts credentials using the business's public key, and the business decrypts them locally.</p> <p>This pattern is ideal when businesses want to avoid round-trip latency to a tokenizer at payment time.</p> <p>Note: While this example uses card credentials (requiring PCI DSS compliance), the encryption pattern applies to any credential type. Compliance requirements vary by credential type.</p>"},{"location":"specification/examples/encrypted-credential-handler/#key-benefits","title":"Key Benefits","text":"<ul> <li>No runtime round-trips: Business decrypts locally, no <code>/detokenize</code> call needed</li> <li>Simpler architecture: No token storage or token-to-credential mapping</li> <li>Business-controlled keys: Business manages their own decryption keys</li> </ul>"},{"location":"specification/examples/encrypted-credential-handler/#quick-start","title":"Quick Start","text":"If you are a... Start here Business accepting this handler Business Integration Platform implementing this handler Platform Integration"},{"location":"specification/examples/encrypted-credential-handler/#participants","title":"Participants","text":"Participant Role Prerequisites Business Registers public key, receives encrypted credentials, decrypts locally Yes \u2014 registers with platform Platform Operates compliant credential vault, encrypts for business using their public key Yes \u2014 implements encryption"},{"location":"specification/examples/encrypted-credential-handler/#pattern-flow","title":"Pattern Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Platform       \u2502                              \u2502  Business  \u2502\n\u2502                 \u2502                              \u2502            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                                              \u2502\n         \u2502  1. Business registers public key (out-of-band)\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n         \u2502                                              \u2502\n         \u2502  2. Confirmation                             \u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n         \u2502                                              \u2502\n         \u2502  3. GET ucp.payment_handlers                 \u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n         \u2502                                              \u2502\n         \u2502  4. Handler with business identity           \u2502\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n         \u2502                                              \u2502\n         \u2502  5. Platform's vaulting service encrypts     \u2502\n         \u2502     credential with business's key           \u2502\n         \u2502                                              \u2502\n         \u2502  6. POST checkout with EncryptedCredential   \u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n         \u2502                                              \u2502\n         \u2502       (Business decrypts locally)            \u2502\n         \u2502                                              \u2502\n         \u2502  7. Checkout complete                        \u2502\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n</code></pre>"},{"location":"specification/examples/encrypted-credential-handler/#business-integration","title":"Business Integration","text":""},{"location":"specification/examples/encrypted-credential-handler/#prerequisites","title":"Prerequisites","text":""},{"location":"specification/examples/encrypted-credential-handler/#critical-compliance-required-for-card-credentials","title":"CRITICAL: Compliance Required for Card Credentials","text":"<p>Before accepting this handler, businesses must register their public encryption key with the platform.</p> <p>While businesses receive only encrypted <code>EncryptedCredential</code> payloads during checkout, they decrypt these payloads locally to obtain raw credentials for payment processing. For card credentials, businesses MUST be PCI DSS compliant because they will handle raw PANs. This includes:</p> <ul> <li>Secure key management for decryption keys</li> <li>Secure handling of raw credentials after decryption</li> <li>For cards: Compliance with all PCI DSS requirements for handling Primary Account Numbers (PANs)</li> </ul> <p>Prerequisites Output:</p> Field Description <code>identity.access_token</code> Business identifier assigned by platform during onboarding Public key registered Platform stores business's public key for encryption"},{"location":"specification/examples/encrypted-credential-handler/#handler-configuration","title":"Handler Configuration","text":"<p>Businesses advertise the platform's handler. The <code>business_id</code> field identifies the business, which the platform uses to look up the correct public key for encryption.</p> <p>The only supported instrument schema is CardPaymentInstrument, the only supported checkout credential schema is <code>EncryptedCredential</code>, and the only supported source credential schema is CardCredential.</p> <p>Note: The <code>EncryptedCredential</code> shape would be formally defined in the handler's schema (referenced via the <code>schema</code> field in the handler declaration).</p> <p>Note: <code>CardCredential</code> contains raw PANs. For card credentials, the platform's vaulting service must be PCI DSS compliant when handling these credentials. Businesses receive only encrypted payloads but must be PCI DSS compliant once they decrypt card credentials locally. Other credential types have their own compliance requirements.</p>"},{"location":"specification/examples/encrypted-credential-handler/#business-config-discovery","title":"Business Config (Discovery)","text":"Field Type Required Description <code>environment</code> string Yes API environment (<code>sandbox</code> or <code>production</code>) <code>business_id</code> string Yes Business identifier assigned by platform <code>public_key_id</code> string Yes Identifier for the business's registered public key"},{"location":"specification/examples/encrypted-credential-handler/#example-business-handler-declaration","title":"Example Business Handler Declaration","text":"<pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"payment_handlers\": {\n      \"com.example.platform_encrypted\": [\n        {\n          \"id\": \"platform_encrypted\",\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://platform.example.com/ucp/encrypted-handler.json\",\n          \"schema\": \"https://platform.example.com/ucp/encrypted-handler/schema.json\",\n          \"config\": {\n            \"environment\": \"production\",\n            \"business_id\": \"merchant_abc123\",\n            \"public_key_id\": \"key_2026_01\"\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/examples/encrypted-credential-handler/#response-config-checkout","title":"Response Config (Checkout)","text":"<p>The response config includes information about the encryption used.</p> Field Type Required Description <code>environment</code> string Yes API environment <code>business_id</code> string Yes Business identifier <code>encryption_algorithm</code> string Yes Algorithm used (e.g., <code>RSA-OAEP-256</code>) <code>key_id</code> string Yes Key identifier used for encryption"},{"location":"specification/examples/encrypted-credential-handler/#example-response-config","title":"Example Response Config","text":"<pre><code>{\n  \"config\": {\n    \"environment\": \"production\",\n    \"business_id\": \"merchant_abc123\",\n    \"encryption_algorithm\": \"RSA-OAEP-256\",\n    \"key_id\": \"key_2026_01\"\n  }\n}\n</code></pre>"},{"location":"specification/examples/encrypted-credential-handler/#processing-payments","title":"Processing Payments","text":"<p>Upon receiving a checkout with an encrypted credential:</p> <ol> <li>Validate Handler: Confirm <code>instrument.handler_id</code> matches the expected handler ID</li> <li>Decrypt Credential: Use business's private key to decrypt the credential</li> <li>Verify Binding: Confirm the decrypted <code>checkout_id</code> matches the current checkout</li> <li>Process Payment: Use the decrypted credential to complete payment</li> <li>Return Response: Respond with the finalized checkout state</li> </ol>"},{"location":"specification/examples/encrypted-credential-handler/#platform-integration","title":"Platform Integration","text":""},{"location":"specification/examples/encrypted-credential-handler/#prerequisites_1","title":"Prerequisites","text":"<p>This handler is implemented by platforms that operate compliant credential vaults and can encrypt credentials for businesses. To implement, platforms must:</p> <ol> <li>Maintain compliance for credential storage and handling (e.g., PCI DSS for cards)</li> <li>Store business public keys during onboarding</li> <li>Encrypt credentials using the correct business's key based on handler identity</li> </ol> <p>Implementation Requirements:</p> Requirement Description Key storage Map business identities to their public keys Encryption Encrypt credentials + binding context with business's public key"},{"location":"specification/examples/encrypted-credential-handler/#handler-configuration-platform","title":"Handler Configuration (Platform)","text":"<p>Platforms advertise this handler in their UCP profile's <code>payment_handlers</code> registry using <code>platform_config</code>.</p>"},{"location":"specification/examples/encrypted-credential-handler/#platform-config-discovery","title":"Platform Config (Discovery)","text":"Field Type Required Description <code>environment</code> string Yes API environment (<code>sandbox</code> or <code>production</code>) <code>platform_id</code> string Yes Platform identifier <code>supported_algorithms</code> array Yes Encryption algorithms supported (e.g., <code>[\"RSA-OAEP-256\"]</code>)"},{"location":"specification/examples/encrypted-credential-handler/#example-platform-handler-declaration","title":"Example Platform Handler Declaration","text":"<pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"payment_handlers\": {\n      \"com.example.platform_encrypted\": [\n        {\n          \"id\": \"platform_encrypted\",\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://platform.example.com/ucp/encrypted-handler.json\",\n          \"schema\": \"https://platform.example.com/ucp/encrypted-handler/schema.json\",\n          \"config\": {\n            \"environment\": \"production\",\n            \"platform_id\": \"platform_abc123\",\n            \"supported_algorithms\": [\"RSA-OAEP-256\", \"RSA-OAEP-384\"]\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/examples/encrypted-credential-handler/#credential-encryption","title":"Credential Encryption","text":"<p>The platform application orchestrates the payment flow but never has access to raw credentials. Instead:</p> <ol> <li>The platform's compliant vaulting service receives the raw credential    from the user</li> <li>The vaulting service encrypts the credential along with binding context using    the business's public key</li> <li>The vaulting service returns the encrypted payload to the platform application</li> <li>The platform application includes this encrypted payload in the checkout submission</li> </ol> <p>This separation ensures the platform application itself never handles or has access to raw PANs.</p>"},{"location":"specification/examples/encrypted-credential-handler/#submitting-checkout","title":"Submitting Checkout","text":"<p>Platform application submits the checkout with the encrypted credential (received from its vaulting service):</p> <pre><code>POST /checkout-sessions/{checkout_id}/complete\nUCP-Agent: profile=\"https://platform.example/profile\"\nContent-Type: application/json\n\n{\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"instr_1\",\n        \"handler_id\": \"platform_encrypted\",\n        \"type\": \"card\",\n        \"selected\": true,\n        \"display\": {\n          \"brand\": \"visa\",\n          \"last_digits\": \"1111\",\n          \"expiry_month\": 12,\n          \"expiry_year\": 2026\n        },\n        \"credential\": {\n          \"type\": \"encrypted\",\n          \"encrypted_data\": \"base64-encoded-encrypted-payload...\"\n        }\n      }\n    ]\n  },\n  \"risk_signals\": {\n    // ... the key value pair for potential risk signal data\n  }\n}\n</code></pre>"},{"location":"specification/examples/encrypted-credential-handler/#security-considerations","title":"Security Considerations","text":"Requirement Description Compliance (Platform) Platform vaulting services MUST be compliant with relevant standards for the credential type (e.g., PCI DSS for cards handling raw PANs) Compliance (Business) Businesses MUST be compliant with relevant standards for decryption and handling of raw credentials locally (e.g., PCI DSS for cards) No platform app credential access Platform applications MUST NOT handle raw credentials\u2014only the compliant vaulting service does Asymmetric encryption Platform's credential vault encrypts with business's public key; only business can decrypt Binding embedded <code>checkout_id</code> MUST be included in encrypted payload to prevent replay Key rotation Businesses SHOULD rotate keys periodically; platform must support key updates No credential storage Platform does not store encrypted credentials; encryption is one-way HTTPS required All checkout submissions must use TLS"},{"location":"specification/examples/encrypted-credential-handler/#references","title":"References","text":"<ul> <li>Identity Schema: <code>https://ucp.dev/schemas/shopping/types/payment_identity.json</code></li> <li>Instrument Schema: <code>https://ucp.dev/schemas/shopping/types/card_payment_instrument.json</code></li> </ul>"},{"location":"specification/examples/platform-tokenizer-payment-handler/","title":"Platform Tokenizer","text":""},{"location":"specification/examples/platform-tokenizer-payment-handler/#platform-tokenizer-payment-handler","title":"Platform Tokenizer Payment Handler","text":"<ul> <li>Handler Name: <code>com.example.platform_tokenizer</code></li> <li>Type: Payment Handler Example</li> </ul>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#introduction","title":"Introduction","text":"<p>This example demonstrates a tokenization payment handler where the platform acts as the tokenizer. The platform's payment credential provider securely stores sensitive payment data (e.g., stored cards from user wallets) and generates tokens internally without calling an external <code>/tokenize</code> endpoint.</p> <p>The platform's credential provider exposes a <code>/detokenize</code> endpoint for businesses to call back and retrieve the sensitive instrument details for processing.</p> <p>This pattern is ideal for platforms that operate as wallet providers with compliant credential storage.</p> <p>Note: While this example uses card credentials, the pattern applies to any credential type. Compliance requirements vary by credential type (e.g., PCI DSS for cards).</p>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#key-benefits","title":"Key Benefits","text":"<ul> <li>Zero early transmission: Platforms never expose sensitive data until a payment request is being finalized.</li> <li>Platform-controlled security: Platform defines token lifecycle and binding policies.</li> <li>PSP flexibility: Businesses can delegate detokenization to their PSP, keeping sensitive data out of business systems entirely.</li> </ul>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#quickstart","title":"QuickStart","text":"If you are a... Start here Business accepting this handler Business Integration Platform implementing this handler Platform Integration PSP processing for businesses PSP Integration"},{"location":"specification/examples/platform-tokenizer-payment-handler/#participants","title":"Participants","text":"Participant Role Prerequisites Business Advertises handler, receives tokens, optionally delegates to PSP Yes \u2014 onboards with platform Platform Operates a payment credential provider that generates tokens and exposes <code>/detokenize</code> endpoint Yes \u2014 implements tokenization service PSP Optionally detokenizes on business's behalf, processes payments Yes \u2014 onboards with platform"},{"location":"specification/examples/platform-tokenizer-payment-handler/#pattern-flow-business-detokenizes","title":"Pattern Flow: Business Detokenizes","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Platform     \u2502                              \u2502  Business  \u2502\n\u2502  (Tokenizer)    \u2502                              \u2502            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                                              \u2502\n         \u2502  1. Business registers with Platform (out-of-band)\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n         \u2502                                              \u2502\n         \u2502  2. API credentials                          \u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n         \u2502                                              \u2502\n         \u2502  3. GET ucp.payment_handlers                 \u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n         \u2502                                              \u2502\n         \u2502  4. Handler with business identity           \u2502\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n         \u2502                                              \u2502\n         \u25025. Platforms's Credential Provider generates token\u2502\n         \u2502                                              \u2502\n         \u2502  6. POST checkout with TokenCredential       \u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n         \u2502                                              \u2502\n         \u2502  7. POST /detokenize (to Credential Provider)\u2502\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n         \u2502                                              \u2502\n         \u2502  8. Sensitive Data                           \u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n         \u2502                                              \u2502\n         \u2502  9. Checkout complete                        \u2502\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n</code></pre>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#pattern-flow-psp-detokenizes","title":"Pattern Flow: PSP Detokenizes","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Platform     \u2502     \u2502  Business  \u2502      \u2502   PSP   \u2502\n\u2502  (Tokenizer)    \u2502     \u2502            \u2502      \u2502         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n         \u2502                     \u2502                 \u2502\n         \u2502  1. Business + PSP register with Platform (out-of-band)\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                 \u2502\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n         \u2502                     \u2502                 \u2502\n         \u2502  2. API credentials \u2502                 \u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502                 \u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n         \u2502                     \u2502                 \u2502\n         \u2502  3. Payment Credential Provider       \u2502\n         \u2502     generates token                   \u2502\n         \u2502                     \u2502                 \u2502\n         \u2502  4. POST checkout with TokenCredential\u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502                 \u2502\n         \u2502                     \u2502                 \u2502\n         \u2502                     \u2502  5. Forward     \u2502\n         \u2502                     \u2502  token to PSP   \u2502\n         \u2502                     \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n         \u2502                     \u2502                 \u2502\n         \u2502  6. POST /detokenize (to Credential Provider, with business identity)\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n         \u2502                     \u2502                 \u2502\n         \u2502  7. Sensitive Data  \u2502                 \u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n         \u2502                     \u2502                 \u2502\n         \u2502                     \u2502  8. Payment     \u2502\n         \u2502                     \u2502  result         \u2502\n         \u2502                     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n         \u2502                     \u2502                 \u2502\n         \u2502  9. Checkout complete                 \u2502\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                 \u2502\n</code></pre>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#business-integration","title":"Business Integration","text":""},{"location":"specification/examples/platform-tokenizer-payment-handler/#prerequisites","title":"Prerequisites","text":""},{"location":"specification/examples/platform-tokenizer-payment-handler/#critical-security-compliance-required","title":"CRITICAL: Security &amp; Compliance Required","text":"<p>Before accepting this handler, businesses must register with the platform to obtain authentication credentials for calling <code>/detokenize</code>.</p> <p>As the party receiving sensitive instrument details via the <code>/detokenize</code> endpoint, businesses MUST be compliant with relevant data security standards for the credential type being handled (e.g., PCI DSS for cards). This includes:</p> <ul> <li>Secure transmission (HTTPS/TLS with strong cipher suites)</li> <li>Secure handling of sensitive data during payment processing</li> <li>Compliance with all regulations regarding the storage and processing of financial instruments</li> </ul> <p>Optionally, businesses may configure their PSP to detokenize on their behalf (PSP must also be compliant).</p> <p>Prerequisites Output:</p> Field Description <code>identity.access_token</code> Business identifier assigned by platform during onboarding Authentication credentials API key or OAuth token for authenticating <code>/detokenize</code> calls"},{"location":"specification/examples/platform-tokenizer-payment-handler/#handler-configuration","title":"Handler Configuration","text":"<p>Businesses advertise the platform's tokenization handler. The <code>config</code> contains the business's identity with the platform for token binding. The platform's handler specification (referenced via <code>spec</code>) documents the <code>/detokenize</code> endpoint URL exposed by the platform's payment credential provider.</p> <p>The handler accepts CardCredential for tokenization and produces TokenCredential for checkout.</p> <p>Note: The result of <code>/detokenize</code> contains sensitive payment data. Both the sender (platform's credential provider) and receiver (business or PSP) MUST be compliant with relevant standards for the credential type (e.g., PCI DSS for cards).</p>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#business-config-discovery","title":"Business Config (Discovery)","text":"Field Type Required Description <code>environment</code> string Yes API environment (<code>sandbox</code> or <code>production</code>) <code>business_id</code> string Yes Business identifier assigned by platform"},{"location":"specification/examples/platform-tokenizer-payment-handler/#example-business-handler-declaration","title":"Example Business Handler Declaration","text":"<pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"payment_handlers\": {\n      \"com.example.platform_tokenizer\": [\n        {\n          \"id\": \"platform_wallet\",\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://platform.example.com/ucp/handler.json\",\n          \"schema\": \"https://platform.example.com/ucp/handler/schema.json\",\n          \"config\": {\n            \"environment\": \"production\",\n            \"business_id\": \"business_abc123\"\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#response-config-checkout","title":"Response Config (Checkout)","text":"<p>The response config includes runtime token lifecycle information.</p> Field Type Required Description <code>environment</code> string Yes API environment <code>business_id</code> string Yes Business identifier <code>token_ttl_seconds</code> integer No Token time-to-live in seconds"},{"location":"specification/examples/platform-tokenizer-payment-handler/#example-response-config","title":"Example Response Config","text":"<pre><code>{\n  \"config\": {\n    \"environment\": \"production\",\n    \"business_id\": \"business_abc123\",\n    \"token_ttl_seconds\": 900,\n  }\n}\n</code></pre>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#processing-payments","title":"Processing Payments","text":"<p>Upon receiving a checkout with a token credential:</p> <ol> <li>Validate Handler: Confirm <code>instrument.handler_id</code> matches the expected handler ID.</li> <li>Detokenize or Delegate:</li> <li>Option A (Direct): Call the platform's credential provider <code>/detokenize</code> endpoint directly, then process payments.</li> <li>Option B (Delegated): Forward the token to a PSP for detokenization and payment processing.</li> <li>Return Response: Respond with the finalized checkout state.</li> </ol> <p>For option B, see section PSP Integration.</p>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#detokenize-request-example-business","title":"Detokenize Request Example (Business)","text":"<pre><code>POST https://provider.platform.example.com/ucp/detokenize\nContent-Type: application/json\nAuthorization: Bearer {business_api_key}\n\n{\n  \"token\": \"ptok_x9y8z7w6v5u4\",\n  \"binding\": {\n    \"checkout_id\": \"checkout_789\"\n  }\n}\n</code></pre> <p>Note: No <code>binding.identity</code> is needed if the business authenticates directly\u2014the platform knows who they are based on the API key.</p>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#platform-integration","title":"Platform Integration","text":""},{"location":"specification/examples/platform-tokenizer-payment-handler/#prerequisites_1","title":"Prerequisites","text":"<p>This handler is implemented by platforms that operate compliant payment credential providers or wallet services. The payment credential provider (not the main platform application) handles sensitive data and exposes the <code>/detokenize</code> endpoint. To implement, platforms must:</p> <ol> <li>Deploy a compliant payment credential provider that maintains compliance for credential storage and handling.</li> <li>Expose a <code>/detokenize</code> endpoint conforming to the API pattern from the credential provider.</li> <li>Onboard businesses and PSPs who will call the credential provider's <code>/detokenize</code> endpoint.</li> </ol> <p>Implementation Requirements:</p> Requirement Description <code>/detokenize</code> endpoint Exposed by the compliant payment credential provider (not the platform application) Token storage Map tokens to credentials with binding metadata in the credential provider Participant allowlist Only onboarded businesses/PSPs can call the credential provider's <code>/detokenize</code> Binding verification payment credential provider verifies <code>checkout_id</code> and caller identity on detokenization"},{"location":"specification/examples/platform-tokenizer-payment-handler/#handler-configuration-platform","title":"Handler Configuration (Platform)","text":"<p>Platforms advertise this handler in their UCP profile's <code>payment_handlers</code> registry using <code>platform_config</code>.</p>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#platform-config-discovery","title":"Platform Config (Discovery)","text":"Field Type Required Description <code>environment</code> string Yes API environment (<code>sandbox</code> or <code>production</code>) <code>platform_id</code> string Yes Platform identifier <code>default_token_ttl_seconds</code> integer No Default token TTL offered to businesses"},{"location":"specification/examples/platform-tokenizer-payment-handler/#example-platform-handler-declaration","title":"Example Platform Handler Declaration","text":"<pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"payment_handlers\": {\n      \"com.example.platform_tokenizer\": [\n        {\n          \"id\": \"platform_wallet\",\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://platform.example.com/ucp/handler.json\",\n          \"schema\": \"https://platform.example.com/ucp/handler/schema.json\",\n          \"config\": {\n            \"environment\": \"production\",\n            \"platform_id\": \"platform_abc123\",\n            \"default_token_ttl_seconds\": 900\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#token-generation","title":"Token Generation","text":"<p>The platform application orchestrates the payment flow but never has access to sensitive payment data. Instead:</p> <ol> <li>The platform's payment credential provider securely stores payment credentials.</li> <li>When a payment is needed, the platform application requests a token from the credential provider.</li> <li>The credential provider generates a token bound to both the <code>checkout_id</code> and the business's <code>identity</code> (from the handler declaration).</li> <li>The credential provider returns the token to the platform application.</li> <li>The platform application includes this token in the checkout submission.</li> </ol> <p>This separation ensures the platform application itself never handles or has access to sensitive instrument details.</p>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#submitting-checkout","title":"Submitting Checkout","text":"<p>The platform application submits the checkout with the token (received from its payment credential provider):</p> <pre><code>POST /checkout-sessions/{checkout_id}/complete\nContent-Type: application/json\n\n{\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"instr_1\",\n        \"handler_id\": \"platform_wallet\",\n        \"type\": \"card\",\n        \"selected\": true,\n        \"display\": {\n          \"brand\": \"visa\",\n          \"last_digits\": \"4242\"\n        },\n        \"credential\": {\n          \"type\": \"token\",\n          \"token\": \"ptok_x9y8z7w6v5u4\"\n        }\n      }\n    ]\n  },\n  \"risk_signals\": {\n    // ... the key value pair for potential risk signal data\n  }\n}\n</code></pre>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#psp-integration","title":"PSP Integration","text":""},{"location":"specification/examples/platform-tokenizer-payment-handler/#prerequisites_2","title":"Prerequisites","text":""},{"location":"specification/examples/platform-tokenizer-payment-handler/#critical-security-compliance-required_1","title":"CRITICAL: Security &amp; Compliance Required","text":"<p>Before detokenizing on behalf of businesses, PSPs must register with the platform, providing the list of businesses they process for.</p> <p>As the party receiving sensitive instrument details via the <code>/detokenize</code> endpoint, PSPs MUST be compliant with relevant security standards for the credential type being handled (e.g., PCI DSS for cards). This includes:</p> <ul> <li>Secure transmission (HTTPS/TLS with strong cipher suites)</li> <li>Secure handling of sensitive data during payment processing</li> <li>Compliance with all regulations regarding the storage and processing of   financial instruments</li> </ul> <p>Prerequisites Output:</p> Field Description Authentication credentials API key or OAuth token for authenticating <code>/detokenize</code> calls Business associations List of business identities this PSP can detokenize for"},{"location":"specification/examples/platform-tokenizer-payment-handler/#detokenization-flow","title":"Detokenization Flow","text":"<p>When the business forwards a token to the PSP:</p> <ol> <li>Extract the token from the payment instrument.</li> <li>Call the platform's payment credential provider <code>/detokenize</code> endpoint    with the business's identity in binding.</li> <li>Process the payment with the returned credential.</li> </ol>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#detokenize-request-example-psp","title":"Detokenize Request Example (PSP)","text":"<pre><code>POST https://provider.platform.example.com/ucp/detokenize\nContent-Type: application/json\nAuthorization: Bearer {psp_api_key}\n\n{\n  \"token\": \"ptok_x9y8z7w6v5u4\",\n  \"binding\": {\n    \"checkout_id\": \"checkout_789\",\n    \"identity\": {\n      \"access_token\": \"business_abc123\"\n    }\n  }\n}\n</code></pre> <p>Note: <code>binding.identity</code> IS required here\u2014the PSP is calling on behalf of a business, so they must specify which businesses' token they are retrieving.</p> <p>The platform's payment credential provider verifies that:</p> <ul> <li>The PSP is authorized to detokenize for this business.</li> <li>The <code>checkout_id</code> matches the original tokenization.</li> <li>The token has not expired or been used.</li> </ul>"},{"location":"specification/examples/platform-tokenizer-payment-handler/#security-considerations","title":"Security Considerations","text":"Requirement Description Compliance (credential provider) Platform's credential provider MUST be compliant with relevant standards for the credential type (e.g., PCI DSS for cards) when handling and storing sensitive instrument details. Compliance (Receivers) Businesses/PSPs calling <code>/detokenize</code> MUST be compliant with relevant standards for the credential type when receiving sensitive data payloads. Secure transmission Data transmission via <code>/detokenize</code> MUST use HTTPS/TLS with strong cipher suites. No Platform App access Platform applications MUST NOT handle sensitive data\u2014only the compliant payment credential provider does. Endpoint isolation <code>/detokenize</code> endpoint MUST be exposed by the payment credential provider, not the platform application. Participant authentication Platform's credential provider MUST authenticate businesses/PSPs before accepting <code>/detokenize</code> calls. Identity binding Tokens MUST be bound to the business's <code>identity</code> from the handler declaration. Checkout-bound Tokens MUST be bound to the specific <code>checkout_id</code>. Caller verification Platform MUST verify authenticated caller matches the token's bound identity (or is an authorized PSP). Single-use Tokens SHOULD be invalidated after detokenization. Short TTL Tokens SHOULD expire shortly. HTTPS required All <code>/detokenize</code> calls must use TLS."},{"location":"specification/examples/platform-tokenizer-payment-handler/#references","title":"References","text":"<ul> <li>Pattern: Tokenization Payment Handler</li> <li>API Pattern: <code>https://ucp.dev/handlers/tokenization/openapi.json</code></li> <li>Identity Schema: <code>https://ucp.dev/schemas/shopping/types/payment_identity.json</code></li> </ul>"},{"location":"specification/examples/processor-tokenizer-payment-handler/","title":"Processor Tokenizer","text":""},{"location":"specification/examples/processor-tokenizer-payment-handler/#processor-tokenizer-payment-handler","title":"Processor Tokenizer Payment Handler","text":"<ul> <li>Handler Name: <code>com.example.processor_tokenizer</code></li> <li>Type: Payment Handler Example</li> </ul>"},{"location":"specification/examples/processor-tokenizer-payment-handler/#introduction","title":"Introduction","text":"<p>This handler implements a \"Tokenize to Process\" flow where the entity that generates the token (the Tokenizer) is the same entity that processes the final payment (the Processor).</p> <p>Note: While this example uses card credentials, the pattern applies to any credential type. Compliance requirements vary by credential type (e.g., PCI DSS for cards).</p> <p>This specification unifies two common implementation scenarios:</p> <ol> <li>Business-Hosted: An enterprise Business hosts their own secure vault.     The Business tokenizes and processes.</li> <li>PSP-Hosted: The Business uses a third-party PSP. The PSP tokenizes     and processes.</li> </ol> <p>In both cases, no API detokenization step is required. The token resolution happens internally within the Processor's secure environment.</p>"},{"location":"specification/examples/processor-tokenizer-payment-handler/#comparison-of-scenarios","title":"Comparison of Scenarios","text":"Feature Scenario A: PSP-Hosted Scenario B: Business-Hosted Tokenizer Host Third-Party PSP The Business Compliance Scope Low (Business never sees PAN) High (Business stores PAN) Identity Binding Required (PSP needs Merchant Identifier) Implicit (Business knows itself)"},{"location":"specification/examples/processor-tokenizer-payment-handler/#participants","title":"Participants","text":"Participant Role Prerequisites Tokenizer / Processor Host <code>/tokenize</code> endpoint, store tokens, process payments. (Can be Business or PSP). Compliance per credential type (e.g., PCI DSS for cards). Platform Collect credentials via secure credential provider, call Tokenizer, submit checkout. Secure credential provider. Business Configures the handler for the checkout. None (if PSP-hosted)."},{"location":"specification/examples/processor-tokenizer-payment-handler/#pattern-flow","title":"Pattern Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Platform  \u2502                         \u2502       Tokenizer / Processor       \u2502\n\u2502 (Collector)\u2502                         \u2502      (Business or PSP)            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n      \u2502                                                  \u2502\n      \u2502  1. GET ucp.payment_handlers                     \u2502\n      \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n      \u2502                                                  \u2502\n      \u2502  2. Handler Config (URL + Identity)              \u2502\n      \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n      \u2502                                                  \u2502\n      \u2502  3. POST /tokenize (Credential + Identity)       \u2502\n      \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n      \u2502                                                  \u2502\n      \u2502  4. Token                                        \u2502\n      \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n      \u2502                                                  \u2502\n      \u2502  5. POST checkout with TokenCredential           \u2502\n      \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n      \u2502                                                  \u2502\n      \u2502        (Internal Resolution: Token -&gt; Info)      \u2502\n      \u2502                                                  \u2502\n      \u2502  6. Payment Result                               \u2502\n      \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n</code></pre>"},{"location":"specification/examples/processor-tokenizer-payment-handler/#configuration","title":"Configuration","text":"<p>The Business advertises this handler in their UCP profile's <code>payment_handlers</code> registry. The configuration determines whether the Platform acts in \"PSP Mode\" (sending identity) or \"Direct Mode\" (implicit identity).</p>"},{"location":"specification/examples/processor-tokenizer-payment-handler/#business-config-discovery","title":"Business Config (Discovery)","text":"<p>The business advertises their tokenization endpoint and identity during discovery. The handler's specification (referenced via the <code>spec</code> field) documents the <code>/tokenize</code> endpoint URL.</p> Field Type Required Description <code>environment</code> string Yes API environment (<code>sandbox</code> or <code>production</code>) <code>business_id</code> string Yes Business identifier with the processor"},{"location":"specification/examples/processor-tokenizer-payment-handler/#example-business-handler-declaration","title":"Example Business Handler Declaration","text":"<pre><code>{\n  \"ucp\": {\n    \"version\": \"2026-01-11\",\n    \"payment_handlers\": {\n      \"com.example.processor_tokenizer\": [\n        {\n          \"id\": \"processor_tokenizer\",\n          \"version\": \"2026-01-11\",\n          \"spec\": \"https://example.com/ucp/processor-tokenizer.json\",\n          \"schema\": \"https://example.com/ucp/processor-tokenizer/schema.json\",\n          \"config\": {\n            \"environment\": \"production\",\n            \"business_id\": \"merchant_xyz789\"\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/examples/processor-tokenizer-payment-handler/#response-config-checkout","title":"Response Config (Checkout)","text":"<p>The response config includes runtime information about what's available for this checkout.</p> Field Type Required Description <code>environment</code> string Yes API environment used for this checkout <code>business_id</code> string Yes Business identifier <code>supported_networks</code> array No Card networks supported for this transaction"},{"location":"specification/examples/processor-tokenizer-payment-handler/#example-response-config","title":"Example Response Config","text":"<pre><code>{\n  \"config\": {\n    \"environment\": \"production\",\n    \"business_id\": \"merchant_xyz789\",\n    \"supported_networks\": [\"visa\", \"mastercard\", \"amex\"]\n  }\n}\n</code></pre>"},{"location":"specification/examples/processor-tokenizer-payment-handler/#platform-integration","title":"Platform Integration","text":""},{"location":"specification/examples/processor-tokenizer-payment-handler/#prerequisites","title":"Prerequisites","text":"<p>Before using this handler, platforms must:</p> <ol> <li>Have access to a compliant secure payment credential providers that collects sensitive payment data from users. This service must meet the compliance requirements of the instruments being handled (e.g., PCI DSS).</li> <li>Obtain authentication credentials (e.g., API Key) authorized to call the specific <code>endpoint</code> defined in the handler configuration.</li> </ol> <p>Prerequisites Output:</p> Field Description payment credential providers Compliant secure service for collecting sensitive payment data from users Authentication credentials API key or OAuth token for authenticating <code>/tokenize</code> calls"},{"location":"specification/examples/processor-tokenizer-payment-handler/#payment-protocol","title":"Payment Protocol","text":""},{"location":"specification/examples/processor-tokenizer-payment-handler/#step-1-discover-handler","title":"Step 1: Discover Handler","text":"<p>Platform identifies the processor tokenizer handler and retrieves the business's configuration.</p> <pre><code>{\n  \"ucp\": {\n    \"payment_handlers\": {\n      \"com.example.processor_tokenizer\": [\n        {\n          \"id\": \"processor_tokenizer\",\n          \"version\": \"2026-01-11\",\n          \"config\": {\n            \"environment\": \"production\",\n            \"business_id\": \"merchant_xyz789\"\n          }\n        }\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"specification/examples/processor-tokenizer-payment-handler/#step-2-collect-sensitive-data","title":"Step 2: Collect Sensitive Data","text":"<p>Platform's compliant secure payment credential providers collects the sensitive payment data from the user (e.g., via a compliant payment form that ensures the sensitive instrument details never touch the platform).</p>"},{"location":"specification/examples/processor-tokenizer-payment-handler/#step-3-tokenize-data","title":"Step 3: Tokenize Data","text":"<p>Platform's payment credential provider calls the configured <code>endpoint</code>.</p> <p>Note: If the handler configuration includes an <code>identity</code> object, the credential provider MUST inject it into the <code>binding</code> object.</p> <p>Response:</p> <pre><code>{\n  \"token\": \"tok_a1b2c3d4e5f6\"\n}\n</code></pre>"},{"location":"specification/examples/processor-tokenizer-payment-handler/#step-4-complete-checkout","title":"Step 4: Complete Checkout","text":"<p>The Platform submits the token.</p> <pre><code>POST /checkout-sessions/{checkout_id}/complete\nUCP-Agent: profile=\"https://platform.example/profile\"\nContent-Type: application/json\n\n{\n  \"payment\": {\n    \"instruments\": [\n      {\n        \"id\": \"instr_1\",\n        \"handler_id\": \"processor_tokenizer\",\n        \"type\": \"card\",\n        \"selected\": true,\n        \"display\": {\n          \"brand\": \"visa\",\n          \"last_digits\": \"1111\",\n          \"expiry_month\": 12,\n          \"expiry_year\": 2026\n        },\n        \"credential\": {\n          \"type\": \"token\",\n          \"token\": \"tok_a1b2c3d4e5f6\"\n        }\n      }\n    ]\n  },\n  \"risk_signal\": {\n    // ... the key value pair for potential risk signal data\n  }\n}\n</code></pre>"},{"location":"specification/examples/processor-tokenizer-payment-handler/#implementation-guide","title":"Implementation Guide","text":""},{"location":"specification/examples/processor-tokenizer-payment-handler/#scenario-a-enterprise-implementation-self-hosted","title":"Scenario A: Enterprise Implementation (Self-Hosted)","text":"<ul> <li>Role: The Business implements this specification.</li> <li>Requirements:<ol> <li>Deploy the <code>endpoint</code> on their own infrastructure.</li> <li>Internally map tokens to PANs in their own database.</li> </ol> </li> <li>Security: CRITICAL. For card credentials, the Business MUST be     PCI DSS compliant as they are receiving raw PANs at their endpoint.     Other credential types have their own compliance requirements.</li> </ul>"},{"location":"specification/examples/processor-tokenizer-payment-handler/#scenario-b-psp-implementation-third-party","title":"Scenario B: PSP Implementation (Third-Party)","text":"<ul> <li>Role: The PSP implements this specification.</li> <li>Requirements:<ol> <li>Provide the <code>endpoint</code> URL to merchants.</li> <li>Issue <code>identity.access_token</code> (Merchant Secure Identifier) to merchants.</li> <li>Validate that the <code>binding.identity</code> matches the merchant requesting the final payment charge.</li> </ol> </li> <li>Security: PSP bears the compliance burden for credential storage     (e.g., PCI DSS for cards).</li> </ul>"},{"location":"specification/examples/processor-tokenizer-payment-handler/#security-considerations","title":"Security Considerations","text":"Requirement Description TLS/HTTPS All traffic to <code>config.endpoint</code> MUST be encrypted. Compliance The entity hosting <code>config.endpoint</code> MUST be compliant with relevant data standards for the credential type (e.g., PCI DSS for cards, GDPR for PII, etc.). Scope Isolation The Platform's main application MUST NOT see the raw credential; only the Platform's Secure credential provider and the Tokenizer Host may see it. Binding Validation The Tokenizer/Processor MUST verify that the <code>checkout_id</code> submitted during final payment matches the <code>checkout_id</code> provided during tokenization."}]}