
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The Universal Commerce Protocol (UCP) is a solution for enabling gen AI agents to make payments on behalf of users, safely, securely, and in a decentralized and privacy protecting manner. This protocol is a part of the broader ecosystem, which includes agentic protocols like A2A and MCP, and encompasses the global nature of payments.
">
      
      
      
        <link rel="canonical" href="https://ucp.dev/draft/specification/embedded-checkout/">
      
      
        <link rel="prev" href="../checkout-a2a/">
      
      
        <link rel="next" href="../ap2-mandates/">
      
      
        
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>EP Binding - Universal Commerce Protocol (UCP)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      
  
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
    
      
      
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M64%20480c-35.3%200-64-28.7-64-64V96c0-35.3%2028.7-64%2064-64h320c35.3%200%2064%2028.7%2064%2064v213.5c0%2017-6.7%2033.3-18.7%2045.3L322.7%20461.3c-12%2012-28.3%2018.7-45.3%2018.7zm325.5-176H296c-13.3%200-24%2010.7-24%2024v93.5z%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M384%20512H96c-53%200-96-43-96-96V96C0%2043%2043%200%2096%200h304c26.5%200%2048%2021.5%2048%2048v288c0%2020.9-13.4%2038.7-32%2045.3V448c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032zM96%20384c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h256v-64zm32-232c0%2013.3%2010.7%2024%2024%2024h176c13.3%200%2024-10.7%2024-24s-10.7-24-24-24H152c-13.3%200-24%2010.7-24%2024m24%2072c-13.3%200-24%2010.7-24%2024s10.7%2024%2024%2024h176c13.3%200%2024-10.7%2024-24s-10.7-24-24-24z%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m-32-352a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200m-8%2064h48c13.3%200%2024%2010.7%2024%2024v88h8c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-80c-13.3%200-24-10.7-24-24s10.7-24%2024-24h24v-64h-24c-13.3%200-24-10.7-24-24s10.7-24%2024-24%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M461.2%2018.9C472.7%2024%20480%2035.4%20480%2048v416c0%2012.6-7.3%2024-18.8%2029.1s-24.8%203.2-34.3-5.1l-46.6-40.7c-43.6-38.1-98.7-60.3-156.4-63V480c0%2017.7-14.3%2032-32%2032h-32c-17.7%200-32-14.3-32-32v-96C57.3%20384%200%20326.7%200%20256s57.3-128%20128-128h84.5c61.8-.2%20121.4-22.7%20167.9-63.3L427%2024c9.4-8.3%2022.9-10.2%2034.3-5.1zM224%20320v.2c70.3%202.7%20137.8%2028.5%20192%2073.4V118.3c-54.2%2044.9-121.7%2070.7-192%2073.4z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M434.8%2070.1c14.3%2010.4%2017.5%2030.4%207.1%2044.7l-256%20352c-5.5%207.6-14%2012.3-23.4%2013.1s-18.5-2.7-25.1-9.3l-128-128c-12.5-12.5-12.5-32.8%200-45.3s32.8-12.5%2045.3%200l101.5%20101.5%20234-321.7c10.4-14.3%2030.4-17.5%2044.7-7.1z%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m0-336c-17.7%200-32%2014.3-32%2032%200%2013.3-10.7%2024-24%2024s-24-10.7-24-24c0-44.2%2035.8-80%2080-80s80%2035.8%2080%2080c0%2047.2-36%2067.2-56%2074.5v3.8c0%2013.3-10.7%2024-24%2024s-24-10.7-24-24v-8.1c0-20.5%2014.8-35.2%2030.1-40.2%206.4-2.1%2013.2-5.5%2018.2-10.3%204.3-4.2%207.7-10%207.7-19.6%200-17.7-14.3-32-32-32zm-32%20192a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%200c14.7%200%2028.2%208.1%2035.2%2021l216%20400c6.7%2012.4%206.4%2027.4-.8%2039.5S486.1%20480%20472%20480H40c-14.1%200-27.2-7.4-34.4-19.5s-7.5-27.1-.8-39.5l216-400c7-12.9%2020.5-21%2035.2-21m0%20352a32%2032%200%201%200%200%2064%2032%2032%200%201%200%200-64m0-192c-18.2%200-32.7%2015.5-31.4%2033.7l7.4%20104c.9%2012.5%2011.4%2022.3%2023.9%2022.3%2012.6%200%2023-9.7%2023.9-22.3l7.4-104c1.3-18.2-13.1-33.7-31.4-33.7z%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M480-16c6.9%200%2013%204.4%2015.2%2010.9l13.5%2040.4%2040.4%2013.5C555.6%2051%20560%2057.1%20560%2064s-4.4%2013-10.9%2015.2l-40.4%2013.5-13.5%2040.4c-2.2%206.5-8.3%2010.9-15.2%2010.9s-13-4.4-15.2-10.9l-13.5-40.4-40.4-13.5C404.4%2077%20400%2070.9%20400%2064s4.4-13%2010.9-15.2l40.4-13.5%2013.5-40.4C467-11.6%20473.1-16%20480-16M321.4%2097.4c12.5-12.5%2032.8-12.5%2045.3%200l80%2080c12.5%2012.5%2012.5%2032.8%200%2045.3l-10.9%2010.9c7.9%2022%2012.2%2045.7%2012.2%2070.5%200%20114.9-93.1%20208-208%20208S32%20418.9%2032%20304%20125.1%2096%20240%2096c24.7%200%2048.5%204.3%2070.5%2012.3zM144%20304c0-53%2043-96%2096-96%2013.3%200%2024-10.7%2024-24s-10.7-24-24-24c-79.5%200-144%2064.5-144%20144%200%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M416%20427.4c58.5-44%2096-111.6%2096-187.4C512%20107.5%20397.4%200%20256%200S0%20107.5%200%20240c0%2075.8%2037.5%20143.4%2096%20187.4V464c0%2026.5%2021.5%2048%2048%2048h32v-40c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v40h64v-40c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v40h32c26.5%200%2048-21.5%2048-48zM96%20256a64%2064%200%201%201%20128%200%2064%2064%200%201%201-128%200m256-64a64%2064%200%201%201%200%20128%2064%2064%200%201%201%200-128%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M352%200c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v64h-96c-53%200-96%2043-96%2096v224c0%2053%2043%2096%2096%2096h256c53%200%2096-43%2096-96V160c0-53-43-96-96-96h-96zM160%20368c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24M224%20176a48%2048%200%201%201%200%2096%2048%2048%200%201%201%200-96m144%2048a48%2048%200%201%201%2096%200%2048%2048%200%201%201-96%200m-304%200c0-17.7-14.3-32-32-32S0%20206.3%200%20224v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32zm544-32c-17.7%200-32%2014.3-32%2032v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32v-96c0-17.7-14.3-32-32-32%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%200H128c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032v151.5L7.5%20426.3C2.6%20435%200%20444.7%200%20454.7%200%20486.4%2025.6%20512%2057.3%20512h333.4c31.6%200%2057.3-25.6%2057.3-57.3%200-10-2.6-19.8-7.5-28.4L320%20215.5V64c17.7%200%2032-14.3%2032-32S337.7%200%20320%200zm-96%20215.5V64h64v151.5c0%2011.1%202.9%2022.1%208.4%2031.8L306%20320H142l41.6-72.7c5.5-9.7%208.4-20.6%208.4-31.8%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M0%20216C0%20149.7%2053.7%2096%20120%2096h8c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032h-8c-30.9%200-56%2025.1-56%2056v8h64c35.3%200%2064%2028.7%2064%2064v64c0%2035.3-28.7%2064-64%2064H64c-35.3%200-64-28.7-64-64zm256%200c0-66.3%2053.7-120%20120-120h8c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032h-8c-30.9%200-56%2025.1-56%2056v8h64c35.3%200%2064%2028.7%2064%2064v64c0%2035.3-28.7%2064-64%2064h-64c-35.3%200-64-28.7-64-64z%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Google+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Google Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-ZEGTBCTMJ9"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-ZEGTBCTMJ9",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-ZEGTBCTMJ9",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
  
<meta property="og:type" content="website" />
<meta property="og:title" content="EP Binding - Universal Commerce Protocol (UCP)" />
<meta property="og:description" content="The Universal Commerce Protocol (UCP) is a solution for enabling gen AI agents to make payments on behalf of users, safely, securely, and in a decentralized and privacy protecting manner. This protocol is a part of the broader ecosystem, which includes agentic protocols like A2A and MCP, and encompasses the global nature of payments.
" />
<meta property="og:image" content="https://ucp.dev/draft/assets/images/social/specification/embedded-checkout.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="https://ucp.dev/draft/specification/embedded-checkout/" />
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:title" content="EP Binding - Universal Commerce Protocol (UCP)" />
<meta property="twitter:description" content="The Universal Commerce Protocol (UCP) is a solution for enabling gen AI agents to make payments on behalf of users, safely, securely, and in a decentralized and privacy protecting manner. This protocol is a part of the broader ecosystem, which includes agentic protocols like A2A and MCP, and encompasses the global nature of payments.
" />
<meta property="twitter:image" content="https://ucp.dev/draft/assets/images/social/specification/embedded-checkout.png" />
</head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#checkout-capability-ep-binding" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Universal Commerce Protocol (UCP)" class="md-header__button md-logo" aria-label="Universal Commerce Protocol (UCP)" data-md-component="logo">
      
  <img src="../../assets/updated-icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Universal Commerce Protocol (UCP)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              EP Binding
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Universal-Commerce-Protocol/ucp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    UCP on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Universal Commerce Protocol (UCP)" class="md-nav__button md-logo" aria-label="Universal Commerce Protocol (UCP)" data-md-component="logo">
      
  <img src="../../assets/updated-icon.svg" alt="logo">

    </a>
    Universal Commerce Protocol (UCP)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Universal-Commerce-Protocol/ucp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    UCP on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/core-concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../playground/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Playground
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Specification
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Specification
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Checkout Capability
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Checkout Capability
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../checkout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../checkout-rest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HTTP/REST Binding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../checkout-mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Binding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../checkout-a2a/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A2A Binding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    EP Binding
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    EP Binding
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#w3c-payment-request-conceptual-alignment" class="md-nav__link">
    <span class="md-ellipsis">
      
        W3C Payment Request Conceptual Alignment
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terminology-actors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Terminology &amp; Actors
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Terminology &amp; Actors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commerce-roles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Commerce Roles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technical-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Technical Components
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Requirements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Discovery
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Discovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-level-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service-Level Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#per-checkout-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Per-Checkout Configuration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-an-embedded-checkout-url" class="md-nav__link">
    <span class="md-ellipsis">
      
        Loading an Embedded Checkout URL
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Loading an Embedded Checkout URL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Authentication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delegation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delegation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delegation-negotiation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delegation Negotiation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delegation-contract" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delegation Contract
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Delegation Contract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delegation-acceptance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delegation Acceptance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binding-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Binding Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#333-delegation-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3.3 Delegation Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navigation-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Navigation Constraints
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transport-messaging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transport &amp; Messaging
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transport &amp; Messaging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Format
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Response Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#communication-channels" class="md-nav__link">
    <span class="md-ellipsis">
      
        Communication Channels
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Communication Channels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#communication-channel-for-web-based-hosts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Communication Channel for Web-Based Hosts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#communication-channel-for-native-hosts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Communication Channel for Native Hosts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message API Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-categories" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Categories
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Categories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Messages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extension-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extension Messages
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handshake-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handshake Messages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handshake Messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecready" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.ready
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lifecycle-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lifecycle Messages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lifecycle Messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecstart" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eccomplete" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.complete
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-change-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        State Change Messages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="State Change Messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecline_itemschange" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.line_items.change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecbuyerchange" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.buyer.change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecmessageschange" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.messages.change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecpaymentchange" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.payment.change
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#payment-extension" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payment Extension
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Payment Extension">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payment-overview-host-choice" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payment Overview &amp; Host Choice
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payment-message-api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payment Message API Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Payment Message API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecpaymentchange_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.payment.change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecpaymentinstruments_change_request" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.payment.instruments_change_request
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecpaymentcredential_request" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.payment.credential_request
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fulfillment-extension" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fulfillment Extension
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fulfillment Extension">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fulfillment-overview-host-choice" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fulfillment Overview &amp; Host Choice
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fulfillment-message-api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fulfillment Message API Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fulfillment Message API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecfulfillmentchange" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.fulfillment.change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecfulfillmentaddress_change_request" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.fulfillment.address_change_request
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#address-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Address Format
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security &amp; Error Handling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security &amp; Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-for-web-based-hosts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security for Web-Based Hosts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security for Web-Based Hosts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content-security-policy-csp" class="md-nav__link">
    <span class="md-ellipsis">
      
        Content Security Policy (CSP)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iframe-sandbox-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Iframe Sandbox Attributes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credentialless-iframes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Credentialless Iframes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strict-origin-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Strict Origin Validation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention-of-unsolicited-payment-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention of Unsolicited Payment Requests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schema-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Schema Definitions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Definitions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checkout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Checkout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order" class="md-nav__link">
    <span class="md-ellipsis">
      
        Order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payment-instrument" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payment Instrument
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payment-handler-response" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payment Handler Response
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ap2-mandates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AP2 Mandates Extension
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../buyer-consent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Buyer Consent Extension
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../discount/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Discounts Extension
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fulfillment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fulfillment Extension
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cart Capability
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cart Capability
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cart-rest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HTTP/REST Binding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cart-mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Binding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../order/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Order Capability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../identity-linking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identity Linking Capability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Payment Handlers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Payment Handlers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../payment-handler-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../payment-handler-template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Template
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tokenization-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tokenization Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_4" >
        
          
          <label class="md-nav__link" for="__nav_4_6_4" id="__nav_4_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/processor-tokenizer-payment-handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Processor Tokenizer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/platform-tokenizer-payment-handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Platform Tokenizer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/encrypted-credential-handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Encrypted Credential
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/schema-authoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Schema Authoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../versioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Versioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/ucp-and-ap2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UCP and AP2
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/roadmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Roadmap
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#w3c-payment-request-conceptual-alignment" class="md-nav__link">
    <span class="md-ellipsis">
      
        W3C Payment Request Conceptual Alignment
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terminology-actors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Terminology &amp; Actors
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Terminology &amp; Actors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commerce-roles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Commerce Roles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technical-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Technical Components
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Requirements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Discovery
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Discovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-level-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service-Level Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#per-checkout-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Per-Checkout Configuration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-an-embedded-checkout-url" class="md-nav__link">
    <span class="md-ellipsis">
      
        Loading an Embedded Checkout URL
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Loading an Embedded Checkout URL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Authentication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delegation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delegation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delegation-negotiation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delegation Negotiation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delegation-contract" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delegation Contract
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Delegation Contract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delegation-acceptance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delegation Acceptance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binding-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Binding Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#333-delegation-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3.3 Delegation Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navigation-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Navigation Constraints
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transport-messaging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transport &amp; Messaging
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transport &amp; Messaging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Format
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Response Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#communication-channels" class="md-nav__link">
    <span class="md-ellipsis">
      
        Communication Channels
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Communication Channels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#communication-channel-for-web-based-hosts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Communication Channel for Web-Based Hosts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#communication-channel-for-native-hosts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Communication Channel for Native Hosts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message API Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-categories" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message Categories
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Categories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Messages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extension-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extension Messages
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handshake-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handshake Messages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handshake Messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecready" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.ready
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lifecycle-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lifecycle Messages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lifecycle Messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecstart" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eccomplete" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.complete
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-change-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        State Change Messages
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="State Change Messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecline_itemschange" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.line_items.change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecbuyerchange" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.buyer.change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecmessageschange" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.messages.change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecpaymentchange" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.payment.change
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#payment-extension" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payment Extension
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Payment Extension">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payment-overview-host-choice" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payment Overview &amp; Host Choice
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payment-message-api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payment Message API Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Payment Message API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecpaymentchange_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.payment.change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecpaymentinstruments_change_request" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.payment.instruments_change_request
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecpaymentcredential_request" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.payment.credential_request
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fulfillment-extension" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fulfillment Extension
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fulfillment Extension">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fulfillment-overview-host-choice" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fulfillment Overview &amp; Host Choice
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fulfillment-message-api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fulfillment Message API Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fulfillment Message API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecfulfillmentchange" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.fulfillment.change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecfulfillmentaddress_change_request" class="md-nav__link">
    <span class="md-ellipsis">
      
        ec.fulfillment.address_change_request
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#address-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Address Format
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security &amp; Error Handling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security &amp; Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-for-web-based-hosts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security for Web-Based Hosts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security for Web-Based Hosts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content-security-policy-csp" class="md-nav__link">
    <span class="md-ellipsis">
      
        Content Security Policy (CSP)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iframe-sandbox-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Iframe Sandbox Attributes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credentialless-iframes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Credentialless Iframes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strict-origin-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Strict Origin Validation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention-of-unsolicited-payment-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention of Unsolicited Payment Requests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schema-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Schema Definitions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Definitions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checkout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Checkout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order" class="md-nav__link">
    <span class="md-ellipsis">
      
        Order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payment-instrument" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payment Instrument
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payment-handler-response" class="md-nav__link">
    <span class="md-ellipsis">
      
        Payment Handler Response
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../overview/" class="md-path__link">
          
  <span class="md-ellipsis">
    Specification
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../checkout/" class="md-path__link">
          
  <span class="md-ellipsis">
    Checkout Capability
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<!--
   Copyright 2026 UCP Authors

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->

<h1 id="checkout-capability-ep-binding">Checkout Capability - EP Binding<a class="headerlink" href="#checkout-capability-ep-binding" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Embedded Checkout Protocol (ECP) is a checkout-specific implementation of
UCP's Embedded Protocol (EP) transport binding that enables a
<strong>host</strong> to embed a <strong>business's</strong> checkout interface, receive events as the
buyer interacts with the checkout, and delegate key user actions such as address
and payment selection. ECP is a transport binding (like REST)it defines <strong>how</strong>
to communicate, not <strong>what</strong> data exists.</p>
<h3 id="w3c-payment-request-conceptual-alignment">W3C Payment Request Conceptual Alignment<a class="headerlink" href="#w3c-payment-request-conceptual-alignment" title="Permanent link">&para;</a></h3>
<p>ECP draws inspiration from the
<strong><a href="https://www.w3.org/TR/payment-request/" target="_blank">W3C Payment Request API</a></strong>,
adapting its mental model for embedded checkout scenarios. Developers familiar
with Payment Request will recognize similar patterns, though the execution model
differs:</p>
<p><strong>W3C Payment Request:</strong> Browser-controlled. The business calls <code>show()</code> and the
browser renders a native payment sheet. Events flow from the payment handler to
the business.</p>
<p><strong>Embedded Checkout:</strong> Business-controlled. The host embeds the business's
checkout UI in an iframe/webview. Events flow bidirectionally, with optional
delegation allowing the host to handle specific interactions natively.</p>
<!-- cSpell:ignore paymentmethodchange -->
<table>
<thead>
<tr>
<th style="text-align: left;">Concept</th>
<th style="text-align: left;">W3C Payment Request</th>
<th style="text-align: left;">Embedded Checkout</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Initialization</strong></td>
<td style="text-align: left;"><code>new PaymentRequest()</code></td>
<td style="text-align: left;">Load embedded context with <code>continue_url</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>UI Ready</strong></td>
<td style="text-align: left;"><code>show()</code> returns Promise</td>
<td style="text-align: left;"><code>ec.start</code> notification</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Payment Method Change</strong></td>
<td style="text-align: left;"><code>paymentmethodchange</code> event</td>
<td style="text-align: left;"><code>ec.payment.change</code> notification</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Address Change</strong></td>
<td style="text-align: left;"><code>shippingaddresschange</code> event</td>
<td style="text-align: left;"><code>ec.fulfillment.change</code> and <code>ec.fulfillment.address_change_request</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Submit Payment</strong></td>
<td style="text-align: left;">User accepts  <code>PaymentResponse</code></td>
<td style="text-align: left;">Delegated <code>ec.payment.credential_request</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Completion</strong></td>
<td style="text-align: left;"><code>response.complete()</code></td>
<td style="text-align: left;"><code>ec.complete</code> notification</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Errors/Messages</strong></td>
<td style="text-align: left;">Promise rejection</td>
<td style="text-align: left;"><code>ec.messages.change</code> notification</td>
</tr>
</tbody>
</table>
<p><strong>Key difference:</strong> In W3C Payment Request, the browser orchestrates the payment
flow. In Embedded Checkout, the business orchestrates within the embedded
context, optionally delegating specific UI (payment method selection, address
picker) to the host for native experiences.</p>
<h2 id="terminology-actors">Terminology &amp; Actors<a class="headerlink" href="#terminology-actors" title="Permanent link">&para;</a></h2>
<h3 id="commerce-roles">Commerce Roles<a class="headerlink" href="#commerce-roles" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Business:</strong> The seller providing goods/services and the checkout
    experience.</li>
<li><strong>Buyer:</strong> The end user making a purchase.</li>
</ul>
<h3 id="technical-components">Technical Components<a class="headerlink" href="#technical-components" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Host:</strong> The application embedding the checkout (e.g., AI Agent app,
    Super
    App, Browser). Responsible for the <strong>Payment Handler</strong> and user
    authentication.</li>
<li><strong>Embedded Checkout:</strong> The business's checkout interface rendered in an
    iframe or webview. Responsible for the checkout flow and order creation.</li>
<li><strong>Payment Handler:</strong> The secure component that performs user authentication
    (biometric/PIN) and credential issuance.</li>
</ul>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<h3 id="discovery">Discovery<a class="headerlink" href="#discovery" title="Permanent link">&para;</a></h3>
<p>ECP availability is signaled at two levels: service-level discovery declares
capability, checkout responses confirm availability and allowed per-session configuration.</p>
<h4 id="service-level-discovery">Service-Level Discovery<a class="headerlink" href="#service-level-discovery" title="Permanent link">&para;</a></h4>
<p>When a business advertises the <code>embedded</code> transport in their <code>/.well-known/ucp</code>
profile, they declare support for the Embedded Checkout Protocol.</p>
<p><strong>Service Discovery Example:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="nt">&quot;services&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">        </span><span class="nt">&quot;dev.ucp.shopping&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">                </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-01-11&quot;</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">                </span><span class="nt">&quot;transport&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rest&quot;</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">                </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://ucp.dev/services/shopping/rest.openapi.json&quot;</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">                </span><span class="nt">&quot;endpoint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://merchant.example.com/ucp/v1&quot;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">                </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-01-11&quot;</span><span class="p">,</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">                </span><span class="nt">&quot;transport&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mcp&quot;</span><span class="p">,</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">                </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://ucp.dev/services/shopping/mcp.openrpc.json&quot;</span><span class="p">,</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">                </span><span class="nt">&quot;endpoint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://merchant.example.com/ucp/mcp&quot;</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">                </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-01-11&quot;</span><span class="p">,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">                </span><span class="nt">&quot;transport&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;embedded&quot;</span><span class="p">,</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">                </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://ucp.dev/services/shopping/embedded.openrpc.json&quot;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="p">}</span>
</span></code></pre></div>
<p>When <code>embedded</code> is absent from the service definition, the business only
supports redirect-based checkout continuation via <code>continue_url</code>.</p>
<h4 id="per-checkout-configuration">Per-Checkout Configuration<a class="headerlink" href="#per-checkout-configuration" title="Permanent link">&para;</a></h4>
<p>Service-level discovery declares that a business supports ECP, but does not
guarantee that every checkout session will enable it. Businesses <strong>MUST</strong> include
an embedded service binding with <code>config.delegate</code> in checkout responses to
indicate ECP availability and allowed delegations for a specific session.</p>
<p><strong>Checkout Response Example:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;checkout_abc123&quot;</span><span class="p">,</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;open&quot;</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="nt">&quot;continue_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://merchant.example.com/checkout/abc123&quot;</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="nt">&quot;ucp&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">        </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-01-11&quot;</span><span class="p">,</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">        </span><span class="nt">&quot;services&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">            </span><span class="nt">&quot;dev.ucp.shopping&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">                </span><span class="p">{</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">                    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-01-11&quot;</span><span class="p">,</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">                    </span><span class="nt">&quot;transport&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;embedded&quot;</span><span class="p">,</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">                    </span><span class="nt">&quot;config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">                        </span><span class="nt">&quot;delegate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;payment.credential&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;fulfillment.address_change&quot;</span><span class="p">]</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">            </span><span class="p">]</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">        </span><span class="nt">&quot;capabilities&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">        </span><span class="nt">&quot;payment_handlers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>config.delegate</code> array confirms the delegations the business accepted for
this checkout sessionthe intersection of what the host requested via
<code>ec_delegate</code> and what the business allows. This may vary based on:</p>
<ul>
<li><strong>Cart contents</strong>: Some products may require business-handled payment flows</li>
<li><strong>Agent authorization</strong>: Authenticated agents may receive more delegations</li>
<li><strong>Business policy</strong>: Risk rules, regional restrictions, etc.</li>
</ul>
<p>When an embedded service binding with <code>config.delegate</code> is present:</p>
<ul>
<li>ECP is available for this checkout via <code>continue_url</code></li>
<li><code>config.delegate</code> confirms which delegations the business accepted</li>
<li>This mirrors the <code>delegate</code> field in the <code>ec.ready</code> handshake</li>
</ul>
<p>When the embedded service binding is absent from a checkout response (even if
service-level discovery advertises embedded support), the checkout only supports
redirect-based continuation via <code>continue_url</code>.</p>
<h3 id="loading-an-embedded-checkout-url">Loading an Embedded Checkout URL<a class="headerlink" href="#loading-an-embedded-checkout-url" title="Permanent link">&para;</a></h3>
<p>When a host receives a checkout response with an embedded service binding, it
<strong>MAY</strong> initiate an ECP session by loading the <code>continue_url</code> in an embedded
context.</p>
<p>Before loading the embedded context, the host <strong>SHOULD</strong>:</p>
<ol>
<li>Check <code>config.delegate</code> for available delegations</li>
<li>Prepare handlers for delegations the host wants to support</li>
<li>Optionally prepare authentication credentials if required by the business</li>
</ol>
<p>To initiate the session, the host <strong>MUST</strong> augment the <code>continue_url</code> with ECP
query parameters using the <code>ec_</code> prefix.</p>
<p>All ECP parameters are passed via URL query string, not HTTP headers, to ensure
maximum compatibility across different embedding environments. Parameters use
the <code>ec_</code> prefix to avoid namespace pollution and clearly distinguish ECP
parameters from business-specific query parameters:</p>
<ul>
<li><code>ec_version</code> (string, <strong>REQUIRED</strong>): The UCP version for this session
    (format: <code>YYYY-MM-DD</code>). Must match the version from the checkout response.</li>
<li><code>ec_auth</code> (string, <strong>OPTIONAL</strong>): Authentication token in business-defined
    format</li>
<li><code>ec_delegate</code> (string, <strong>OPTIONAL</strong>): Comma-delimited list of delegations
    the host wants to handle. <strong>SHOULD</strong> be a subset of <code>config.delegate</code>
    from the embedded service binding.</li>
</ul>
<h4 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h4>
<p><strong>Token Format:</strong></p>
<ul>
<li>The <code>auth</code> parameter format is entirely business-defined</li>
<li>Common formats include JWT, OAuth tokens, API keys, or session identifiers</li>
<li>Businesses <strong>MUST</strong> document their expected token format and validation process</li>
</ul>
<p><strong>Example (Informative - JWT-based):</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">// One possible implementation using JWT</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HS256&quot;</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="nt">&quot;typ&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;JWT&quot;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="p">}</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="p">{</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1234567890</span><span class="p">,</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1234568190</span><span class="p">,</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">  </span><span class="nt">&quot;jti&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unique-id&quot;</span><span class="p">,</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">  </span><span class="c1">// ... business-specific claims ...</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="p">}</span>
</span></code></pre></div>
<p>Businesses <strong>MUST</strong> validate authentication according to their security
requirements.</p>
<p><strong>Example initialization with authentication:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>https://example.com/checkout/abc123?ec_version=2026-01-11&amp;ec_auth=eyJ...
</span></code></pre></div>
<p>Note: All query parameter values must be properly URL-encoded per RFC 3986.</p>
<h4 id="delegation">Delegation<a class="headerlink" href="#delegation" title="Permanent link">&para;</a></h4>
<p>The optional <code>ec_delegate</code> parameter declares which operations the host wants
to handle natively, instead of having a buyer handle them in the Embedded
Checkout UI. Each delegation identifier maps to a corresponding <code>_request</code>
message following a consistent pattern: <code>ec.{delegation}_request</code></p>
<p><strong>Example delegation identifiers:</strong></p>
<table>
<thead>
<tr>
<th><code>ec_delegate</code> value</th>
<th>Corresponding message</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>payment.instruments_change</code></td>
<td><code>ec.payment.instruments_change_request</code></td>
</tr>
<tr>
<td><code>payment.credential</code></td>
<td><code>ec.payment.credential_request</code></td>
</tr>
<tr>
<td><code>fulfillment.address_change</code></td>
<td><code>ec.fulfillment.address_change_request</code></td>
</tr>
</tbody>
</table>
<p>Extensions define their own delegation identifiers; see each extension's
specification for available options.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>?ec_version=2026-01-11&amp;ec_delegate=payment.instruments_change,payment.credential,fulfillment.address_change
</span></code></pre></div>
<h4 id="delegation-negotiation">Delegation Negotiation<a class="headerlink" href="#delegation-negotiation" title="Permanent link">&para;</a></h4>
<p>Delegation follows a narrowing chain from business policy to final acceptance:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>config.delegate  ec_delegate  ec.ready delegate
</span></code></pre></div>
<ol>
<li><strong>Business allows</strong> (<code>config.delegate</code> in checkout response): The set of
    delegations the business permits for this checkout session</li>
<li><strong>Host requests</strong> (<code>ec_delegate</code> URL parameter): The subset the host wants
    to handle natively</li>
<li><strong>ECP accepts</strong> (<code>delegate</code> in <code>ec.ready</code>): The final subset the Embedded
    Checkout will actually delegate</li>
</ol>
<p>Each stage is a subset of the previous:</p>
<ul>
<li>The host <strong>SHOULD</strong> only request delegations present in <code>config.delegate</code></li>
<li>The business <strong>SHOULD NOT</strong> accept delegations not present in
    <code>config.delegate</code> and <strong>MUST</strong> confirm accepted delegations in <code>ec.ready</code></li>
</ul>
<h3 id="delegation-contract">Delegation Contract<a class="headerlink" href="#delegation-contract" title="Permanent link">&para;</a></h3>
<p>Delegation creates a binding contract between the host and Embedded Checkout.
However, the Embedded Checkout <strong>MAY</strong> restrict delegation to authenticated or
approved hosts based on business policy.</p>
<h4 id="delegation-acceptance">Delegation Acceptance<a class="headerlink" href="#delegation-acceptance" title="Permanent link">&para;</a></h4>
<p>The Embedded Checkout determines which delegations to honor based on:</p>
<ul>
<li>Authentication status (via <code>ec_auth</code> parameter)</li>
<li>host authorization level</li>
<li>Business policy</li>
</ul>
<p>The Embedded Checkout <strong>MUST</strong> indicate accepted delegations in the <code>ec.ready</code>
request via the <code>delegate</code> field (see <a href="#ecready"><code>ec.ready</code></a>). If a
requested delegation is not accepted, the Embedded Checkout <strong>MUST</strong> handle that
capability using its own UI.</p>
<h4 id="binding-requirements">Binding Requirements<a class="headerlink" href="#binding-requirements" title="Permanent link">&para;</a></h4>
<p><strong>Once delegation is accepted</strong>, both parties enter a binding contract:</p>
<p><strong>Embedded Checkout responsibilities:</strong></p>
<ol>
<li><strong>MUST</strong> fire the appropriate <code>{action}_request</code> message when that action is
    triggered</li>
<li><strong>MUST</strong> wait for the host's response before proceeding</li>
<li><strong>MUST NOT</strong> show its own UI for that delegated action</li>
</ol>
<p><strong>Host responsibilities:</strong></p>
<ol>
<li><strong>MUST</strong> respond to every <code>{action}_request</code> message it receives</li>
<li><strong>MUST</strong> respond with an appropriate error if the user cancels</li>
<li><strong>SHOULD</strong> show loading/processing states while handling delegation</li>
</ol>
<h4 id="333-delegation-flow">3.3.3 Delegation Flow<a class="headerlink" href="#333-delegation-flow" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Request</strong>: Embedded Checkout sends an <code>ec.{capability}.{action}_request</code>
    message with current state (includes <code>id</code>)</li>
<li><strong>Native UI</strong>: Host presents native UI for the delegated action</li>
<li><strong>Response</strong>: host sends back a JSON-RPC response with matching <code>id</code> and
    <code>result</code> or <code>error</code></li>
<li><strong>Update</strong>: Embedded Checkout updates its state and may send subsequent
    change notifications</li>
</ol>
<p>See <a href="#payment-extension">Payment Extension</a> and
<a href="#fulfillment-extension">Fulfillment Extension</a> for
capability-specific delegation details.</p>
<h3 id="navigation-constraints">Navigation Constraints<a class="headerlink" href="#navigation-constraints" title="Permanent link">&para;</a></h3>
<p>When checkout is rendered in embedded mode, the implementation <strong>SHOULD</strong>
prevent off-checkout navigation to maintain a focused checkout experience.
The embedded view is intended to provide a checkout flow, not a general-purpose
browser.</p>
<p><strong>Navigation Requirements:</strong></p>
<ul>
<li>The embedded checkout <strong>SHOULD</strong> block or intercept navigation attempts to
    URLs outside the checkout flow</li>
<li>The embedded checkout <strong>SHOULD</strong> remove or disable UI elements that would
    navigate away from checkout (e.g., external links, navigation bars)</li>
<li>The embedder <strong>MAY</strong> implement additional navigation restrictions at the
    container level</li>
</ul>
<p><strong>Permitted Exceptions:</strong> The following navigation scenarios <strong>MAY</strong> be allowed
when required for checkout completion:</p>
<ul>
<li>Payment provider redirects: off-site payment flows</li>
<li>3D Secure verification: card authentication frames and redirects</li>
<li>Bank authorization: open banking or similar authorization flows</li>
<li>Identity verification: KYC/AML compliance checks when required</li>
</ul>
<p>These exceptions <strong>SHOULD</strong> return the user to the checkout flow upon
completion.</p>
<h2 id="transport-messaging">Transport &amp; Messaging<a class="headerlink" href="#transport-messaging" title="Permanent link">&para;</a></h2>
<h3 id="message-format">Message Format<a class="headerlink" href="#message-format" title="Permanent link">&para;</a></h3>
<p>All ECP messages <strong>MUST</strong> use JSON-RPC 2.0 format
(<a href="https://datatracker.ietf.org/doc/html/rfc7159">RFC 7159</a>). Each message <strong>MUST</strong> contain:</p>
<ul>
<li><code>jsonrpc</code>: <strong>MUST</strong> be <code>"2.0"</code></li>
<li><code>method</code>: The message name (e.g., <code>"ec.start"</code>)</li>
<li><code>params</code>: Message-specific payload (may be empty object)</li>
<li><code>id</code>: (Optional) Present only for requests that expect responses</li>
</ul>
<h3 id="message-types">Message Types<a class="headerlink" href="#message-types" title="Permanent link">&para;</a></h3>
<p><strong>Requests</strong> (with <code>id</code> field):</p>
<ul>
<li>Require a response from the receiver</li>
<li><strong>MUST</strong> include a unique <code>id</code> field</li>
<li>Receiver <strong>MUST</strong> respond with matching <code>id</code></li>
<li>Response <strong>MUST</strong> be either a <code>result</code> or <code>error</code> object</li>
<li>Used for operations requiring acknowledgment or data</li>
</ul>
<p><strong>Notifications</strong> (without <code>id</code> field):</p>
<ul>
<li>Informational only, no response expected</li>
<li><strong>MUST NOT</strong> include an <code>id</code> field</li>
<li>Receiver <strong>MUST NOT</strong> send a response</li>
<li>Used for state updates and informational events</li>
</ul>
<h3 id="response-handling">Response Handling<a class="headerlink" href="#response-handling" title="Permanent link">&para;</a></h3>
<p>For requests (messages with <code>id</code>), receivers <strong>MUST</strong> respond with either:</p>
<p><strong>Success Response:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span><span class="w"> </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>Error Response:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">{</span><span class="w"> </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<h3 id="communication-channels">Communication Channels<a class="headerlink" href="#communication-channels" title="Permanent link">&para;</a></h3>
<h4 id="communication-channel-for-web-based-hosts">Communication Channel for Web-Based Hosts<a class="headerlink" href="#communication-channel-for-web-based-hosts" title="Permanent link">&para;</a></h4>
<p>When the host is a web application, communication starts using <code>postMessage</code>
between the host and Checkout windows. The host <strong>MUST</strong> listen for
<code>postMessage</code> calls from the embedded window, and when a message is received,
they <strong>MUST</strong> validate the origin matches the <code>checkout_url</code> used to start the
checkout.</p>
<p>Upon validation, the host <strong>MAY</strong> create a <code>MessageChannel</code>, and transfer one of
its ports in the result of the <a href="#ecready"><code>ec.ready</code> response</a>. When a host
responds with a <code>MessagePort</code>, all subsequent messages <strong>MUST</strong> be sent over
that channel. Otherwise, the host and business <strong>MUST</strong> continue using
<code>postMessage()</code> between their <code>window</code> objects, including origin validation.</p>
<h4 id="communication-channel-for-native-hosts">Communication Channel for Native Hosts<a class="headerlink" href="#communication-channel-for-native-hosts" title="Permanent link">&para;</a></h4>
<p>When the host is a native application, they MUST inject globals into the
Embedded Checkout that allows <code>postMessage</code> communication between the web and
native environments. The host <strong>MUST</strong> create at least one of the following
globals:</p>
<ul>
<li><code>window.EmbeddedCheckoutProtocolConsumer</code> (preferred)</li>
<li><code>window.webkit.messageHandlers.EmbeddedCheckoutProtocolConsumer</code></li>
</ul>
<p>This object <strong>MUST</strong> implement the following interface:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="nx">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="p">}</span>
</span></code></pre></div>
<p>Where <code>message</code> is a JSON-stringified JSON-RPC 2.0 message. The host <strong>MUST</strong>
parse the JSON string before processing.</p>
<p>For messages traveling from the host to the Embedded Checkout, the host <strong>MUST</strong>
inject JavaScript in the webview that will call
<code>window.EmbeddedCheckoutProtocol.postMessage()</code> with the JSON RPC message. The
Embedded Checkout <strong>MUST</strong> initialize this global object  and start listening
for <code>postMessage()</code> calls  before the <code>ec.ready</code> message is sent.</p>
<h2 id="message-api-reference">Message API Reference<a class="headerlink" href="#message-api-reference" title="Permanent link">&para;</a></h2>
<h3 id="message-categories">Message Categories<a class="headerlink" href="#message-categories" title="Permanent link">&para;</a></h3>
<h4 id="core-messages">Core Messages<a class="headerlink" href="#core-messages" title="Permanent link">&para;</a></h4>
<p>Core messages are defined by the ECP specification and <strong>MUST</strong> be supported by
all implementations. All messages are sent from Embedded Checkout to host.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Purpose</th>
<th style="text-align: left;">Pattern</th>
<th style="text-align: left;">Core Messages</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Handshake</strong></td>
<td style="text-align: left;">Establish connection between host and Embedded Checkout</td>
<td style="text-align: left;">Request</td>
<td style="text-align: left;"><code>ec.ready</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Lifecycle</strong></td>
<td style="text-align: left;">Inform of checkout state transitions</td>
<td style="text-align: left;">Notification</td>
<td style="text-align: left;"><code>ec.start</code>, <code>ec.complete</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>State Change</strong></td>
<td style="text-align: left;">Inform of checkout field changes</td>
<td style="text-align: left;">Notification</td>
<td style="text-align: left;"><code>ec.line_items.change</code>, <code>ec.buyer.change</code>, <code>ec.payment.change</code>, <code>ec.messages.change</code></td>
</tr>
</tbody>
</table>
<h4 id="extension-messages">Extension Messages<a class="headerlink" href="#extension-messages" title="Permanent link">&para;</a></h4>
<p>Extensions <strong>MAY</strong> extend the Embedded protocol by defining additional messages.
Extension messages <strong>MUST</strong> follow the naming convention:</p>
<ul>
<li><strong>Notifications</strong>: <code>ec.{capability}.change</code>  state change notifications (no
    <code>id</code>)</li>
<li><strong>Delegation requests</strong>: <code>ec.{capability}.{action}_request</code>  requires
    response (has <code>id</code>)</li>
</ul>
<p>Where:</p>
<ul>
<li><code>{capability}</code> matches the capability identifier from discovery</li>
<li><code>{action}</code> describes the specific action being delegated (e.g.,
    <code>instruments_change</code>, <code>address_change</code>)</li>
<li><code>_request</code> suffix signals this is a delegation point requiring a response</li>
</ul>
<h3 id="handshake-messages">Handshake Messages<a class="headerlink" href="#handshake-messages" title="Permanent link">&para;</a></h3>
<h4 id="ecready"><code>ec.ready</code><a class="headerlink" href="#ecready" title="Permanent link">&para;</a></h4>
<p>Upon rendering, the Embedded Checkout <strong>MUST</strong> broadcast readiness to the parent
context using the <code>ec.ready</code> message. This message initializes a secure
communication channel between the host and Embedded Checkout, communicates which
delegations were accepted, and allows the host to provide additional,
display-only state for the checkout that was not communicated over UCP checkout
actions.</p>
<ul>
<li><strong>Direction:</strong> Embedded Checkout  host</li>
<li><strong>Type:</strong> Request</li>
<li><strong>Payload:</strong><ul>
<li><code>delegate</code> (array of strings, <strong>REQUIRED</strong>): List of delegation
    identifiers accepted by the Embedded Checkout. <strong>MUST</strong> be a subset of
    both <code>ec_delegate</code> (what host requested) and <code>config.delegate</code> from the
    checkout response (what business allows). An empty array means no
    delegations were accepted.</li>
</ul>
</li>
</ul>
<p><strong>Example Message (no delegations accepted):</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ready_1&quot;</span><span class="p">,</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec.ready&quot;</span><span class="p">,</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">        </span><span class="nt">&quot;delegate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Example Message (delegations accepted):</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ready_1&quot;</span><span class="p">,</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec.ready&quot;</span><span class="p">,</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">        </span><span class="nt">&quot;delegate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;payment.credential&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;fulfillment.address_change&quot;</span><span class="p">]</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>ec.ready</code> message is a request, which means that the host <strong>MUST</strong> respond
to complete the handshake.</p>
<ul>
<li><strong>Direction:</strong> host  Embedded Checkout</li>
<li><strong>Type:</strong> Response</li>
<li><strong>Result Payload:</strong><ul>
<li><code>upgrade</code> (object, <strong>OPTIONAL</strong>): An object describing how the Embedded
    Checkout should update the communication channel it uses to communicate
    with the host.</li>
<li><code>checkout</code> (object, <strong>OPTIONAL</strong>): Additional, display-only state for
    the checkout that was not communicated over UCP checkout actions. This
    is used to populate the checkout UI, and may only be used to populate
    the following fields, under specific conditions:<ul>
<li><code>payment.instruments</code>: can be overwritten when the host and Embedded
    Checkout both accept the <code>payment.instruments_change</code> delegation.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Example Message:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ready_1&quot;</span><span class="p">,</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>Hosts <strong>MAY</strong> respond with an <code>upgrade</code> field to update the communication
channel between host and Embedded Checkout. Currently, this object only supports
a <code>port</code> field, which <strong>MUST</strong> be a <code>MessagePort</code> object, and <strong>MUST</strong> be
transferred to the embedded checkout context (e.g., with <code>{transfer: [port2]}</code>
on the host's <code>iframe.contentWindow.postMessage()</code> call):</p>
<p><strong>Example Message:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="p">{</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ready_1&quot;</span><span class="p">,</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">        </span><span class="nt">&quot;upgrade&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">            </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;[Transferable MessagePort]&quot;</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="p">}</span>
</span></code></pre></div>
<p>When the host responds with an <code>upgrade</code> object, the Embedded Checkout <strong>MUST</strong>
discard any other information in the message, send a new <code>ec.ready</code> message
over the upgraded communication channel, and wait for a new response. All
subsequent messages <strong>MUST</strong> be sent only over the upgraded communication
channel.</p>
<p>The host <strong>MAY</strong> also respond with a <code>checkout</code> object, which will be used to
populate the checkout UI according to the delegation contract between host and
business.</p>
<p><strong>Example Message: Providing payment instruments, including display
information:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ready_1&quot;</span><span class="p">,</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">    </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">            </span><span class="nt">&quot;payment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">                </span><span class="c1">// The instrument structure is defined by the handler&#39;s instrument schema</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">                </span><span class="nt">&quot;instruments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">                        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_instrument_123&quot;</span><span class="p">,</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">                        </span><span class="nt">&quot;handler_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;merchant_psp_handler_123&quot;</span><span class="p">,</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;card&quot;</span><span class="p">,</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">                        </span><span class="nt">&quot;selected&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">                        </span><span class="nt">&quot;display&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">                            </span><span class="nt">&quot;brand&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;visa&quot;</span><span class="p">,</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">                            </span><span class="nt">&quot;expiry_month&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">                            </span><span class="nt">&quot;expiry_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2026</span><span class="p">,</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">                            </span><span class="nt">&quot;last_digits&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1111&quot;</span><span class="p">,</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="w">                            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Visa  1111&quot;</span><span class="p">,</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="w">                            </span><span class="nt">&quot;card_art&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://host.com/cards/visa-gold.png&quot;</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="w">                </span><span class="p">]</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="lifecycle-messages">Lifecycle Messages<a class="headerlink" href="#lifecycle-messages" title="Permanent link">&para;</a></h3>
<h4 id="ecstart"><code>ec.start</code><a class="headerlink" href="#ecstart" title="Permanent link">&para;</a></h4>
<p>Signals that checkout is visible and ready for interaction.</p>
<ul>
<li><strong>Direction:</strong> Embedded Checkout  host</li>
<li><strong>Type:</strong> Notification</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The latest state of the checkout, using the same structure
    as the <code>checkout</code> object in UCP responses.</li>
</ul>
</li>
</ul>
<p><strong>Example Message:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec.start&quot;</span><span class="p">,</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;checkout_123&quot;</span><span class="p">,</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">            </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;incomplete&quot;</span><span class="p">,</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">            </span><span class="nt">&quot;messages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">                </span><span class="p">{</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">                    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;missing&quot;</span><span class="p">,</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">                    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$.buyer.shipping_address&quot;</span><span class="p">,</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">                    </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Shipping address is required&quot;</span><span class="p">,</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">                    </span><span class="nt">&quot;severity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;recoverable&quot;</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">            </span><span class="p">],</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">            </span><span class="nt">&quot;totals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="cm">/* ... */</span><span class="p">],</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">            </span><span class="nt">&quot;line_items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="cm">/* ... */</span><span class="p">],</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">            </span><span class="nt">&quot;buyer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="cm">/* ... */</span><span class="p">},</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">            </span><span class="nt">&quot;payment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="cm">/* ... */</span><span class="p">}</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="eccomplete"><code>ec.complete</code><a class="headerlink" href="#eccomplete" title="Permanent link">&para;</a></h4>
<p>Indicates successful checkout completion.</p>
<ul>
<li><strong>Direction:</strong> Embedded Checkout  host</li>
<li><strong>Type:</strong> Notification</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The latest state of the checkout, using the same structure
    as the <code>checkout</code> object in UCP responses.</li>
</ul>
</li>
</ul>
<p><strong>Example Message:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="p">{</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec.complete&quot;</span><span class="p">,</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;checkout_123&quot;</span><span class="p">,</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">            </span><span class="c1">// ... other checkout fields</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">            </span><span class="nt">&quot;order&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">                </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ord_99887766&quot;</span><span class="p">,</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">                </span><span class="nt">&quot;permalink_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://merchant.com/orders/ord_99887766&quot;</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="state-change-messages">State Change Messages<a class="headerlink" href="#state-change-messages" title="Permanent link">&para;</a></h3>
<p>State change messages inform the embedder of changes that have already occurred
in the checkout interface. These are informational only. The checkout has
already applied the changes and rendered the updated UI.</p>
<h4 id="ecline_itemschange"><code>ec.line_items.change</code><a class="headerlink" href="#ecline_itemschange" title="Permanent link">&para;</a></h4>
<p>Line items have been modified (quantity changed, items added/removed) in the
checkout UI.</p>
<ul>
<li><strong>Direction:</strong> Embedded Checkout  host</li>
<li><strong>Type:</strong> Notification</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The latest state of the checkout</li>
</ul>
</li>
</ul>
<p><strong>Example Message:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="p">{</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec.line_items.change&quot;</span><span class="p">,</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;checkout_123&quot;</span><span class="p">,</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">            </span><span class="c1">// The entire checkout object is provided, including the updated line items and totals</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">            </span><span class="nt">&quot;totals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">                </span><span class="cm">/* ... */</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">            </span><span class="p">],</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">            </span><span class="nt">&quot;line_items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">                </span><span class="cm">/* ... */</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">            </span><span class="p">]</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">            </span><span class="c1">// ...</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="ecbuyerchange"><code>ec.buyer.change</code><a class="headerlink" href="#ecbuyerchange" title="Permanent link">&para;</a></h4>
<p>Buyer information has been updated in the checkout UI.</p>
<ul>
<li><strong>Direction:</strong> Embedded Checkout  host</li>
<li><strong>Type:</strong> Notification</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The latest state of the checkout</li>
</ul>
</li>
</ul>
<p><strong>Example Message:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="p">{</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec.buyer.change&quot;</span><span class="p">,</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;checkout_123&quot;</span><span class="p">,</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">            </span><span class="c1">// The entire checkout object is provided, including the updated buyer information</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">            </span><span class="nt">&quot;buyer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">                </span><span class="cm">/* ... */</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">            </span><span class="c1">// ...</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="ecmessageschange"><code>ec.messages.change</code><a class="headerlink" href="#ecmessageschange" title="Permanent link">&para;</a></h4>
<p>Checkout messages have been updated. Messages include errors, warnings, and
informational notices about the checkout state.</p>
<ul>
<li><strong>Direction:</strong> Embedded Checkout  host</li>
<li><strong>Type:</strong> Notification</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The latest state of the checkout</li>
</ul>
</li>
</ul>
<p><strong>Example Message:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec.messages.change&quot;</span><span class="p">,</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;checkout_123&quot;</span><span class="p">,</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">            </span><span class="nt">&quot;messages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">                </span><span class="p">{</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">                    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;invalid_address&quot;</span><span class="p">,</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">                    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$.buyer.shipping_address&quot;</span><span class="p">,</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">                    </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;We cannot ship to this address&quot;</span><span class="p">,</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">                    </span><span class="nt">&quot;severity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;recoverable&quot;</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">                </span><span class="p">{</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">                    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;free_shipping&quot;</span><span class="p">,</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">                    </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Free shipping applied!&quot;</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">            </span><span class="p">]</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">            </span><span class="c1">// ...</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="ecpaymentchange"><code>ec.payment.change</code><a class="headerlink" href="#ecpaymentchange" title="Permanent link">&para;</a></h4>
<p>Payment state has been updated. See <a href="#ecpaymentchange"><code>ec.payment.change</code></a> for
full documentation.</p>
<h2 id="payment-extension">Payment Extension<a class="headerlink" href="#payment-extension" title="Permanent link">&para;</a></h2>
<p>The payment extension defines how a host can use state change notifications and
delegation requests to orchestrate user escalation flows. When a checkout URL
includes <code>ec_delegate=payment.instruments_change,payment.credential</code>, the host
gains control over payment method selection and token acquisition, providing
state updates to the Embedded Checkout in response.</p>
<h3 id="payment-overview-host-choice">Payment Overview &amp; Host Choice<a class="headerlink" href="#payment-overview-host-choice" title="Permanent link">&para;</a></h3>
<p>Payment delegation allows for two different patterns of orchestrating the host
and Embedded Checkout:</p>
<p><strong>Option A: Host Delegates to Embedded Checkout</strong> The host does NOT include
payment delegation in the URL. The Embedded Checkout handles payment selection
and processing using its own UI and payment flows. This is the standard,
non-delegated flow.</p>
<p><strong>Option B: Host Takes Control</strong> The host includes
<code>ec_delegate=payment.instruments_change,payment.credential</code> in the Checkout URL,
informing the Embedded Checkout to delegate payment UI and token acquisition to
the host. When delegated:</p>
<ul>
<li><strong>Embedded Checkout responsibilities</strong>:<ul>
<li>Display current payment method with a change intent (e.g., "Change
    Payment Method" button)</li>
<li>Wait for a response to the <code>ec.payment.credential_request</code> message
    before submitting the payment</li>
</ul>
</li>
<li><strong>Host responsibilities</strong>:<ul>
<li>Respond to the <code>ec.payment.instruments_change_request</code> by rendering
    native UI for the buyer to select alternative payment methods, then
    respond with the selected method</li>
<li>Respond to the <code>ec.payment.credential_request</code> by obtaining a payment
    token for the selected payment method, and sending that token to the
    Embedded Checkout</li>
</ul>
</li>
</ul>
<h3 id="payment-message-api-reference">Payment Message API Reference<a class="headerlink" href="#payment-message-api-reference" title="Permanent link">&para;</a></h3>
<h4 id="ecpaymentchange_1"><code>ec.payment.change</code><a class="headerlink" href="#ecpaymentchange_1" title="Permanent link">&para;</a></h4>
<p>Informs the host that something has changed in the payment section of the
checkout UI, such as a new payment method being selected.</p>
<ul>
<li><strong>Direction:</strong> Embedded Checkout  host</li>
<li><strong>Type:</strong> Notification</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The latest state of the checkout</li>
</ul>
</li>
</ul>
<p><strong>Example Message:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec.payment.change&quot;</span><span class="p">,</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;checkout_123&quot;</span><span class="p">,</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">            </span><span class="c1">// The entire checkout object is provided, including the updated payment details</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">            </span><span class="nt">&quot;payment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">                </span><span class="nt">&quot;instruments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">                        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_instrument_123&quot;</span><span class="p">,</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">                        </span><span class="nt">&quot;selected&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">                        </span><span class="cm">/* ... */</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">                </span><span class="p">]</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">            </span><span class="c1">// ...</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="ecpaymentinstruments_change_request"><code>ec.payment.instruments_change_request</code><a class="headerlink" href="#ecpaymentinstruments_change_request" title="Permanent link">&para;</a></h4>
<p>Requests the host to present payment instrument selection UI.</p>
<ul>
<li><strong>Direction:</strong> Embedded Checkout  host</li>
<li><strong>Type:</strong> Request</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The latest state of the checkout</li>
</ul>
</li>
</ul>
<p><strong>Example Message:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="p">{</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_instruments_change_request_1&quot;</span><span class="p">,</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec.payment.instruments_change_request&quot;</span><span class="p">,</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;checkout_123&quot;</span><span class="p">,</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">            </span><span class="c1">// The entire checkout object is provided, including the current payment details</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">            </span><span class="nt">&quot;payment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">                </span><span class="cm">/* ... */</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">            </span><span class="c1">// ...</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="p">}</span>
</span></code></pre></div>
<p>The host <strong>MUST</strong> respond with either an error, or the newly-selected payment
instruments. In successful responses, the host <strong>MUST</strong> respond with a partial
update to the <code>checkout</code> object, with only the <code>payment.instruments</code> field updated. The Embedded Checkout <strong>MUST</strong>
treat this update as a PUT-style change by entirely replacing the existing state
for the provided fields, rather than attempting to merge the new data with
existing state.</p>
<ul>
<li><strong>Direction:</strong> host  Embedded Checkout</li>
<li><strong>Type:</strong> Response</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The update to apply to the checkout object</li>
</ul>
</li>
</ul>
<p><strong>Example Success Response:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_instruments_change_request_1&quot;</span><span class="p">,</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">            </span><span class="nt">&quot;payment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">                </span><span class="c1">// The instrument structure is defined by the handler&#39;s instrument schema</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">                </span><span class="nt">&quot;instruments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">                        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_instrument_123&quot;</span><span class="p">,</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">                        </span><span class="nt">&quot;handler_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;merchant_psp_handler_123&quot;</span><span class="p">,</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;card&quot;</span><span class="p">,</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">                        </span><span class="nt">&quot;selected&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">                        </span><span class="nt">&quot;display&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">                            </span><span class="nt">&quot;brand&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;visa&quot;</span><span class="p">,</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">                            </span><span class="nt">&quot;expiry_month&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="w">                            </span><span class="nt">&quot;expiry_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2026</span><span class="p">,</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">                            </span><span class="nt">&quot;last_digits&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1111&quot;</span><span class="p">,</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">                            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Visa  1111&quot;</span><span class="p">,</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">                            </span><span class="nt">&quot;card_art&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://host.com/cards/visa-gold.png&quot;</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">                        </span><span class="c1">// No `credential` yet; it will be attached in the `ec.payment.credential_request` response</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="w">                </span><span class="p">]</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Example Error Response:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="p">{</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_instruments_change_request_1&quot;</span><span class="p">,</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">    </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">        </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abort_error&quot;</span><span class="p">,</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">        </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User closed the payment sheet without authorizing.&quot;</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="ecpaymentcredential_request"><code>ec.payment.credential_request</code><a class="headerlink" href="#ecpaymentcredential_request" title="Permanent link">&para;</a></h4>
<p>Requests a credential for the selected payment instrument during checkout
submission.</p>
<ul>
<li><strong>Direction:</strong> Embedded Checkout  Host</li>
<li><strong>Type:</strong> Request</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The latest state of the checkout</li>
</ul>
</li>
</ul>
<p><strong>Example Message:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="p">{</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_credential_request_1&quot;</span><span class="p">,</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec.payment.credential_request&quot;</span><span class="p">,</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;checkout_123&quot;</span><span class="p">,</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">            </span><span class="c1">// The entire checkout object is provided, including the current payment details</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">            </span><span class="nt">&quot;payment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">                </span><span class="nt">&quot;instruments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">                        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_instrument_123&quot;</span><span class="p">,</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">                        </span><span class="nt">&quot;selected&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">                        </span><span class="cm">/* ... */</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">                </span><span class="p">]</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">            </span><span class="c1">// ...</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="p">}</span>
</span></code></pre></div>
<p>The host <strong>MUST</strong> respond with either an error, or the credential for the
selected payment instrument. In successful responses, the host <strong>MUST</strong> supply a
partial update to the <code>checkout</code> object, updating the instrument with
<code>selected: true</code> with the new <code>credentials</code> field. The Embedded Checkout
<strong>MUST</strong> treat this update as a PUT-style change by entirely replacing the
existing state for <code>payment.instruments</code>, rather than attempting to merge the
new data with existing state.</p>
<ul>
<li><strong>Direction:</strong> host  Embedded Checkout</li>
<li><strong>Type:</strong> Response</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The update to apply to the checkout object</li>
</ul>
</li>
</ul>
<p><strong>Example Success Response:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="p">{</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_credential_request_1&quot;</span><span class="p">,</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">    </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">            </span><span class="nt">&quot;payment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">                </span><span class="nt">&quot;instruments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="w">                        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_instrument_123&quot;</span><span class="p">,</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="w">                        </span><span class="nt">&quot;handler_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;merchant_psp_handler_123&quot;</span><span class="p">,</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;card&quot;</span><span class="p">,</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">                        </span><span class="nt">&quot;selected&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="w">                        </span><span class="nt">&quot;display&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="w">                            </span><span class="nt">&quot;brand&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;visa&quot;</span><span class="p">,</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="w">                            </span><span class="nt">&quot;expiry_month&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w">                            </span><span class="nt">&quot;expiry_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2026</span><span class="p">,</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w">                            </span><span class="nt">&quot;last_digits&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1111&quot;</span><span class="p">,</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="w">                            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Visa  1111&quot;</span><span class="p">,</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="w">                            </span><span class="nt">&quot;card_art&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://host.com/cards/visa-gold.png&quot;</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="w">                        </span><span class="c1">// The credential structure is defined by the handler&#39;s instrument schema</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="w">                        </span><span class="nt">&quot;credential&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="w">                            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="w">                            </span><span class="nt">&quot;token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tok_123&quot;</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="w">                </span><span class="p">]</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Example Error Response:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="p">{</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_credential_request_1&quot;</span><span class="p">,</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">    </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">        </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abort_error&quot;</span><span class="p">,</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">        </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User closed the payment sheet without authorizing.&quot;</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Host responsibilities during payment token delegation:</strong></p>
<ol>
<li><strong>Confirmation:</strong> Host displays the Trusted Payment UI (Payment Sheet /
    Biometric Prompt). The host <strong>MUST NOT</strong> silently release a token based
    solely on the message.</li>
<li><strong>Auth:</strong> host performs User Authorization via the Payment Handler.</li>
<li><strong>AP2 Integration (Optional):</strong> If <code>ucp.ap2_mandate</code> is active (see
    <strong><a href="https://ap2-extension.org/">AP2 extension</a></strong>), the host generates the
    <code>payment_mandate</code> here using trusted user interface.</li>
</ol>
<h2 id="fulfillment-extension">Fulfillment Extension<a class="headerlink" href="#fulfillment-extension" title="Permanent link">&para;</a></h2>
<p>The fulfillment extension defines how a host can delegate address selection to
provide a native address picker experience. When a checkout URL includes
<code>ec_delegate=fulfillment.address_change</code>, the host gains control over shipping
address selection, providing address updates to the Embedded Checkout in
response.</p>
<h3 id="fulfillment-overview-host-choice">Fulfillment Overview &amp; Host Choice<a class="headerlink" href="#fulfillment-overview-host-choice" title="Permanent link">&para;</a></h3>
<p>Fulfillment delegation allows for two different patterns:</p>
<p><strong>Option A: Host Delegates to Embedded Checkout</strong> The host does NOT include
fulfillment delegation in the URL. The Embedded Checkout handles address input
using its own UI and address forms. This is the standard, non-delegated flow.</p>
<p><strong>Option B: host Takes Control</strong> The host includes
<code>ec_delegate=fulfillment.address_change</code> in the Checkout URL, informing the
Embedded Checkout to delegate address selection UI to the host. When delegated:</p>
<p><strong>Embedded Checkout responsibilities</strong>:</p>
<ul>
<li>Display current shipping address with a change intent (e.g., "Change
    Address" button)</li>
<li>Send <code>ec.fulfillment.address_change_request</code> when the buyer triggers address
    change</li>
<li>Update shipping options based on the address returned by the host</li>
</ul>
<p><strong>Host responsibilities</strong>:</p>
<ul>
<li>Respond to the <code>ec.fulfillment.address_change_request</code> by rendering native
    UI for the buyer to select or enter a shipping address</li>
<li>Respond with the selected address in UCP PostalAddress format</li>
</ul>
<h3 id="fulfillment-message-api-reference">Fulfillment Message API Reference<a class="headerlink" href="#fulfillment-message-api-reference" title="Permanent link">&para;</a></h3>
<h4 id="ecfulfillmentchange"><code>ec.fulfillment.change</code><a class="headerlink" href="#ecfulfillmentchange" title="Permanent link">&para;</a></h4>
<p>Informs the host that the fulfillment details have been changed in the checkout
UI.</p>
<ul>
<li><strong>Direction:</strong> Embedded Checkout  Host</li>
<li><strong>Type:</strong> Notification</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The latest state of the checkout</li>
</ul>
</li>
</ul>
<p><strong>Example Message:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="p">{</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec.fulfillment.change&quot;</span><span class="p">,</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;checkout_123&quot;</span><span class="p">,</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">            </span><span class="c1">// The entire checkout object is provided, including the updated fulfillment details</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">            </span><span class="nt">&quot;fulfillment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w">                </span><span class="cm">/* ... */</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">            </span><span class="c1">// ...</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="ecfulfillmentaddress_change_request"><code>ec.fulfillment.address_change_request</code><a class="headerlink" href="#ecfulfillmentaddress_change_request" title="Permanent link">&para;</a></h4>
<p>Requests the host to present address selection UI for a shipping fulfillment
method.</p>
<ul>
<li><strong>Direction:</strong> Embedded Checkout  Host</li>
<li><strong>Type:</strong> Request</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The latest state of the checkout</li>
</ul>
</li>
</ul>
<p><strong>Example Message:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="p">{</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fulfillment_address_change_request_1&quot;</span><span class="p">,</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec.fulfillment.address_change_request&quot;</span><span class="p">,</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;checkout_123&quot;</span><span class="p">,</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w">            </span><span class="c1">// The entire checkout object is provided, including the current fulfillment details</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">            </span><span class="nt">&quot;fulfillment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">                </span><span class="nt">&quot;methods&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="w">                        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;method_1&quot;</span><span class="p">,</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shipping&quot;</span><span class="p">,</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="w">                        </span><span class="nt">&quot;selected_destination_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;address_123&quot;</span><span class="p">,</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="w">                        </span><span class="nt">&quot;destinations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="w">                            </span><span class="p">{</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="w">                                </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;address_123&quot;</span><span class="p">,</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="w">                                </span><span class="nt">&quot;address_street&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;456 Old Street&quot;</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="w">                                </span><span class="c1">// ...</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="w">                            </span><span class="p">}</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a><span class="w">                        </span><span class="p">]</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a><span class="w">                        </span><span class="c1">// ...</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a><span class="w">                </span><span class="p">]</span>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a><span class="w">            </span><span class="c1">// ...</span>
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a><span class="p">}</span>
</span></code></pre></div>
<p>The host <strong>MUST</strong> respond with either an error, or the newly-selected address.
In successful responses, the host <strong>MUST</strong> respond with an updated
<code>fulfillment.methods</code> object, updating the <code>selected_destination_id</code> and
<code>destinations</code> fields for fulfillment methods, and otherwise preserving the
existing state. The Embedded Checkout <strong>MUST</strong> treat this update as a PUT-style
change by entirely replacing the existing state for <code>fulfillment.methods</code>,
rather than attempting to merge the new data with existing state.</p>
<ul>
<li><strong>Direction:</strong> host  Embedded Checkout</li>
<li><strong>Type:</strong> Response</li>
<li><strong>Payload:</strong><ul>
<li><code>checkout</code>: The update to apply to the checkout object</li>
</ul>
</li>
</ul>
<p><strong>Example Success Response:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="p">{</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fulfillment_address_change_request_1&quot;</span><span class="p">,</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">        </span><span class="nt">&quot;checkout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">            </span><span class="nt">&quot;fulfillment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">                </span><span class="nt">&quot;methods&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">                        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;method_1&quot;</span><span class="p">,</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shipping&quot;</span><span class="p">,</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">                        </span><span class="nt">&quot;selected_destination_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;address_789&quot;</span><span class="p">,</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">                        </span><span class="nt">&quot;destinations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">                            </span><span class="p">{</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">                                </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;address_789&quot;</span><span class="p">,</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">                                </span><span class="nt">&quot;first_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="w">                                </span><span class="nt">&quot;last_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="w">                                </span><span class="nt">&quot;street_address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;123 New Street&quot;</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="w">                            </span><span class="p">}</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="w">                        </span><span class="p">]</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a><span class="w">                </span><span class="p">]</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Example Error Response:</strong></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="p">{</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fulfillment_address_change_request_1&quot;</span><span class="p">,</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">    </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">        </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abort_error&quot;</span><span class="p">,</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">        </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User cancelled address selection.&quot;</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="address-format">Address Format<a class="headerlink" href="#address-format" title="Permanent link">&para;</a></h3>
<p>The address object uses the UCP
<a href="/draft/specification/checkout/#postal-address">PostalAddress</a> format:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Required</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">extended_address</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">An address extension such as an apartment number, C/O or alternative name.</td>
</tr>
<tr>
<td style="text-align: left;">street_address</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The street address.</td>
</tr>
<tr>
<td style="text-align: left;">address_locality</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The locality in which the street address is, and which is in the region. For example, Mountain View.</td>
</tr>
<tr>
<td style="text-align: left;">address_region</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The region in which the locality is, and which is in the country. Required for applicable countries (i.e. state in US, province in CA). For example, California or another appropriate first-level Administrative division.</td>
</tr>
<tr>
<td style="text-align: left;">address_country</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The country. Recommended to be in 2-letter ISO 3166-1 alpha-2 format, for example "US". For backward compatibility, a 3-letter ISO 3166-1 alpha-3 country code such as "SGP" or a full country name such as "Singapore" can also be used.</td>
</tr>
<tr>
<td style="text-align: left;">postal_code</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The postal code. For example, 94043.</td>
</tr>
<tr>
<td style="text-align: left;">first_name</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Optional. First name of the contact associated with the address.</td>
</tr>
<tr>
<td style="text-align: left;">last_name</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Optional. Last name of the contact associated with the address.</td>
</tr>
<tr>
<td style="text-align: left;">phone_number</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Optional. Phone number of the contact associated with the address.</td>
</tr>
</tbody>
</table>
<h2 id="security-error-handling">Security &amp; Error Handling<a class="headerlink" href="#security-error-handling" title="Permanent link">&para;</a></h2>
<h3 id="error-codes">Error Codes<a class="headerlink" href="#error-codes" title="Permanent link">&para;</a></h3>
<p>Responses to delegation request messages from the
embedded checkout may resolve to errors. The message responder <strong>SHOULD</strong> use
error codes mapped to
<strong><a href="https://webidl.spec.whatwg.org/#idl-DOMException">W3C DOMException</a></strong> names
where possible.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Code</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>abort_error</code></td>
<td style="text-align: left;">The user cancelled the interaction (e.g., closed the sheet).</td>
</tr>
<tr>
<td style="text-align: left;"><code>security_error</code></td>
<td style="text-align: left;">The host origin validation failed.</td>
</tr>
<tr>
<td style="text-align: left;"><code>not_supported_error</code></td>
<td style="text-align: left;">The requested payment method is not supported by the host.</td>
</tr>
<tr>
<td style="text-align: left;"><code>invalid_state_error</code></td>
<td style="text-align: left;">Handshake was attempted out of order.</td>
</tr>
<tr>
<td style="text-align: left;"><code>not_allowed_error</code></td>
<td style="text-align: left;">The request was missing valid User Activation (see <a href="#prevention-of-unsolicited-payment-requests">Prevention of Unsolicited Payment Requests</a>).</td>
</tr>
</tbody>
</table>
<h3 id="security-for-web-based-hosts">Security for Web-Based Hosts<a class="headerlink" href="#security-for-web-based-hosts" title="Permanent link">&para;</a></h3>
<h4 id="content-security-policy-csp">Content Security Policy (CSP)<a class="headerlink" href="#content-security-policy-csp" title="Permanent link">&para;</a></h4>
<p>To ensure security, both parties <strong>MUST</strong> implement appropriate
<strong><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">Content Security Policy (CSP)</a></strong>
directives:</p>
<ul>
<li>
<p><strong>Business:</strong> <strong>MUST</strong> set <code>frame-ancestors &lt;host_origin&gt;;</code> to ensure it's
    only embedded by trusted hosts.</p>
</li>
<li>
<p><strong>Host:</strong></p>
<ul>
<li><strong>Direct Embedding:</strong> If the host directly embeds the business's page,
    specifying a <code>frame-src</code> directive listing every potential business
    origin can be impractical, especially if there are many businesses. In
    this scenario, while a strict <code>frame-src</code> is ideal, other security
    measures like those in <a href="#iframe-sandbox-attributes">Iframe Sandbox Attributes</a>
    and <a href="#credentialless-iframes">Credentialless Iframes</a> are critical.</li>
<li><strong>Intermediate Iframe:</strong> The host <strong>MAY</strong> use an intermediate iframe
    (e.g., on a host-controlled subdomain) to embed the business's page.
    This offers better control:<ul>
<li>The host's main page only needs to allow the origin of the
    intermediate iframe in its <code>frame-src</code> (e.g.,
    <code>frame-src &lt;intermediate_iframe_origin&gt;;</code>).</li>
<li>The intermediate iframe <strong>MUST</strong> implement a strict <code>frame-src</code>
    policy, dynamically set to allow <em>only</em> the specific
    <code>&lt;merchant_origin&gt;</code> for the current embedded session (e.g.,
    <code>frame-src &lt;merchant_origin&gt;;</code>). This can be set via HTTP headers
    when serving the intermediate iframe content.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="iframe-sandbox-attributes">Iframe Sandbox Attributes<a class="headerlink" href="#iframe-sandbox-attributes" title="Permanent link">&para;</a></h4>
<p>All business iframes <strong>MUST</strong> be sandboxed to restrict their capabilities. The
following sandbox attributes <strong>SHOULD</strong> be applied, but a host and business
<strong>MAY</strong> negotiate additional capabilities:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">sandbox</span><span class="o">=</span><span class="s">&quot;allow-scripts allow-forms allow-same-origin&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</span></code></pre></div>
<h4 id="credentialless-iframes">Credentialless Iframes<a class="headerlink" href="#credentialless-iframes" title="Permanent link">&para;</a></h4>
<p>Hosts <strong>SHOULD</strong> use the <code>credentialless</code> attribute on the iframe to load it in
a new, ephemeral context. This prevents the business from correlating user
activity across contexts or accessing existing sessions, protecting user
privacy.</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">credentialless</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://business.example.com/checkout&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</span></code></pre></div>
<h4 id="strict-origin-validation">Strict Origin Validation<a class="headerlink" href="#strict-origin-validation" title="Permanent link">&para;</a></h4>
<p>Enforce strict validation of the <code>origin</code> for all <code>postMessage</code> communications
between frames.</p>
<h3 id="prevention-of-unsolicited-payment-requests">Prevention of Unsolicited Payment Requests<a class="headerlink" href="#prevention-of-unsolicited-payment-requests" title="Permanent link">&para;</a></h3>
<p><strong>Vulnerability:</strong> A malicious or compromised business could programmatically
trigger <code>ec.payment.credential_request</code> without user interaction.</p>
<p><strong>Mitigation (Host-Controlled Execution):</strong> To eliminate this risk, the host is
designated as the sole trusted initiator of the payment execution. The host
SHOULD display a User Confirmation UI before releasing the token. Silent
tokenization is strictly PROHIBITED when the trigger originates from the
Embedded Checkout.</p>
<h2 id="schema-definitions">Schema Definitions<a class="headerlink" href="#schema-definitions" title="Permanent link">&para;</a></h2>
<p>The following schemas define the data structures used within the Embedded
Checkout protocol and its extensions.</p>
<h3 id="checkout">Checkout<a class="headerlink" href="#checkout" title="Permanent link">&para;</a></h3>
<p>The core object representing the current state of the transaction, including
line items, totals, and buyer information.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Required</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">ucp</td>
<td style="text-align: left;"><a href="/draft/specification/checkout/#ucp-response-checkout-schema">UCP Response Checkout Schema</a></td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields.</td>
</tr>
<tr>
<td style="text-align: left;">id</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">Unique identifier of the checkout session.</td>
</tr>
<tr>
<td style="text-align: left;">line_items</td>
<td style="text-align: left;">Array[<a href="/draft/specification/checkout/#line-item-response">Line Item Response</a>]</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">List of line items being checked out.</td>
</tr>
<tr>
<td style="text-align: left;">buyer</td>
<td style="text-align: left;"><a href="/draft/specification/checkout/#buyer">Buyer</a></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Representation of the buyer.</td>
</tr>
<tr>
<td style="text-align: left;">status</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">Checkout state indicating the current phase and required action. See Checkout Status lifecycle documentation for state transition details.<br><strong>Enum:</strong> <code>incomplete</code>, <code>requires_escalation</code>, <code>ready_for_complete</code>, <code>complete_in_progress</code>, <code>completed</code>, <code>canceled</code></td>
</tr>
<tr>
<td style="text-align: left;">currency</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">ISO 4217 currency code reflecting the merchant's market determination. Derived from address, context, and geo IPbuyers provide signals, merchants determine currency.</td>
</tr>
<tr>
<td style="text-align: left;">totals</td>
<td style="text-align: left;">Array[<a href="/draft/specification/checkout/#total-response">Total Response</a>]</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">Different cart totals.</td>
</tr>
<tr>
<td style="text-align: left;">messages</td>
<td style="text-align: left;">Array[<a href="/draft/specification/checkout/#message">Message</a>]</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">List of messages with error and info about the checkout session state.</td>
</tr>
<tr>
<td style="text-align: left;">links</td>
<td style="text-align: left;">Array[<a href="/draft/specification/checkout/#link">Link</a>]</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">Links to be displayed by the platform (Privacy Policy, TOS). Mandatory for legal compliance.</td>
</tr>
<tr>
<td style="text-align: left;">expires_at</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">RFC 3339 expiry timestamp. Default TTL is 6 hours from creation if not sent.</td>
</tr>
<tr>
<td style="text-align: left;">continue_url</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">URL for checkout handoff and session recovery. MUST be provided when status is requires_escalation. See specification for format and availability requirements.</td>
</tr>
<tr>
<td style="text-align: left;">payment</td>
<td style="text-align: left;"><a href="/draft/specification/checkout/#payment">Payment</a></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Payment configuration containing handlers.</td>
</tr>
<tr>
<td style="text-align: left;">order</td>
<td style="text-align: left;"><a href="/draft/specification/checkout/#order-confirmation">Order Confirmation</a></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Details about an order created for this checkout session.</td>
</tr>
</tbody>
</table>
<h3 id="order">Order<a class="headerlink" href="#order" title="Permanent link">&para;</a></h3>
<p>The object returned upon successful completion of a checkout, containing
confirmation details.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Required</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">ucp</td>
<td style="text-align: left;"><a href="/draft/specification/order/#ucp-response-order-schema">UCP Response Order Schema</a></td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">Protocol metadata for discovery profiles and responses. Uses slim schema pattern with context-specific required fields.</td>
</tr>
<tr>
<td style="text-align: left;">id</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">Unique order identifier.</td>
</tr>
<tr>
<td style="text-align: left;">checkout_id</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">Associated checkout ID for reconciliation.</td>
</tr>
<tr>
<td style="text-align: left;">permalink_url</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">Permalink to access the order on merchant site.</td>
</tr>
<tr>
<td style="text-align: left;">line_items</td>
<td style="text-align: left;">Array[<a href="/draft/specification/order/#order-line-item">Order Line Item</a>]</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">Immutable line items  source of truth for what was ordered.</td>
</tr>
<tr>
<td style="text-align: left;">fulfillment</td>
<td style="text-align: left;">object</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">Fulfillment data: buyer expectations and what actually happened.</td>
</tr>
<tr>
<td style="text-align: left;">adjustments</td>
<td style="text-align: left;">Array[<a href="/draft/specification/order/#adjustment">Adjustment</a>]</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Append-only event log of money movements (refunds, returns, credits, disputes, cancellations, etc.) that exist independently of fulfillment.</td>
</tr>
<tr>
<td style="text-align: left;">totals</td>
<td style="text-align: left;">Array[<a href="/draft/specification/order/#total-response">Total Response</a>]</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">Different totals for the order.</td>
</tr>
</tbody>
</table>
<h3 id="payment">Payment<a class="headerlink" href="#payment" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Required</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">instruments</td>
<td style="text-align: left;">Array[<a href="/draft/specification/embedded-checkout/#selected-payment-instrument">Selected Payment Instrument</a>]</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The payment instruments available for this payment. Each instrument is associated with a specific handler via the handler_id field. Handlers can extend the base payment_instrument schema to add handler-specific fields.</td>
</tr>
</tbody>
</table>
<h3 id="payment-instrument">Payment Instrument<a class="headerlink" href="#payment-instrument" title="Permanent link">&para;</a></h3>
<p>Represents a specific method of payment (e.g., a specific credit card, bank
account, or wallet credential) available to the buyer.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Required</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">id</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">A unique identifier for this instrument instance, assigned by the platform.</td>
</tr>
<tr>
<td style="text-align: left;">handler_id</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">The unique identifier for the handler instance that produced this instrument. This corresponds to the 'id' field in the Payment Handler definition.</td>
</tr>
<tr>
<td style="text-align: left;">type</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;"><strong>Yes</strong></td>
<td style="text-align: left;">The broad category of the instrument (e.g., 'card', 'tokenized_card'). Specific schemas will constrain this to a constant value.</td>
</tr>
<tr>
<td style="text-align: left;">billing_address</td>
<td style="text-align: left;"><a href="/draft/specification/embedded-checkout/#postal-address">Postal Address</a></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The billing address associated with this payment method.</td>
</tr>
<tr>
<td style="text-align: left;">credential</td>
<td style="text-align: left;"><a href="/draft/specification/embedded-checkout/#payment-credential">Payment Credential</a></td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">The base definition for any payment credential. Handlers define specific credential types.</td>
</tr>
<tr>
<td style="text-align: left;">display</td>
<td style="text-align: left;">object</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Display information for this payment instrument. Each payment instrument schema defines its specific display properties, as outlined by the payment handler.</td>
</tr>
</tbody>
</table>
<h3 id="payment-handler-response">Payment Handler Response<a class="headerlink" href="#payment-handler-response" title="Permanent link">&para;</a></h3>
<p>Represents the processor or wallet provider responsible for authenticating and
processing a specific payment instrument (e.g., Google Pay, Stripe, or a Bank
App).</p>
<p><em>No properties defined.</em></p>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../checkout-a2a/" class="md-footer__link md-footer__link--prev" aria-label="Previous: A2A Binding">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                A2A Binding
              </div>
            </div>
          </a>
        
        
          
          <a href="../ap2-mandates/" class="md-footer__link md-footer__link--next" aria-label="Next: AP2 Mandates Extension">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                AP2 Mandates Extension
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright 2026 UCP Authors. Licensed under the <a href="https://github.com/Universal-Commerce-Protocol/ucp/blob/main/LICENSE">Apache License, Version 2.0</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.progress", "navigation.path", "navigation.top", "navigation.tracking", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>